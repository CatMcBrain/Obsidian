"use strict";const N=require("obsidian"),Ua={baseURL:"ticktick.com",automaticSynchronizationInterval:300,enableFullVaultSync:!1,tagAndOr:1,debugMode:!1,logLevel:"info",SyncProject:"",SyncTag:"",defaultProjectId:"",defaultProjectName:"Inbox",TickTickTasksFilePath:"/",keepProjectFolders:!1,syncNotes:!0,fileLinksInTickTick:"taskLink",taskLinksInObsidian:"taskLink",inboxID:"",inboxName:"Inbox",checkPoint:0,fileMetadata:{},TickTickTasksData:{projects:[],tasks:[]}};let St={...Ua};const _=()=>St,ge=s=>(St={...St,...s},_()),Ai=()=>St.TickTickTasksData.projects,qa=s=>(St.TickTickTasksData.projects=s,Ai()),ze=()=>St.TickTickTasksData.tasks,si=s=>(St.TickTickTasksData.tasks=s,ze()),Fl=()=>St.TickTickTasksData.projectGroups,Ha=s=>(St.TickTickTasksData.projectGroups=s,Fl());function Ka(s){return s&&s.__esModule&&Object.prototype.hasOwnProperty.call(s,"default")?s.default:s}var Zi={exports:{}},xl=Zi.exports,Wr;function Ml(){return Wr||(Wr=1,function(s,e){(function(t,i){var n="1.0.40",r="",a="?",o="function",l="undefined",c="object",d="string",g="major",f="model",u="name",p="type",h="vendor",m="version",k="architecture",T="console",w="mobile",v="tablet",b="smarttv",I="wearable",O="embedded",E=500,L="Amazon",A="Apple",S="ASUS",C="BlackBerry",F="Browser",V="Chrome",Q="Edge",K="Firefox",G="Google",re="Huawei",he="LG",ue="Microsoft",Y="Motorola",fe="Opera",X="Samsung",ie="Sharp",se="Sony",Z="Xiaomi",$="Zebra",ve="Facebook",Ee="Chromium OS",R="Mac OS",Ue=" Browser",Ct=function(H,W){var j={};for(var B in H)W[B]&&W[B].length%2===0?j[B]=W[B].concat(H[B]):j[B]=H[B];return j},Pe=function(H){for(var W={},j=0;j<H.length;j++)W[H[j].toUpperCase()]=H[j];return W},Qe=function(H,W){return typeof H===d?Oe(W).indexOf(Oe(H))!==-1:!1},Oe=function(H){return H.toLowerCase()},ft=function(H){return typeof H===d?H.replace(/[^\d\.]/g,r).split(".")[0]:i},Ze=function(H,W){if(typeof H===d)return H=H.replace(/^\s\s*/,r),typeof W===l?H:H.substring(0,E)},qe=function(H,W){for(var j=0,B,_e,Ke,ee,U,bt;j<W.length&&!U;){var xn=W[j],Gr=W[j+1];for(B=_e=0;B<xn.length&&!U&&xn[B];)if(U=xn[B++].exec(H),U)for(Ke=0;Ke<Gr.length;Ke++)bt=U[++_e],ee=Gr[Ke],typeof ee===c&&ee.length>0?ee.length===2?typeof ee[1]==o?this[ee[0]]=ee[1].call(this,bt):this[ee[0]]=ee[1]:ee.length===3?typeof ee[1]===o&&!(ee[1].exec&&ee[1].test)?this[ee[0]]=bt?ee[1].call(this,bt,ee[2]):i:this[ee[0]]=bt?bt.replace(ee[1],ee[2]):i:ee.length===4&&(this[ee[0]]=bt?ee[3].call(this,bt.replace(ee[1],ee[2])):i):this[ee]=bt||i;j+=2}},wt=function(H,W){for(var j in W)if(typeof W[j]===c&&W[j].length>0){for(var B=0;B<W[j].length;B++)if(Qe(W[j][B],H))return j===a?i:j}else if(Qe(W[j],H))return j===a?i:j;return W.hasOwnProperty("*")?W["*"]:H},de={"1.0":"/8","1.2":"/1","1.3":"/3","2.0":"/412","2.0.2":"/416","2.0.3":"/417","2.0.4":"/419","?":"/"},Ne={ME:"4.90","NT 3.11":"NT3.51","NT 4.0":"NT4.0",2e3:"NT 5.0",XP:["NT 5.1","NT 5.2"],Vista:"NT 6.0",7:"NT 6.1",8:"NT 6.2","8.1":"NT 6.3",10:["NT 6.4","NT 10.0"],RT:"ARM"},dt={browser:[[/\b(?:crmo|crios)\/([\w\.]+)/i],[m,[u,"Chrome"]],[/edg(?:e|ios|a)?\/([\w\.]+)/i],[m,[u,"Edge"]],[/(opera mini)\/([-\w\.]+)/i,/(opera [mobiletab]{3,6})\b.+version\/([-\w\.]+)/i,/(opera)(?:.+version\/|[\/ ]+)([\w\.]+)/i],[u,m],[/opios[\/ ]+([\w\.]+)/i],[m,[u,fe+" Mini"]],[/\bop(?:rg)?x\/([\w\.]+)/i],[m,[u,fe+" GX"]],[/\bopr\/([\w\.]+)/i],[m,[u,fe]],[/\bb[ai]*d(?:uhd|[ub]*[aekoprswx]{5,6})[\/ ]?([\w\.]+)/i],[m,[u,"Baidu"]],[/\b(?:mxbrowser|mxios|myie2)\/?([-\w\.]*)\b/i],[m,[u,"Maxthon"]],[/(kindle)\/([\w\.]+)/i,/(lunascape|maxthon|netfront|jasmine|blazer|sleipnir)[\/ ]?([\w\.]*)/i,/(avant|iemobile|slim(?:browser|boat|jet))[\/ ]?([\d\.]*)/i,/(?:ms|\()(ie) ([\w\.]+)/i,/(flock|rockmelt|midori|epiphany|silk|skyfire|ovibrowser|bolt|iron|vivaldi|iridium|phantomjs|bowser|qupzilla|falkon|rekonq|puffin|brave|whale(?!.+naver)|qqbrowserlite|duckduckgo|klar|helio|(?=comodo_)?dragon)\/([-\w\.]+)/i,/(heytap|ovi|115)browser\/([\d\.]+)/i,/(weibo)__([\d\.]+)/i],[u,m],[/quark(?:pc)?\/([-\w\.]+)/i],[m,[u,"Quark"]],[/\bddg\/([\w\.]+)/i],[m,[u,"DuckDuckGo"]],[/(?:\buc? ?browser|(?:juc.+)ucweb)[\/ ]?([\w\.]+)/i],[m,[u,"UC"+F]],[/microm.+\bqbcore\/([\w\.]+)/i,/\bqbcore\/([\w\.]+).+microm/i,/micromessenger\/([\w\.]+)/i],[m,[u,"WeChat"]],[/konqueror\/([\w\.]+)/i],[m,[u,"Konqueror"]],[/trident.+rv[: ]([\w\.]{1,9})\b.+like gecko/i],[m,[u,"IE"]],[/ya(?:search)?browser\/([\w\.]+)/i],[m,[u,"Yandex"]],[/slbrowser\/([\w\.]+)/i],[m,[u,"Smart Lenovo "+F]],[/(avast|avg)\/([\w\.]+)/i],[[u,/(.+)/,"$1 Secure "+F],m],[/\bfocus\/([\w\.]+)/i],[m,[u,K+" Focus"]],[/\bopt\/([\w\.]+)/i],[m,[u,fe+" Touch"]],[/coc_coc\w+\/([\w\.]+)/i],[m,[u,"Coc Coc"]],[/dolfin\/([\w\.]+)/i],[m,[u,"Dolphin"]],[/coast\/([\w\.]+)/i],[m,[u,fe+" Coast"]],[/miuibrowser\/([\w\.]+)/i],[m,[u,"MIUI"+Ue]],[/fxios\/([\w\.-]+)/i],[m,[u,K]],[/\bqihoobrowser\/?([\w\.]*)/i],[m,[u,"360"]],[/\b(qq)\/([\w\.]+)/i],[[u,/(.+)/,"$1Browser"],m],[/(oculus|sailfish|huawei|vivo|pico)browser\/([\w\.]+)/i],[[u,/(.+)/,"$1"+Ue],m],[/samsungbrowser\/([\w\.]+)/i],[m,[u,X+" Internet"]],[/metasr[\/ ]?([\d\.]+)/i],[m,[u,"Sogou Explorer"]],[/(sogou)mo\w+\/([\d\.]+)/i],[[u,"Sogou Mobile"],m],[/(electron)\/([\w\.]+) safari/i,/(tesla)(?: qtcarbrowser|\/(20\d\d\.[-\w\.]+))/i,/m?(qqbrowser|2345(?=browser|chrome|explorer))\w*[\/ ]?v?([\w\.]+)/i],[u,m],[/(lbbrowser|rekonq)/i,/\[(linkedin)app\]/i],[u],[/ome\/([\w\.]+) \w* ?(iron) saf/i,/ome\/([\w\.]+).+qihu (360)[es]e/i],[m,u],[/((?:fban\/fbios|fb_iab\/fb4a)(?!.+fbav)|;fbav\/([\w\.]+);)/i],[[u,ve],m],[/(Klarna)\/([\w\.]+)/i,/(kakao(?:talk|story))[\/ ]([\w\.]+)/i,/(naver)\(.*?(\d+\.[\w\.]+).*\)/i,/safari (line)\/([\w\.]+)/i,/\b(line)\/([\w\.]+)\/iab/i,/(alipay)client\/([\w\.]+)/i,/(twitter)(?:and| f.+e\/([\w\.]+))/i,/(chromium|instagram|snapchat)[\/ ]([-\w\.]+)/i],[u,m],[/\bgsa\/([\w\.]+) .*safari\//i],[m,[u,"GSA"]],[/musical_ly(?:.+app_?version\/|_)([\w\.]+)/i],[m,[u,"TikTok"]],[/headlesschrome(?:\/([\w\.]+)| )/i],[m,[u,V+" Headless"]],[/ wv\).+(chrome)\/([\w\.]+)/i],[[u,V+" WebView"],m],[/droid.+ version\/([\w\.]+)\b.+(?:mobile safari|safari)/i],[m,[u,"Android "+F]],[/(chrome|omniweb|arora|[tizenoka]{5} ?browser)\/v?([\w\.]+)/i],[u,m],[/version\/([\w\.\,]+) .*mobile\/\w+ (safari)/i],[m,[u,"Mobile Safari"]],[/version\/([\w(\.|\,)]+) .*(mobile ?safari|safari)/i],[m,u],[/webkit.+?(mobile ?safari|safari)(\/[\w\.]+)/i],[u,[m,wt,de]],[/(webkit|khtml)\/([\w\.]+)/i],[u,m],[/(navigator|netscape\d?)\/([-\w\.]+)/i],[[u,"Netscape"],m],[/(wolvic|librewolf)\/([\w\.]+)/i],[u,m],[/mobile vr; rv:([\w\.]+)\).+firefox/i],[m,[u,K+" Reality"]],[/ekiohf.+(flow)\/([\w\.]+)/i,/(swiftfox)/i,/(icedragon|iceweasel|camino|chimera|fennec|maemo browser|minimo|conkeror)[\/ ]?([\w\.\+]+)/i,/(seamonkey|k-meleon|icecat|iceape|firebird|phoenix|palemoon|basilisk|waterfox)\/([-\w\.]+)$/i,/(firefox)\/([\w\.]+)/i,/(mozilla)\/([\w\.]+) .+rv\:.+gecko\/\d+/i,/(polaris|lynx|dillo|icab|doris|amaya|w3m|netsurf|obigo|mosaic|(?:go|ice|up)[\. ]?browser)[-\/ ]?v?([\w\.]+)/i,/(links) \(([\w\.]+)/i],[u,[m,/_/g,"."]],[/(cobalt)\/([\w\.]+)/i],[u,[m,/master.|lts./,""]]],cpu:[[/(?:(amd|x(?:(?:86|64)[-_])?|wow|win)64)[;\)]/i],[[k,"amd64"]],[/(ia32(?=;))/i],[[k,Oe]],[/((?:i[346]|x)86)[;\)]/i],[[k,"ia32"]],[/\b(aarch64|arm(v?8e?l?|_?64))\b/i],[[k,"arm64"]],[/\b(arm(?:v[67])?ht?n?[fl]p?)\b/i],[[k,"armhf"]],[/windows (ce|mobile); ppc;/i],[[k,"arm"]],[/((?:ppc|powerpc)(?:64)?)(?: mac|;|\))/i],[[k,/ower/,r,Oe]],[/(sun4\w)[;\)]/i],[[k,"sparc"]],[/((?:avr32|ia64(?=;))|68k(?=\))|\barm(?=v(?:[1-7]|[5-7]1)l?|;|eabi)|(?=atmel )avr|(?:irix|mips|sparc)(?:64)?\b|pa-risc)/i],[[k,Oe]]],device:[[/\b(sch-i[89]0\d|shw-m380s|sm-[ptx]\w{2,4}|gt-[pn]\d{2,4}|sgh-t8[56]9|nexus 10)/i],[f,[h,X],[p,v]],[/\b((?:s[cgp]h|gt|sm)-(?![lr])\w+|sc[g-]?[\d]+a?|galaxy nexus)/i,/samsung[- ]((?!sm-[lr])[-\w]+)/i,/sec-(sgh\w+)/i],[f,[h,X],[p,w]],[/(?:\/|\()(ip(?:hone|od)[\w, ]*)(?:\/|;)/i],[f,[h,A],[p,w]],[/\((ipad);[-\w\),; ]+apple/i,/applecoremedia\/[\w\.]+ \((ipad)/i,/\b(ipad)\d\d?,\d\d?[;\]].+ios/i],[f,[h,A],[p,v]],[/(macintosh);/i],[f,[h,A]],[/\b(sh-?[altvz]?\d\d[a-ekm]?)/i],[f,[h,ie],[p,w]],[/(?:honor)([-\w ]+)[;\)]/i],[f,[h,"Honor"],[p,w]],[/\b((?:ag[rs][23]?|bah2?|sht?|btv)-a?[lw]\d{2})\b(?!.+d\/s)/i],[f,[h,re],[p,v]],[/(?:huawei)([-\w ]+)[;\)]/i,/\b(nexus 6p|\w{2,4}e?-[atu]?[ln][\dx][012359c][adn]?)\b(?!.+d\/s)/i],[f,[h,re],[p,w]],[/\b(poco[\w ]+|m2\d{3}j\d\d[a-z]{2})(?: bui|\))/i,/\b; (\w+) build\/hm\1/i,/\b(hm[-_ ]?note?[_ ]?(?:\d\w)?) bui/i,/\b(redmi[\-_ ]?(?:note|k)?[\w_ ]+)(?: bui|\))/i,/oid[^\)]+; (m?[12][0-389][01]\w{3,6}[c-y])( bui|; wv|\))/i,/\b(mi[-_ ]?(?:a\d|one|one[_ ]plus|note lte|max|cc)?[_ ]?(?:\d?\w?)[_ ]?(?:plus|se|lite|pro)?)(?: bui|\))/i],[[f,/_/g," "],[h,Z],[p,w]],[/oid[^\)]+; (2\d{4}(283|rpbf)[cgl])( bui|\))/i,/\b(mi[-_ ]?(?:pad)(?:[\w_ ]+))(?: bui|\))/i],[[f,/_/g," "],[h,Z],[p,v]],[/; (\w+) bui.+ oppo/i,/\b(cph[12]\d{3}|p(?:af|c[al]|d\w|e[ar])[mt]\d0|x9007|a101op)\b/i],[f,[h,"OPPO"],[p,w]],[/\b(opd2\d{3}a?) bui/i],[f,[h,"OPPO"],[p,v]],[/vivo (\w+)(?: bui|\))/i,/\b(v[12]\d{3}\w?[at])(?: bui|;)/i],[f,[h,"Vivo"],[p,w]],[/\b(rmx[1-3]\d{3})(?: bui|;|\))/i],[f,[h,"Realme"],[p,w]],[/\b(milestone|droid(?:[2-4x]| (?:bionic|x2|pro|razr))?:?( 4g)?)\b[\w ]+build\//i,/\bmot(?:orola)?[- ](\w*)/i,/((?:moto[\w\(\) ]+|xt\d{3,4}|nexus 6)(?= bui|\)))/i],[f,[h,Y],[p,w]],[/\b(mz60\d|xoom[2 ]{0,2}) build\//i],[f,[h,Y],[p,v]],[/((?=lg)?[vl]k\-?\d{3}) bui| 3\.[-\w; ]{10}lg?-([06cv9]{3,4})/i],[f,[h,he],[p,v]],[/(lm(?:-?f100[nv]?|-[\w\.]+)(?= bui|\))|nexus [45])/i,/\blg[-e;\/ ]+((?!browser|netcast|android tv)\w+)/i,/\blg-?([\d\w]+) bui/i],[f,[h,he],[p,w]],[/(ideatab[-\w ]+)/i,/lenovo ?(s[56]000[-\w]+|tab(?:[\w ]+)|yt[-\d\w]{6}|tb[-\d\w]{6})/i],[f,[h,"Lenovo"],[p,v]],[/(?:maemo|nokia).*(n900|lumia \d+)/i,/nokia[-_ ]?([-\w\.]*)/i],[[f,/_/g," "],[h,"Nokia"],[p,w]],[/(pixel c)\b/i],[f,[h,G],[p,v]],[/droid.+; (pixel[\daxl ]{0,6})(?: bui|\))/i],[f,[h,G],[p,w]],[/droid.+; (a?\d[0-2]{2}so|[c-g]\d{4}|so[-gl]\w+|xq-a\w[4-7][12])(?= bui|\).+chrome\/(?![1-6]{0,1}\d\.))/i],[f,[h,se],[p,w]],[/sony tablet [ps]/i,/\b(?:sony)?sgp\w+(?: bui|\))/i],[[f,"Xperia Tablet"],[h,se],[p,v]],[/ (kb2005|in20[12]5|be20[12][59])\b/i,/(?:one)?(?:plus)? (a\d0\d\d)(?: b|\))/i],[f,[h,"OnePlus"],[p,w]],[/(alexa)webm/i,/(kf[a-z]{2}wi|aeo(?!bc)\w\w)( bui|\))/i,/(kf[a-z]+)( bui|\)).+silk\//i],[f,[h,L],[p,v]],[/((?:sd|kf)[0349hijorstuw]+)( bui|\)).+silk\//i],[[f,/(.+)/g,"Fire Phone $1"],[h,L],[p,w]],[/(playbook);[-\w\),; ]+(rim)/i],[f,h,[p,v]],[/\b((?:bb[a-f]|st[hv])100-\d)/i,/\(bb10; (\w+)/i],[f,[h,C],[p,w]],[/(?:\b|asus_)(transfo[prime ]{4,10} \w+|eeepc|slider \w+|nexus 7|padfone|p00[cj])/i],[f,[h,S],[p,v]],[/ (z[bes]6[027][012][km][ls]|zenfone \d\w?)\b/i],[f,[h,S],[p,w]],[/(nexus 9)/i],[f,[h,"HTC"],[p,v]],[/(htc)[-;_ ]{1,2}([\w ]+(?=\)| bui)|\w+)/i,/(zte)[- ]([\w ]+?)(?: bui|\/|\))/i,/(alcatel|geeksphone|nexian|panasonic(?!(?:;|\.))|sony(?!-bra))[-_ ]?([-\w]*)/i],[h,[f,/_/g," "],[p,w]],[/droid [\w\.]+; ((?:8[14]9[16]|9(?:0(?:48|60|8[01])|1(?:3[27]|66)|2(?:6[69]|9[56])|466))[gqswx])\w*(\)| bui)/i],[f,[h,"TCL"],[p,v]],[/(itel) ((\w+))/i],[[h,Oe],f,[p,wt,{tablet:["p10001l","w7001"],"*":"mobile"}]],[/droid.+; ([ab][1-7]-?[0178a]\d\d?)/i],[f,[h,"Acer"],[p,v]],[/droid.+; (m[1-5] note) bui/i,/\bmz-([-\w]{2,})/i],[f,[h,"Meizu"],[p,w]],[/; ((?:power )?armor(?:[\w ]{0,8}))(?: bui|\))/i],[f,[h,"Ulefone"],[p,w]],[/; (energy ?\w+)(?: bui|\))/i,/; energizer ([\w ]+)(?: bui|\))/i],[f,[h,"Energizer"],[p,w]],[/; cat (b35);/i,/; (b15q?|s22 flip|s48c|s62 pro)(?: bui|\))/i],[f,[h,"Cat"],[p,w]],[/((?:new )?andromax[\w- ]+)(?: bui|\))/i],[f,[h,"Smartfren"],[p,w]],[/droid.+; (a(?:015|06[35]|142p?))/i],[f,[h,"Nothing"],[p,w]],[/(blackberry|benq|palm(?=\-)|sonyericsson|acer|asus|dell|meizu|motorola|polytron|infinix|tecno|micromax|advan)[-_ ]?([-\w]*)/i,/; (imo) ((?!tab)[\w ]+?)(?: bui|\))/i,/(hp) ([\w ]+\w)/i,/(asus)-?(\w+)/i,/(microsoft); (lumia[\w ]+)/i,/(lenovo)[-_ ]?([-\w]+)/i,/(jolla)/i,/(oppo) ?([\w ]+) bui/i],[h,f,[p,w]],[/(imo) (tab \w+)/i,/(kobo)\s(ereader|touch)/i,/(archos) (gamepad2?)/i,/(hp).+(touchpad(?!.+tablet)|tablet)/i,/(kindle)\/([\w\.]+)/i,/(nook)[\w ]+build\/(\w+)/i,/(dell) (strea[kpr\d ]*[\dko])/i,/(le[- ]+pan)[- ]+(\w{1,9}) bui/i,/(trinity)[- ]*(t\d{3}) bui/i,/(gigaset)[- ]+(q\w{1,9}) bui/i,/(vodafone) ([\w ]+)(?:\)| bui)/i],[h,f,[p,v]],[/(surface duo)/i],[f,[h,ue],[p,v]],[/droid [\d\.]+; (fp\du?)(?: b|\))/i],[f,[h,"Fairphone"],[p,w]],[/(u304aa)/i],[f,[h,"AT&T"],[p,w]],[/\bsie-(\w*)/i],[f,[h,"Siemens"],[p,w]],[/\b(rct\w+) b/i],[f,[h,"RCA"],[p,v]],[/\b(venue[\d ]{2,7}) b/i],[f,[h,"Dell"],[p,v]],[/\b(q(?:mv|ta)\w+) b/i],[f,[h,"Verizon"],[p,v]],[/\b(?:barnes[& ]+noble |bn[rt])([\w\+ ]*) b/i],[f,[h,"Barnes & Noble"],[p,v]],[/\b(tm\d{3}\w+) b/i],[f,[h,"NuVision"],[p,v]],[/\b(k88) b/i],[f,[h,"ZTE"],[p,v]],[/\b(nx\d{3}j) b/i],[f,[h,"ZTE"],[p,w]],[/\b(gen\d{3}) b.+49h/i],[f,[h,"Swiss"],[p,w]],[/\b(zur\d{3}) b/i],[f,[h,"Swiss"],[p,v]],[/\b((zeki)?tb.*\b) b/i],[f,[h,"Zeki"],[p,v]],[/\b([yr]\d{2}) b/i,/\b(dragon[- ]+touch |dt)(\w{5}) b/i],[[h,"Dragon Touch"],f,[p,v]],[/\b(ns-?\w{0,9}) b/i],[f,[h,"Insignia"],[p,v]],[/\b((nxa|next)-?\w{0,9}) b/i],[f,[h,"NextBook"],[p,v]],[/\b(xtreme\_)?(v(1[045]|2[015]|[3469]0|7[05])) b/i],[[h,"Voice"],f,[p,w]],[/\b(lvtel\-)?(v1[12]) b/i],[[h,"LvTel"],f,[p,w]],[/\b(ph-1) /i],[f,[h,"Essential"],[p,w]],[/\b(v(100md|700na|7011|917g).*\b) b/i],[f,[h,"Envizen"],[p,v]],[/\b(trio[-\w\. ]+) b/i],[f,[h,"MachSpeed"],[p,v]],[/\btu_(1491) b/i],[f,[h,"Rotor"],[p,v]],[/(shield[\w ]+) b/i],[f,[h,"Nvidia"],[p,v]],[/(sprint) (\w+)/i],[h,f,[p,w]],[/(kin\.[onetw]{3})/i],[[f,/\./g," "],[h,ue],[p,w]],[/droid.+; (cc6666?|et5[16]|mc[239][23]x?|vc8[03]x?)\)/i],[f,[h,$],[p,v]],[/droid.+; (ec30|ps20|tc[2-8]\d[kx])\)/i],[f,[h,$],[p,w]],[/smart-tv.+(samsung)/i],[h,[p,b]],[/hbbtv.+maple;(\d+)/i],[[f,/^/,"SmartTV"],[h,X],[p,b]],[/(nux; netcast.+smarttv|lg (netcast\.tv-201\d|android tv))/i],[[h,he],[p,b]],[/(apple) ?tv/i],[h,[f,A+" TV"],[p,b]],[/crkey/i],[[f,V+"cast"],[h,G],[p,b]],[/droid.+aft(\w+)( bui|\))/i],[f,[h,L],[p,b]],[/\(dtv[\);].+(aquos)/i,/(aquos-tv[\w ]+)\)/i],[f,[h,ie],[p,b]],[/(bravia[\w ]+)( bui|\))/i],[f,[h,se],[p,b]],[/(mitv-\w{5}) bui/i],[f,[h,Z],[p,b]],[/Hbbtv.*(technisat) (.*);/i],[h,f,[p,b]],[/\b(roku)[\dx]*[\)\/]((?:dvp-)?[\d\.]*)/i,/hbbtv\/\d+\.\d+\.\d+ +\([\w\+ ]*; *([\w\d][^;]*);([^;]*)/i],[[h,Ze],[f,Ze],[p,b]],[/\b(android tv|smart[- ]?tv|opera tv|tv; rv:)\b/i],[[p,b]],[/(ouya)/i,/(nintendo) ([wids3utch]+)/i],[h,f,[p,T]],[/droid.+; (shield) bui/i],[f,[h,"Nvidia"],[p,T]],[/(playstation [345portablevi]+)/i],[f,[h,se],[p,T]],[/\b(xbox(?: one)?(?!; xbox))[\); ]/i],[f,[h,ue],[p,T]],[/\b(sm-[lr]\d\d[05][fnuw]?s?)\b/i],[f,[h,X],[p,I]],[/((pebble))app/i],[h,f,[p,I]],[/(watch)(?: ?os[,\/]|\d,\d\/)[\d\.]+/i],[f,[h,A],[p,I]],[/droid.+; (glass) \d/i],[f,[h,G],[p,I]],[/droid.+; (wt63?0{2,3})\)/i],[f,[h,$],[p,I]],[/droid.+; (glass) \d/i],[f,[h,G],[p,I]],[/(pico) (4|neo3(?: link|pro)?)/i],[h,f,[p,I]],[/; (quest( \d| pro)?)/i],[f,[h,ve],[p,I]],[/(tesla)(?: qtcarbrowser|\/[-\w\.]+)/i],[h,[p,O]],[/(aeobc)\b/i],[f,[h,L],[p,O]],[/droid .+?; ([^;]+?)(?: bui|; wv\)|\) applew).+? mobile safari/i],[f,[p,w]],[/droid .+?; ([^;]+?)(?: bui|\) applew).+?(?! mobile) safari/i],[f,[p,v]],[/\b((tablet|tab)[;\/]|focus\/\d(?!.+mobile))/i],[[p,v]],[/(phone|mobile(?:[;\/]| [ \w\/\.]*safari)|pda(?=.+windows ce))/i],[[p,w]],[/(android[-\w\. ]{0,9});.+buil/i],[f,[h,"Generic"]]],engine:[[/windows.+ edge\/([\w\.]+)/i],[m,[u,Q+"HTML"]],[/(arkweb)\/([\w\.]+)/i],[u,m],[/webkit\/537\.36.+chrome\/(?!27)([\w\.]+)/i],[m,[u,"Blink"]],[/(presto)\/([\w\.]+)/i,/(webkit|trident|netfront|netsurf|amaya|lynx|w3m|goanna|servo)\/([\w\.]+)/i,/ekioh(flow)\/([\w\.]+)/i,/(khtml|tasman|links)[\/ ]\(?([\w\.]+)/i,/(icab)[\/ ]([23]\.[\d\.]+)/i,/\b(libweb)/i],[u,m],[/rv\:([\w\.]{1,9})\b.+(gecko)/i],[m,u]],os:[[/microsoft (windows) (vista|xp)/i],[u,m],[/(windows (?:phone(?: os)?|mobile))[\/ ]?([\d\.\w ]*)/i],[u,[m,wt,Ne]],[/windows nt 6\.2; (arm)/i,/windows[\/ ]?([ntce\d\. ]+\w)(?!.+xbox)/i,/(?:win(?=3|9|n)|win 9x )([nt\d\.]+)/i],[[m,wt,Ne],[u,"Windows"]],[/ip[honead]{2,4}\b(?:.*os ([\w]+) like mac|; opera)/i,/(?:ios;fbsv\/|iphone.+ios[\/ ])([\d\.]+)/i,/cfnetwork\/.+darwin/i],[[m,/_/g,"."],[u,"iOS"]],[/(mac os x) ?([\w\. ]*)/i,/(macintosh|mac_powerpc\b)(?!.+haiku)/i],[[u,R],[m,/_/g,"."]],[/droid ([\w\.]+)\b.+(android[- ]x86|harmonyos)/i],[m,u],[/(android|webos|qnx|bada|rim tablet os|maemo|meego|sailfish|openharmony)[-\/ ]?([\w\.]*)/i,/(blackberry)\w*\/([\w\.]*)/i,/(tizen|kaios)[\/ ]([\w\.]+)/i,/\((series40);/i],[u,m],[/\(bb(10);/i],[m,[u,C]],[/(?:symbian ?os|symbos|s60(?=;)|series60)[-\/ ]?([\w\.]*)/i],[m,[u,"Symbian"]],[/mozilla\/[\d\.]+ \((?:mobile|tablet|tv|mobile; [\w ]+); rv:.+ gecko\/([\w\.]+)/i],[m,[u,K+" OS"]],[/web0s;.+rt(tv)/i,/\b(?:hp)?wos(?:browser)?\/([\w\.]+)/i],[m,[u,"webOS"]],[/watch(?: ?os[,\/]|\d,\d\/)([\d\.]+)/i],[m,[u,"watchOS"]],[/crkey\/([\d\.]+)/i],[m,[u,V+"cast"]],[/(cros) [\w]+(?:\)| ([\w\.]+)\b)/i],[[u,Ee],m],[/panasonic;(viera)/i,/(netrange)mmh/i,/(nettv)\/(\d+\.[\w\.]+)/i,/(nintendo|playstation) ([wids345portablevuch]+)/i,/(xbox); +xbox ([^\);]+)/i,/\b(joli|palm)\b ?(?:os)?\/?([\w\.]*)/i,/(mint)[\/\(\) ]?(\w*)/i,/(mageia|vectorlinux)[; ]/i,/([kxln]?ubuntu|debian|suse|opensuse|gentoo|arch(?= linux)|slackware|fedora|mandriva|centos|pclinuxos|red ?hat|zenwalk|linpus|raspbian|plan 9|minix|risc os|contiki|deepin|manjaro|elementary os|sabayon|linspire)(?: gnu\/linux)?(?: enterprise)?(?:[- ]linux)?(?:-gnu)?[-\/ ]?(?!chrom|package)([-\w\.]*)/i,/(hurd|linux) ?([\w\.]*)/i,/(gnu) ?([\w\.]*)/i,/\b([-frentopcghs]{0,5}bsd|dragonfly)[\/ ]?(?!amd|[ix346]{1,2}86)([\w\.]*)/i,/(haiku) (\w+)/i],[u,m],[/(sunos) ?([\w\.\d]*)/i],[[u,"Solaris"],m],[/((?:open)?solaris)[-\/ ]?([\w\.]*)/i,/(aix) ((\d)(?=\.|\)| )[\w\.])*/i,/\b(beos|os\/2|amigaos|morphos|openvms|fuchsia|hp-ux|serenityos)/i,/(unix) ?([\w\.]*)/i],[u,m]]},Ie=function(H,W){if(typeof H===c&&(W=H,H=i),!(this instanceof Ie))return new Ie(H,W).getResult();var j=typeof t!==l&&t.navigator?t.navigator:i,B=H||(j&&j.userAgent?j.userAgent:r),_e=j&&j.userAgentData?j.userAgentData:i,Ke=W?Ct(dt,W):dt,ee=j&&j.userAgent==B;return this.getBrowser=function(){var U={};return U[u]=i,U[m]=i,qe.call(U,B,Ke.browser),U[g]=ft(U[m]),ee&&j&&j.brave&&typeof j.brave.isBrave==o&&(U[u]="Brave"),U},this.getCPU=function(){var U={};return U[k]=i,qe.call(U,B,Ke.cpu),U},this.getDevice=function(){var U={};return U[h]=i,U[f]=i,U[p]=i,qe.call(U,B,Ke.device),ee&&!U[p]&&_e&&_e.mobile&&(U[p]=w),ee&&U[f]=="Macintosh"&&j&&typeof j.standalone!==l&&j.maxTouchPoints&&j.maxTouchPoints>2&&(U[f]="iPad",U[p]=v),U},this.getEngine=function(){var U={};return U[u]=i,U[m]=i,qe.call(U,B,Ke.engine),U},this.getOS=function(){var U={};return U[u]=i,U[m]=i,qe.call(U,B,Ke.os),ee&&!U[u]&&_e&&_e.platform&&_e.platform!="Unknown"&&(U[u]=_e.platform.replace(/chrome os/i,Ee).replace(/macos/i,R)),U},this.getResult=function(){return{ua:this.getUA(),browser:this.getBrowser(),engine:this.getEngine(),os:this.getOS(),device:this.getDevice(),cpu:this.getCPU()}},this.getUA=function(){return B},this.setUA=function(U){return B=typeof U===d&&U.length>E?Ze(U,E):U,this},this.setUA(B),this};Ie.VERSION=n,Ie.BROWSER=Pe([u,m,g]),Ie.CPU=Pe([k]),Ie.DEVICE=Pe([f,h,p,T,w,b,v,I,O]),Ie.ENGINE=Ie.OS=Pe([u,m]),s.exports&&(e=s.exports=Ie),e.UAParser=Ie;var Le=typeof t!==l&&(t.jQuery||t.Zepto);if(Le&&!Le.ua){var He=new Ie;Le.ua=He.getResult(),Le.ua.get=function(){return He.getUA()},Le.ua.set=function(H){He.setUA(H);var W=He.getResult();for(var j in W)Le.ua[j]=W[j]}}})(typeof window=="object"?window:xl)}(Zi,Zi.exports)),Zi.exports}var $l=Ml(),Mn,Yr;function jl(){if(Yr)return Mn;Yr=1;for(var s=Math.floor(Math.random()*16777215),e=c.index=parseInt(Math.random()*16777215,10),t=(typeof process>"u"||typeof process.pid!="number"?Math.floor(Math.random()*1e5):process.pid)%65535,i=(()=>{try{return _Buffer}catch{try{return Buffer}catch{return null}}})(),n=function(u){return!!(u!=null&&u.constructor&&typeof u.constructor.isBuffer=="function"&&u.constructor.isBuffer(u))},r=[],a=0;a<256;a++)r[a]=(a<=15?"0":"")+a.toString(16);var o=new RegExp("^[0-9a-fA-F]{24}$"),l=[];for(a=0;a<10;)l[48+a]=a++;for(;a<16;)l[55+a]=l[87+a]=a++;function c(u){if(!(this instanceof c))return new c(u);if(u&&(u instanceof c||u._bsontype==="ObjectID"))return u;if(this._bsontype="ObjectID",u==null||typeof u=="number"){this.id=this.generate(u);return}var p=c.isValid(u);if(!p&&u!=null)throw new Error("Argument passed in must be a single String of 12 bytes or a string of 24 hex characters");if(p&&typeof u=="string"&&u.length===24)return c.createFromHexString(u);if(u!=null&&u.length===12)this.id=u;else{if(u!=null&&typeof u.toHexString=="function")return u;throw new Error("Argument passed in must be a single String of 12 bytes or a string of 24 hex characters")}}Mn=c,c.default=c,c.createFromTime=function(u){return u=parseInt(u,10)%4294967295,new c(g(8,u)+"0000000000000000")},c.createFromHexString=function(u){if(typeof u>"u"||u!=null&&u.length!==24)throw new Error("Argument passed in must be a single String of 12 bytes or a string of 24 hex characters");for(var p="",h=0;h<24;)p+=String.fromCharCode(l[u.charCodeAt(h++)]<<4|l[u.charCodeAt(h++)]);return new c(p)},c.isValid=function(u){return u==null?!1:typeof u=="number"?!0:typeof u=="string"?u.length===12||u.length===24&&o.test(u):u instanceof c?!0:n(u)?c.isValid(u.toString("hex")):typeof u.toHexString=="function"&&i&&(u.id instanceof i||typeof u.id=="string")?u.id.length===12||u.id.length===24&&o.test(u.id):!1},c.prototype={constructor:c,toHexString:function(){if(!this.id||!this.id.length)throw new Error("invalid ObjectId, ObjectId.id must be either a string or a Buffer, but is ["+JSON.stringify(this.id)+"]");if(this.id.length===24)return this.id;if(n(this.id))return this.id.toString("hex");for(var u="",p=0;p<this.id.length;p++)u+=r[this.id.charCodeAt(p)];return u},equals:function(u){return u instanceof c?this.toString()===u.toString():typeof u=="string"&&c.isValid(u)&&u.length===12&&n(this.id)?u===this.id.toString("binary"):typeof u=="string"&&c.isValid(u)&&u.length===24?u.toLowerCase()===this.toHexString():typeof u=="string"&&c.isValid(u)&&u.length===12?u===this.id:u!=null&&(u instanceof c||u.toHexString)?u.toHexString()===this.toHexString():!1},getTimestamp:function(){var u=new Date,p;return n(this.id)?p=this.id[3]|this.id[2]<<8|this.id[1]<<16|this.id[0]<<24:p=this.id.charCodeAt(3)|this.id.charCodeAt(2)<<8|this.id.charCodeAt(1)<<16|this.id.charCodeAt(0)<<24,u.setTime(Math.floor(p)*1e3),u},generate:function(u){typeof u!="number"&&(u=~~(Date.now()/1e3)),u=parseInt(u,10)%4294967295;var p=d();return String.fromCharCode(u>>24&255,u>>16&255,u>>8&255,u&255,s>>16&255,s>>8&255,s&255,t>>8&255,t&255,p>>16&255,p>>8&255,p&255)}};function d(){return e=(e+1)%16777215}function g(u,p){return p=p.toString(16),p.length===u?p:"00000000".substring(p.length,u)+p}var f=Symbol&&Symbol.for&&Symbol.for("nodejs.util.inspect.custom")||"inspect";return c.prototype[f]=function(){return"ObjectID("+this+")"},c.prototype.toJSON=c.prototype.toHexString,c.prototype.toString=c.prototype.toHexString,Mn}var Rl=jl();const es=Ka(Rl),Bl={ticktickServer:"ticktick.com",protocol:"https://",apiProtocol:"https://api.",apiVersion:"/api/v2",signInEndPoint:"user/signon?wc=true&remember=true",userPreferencesEndPoint:"user/preferences/settings",allProjectGroupsEndPoint:"batch/check/",allProjectsEndPoint:"projects",allTasksEndPoint:"batch/check/",TaskEndPoint:"task",updateTaskEndPoint:"batch/task",getSections:"column/project/",getAllCompletedItems:"project/all/completedInAll/",exportData:"data/export",projectMove:"batch/taskProject",parentMove:"batch/taskParent"};var Bs={exports:{}},Ul=Bs.exports,Jr;function ql(){return Jr||(Jr=1,function(s){(function(e,t){s.exports?s.exports=t():e.log=t()})(Ul,function(){var e=function(){},t="undefined",i=typeof window!==t&&typeof window.navigator!==t&&/Trident\/|MSIE /.test(window.navigator.userAgent),n=["trace","debug","info","warn","error"],r={},a=null;function o(h,m){var k=h[m];if(typeof k.bind=="function")return k.bind(h);try{return Function.prototype.bind.call(k,h)}catch{return function(){return Function.prototype.apply.apply(k,[h,arguments])}}}function l(){console.log&&(console.log.apply?console.log.apply(console,arguments):Function.prototype.apply.apply(console.log,[console,arguments])),console.trace&&console.trace()}function c(h){return h==="debug"&&(h="log"),typeof console===t?!1:h==="trace"&&i?l:console[h]!==void 0?o(console,h):console.log!==void 0?o(console,"log"):e}function d(){for(var h=this.getLevel(),m=0;m<n.length;m++){var k=n[m];this[k]=m<h?e:this.methodFactory(k,h,this.name)}if(this.log=this.debug,typeof console===t&&h<this.levels.SILENT)return"No console available for logging"}function g(h){return function(){typeof console!==t&&(d.call(this),this[h].apply(this,arguments))}}function f(h,m,k){return c(h)||g.apply(this,arguments)}function u(h,m){var k=this,T,w,v,b="loglevel";typeof h=="string"?b+=":"+h:typeof h=="symbol"&&(b=void 0);function I(S){var C=(n[S]||"silent").toUpperCase();if(!(typeof window===t||!b)){try{window.localStorage[b]=C;return}catch{}try{window.document.cookie=encodeURIComponent(b)+"="+C+";"}catch{}}}function O(){var S;if(!(typeof window===t||!b)){try{S=window.localStorage[b]}catch{}if(typeof S===t)try{var C=window.document.cookie,F=encodeURIComponent(b),V=C.indexOf(F+"=");V!==-1&&(S=/^([^;]+)/.exec(C.slice(V+F.length+1))[1])}catch{}return k.levels[S]===void 0&&(S=void 0),S}}function E(){if(!(typeof window===t||!b)){try{window.localStorage.removeItem(b)}catch{}try{window.document.cookie=encodeURIComponent(b)+"=; expires=Thu, 01 Jan 1970 00:00:00 UTC"}catch{}}}function L(S){var C=S;if(typeof C=="string"&&k.levels[C.toUpperCase()]!==void 0&&(C=k.levels[C.toUpperCase()]),typeof C=="number"&&C>=0&&C<=k.levels.SILENT)return C;throw new TypeError("log.setLevel() called with invalid level: "+S)}k.name=h,k.levels={TRACE:0,DEBUG:1,INFO:2,WARN:3,ERROR:4,SILENT:5},k.methodFactory=m||f,k.getLevel=function(){return v??w??T},k.setLevel=function(S,C){return v=L(S),C!==!1&&I(v),d.call(k)},k.setDefaultLevel=function(S){w=L(S),O()||k.setLevel(S,!1)},k.resetLevel=function(){v=null,E(),d.call(k)},k.enableAll=function(S){k.setLevel(k.levels.TRACE,S)},k.disableAll=function(S){k.setLevel(k.levels.SILENT,S)},k.rebuild=function(){if(a!==k&&(T=L(a.getLevel())),d.call(k),a===k)for(var S in r)r[S].rebuild()},T=L(a?a.getLevel():"WARN");var A=O();A!=null&&(v=L(A)),d.call(k)}a=new u,a.getLogger=function(m){if(typeof m!="symbol"&&typeof m!="string"||m==="")throw new TypeError("You must supply a name when creating a logger.");var k=r[m];return k||(k=r[m]=new u(m,a.methodFactory)),k};var p=typeof window!==t?window.log:void 0;return a.noConflict=function(){return typeof window!==t&&window.log===a&&(window.log=p),a},a.getLoggers=function(){return r},a.default=a,a})}(Bs)),Bs.exports}var Hl=ql();const y=Ka(Hl),{ticktickServer:$n,protocol:As,apiProtocol:Xr,apiVersion:Cs,TaskEndPoint:Qr,updateTaskEndPoint:Zr,allProjectGroupsEndPoint:Kl,allProjectsEndPoint:Vl,allTasksEndPoint:Ns,signInEndPoint:zl,userPreferencesEndPoint:Gl,getSections:Wl,getAllCompletedItems:Yl,exportData:Jl,projectMove:Xl,parentMove:Ql}=Bl;class Qn{constructor({username:e,password:t,baseUrl:i,token:n,checkPoint:r}){this.username=e,this.password=t,this.token=n,this.inboxProperties={id:"",sortOrder:0},this.userAgent=this.getUserAgent(),this.deviceAgent=this.getXDevice(),i?(this.apiUrl=`${Xr}${i}${Cs}`,this.loginUrl=`${As}${i}${Cs}`,this.originUrl=`${As}${i}`):(this.apiUrl=`${Xr}${$n}${Cs}`,this.loginUrl=`${As}${$n}${Cs}`,this.originUrl=`${As}${$n}`),r!=null?this._checkpoint=r:this.getPreviousCheckPoint()}get checkpoint(){return this._checkpoint}set checkpoint(e){this._checkpoint=e}get inboxId(){return this.inboxProperties.id}get lastError(){return this._lastError}set lastError(e){this._lastError=e}async login(){try{const e=`${this.loginUrl}/${zl}`,t={username:this.username,password:this.password},i=await this.makeRequest("Login",e,"POST",t);if(y.debug("Signed in Response: ",i),i&&i.token)return this._checkpoint=0,{token:i.token,inboxId:i.inboxId}}catch(e){this.setError("Login",null,e),y.error(e)}return null}async getUserSettings(){try{const e=`${this.apiUrl}/${Gl}`,t=await this.makeRequest("Get User Settings",e,"GET",void 0);return t||null}catch(e){return y.error("Get Inbox Properties failed: ",e),this.setError("Get Inbox Properties",null,e),null}}async getInboxProperties(){try{for(let e=0;e<10;e++){e!==0&&this.reset();const t=`${this.apiUrl}/${Ns}`+this._checkpoint,i=await this.makeRequest("Get Inbox Properties",t,"GET");if(i)return i.syncTaskBean.update.forEach(n=>{n.projectId==this.inboxProperties.id&&n.sortOrder<this.inboxProperties.sortOrder&&(this.inboxProperties.sortOrder=n.sortOrder)}),this.inboxProperties.sortOrder--,!0}}catch(e){y.error("Get Inbox Properties failed: ",e),this.setError("Get Inbox Properties",null,e)}return!1}async getProjectGroups(){try{const e=`${this.apiUrl}/${Kl}`,t=await this.makeRequest("Get Project Groups",e,"GET",void 0);if(t)return t}catch(e){y.error("Get Project Groups failed: ",e),this.setError("Get Project Groups",null,e)}return[]}async getProjects(){try{const e=`${this.apiUrl}/${Vl}`,t=await this.makeRequest("Get Projects",e,"GET",void 0);if(t)return t}catch(e){y.error("Get Projects failed: ",e),this.setError("Get Projects",null,e)}return[]}async getProjectSections(e){try{const t=`${this.apiUrl}/${Wl}/${e}`,i=await this.makeRequest("Get Project Sections",t,"GET",void 0);return i||[]}catch(t){return y.error("Get Project Sections failed: ",t),this.setError("Get Project Sections",null,t),[]}}async getAllResources(){try{let e=10;for(;e>0;){const t=new Date(this._checkpoint);y.debug("Get All Resources",this._checkpoint?"as of: "+t.toISOString():"from the beginning of time. ");const i=`${this.apiUrl}/${Ns}`+this._checkpoint,n=await this.makeRequest("Get All Resources",i,"GET",void 0);if(n)return n;e-=1,this.getPreviousCheckPoint()}}catch(e){y.error("Get All Resources failed: ",e),this.setError("Get All Resources",null,e)}return null}async getTaskDetails(){try{let e=10;for(;e>0;){const t=`${this.apiUrl}/${Ns}`+this._checkpoint,i=await this.makeRequest("Get Task Details",t,"GET",void 0);if(i){if(i.syncTaskBean.update.length>0)return _().checkPoint!=i.checkPoint&&(this._checkpoint=i.checkPoint,_().checkPoint=this._checkpoint,ge({checkPoint:this._checkpoint})),i.syncTaskBean;e-=1,this.getPreviousCheckPoint()}else e-=1,this.getPreviousCheckPoint()}return[]}catch(e){return y.error("Get Tasks Details failed: ",e),this.setError("Get Tasks",null,e),[]}}async getTasks(){try{let e=3;for(;e>0;){const t=`${this.apiUrl}/${Ns}`+this._checkpoint,i=await this.makeRequest("Get Tasks",t,"GET",void 0);if(i)return y.debug("Got: ",i.syncTaskBean.update.length),i.syncTaskBean.update;if(e>0)this.getPreviousCheckPoint(),e=e-1;else return[]}}catch(e){return y.error("Get Tasks failed: ",e),this.setError("Get Tasks",null,e),[]}}async getTask(e,t){try{let i=`${this.apiUrl}/${Qr}/${e}`;const n=`?projectID=${t}`;t&&(i=i+n);const r=await this.makeRequest("Get Tasks",i,"GET",void 0);return r||null}catch(i){return y.error("Get Tasks failed: ",i),this.setError("Get Tasks",null,i),null}}async getAllCompletedItems(){try{const e=`${this.apiUrl}/${Yl}`,t=await this.makeRequest("Get All Completed Items",e,"GET",void 0);return t?t.syncTaskBean.update:[]}catch(e){return y.error("Get All Completed Items failed: ",e),this.setError("Get All Completed Tasks",null,e),[]}}async addTask(e){try{let t=!0;e.isAllDay==null?t=!0:t=e.isAllDay;const i={id:e.id?e.id:es(),projectId:e.projectId?e.projectId:this.inboxProperties.id,sortOrder:e.sortOrder?e.sortOrder:this.inboxProperties.sortOrder,title:e.title,content:e.content?e.content:"",desc:e.desc?e.desc:"",startDate:e.startDate?e.startDate:null,dueDate:e.dueDate?e.dueDate:null,timeZone:e.timeZone?e.timeZone:"America/New_York",isAllDay:t,reminder:e.reminder?e.reminder:null,reminders:e.reminders?e.reminders:[{id:es(),trigger:"TRIGGER:PT0S"}],repeatFlag:e.repeatFlag?e.repeatFlag:null,priority:e.priority?e.priority:0,status:e.status?e.status:0,items:e.items?e.items:[],progress:e.progress?e.progress:0,modifiedTime:e.modifiedTime?e.modifiedTime:new Date().toISOString().replace("Z","+0000"),deleted:e.deleted?e.deleted:0,assignee:e.assignee?e.assignee:null,isDirty:e.isDirty?e.isDirty:!0,local:e.local?e.local:!0,remindTime:e.remindTime?e.remindTime:null,tags:e.tags?e.tags:[],childIds:e.childIds?e.childIds:[],parentId:e.parentId?e.parentId:null},n=`${this.apiUrl}/${Qr}`,r=await this.makeRequest("Add Task",n,"POST",i);if(r){let a;return a=r.sortOrder,this.inboxProperties.sortOrder=a-1,r}else return[]}catch(t){return y.error("Add Task failed: ",t),this.setError("Add Task",null,t),[]}}async updateTask(e){try{let t=!0;e.isAllDay==null?t=!0:t=e.isAllDay;const i={id:e.id?e.id:es(),projectId:e.projectId?e.projectId:this.inboxProperties.id,sortOrder:e.sortOrder?e.sortOrder:this.inboxProperties.sortOrder,title:e.title,content:e.content?e.content:"",desc:e.desc?e.desc:"",startDate:e.startDate?e.startDate:null,dueDate:e.dueDate?e.dueDate:null,timeZone:e.timeZone?e.timeZone:"America/New_York",isAllDay:t,reminder:e.reminder?e.reminder:null,reminders:e.reminders?e.reminders:[{id:es(),trigger:"TRIGGER:PT0S"}],repeatFlag:e.repeatFlag?e.repeatFlag:null,priority:e.priority?e.priority:0,status:e.status?e.status:0,items:e.items?e.items:[],progress:e.progress?e.progress:0,modifiedTime:e.modifiedTime?e.modifiedTime:new Date().toISOString().replace("Z","+0000"),deleted:e.deleted?e.deleted:0,assignee:e.assignee?e.assignee:null,isDirty:e.isDirty?e.isDirty:!0,local:e.local?e.local:!0,remindTime:e.remindTime?e.remindTime:null,tags:e.tags?e.tags:[],childIds:e.childIds?e.childIds:[],parentId:e.parentId?e.parentId:null};let n;n={add:[],addAttachments:[],delete:[],deleteAttachments:[],updateAttachments:[],update:[i]};const r=`${this.apiUrl}/${Zr}`,a=await this.makeRequest("Update Task",r,"POST",n);return a||null}catch(t){return y.error("Update Task failed: ",t),this.setError("Update Task",null,t),null}}async deleteTask(e,t){if(!e||!t)throw new Error("Both Task Id and Project ID are required for a delete, otherwise TickTick will fail silently.");try{const i={taskId:e,projectId:t};let n;n={add:[],addAttachments:[],delete:[i],deleteAttachments:[],updateAttachments:[],update:[]};const r=`${this.apiUrl}/${Zr}`,a=await this.makeRequest("Delete Task",r,"POST",n);return a?(this.inboxProperties.sortOrder=a.sortOrder-1,a):null}catch(i){return y.error("Delete Task  failed: ",i),this.setError("Delete Task Tasks",null,i),null}}async exportData(){try{const e=`${this.apiUrl}/${Jl}`,t=await this.makeRequest("Export",e,"GET",void 0);if(t){let i=t;return i=i.substring(1),i=i.substring(0,i.length-1),i=i.replace(/\\\"/g,'"'),i=i.replace(/\\n/g,`
`),i}else return null}catch(e){return y.error("Export failed: ",e),this.setError("Export",null,e),null}}async projectMove(e,t,i){try{const n=`${this.apiUrl}/${Xl}`,r=[{fromProjectId:t,toProjectId:i,taskId:e,sortOrder:this.inboxProperties.sortOrder}],a=await this.makeRequest("Project Move",n,"POST",r);return a?(this.inboxProperties.sortOrder=a.sortOrder-1,a):null}catch(n){return y.error("Project Move failed: ",n),this.setError("Project Move",null,n),null}}async parentMove(e,t,i){try{const n=`${this.apiUrl}/${Ql}`,r=[{parentId:t,projectId:i,taskId:e}],a=await this.makeRequest("Project Move",n,"POST",r);if(a)return this.inboxProperties.sortOrder=a.sortOrder-1,a}catch(n){return y.error("Parent Move failed: ",n),this.setError("Parent Move",null,n),null}}async makeRequest(e,t,i,n=void 0){this.lastError=void 0;try{let r={};e=="Login"?r=this.createLoginRequestOptions(t,n):(this.cookieHeader||(this.cookieHeader=localStorage.getItem("TTS_Cookies")),r=this.createRequestOptions(i,t,n));const a=await N.requestUrl(r);return a.status!=200?(this.setError(e,a,null),null):(this.cookies=a.headers["set-cookie"]??[],this.cookieHeader=this.cookies.join("; ")+";",localStorage.setItem("TTS_Cookies",this.cookieHeader),a.json)}catch(r){return this.setError(e,null,r),y.error(r),null}}createLoginRequestOptions(e,t){const i={Accept:"*/*","x-device":this.deviceAgent,"Content-Type":"application/json","X-Requested-With":"XMLHttpRequest"};return{method:"POST",url:e,headers:i,contentType:"application/json",body:t?JSON.stringify(t):void 0,throw:!1}}createRequestOptions(e,t,i){let n={"Content-Type":"application/json","User-Agent":`${this.userAgent}`,"x-device":`${this.deviceAgent}`,Cookie:`t=${this.token};`+this.cookieHeader,t:`${this.token}`};return{method:e,url:t,headers:n,contentType:"application/json",body:i?JSON.stringify(i):void 0,throw:!1}}setError(e,t,i){if(t){const n=t.status;let r;if(n==429)r="Error: "+n+" TickTick reporting too many requests.",this._lastError={operation:e,statusCode:n,errorMessage:r};else{try{r=t.json}catch{y.debug("Bad JSON response"),y.debug("Trying Text.");try{r=this.extractTitleContent(t.text),y.error("Error: ",r)}catch{y.debug("Bad text response"),y.debug("No error message."),r="No Error message received."}}this._lastError={operation:e,statusCode:n,errorMessage:r}}}else{let n,r=666;i?n=i:n="Unknown Error",y.error(e,n),this._lastError={operation:e,statusCode:r,errorMessage:n}}}getPreviousCheckPoint(){let e=new Date;return e.setDate(e.getDate()-15),this._checkpoint=e.getTime(),y.debug("Checkpoint has been changed.",this._checkpoint),this._checkpoint}extractTitleContent(e){const t="<title>",i="</title>",n=e.indexOf(t)+t.length,r=e.indexOf(i);return e.substring(n,r)}getUserAgent(){return navigator.userAgent}getXDevice(){const e=this.generateRandomID(),t=6070;return $l.UAParser(navigator.userAgent),JSON.stringify({platform:"web",os:"Windows 10",device:"Firefox 117.0",name:"",version:t,id:e,channel:"website",campaign:"",websocket:""})}getPlatform(){if(N.Platform.isIosApp)return"ios";if(N.Platform.isAndroidApp)return"android";if(N.Platform.isMacOS)return"macOS";if(N.Platform.isWin)return"windows";if(N.Platform.isLinux)return"linux";if(N.Platform.isSafari)return"safari"}reset(){this._checkpoint=this.getPreviousCheckPoint()}generateRandomID(){let e=localStorage.getItem("TTS_UniqueID");if(e&&e.includes("-")&&(localStorage.removeItem("TTS_UniqueID"),e=null),!e){const t="66",n="0123456789abcdef";e=t;const r=24-t.length;for(let a=0;a<r;a++){const o=Math.floor(Math.random()*n.length);e+=n[o]}localStorage.setItem("TTS_UniqueID",e)}return e}generateRandomVersion(){let e;do e=Math.floor(Math.random()*4e3)+6e3;while(e<6e3||e>9999);return e}}const jn={};async function ht(s,e){jn[s]||(jn[s]=[]);const t=jn[s],i=t.length===0;let n=()=>{};const r=new Promise(a=>{n=a});t.push(r),i||await t[t.length-2];try{return await e()}catch(a){throw a}finally{t.splice(0,1),n()}}class Va extends N.Modal{constructor(e,t,i,n){super(e),this.title="Task Deletion Confirmation",this.message="The following Task(s) will be deleted because: ",this.cancelLabel="Cancel",this.confirmLabel="Confirm Deletion",this.taskTitles=[],this.taskTitles=t,this.reason=i,this.onSubmit=n}onOpen(){const{titleEl:e,contentEl:t}=this;e.setText(this.title),t.createEl("p",{text:`${this.message}${this.reason}`});const i=t.createEl("ul");this.taskTitles.forEach(n=>{i.createEl("li",{text:n})}),new N.Setting(t).addButton(n=>{n.setClass("ts_button"),n.setButtonText(this.cancelLabel),n.onClick(()=>{this.result=!1,this.onSubmit(this.result),this.close()})}).addButton(n=>{n.setClass("ts_button"),n.setWarning(),n.setButtonText(this.confirmLabel),n.onClick(()=>{this.result=!0,this.onSubmit(this.result),this.close()})})}onClose(){this.titleEl.empty(),this.contentEl.empty(),super.onClose(),this.resolvePromise(this.result)}showModal(){return this.open(),new Promise(e=>this.resolvePromise=e)}}class Dt{constructor(e,t,i){this.fileLines=[],this.app=e,this.plugin=t,this.file=i}addTask(e,t,i=-1){let n=this.fileLines.length;i>=0?n=i:e.parentId?n=this.getTaskEndLineByTaskID(e.parentId)+1:n=this.fileLines.length;let r=t.split(`
`);return this.fileLines.splice(n,0,...r),n}updateTask(e,t,i=!1){let n=this.getTaskIndex(e.id),r=0,a=0;n>=0?(r=this.getTaskEndLineByTaskID(e.id),a=r-n+1):n=0;let o={};e.childIds&&e.childIds.length>0&&(o=this.buildMoveMap(e.id,e.childIds,o));const l=t.split(`
`);if(this.fileLines.splice(n,a,...l),i){let c=0;e.parentId?c=this.getTaskIndex(e.parentId):c=n,n!=c&&this.moveTask(n,c),e.childIds&&e.childIds.length>0&&(o[e.id].tabs=this.plugin.taskParser.getTabs(t),this.fixUpChildren(o))}}deleteTask(e,t=!1){if(!t)this.deleteTaskAndLines(e);else{let i={};const n=this.plugin.taskParser.getTabs(this.fileLines[e]),r=this.findChildren(this.getTaskIndex(e),n);i=this.buildMoveMap(e,r,i),Object.entries(i).sort(([,o],[,l])=>o.depth-l.depth).forEach(([o,l])=>{this.deleteTaskAndLines(o)})}}getFileLines(){return this.fileLines.join(`
`)}getTaskRecord(e){return this.getTaskLines(e)}getNumParentTabs(e){return this.plugin.taskParser.getNumTabs(this.fileLines[this.getTaskIndex(e)])}getTaskItems(e){const t=this.getTaskIndex(e),i=[];for(let n=t+1;n<this.fileLines.length;n++){const r=this.fileLines[n];if(this.plugin.taskParser.isMarkdownTask(r)){if(this.plugin.taskParser.getTickTickId(r))break;this.plugin.taskParser.getLineItemId(r)&&i.push(r)}}return i}getFilePath(){return this.file.path}getTaskIndex(e){return this.fileLines.findIndex(t=>this.plugin.taskParser.isMarkdownTask(t)&&t.includes(e))}getTaskString(e){return this.fileLines[this.getTaskIndex(e)]}async init(e=null){let t;e?t=e:t=await this.app.vault.read(this.file),t&&(this.fileLines=t.split(`
`))}getTaskItemRecord(e){const t={},i=this.fileLines[this.getTaskIndex(e)];return t.parentId=this.getParentId(e),t.ID=this.plugin.taskParser.getLineItemId(i),t}getTaskItemRecordByLine(e){const t={},i=this.fileLines[e],n=this.getParentIDByIdx(e);return t.ID=this.plugin.taskParser.getLineItemId(i),t.parentId=n,t}async getTaskRecordByLine(e){let t={};const i=this.getParentIDByIdx(e);if(t=this.getTaskLinesByIdx(e,t),t.parentId=i,t.taskLines&&t.taskLines.length>0){this.fileLines.splice(e+1,t.taskLines.length-1);const n=this.fileLines.join(`
`);await this.app.vault.modify(this.file,n)}return t}markAllTasks(){var i,n,r,a,o,l;let e=!1;const t=this.fileLines;for(let c=0;c<t.length;c++){const d=t[c];if((i=this.plugin.taskParser)!=null&&i.isMarkdownTask(d)&&((n=this.plugin.taskParser)==null?void 0:n.getTaskContentFromLineText(d))!=""&&!((r=this.plugin.taskParser)!=null&&r.hasTickTickId(d))&&!((a=this.plugin.taskParser)!=null&&a.hasTickTickTag(d))&&!((o=this.plugin.taskParser)!=null&&o.getLineItemId(d))){let g=(l=this.plugin.taskParser)==null?void 0:l.addTickTickTag(d);t[c]=g,e=!0}}return e}modifyTask(e,t){this.fileLines[t]=e}fixChildTabs(e,t){let i=this.plugin.taskParser.getTabs(this.fileLines[t]);return i+="	",this.fixTabs(e,i)}deleteTaskAndLines(e){const t=this.getTaskIndex(e),i=this.getTaskEndLineByTaskID(e)-t+1;this.fileLines.splice(t,i)}getTaskEndLineByTaskID(e){const t=this.getTaskIndex(e);return this.getTaskEndLineByIdx(t)}getTaskEndLineByIdx(e){const t=this.plugin.taskParser.getTabs(this.fileLines[e]),i=t.length,n=t+"  ";for(let r=e+1;r<this.fileLines.length;r++){const a=this.fileLines[r],o=this.plugin.taskParser.getNumTabs(a);if(this.plugin.taskParser.isMarkdownTask(a)&&this.plugin.taskParser.hasTickTickId(a)||o<i)return r-1;if(!(this.plugin.taskParser.isMarkdownTask(a)&&this.plugin.taskParser.getLineItemId(a)||a.startsWith(n))&&(o<i||!a.startsWith(n)))return r-1}return this.fileLines.length-1}getTaskLines(e){let t={};const i=this.getTaskIndex(e);return t=this.getTaskLinesByIdx(i,t),t}getTaskLinesByIdx(e,t){const i=[],n=this.plugin.taskParser.getNumTabs(this.fileLines[e]);t.parentId=this.getParentIDByIdx(e);for(let r=e;r<this.fileLines.length;r++){const a=this.fileLines[r];if(r===e)t.task=a;else{const o=this.plugin.taskParser.getTabs(a),l=o.length,c=o+"  ";if(n===l&&!this.plugin.taskParser.isMarkdownTask(a)&&a.startsWith(c))i.push(a);else{n<l&&this.plugin.taskParser.isMarkdownTask(a)?this.plugin.taskParser.getLineItemId(a)?t.isNote=!1:this.plugin.taskParser.hasTickTickId(a)&&(t.isNote=!0):t.isNote=!0;break}}}return t.taskLines=i,i&&i.length>0&&t.isNote==null&&(t.isNote=!0),t}getParentId(e){const t=this.getTaskIndex(e);return this.getParentIDByIdx(t)}getParentIDByIdx(e){let t=this.plugin.taskParser.getNumTabs(this.fileLines[e]),i="";for(let n=e-1;n>=0;n--){const r=this.fileLines[n];if(this.plugin.taskParser.isMarkdownTask(r)){const a=this.plugin.taskParser.getNumTabs(this.fileLines[n]),o=this.plugin.taskParser.getTickTickId(r);if(a<t){i=o||"";break}}}return i}fixUpChildren(e){Object.entries(e).sort(([,i],[,n])=>i.depth-n.depth).forEach(([i,n])=>{n.depth==0&&n.tabs;const r=this.getTaskIndex(i);n.children.forEach(a=>{const o=this.getTaskIndex(a),l=this.fixChildTabs(a,r);this.fileLines.splice(o,l.length,...l),this.moveTask(o,r)})})}fixTabs(e,t){const i=this.getTaskIndex(e),n=this.getTaskEndLineByTaskID(e)+1,r=this.fileLines.slice(i,n);for(let a=0;a<r.length;a++){let o=t;this.plugin.taskParser.isMarkdownTask(r[a])&&a>0&&(o=t+"	"),r[a].startsWith("	")?r[a]=r[a].replace(/\t+/g,o):r[a]=o+r[a]}return r}moveTask(e,t){const i=this.getTaskEndLineByIdx(e)-e+1,n=this.plugin.taskParser.getTickTickId(this.fileLines[t]),r=this.fileLines.splice(e,i);n&&(t=this.getTaskEndLineByIdx(this.getTaskIndex(n))+1),this.fileLines.splice(t,0,...r)}findChildren(e,t){const i=[],n=t.length+1;for(let r=e+1;r<this.fileLines.length;r++){const a=this.fileLines[r],o=this.plugin.taskParser.getTickTickId(a);this.plugin.taskParser.getNumTabs(a)===n&&this.plugin.taskParser.isMarkdownTask(a)&&o&&i.push(o)}return i}buildMoveMap(e,t,i,n=0){const r=this.getTaskIndex(e),a=this.plugin.taskParser.getTabs(this.fileLines[r]),o=t;return i[e]={tabs:a,children:o,depth:n},o&&o.length>0&&o.forEach(l=>{const c=this.getTaskIndex(l),d=this.plugin.taskParser.getTabs(this.fileLines[c]),g=this.findChildren(c,d);this.buildMoveMap(l,g,i,n+1)}),i}}class Zl{constructor(e,t){this.app=e,this.plugin=t}async deletedTaskCheck(e){var l,c,d,g,f;let t,i,n,r;if(e){if(t=this.app.vault.getAbstractFileByPath(e),t&&t instanceof N.TFolder)return;r=e,t instanceof N.TFile&&(i=await this.app.vault.read(t))}else n=this.app.workspace.getActiveViewOfType(N.MarkdownView),t=this.app.workspace.getActiveFile(),r=t==null?void 0:t.path,i=n==null?void 0:n.data;let a=await((l=this.plugin.cacheOperation)==null?void 0:l.getFileMetadata(r,null));if(!a||!a.TickTickTasks)return;let o=a.TickTickTasks;if(i){const u=i.replace(/^---[\s\S]*?---\n/,""),p=await this.findMissingTaskIds(u,o,r);if(p.length>0){if(await this.deleteTasksByIds(p),a=await((c=this.plugin.cacheOperation)==null?void 0:c.getFileMetadata(r,null)),!a||!a.TickTickTasks)return;o=a.TickTickTasks}const m=[];for(const k of o)if(k.taskItems){for(const T of k.taskItems)u.includes(T)||m.push(T);if(m.length>0)try{let T=await((d=this.plugin.cacheOperation)==null?void 0:d.removeTaskItem(a,k.taskId,m));if(T){let w=this.plugin.taskParser.getObsidianUrlFromFilepath(r);w&&(T.title=T.title+" "+w);let v=await((g=this.plugin.tickTickRestAPI)==null?void 0:g.UpdateTask(T))}}catch(T){y.error("Task Item removal failed: ",T)}}}else{let u=o.map(p=>p.taskId);if(u.length>0){let p=[];for(const h of u){const m=await((f=this.plugin.cacheOperation)==null?void 0:f.findTaskInFiles(h));m&&(y.debug("== found:",h,m),p.push(h))}u=u.filter(h=>!p.includes(h))}u.length>0&&(y.error("Content not readable.",i,r," file could open elsewhere or deleted."),new N.Notice(`All content from ${e} APPEARS to have been removed.
If this is correct, please confirm task deletion. Otherwise, cancel task deletion.`,0),await this.deleteTasksByIds(u))}}async findMissingTaskIds(e,t,i){var l;const n=/%%\[ticktick_id:: ([a-f0-9]{24})\]%%/g,r=e.matchAll(n),a=new Set([...r].map(c=>c[1]));let o=t.filter(c=>!a.has(c.taskId)).map(c=>c.taskId);if(o&&o.length>0){let c=[];for(const d of o){const g=await((l=this.plugin.cacheOperation)==null?void 0:l.findTaskInFiles(d));g&&(y.debug("Task found in different file:",d,g),c.push(d))}o=o.filter(d=>!c.includes(d))}return o}async lineNewContentTaskCheck(e,t){var d;(d=t.file)==null||d.path;const i=t==null?void 0:t.data,n=e.getCursor(),r=n.line,a=e.getLine(r);let o=i==null?void 0:i.length;const l=new Dt(this.app,this.plugin,t.file);await l.init(i),await this.addTask(a,r,e,n,l);let c=i==null?void 0:i.length;return o!=c}async addTask(e,t,i,n,r){var a,o,l,c,d,g,f,u;if(!(!e||e.length==0)&&!this.plugin.taskParser.hasTickTickId(e)&&this.plugin.taskParser.hasTickTickTag(e))try{const p=await this.plugin.taskParser.convertLineToTask(e,t,r.getFilePath(),r,null),h=await((a=this.plugin.tickTickRestAPI)==null?void 0:a.AddTask(p));if(p.parentId){let v=(o=this.plugin.cacheOperation)==null?void 0:o.loadTaskFromCacheID(p.parentId);v=this.plugin.taskParser.addChildToParent(v,p.parentId),v=await((l=this.plugin.tickTickRestAPI)==null?void 0:l.UpdateTask(v)),await((c=this.plugin.cacheOperation)==null?void 0:c.updateTaskToCache(v))}const m=h.id;new N.Notice(`new task ${h.title} id is ${h.id}`),p.status!=0&&(await((d=this.plugin.tickTickRestAPI)==null?void 0:d.CloseTask(h.id,h.projectId)),await((g=this.plugin.cacheOperation)==null?void 0:g.closeTaskToCacheByID(m))),h.dateHolder=p.dateHolder,await this.updateTaskLine(h,e,i,n,t,r);const k=r.getTaskRecord(h.id),w=k.task+this.plugin.taskParser.getNoteString(k,h.id).textContent;h.lineHash=await((f=this.plugin.taskParser)==null?void 0:f.getLineHash(w)),await((u=this.plugin.cacheOperation)==null?void 0:u.appendTaskToCache(h,r.getFilePath())),await this.plugin.saveSettings()}catch(p){y.error("Error adding task:",p),y.error(`The error occurred in file: ${r.getFilePath()}`)}}async fullTextNewTaskCheck(e){var o,l;let t,i=null,n=null;if(e){if(t=this.app.vault.getAbstractFileByPath(e),t&&t instanceof N.TFolder)return!1;if(!t)return y.error(`File: ${e} not found. Removing from Meta Data`),await((o=this.plugin.cacheOperation)==null?void 0:o.deleteFilepathFromMetadata(e)),!1}else throw new Error("No file path provided");const r=new Dt(this.app,this.plugin,t);await r.init(),_().enableFullVaultSync&&await((l=this.plugin.fileOperation)==null?void 0:l.addTickTickTagToFile(r));const a=r.getFileLines().split(`
`);for(let c=0;c<a.length;c++){const d=a[c];await this.addTask(d,c,i,n,r)}return!0}async lineModifiedTaskCheck(e,t,i,n){var o,l,c,d,g,f,u,p,h,m,k,T,w,v,b,I,O,E,L,A,S,C,F,V,Q,K,G,re,he,ue,Y,fe;let r=!1;if(_().enableFullVaultSync){if(!await((o=this.plugin.cacheOperation)==null?void 0:o.getFileMetadata(e)))return!1;await this.plugin.saveSettings()}let a;if((l=this.plugin.taskParser)!=null&&l.hasTickTickId(t)&&((c=this.plugin.taskParser)!=null&&c.hasTickTickTag(t))){const X=this.plugin.taskParser.getTickTickId(t),ie=n.getTaskRecord(X);if(!ie)return y.error("Task Not Found in file map",n.file,e,X),!1;if(!ie.task)return y.error("Task Not Found in file map",ie,X),!1;let se="";ie.taskLines&&ie.taskLines.length>1&&(se=this.plugin.taskParser.getNoteString(ie,X).textContent);const Z=await((d=this.plugin.taskParser)==null?void 0:d.getLineHash(t+se)),$=(g=this.plugin.cacheOperation)==null?void 0:g.loadTaskFromCacheID(X);let ve=!1,Ee="";if($&&$.lineHash)if(Z==$.lineHash){a=!1;const de=await this.checkForMoves(X,e);ve=de.projectMoved,Ee=de.oldFilePath;const Ne=(ie.parentId?ie.parentId:"")!=($.parentId?$.parentId:"");if(!ve&&!Ne)return!1;y.debug("Task Moved.",{projectMoved:ve,parentChanged:Ne,taskrecordparentid:ie.parentId,savedtaskparentid:$.parentId,lineText:t,savedTaskTitle:$.title,newHash:Z,oldHash:$.lineHash})}else _().debugMode&&y.debug("Task Hash Changed.",`
`,t,`
`,$.title,`
`,Z,`
`,$.lineHash),a=!0;const R=await((f=this.plugin.taskParser)==null?void 0:f.convertLineToTask(t,i,e,n,ie));if($)$.dateHolder||($.dateHolder=(p=this.plugin.dateMan)==null?void 0:p.getEmptydateHolder(),await((h=this.plugin.cacheOperation)==null?void 0:h.updateTaskToCache($,null))),$.lineHash||($.lineHash=await((m=this.plugin.taskParser)==null?void 0:m.getLineHash(Z)));else{y.error(`There is no task for ${t.substring(0,10)} in the local cache. It will be deleted from file ${e}`),new N.Notice(`There is no task ${this.plugin.taskParser.getTaskContentFromLineText(t)} in the local cache. It will be deleted`);const de=this.plugin.app.vault.getAbstractFileByPath(e);return await((u=this.plugin.fileOperation)==null?void 0:u.deleteTaskFromSpecificFile(de,R,!0)),!1}const Ue=R.title,Ct=(k=this.plugin.taskParser)==null?void 0:k.isTitleChanged(R,$),Pe=(T=this.plugin.taskParser)==null?void 0:T.isTagsChanged(R,$),Qe=(w=this.plugin.taskParser)==null?void 0:w.isStatusChanged(R,$),Oe=(v=this.plugin.dateMan)==null?void 0:v.areDatesChanged(R,$),ft=(b=this.plugin.taskParser)==null?void 0:b.isParentIdChanged(R,$),Ze=R.priority!=$.priority,qe=this.plugin.taskParser.areItemsChanged(R.items,$.items);let wt=!1;_().syncNotes&&(R.content?wt=this.plugin.taskParser.areNotesChanged(R.content,$.content):R.desc&&(wt=this.plugin.taskParser.areNotesChanged(R.desc,$.desc)));try{let de=!1,Ne=!1,dt=!1,Ie=!1,Le=!1,He=!1,H=!1,W=!1,j=!1;if(Ct&&(_().debugMode&&y.debug(`Title modified for task ${X}
"New:" ${R.title}
"Cached:" ${$.title}`),de=!0),Pe&&(_().debugMode&&y.debug(`Tags modified for task ${X}, , ${R.tags}, ${$.tags}`),Ne=!0),Oe&&(_().debugMode&&y.debug(`Dates modified for task ${X}`),Le=!0),R.timeZone=$.timeZone,ve){await((I=this.plugin.tickTickRestAPI)==null?void 0:I.moveTaskProject(R,$.projectId,R.projectId));let B="";_().debugMode&&y.debug("Project Moved"),B=`Task ${X}: ${this.plugin.taskParser.getTaskContentFromLineText(Ue)} has moved from ${Ee} to ${e} 
If any children were moved, they will be updated to ${_().baseURL} on the next Sync event`,new N.Notice(B,5e3),_().debugMode&&y.debug(B),dt=!0}if(ft){let B=await((O=this.plugin.cacheOperation)==null?void 0:O.loadTaskFromCacheID($.parentId)),_e=await((E=this.plugin.cacheOperation)==null?void 0:E.loadTaskFromCacheID(R.parentId)),Ke=`Task ${X}:
${(L=this.plugin.taskParser)==null?void 0:L.stripOBSUrl(Ue).trim()}
used to be a child of:
${B?B.title.trim():"No old parent found"}
but is now a child of:
${_e?_e.title.trim():"No new parent found."}
If any children were moved, they will be updated to ${_().baseURL} on the next Sync event`;await((A=this.plugin.tickTickRestAPI)==null?void 0:A.moveTaskParent(X,$.parentId,R.parentId,R.projectId)),new N.Notice(Ke,5e3),_().debugMode&&y.debug(Ke),He=!0}if(Ze&&(H=!0),qe&&(_().debugMode&&y.debug("Number of items changed: ",(S=R.items)==null?void 0:S.length,(C=$.items)==null?void 0:C.length),W=!0),wt&&(_().debugMode&&(R.content?y.debug("Notes changed: ",R.content,$.content):y.debug("Desc changed: ",R.desc,$.desc)),j=!0),de||Ne||Le||dt||He||H||He||W||j){$.modifiedTime=(F=this.plugin.dateMan)==null?void 0:F.formatDateToISO(new Date);const B=R.dateHolder,_e=await((V=this.plugin.tickTickRestAPI)==null?void 0:V.UpdateTask(R));_e.dateHolder=B,_e.lineHash=Z,dt?await((K=this.plugin.cacheOperation)==null?void 0:K.updateTaskToCache(_e,e)):await((Q=this.plugin.cacheOperation)==null?void 0:Q.updateTaskToCache(_e,null)),r=!0}if(Qe&&(_().debugMode&&y.debug(`Status modified for task ${X}`),R.status!=0?(_().debugMode&&y.debug("task completed"),(G=this.plugin.tickTickRestAPI)==null||G.CloseTask(R.id,R.projectId),await((re=this.plugin.cacheOperation)==null?void 0:re.closeTaskToCacheByID(R.id))):(_().debugMode&&y.debug("task not completed"),(he=this.plugin.tickTickRestAPI)==null||he.OpenTask(R.id,R.projectId),await((ue=this.plugin.cacheOperation)==null?void 0:ue.reopenTaskToCacheByID(R.id))),Ie=!0,new N.Notice(`Task Status for ${X} updated `)),de||Ne||Le||dt||He||H||He||W||j){await this.plugin.saveSettings();let B=`Task ${X} is updated.`;new N.Notice(B),de&&(B+=`
Content was changed.`),Ie&&(B+=`
Status was changed.`),Le&&(B+=`
Due date was changed.`),Ne&&(B+=`
Tags were changed.`),dt&&(B+=`
Project was changed.`),H&&(B+=`
Priority was changed.`),ft&&(B+=`
Parent was changed.`),W&&(B+=`
Task Items changed`),j&&(B+=`
Notes Changed`),_().debugMode&&y.debug("Task Changed: ",R.id,`
`,B)}}catch(de){y.error("Error updating task:",de)}if(!r&&a){const de=await((Y=this.plugin.taskParser)==null?void 0:Y.getLineHash(t+se));R.lineHash=de,await((fe=this.plugin.cacheOperation)==null?void 0:fe.updateTaskToCache(R,null)),await this.plugin.saveSettings(),y.debug(`Updated hash: ${de}`)}}else this.plugin.taskParser.isMarkdownTask(t)&&(r=await this.handleTaskItem(t,n,i));return r}async deleteTaskItemCheck(e,t,i,n){var r,a,o,l,c,d,g,f,u,p,h;if(!((r=this.plugin.taskParser)!=null&&r.hasTickTickId(t))&&!((a=this.plugin.taskParser)!=null&&a.hasTickTickTag(t))&&((o=this.plugin.taskParser)!=null&&o.isMarkdownTask(t))){let m=!1;if(!((l=this.plugin.taskParser)!=null&&l.isMarkdownTask(t)))return;let k=(c=this.plugin.taskParser)==null?void 0:c.taskFromLine(t),T=k==null?void 0:k.indent,w=k==null?void 0:k.description;k==null||k.status;let v;if(T>0){const b=n.split(`
`);for(let I=i-1;I>=0;I--){const O=b[I];if((d=this.plugin.taskParser)!=null&&d.hasTickTickId(O)&&((g=this.plugin.taskParser)!=null&&g.hasTickTickTag(O))){const E=this.plugin.taskParser.getTickTickId(O);if(v=await((f=this.plugin.cacheOperation)==null?void 0:f.loadTaskFromCacheID(E)),v&&v.items){let L="",S=/%%(.*)%%/.exec(w);if(S){L=S[1],v.items.find(F=>F.id===L)&&(v.items=v.items.filter(F=>F.id!==L),m=!0);break}else{y.debug(`${L} Not found.`);break}}else break}}m&&(v.modifiedTime=(u=this.plugin.dateMan)==null?void 0:u.formatDateToISO(new Date),await((p=this.plugin.tickTickRestAPI)==null?void 0:p.UpdateTask(v)),await((h=this.plugin.cacheOperation)==null?void 0:h.updateTaskToCache(v)))}}}async fullTextModifiedTaskCheck(e){var t;try{let i,n,r;if(e){if(i=this.app.vault.getAbstractFileByPath(e),i&&i instanceof N.TFolder)return}else r=this.app.workspace.getActiveViewOfType(N.MarkdownView),i=this.app.workspace.getActiveFile(),e=i==null?void 0:i.path;let a=!1;const o=new Dt(this.app,this.plugin,i);await o.init();const l=o.getFileLines().split(`
`);for(let c=0;c<l.length;c++){const d=l[c];if((t=this.plugin.taskParser)!=null&&t.isMarkdownTask(d))try{await this.lineModifiedTaskCheck(e,d,c,o),a=!0}catch(g){y.error("Error modifying task:",g)}}}catch(i){y.error("Error:",i)}}async closeTask(e){var t,i;try{let n=await((t=this.plugin.cacheOperation)==null?void 0:t.closeTaskToCacheByID(e));await((i=this.plugin.tickTickRestAPI)==null?void 0:i.CloseTask(e,n)),this.plugin.saveSettings(),new N.Notice(`Task ${e} is closed.`)}catch(n){throw y.error("Error closing task:",n),n}}async reopenTask(e){var t,i;try{let n=await((t=this.plugin.cacheOperation)==null?void 0:t.reopenTaskToCacheByID(e));await((i=this.plugin.tickTickRestAPI)==null?void 0:i.OpenTask(e,n)),await this.plugin.fileOperation.uncompleteTaskInTheFile(e),this.plugin.saveSettings(),new N.Notice(`Task ${e} is reopened.`)}catch(n){throw y.error("Error opening task:",n),n}}async deleteTasksByIds(e){var n,r,a;const t=[];if(!await this.confirmDeletion(e,"The tasks were removed from the file"))return new N.Notice("Tasks will not be deleted. Please rectify the issue before the next sync.",5e3),[];for(const o of e)try{let l,c=await((n=this.plugin.cacheOperation)==null?void 0:n.getProjectIdForTask(o));c&&(l=await((r=this.plugin.tickTickRestAPI)==null?void 0:r.deleteTask(o,c))),l&&new N.Notice(`Task ${o} is deleted.`),t.push(o)}catch(l){y.error(`Failed to delete task ${o}: ${l}`)}return t.length?(await((a=this.plugin.cacheOperation)==null?void 0:a.deleteTaskFromCacheByIDs(t)),this.plugin.saveSettings(),t):(_().debugMode&&y.debug("Task not deleted:",t),[])}async syncCompletedTaskStatusToObsidian(e){var t,i;try{const n=[];for(const r of e)await this.plugin.fileOperation.completeTaskInTheFile(r.object_id),await((t=this.plugin.cacheOperation)==null?void 0:t.closeTaskToCacheByID(r.object_id)),new N.Notice(`Task ${r.object_id} is closed.`),n.push(r);await((i=this.plugin.cacheOperation)==null?void 0:i.appendTaskToCache(n)),this.plugin.saveSettings()}catch(n){y.error("Error synchronizing task status:",n)}}async syncUncompletedTaskStatusToObsidian(e){var t,i;try{const n=[];for(const r of e)await this.plugin.fileOperation.uncompleteTaskInTheFile(r.object_id),await((t=this.plugin.cacheOperation)==null?void 0:t.reopenTaskToCacheByID(r.object_id)),new N.Notice(`Task ${r.object_id} is reopened.`),n.push(r);await((i=this.plugin.cacheOperation)==null?void 0:i.appendTaskToCache(n)),await this.plugin.saveSettings()}catch(n){y.error("Error synchronizing task status:",n)}}async syncTickTickToObsidian(){var e,t,i,n,r,a,o,l,c;try{if(!await this.plugin.saveProjectsToCache())return y.error("probable network connection error."),!1;let g=!1;const f=await((e=this.plugin.tickTickRestAPI)==null?void 0:e.getAllResources());if(!f)return y.error("probable network connection error."),!1;f.projectGroups&&Ha(f.projectGroups);const u=f.syncTaskBean;let p=u.update,h=u.delete,m=_().SyncTag;if(m&&(m.toLowerCase(),m.includes("/")&&(m=m.replace(/\//g,"-"))),m&&_().SyncProject)if(_().tagAndOr==1){let S;S=p.filter(C=>{var F;return S=(F=C.tags)==null?void 0:F.includes(m),S}),S&&(p=S.filter(C=>C.projectId===_().SyncProject))}else{let S=p.filter(F=>{var V;return(V=F.tags)==null?void 0:V.includes(m)}),C=p.filter(F=>F.projectId===_().SyncProject);p=[...S,...C].reduce((F,V)=>{const Q=F.find(K=>K.id===V.id);return Q?Object.assign(Q,V):F.push(V),F},[])}else(m||_().SyncProject)&&(p=p.filter(A=>{var F;const S=(F=A.tags)==null?void 0:F.includes(m),C=A.projectId===_().SyncProject;return S||C}));let k=await((t=this.plugin.cacheOperation)==null?void 0:t.loadTasksFromCache());if(_().debugMode){if(p){y.debug("We have: ",p.length," recent tasks on "+((n=(i=this.plugin.tickTickRestAPI)==null?void 0:i.api)==null?void 0:n.apiUrl));const A=p.filter(C=>C.status!=0),S=p.filter(C=>C.status===0);y.debug("openTasks",S.length,"closedTasks",A.length)}else y.debug("No tasks found.");k?y.debug("There are: ",k.length," tasks in Cache."):y.debug("There are no tasks in cache.")}k?k=k.sort((A,S)=>A.id>S.id?1:S.id>A.id?-1:0):k=[],p?p=p.sort((A,S)=>A.id>S.id?1:S.id>A.id?-1:0):p=[];let T=[];Object.keys(_().fileMetadata).length===0?T=p:T=p.filter(A=>!k.some(S=>S.id===A.id)),T.length>0&&(T.forEach(S=>{var C;(C=this.plugin.dateMan)==null||C.addDateHolderToTask(S)}),await((r=this.plugin.fileOperation)==null?void 0:r.addTasksToFile(T,!1))&&await new Promise(S=>setTimeout(S,1e3)),g=!0);const v=k.filter(A=>!p.some(S=>S.id===A.id)).filter(A=>h.some(S=>S.taskId===A.id));if(v.length>0){const A=v.map(C=>C.id);if(await this.confirmDeletion(A,"tasks deleted from TickTick")){v.sort((C,F)=>!C.parentId&&F.parentId?-1:C.parentId&&!F.parentId?1:0);for(const C of v){try{await((a=this.plugin.fileOperation)==null?void 0:a.deleteTaskFromFile(C))}catch(F){y.debug("Task deletion failed.",F)}try{await((o=this.plugin.cacheOperation)==null?void 0:o.deleteTaskFromCache(C.id)),g=!0}catch(F){y.debug("Task deletion failed.",F),g=!0}}}}const I=k.filter(A=>!p.some(S=>S.id===A.id)).filter(A=>v.some(S=>S.taskId===A.id));for(const A of I)await((l=this.plugin.tickTickRestAPI)==null?void 0:l.AddTask(A)),g=!0;const O=p.filter(A=>{const S=k.find(C=>C.id===A.id);return S&&new Date(S.modifiedTime)<new Date(A.modifiedTime)}),E=k.filter(A=>{const S=p.find(C=>C.id===A.id);return S&&new Date(S.modifiedTime)>new Date(A.modifiedTime)}),L=O.filter(A=>{const S=E.find(C=>C.id===A.id);return S&&S.modifiedTime===void 0?!0:S&&new Date(A.modifiedTime)>new Date(S.modifiedTime)});return L.length>0&&(await((c=this.plugin.fileOperation)==null?void 0:c.addTasksToFile(L,!0))&&(await new Promise(S=>setTimeout(S,1e3)),g=!0),await this.plugin.saveSettings(),_().debugMode&&y.debug(g?"File System Modified.":"No synchronization changes.")),g}catch(d){y.error("An error occurred while synchronizing:",d)}return!1}dumpArray(e,t){y.debug(e,t)}async backupTickTickAllResources(){var e;try{const t=await((e=this.plugin.tickTickRestAPI)==null?void 0:e.exportData());if(t){const i=new Date,r="ticktick-backup-"+`${i.getFullYear()}${i.getMonth()+1}${i.getDate()}${i.getHours()}${i.getMinutes()}${i.getSeconds()}`+".csv";await this.app.vault.create(r,t),new N.Notice(`TickTick backup data is saved in the path ${r}`)}}catch(t){y.error("An error occurred while creating TickTick backup",t),new N.Notice("An error occurred while creating TickTick backup"+t,5e3)}}async updateTaskContent(e){var n,r,a,o,l,c;const t=await((n=this.plugin.cacheOperation)==null?void 0:n.getFileMetadata(e));if(!t||!t.TickTickTasks)return;const i=(r=this.plugin.taskParser)==null?void 0:r.getObsidianUrlFromFilepath(e);try{for(const d of t.TickTickTasks){const g=await((a=this.plugin.cacheOperation)==null?void 0:a.loadTaskFromCacheID(d.taskId));if(g){g.title=g.title+" "+i;const f=await((o=this.plugin.tickTickRestAPI)==null?void 0:o.UpdateTask(g));f.title=await((l=this.plugin.taskParser)==null?void 0:l.stripOBSUrl(f.title)),await((c=this.plugin.cacheOperation)==null?void 0:c.updateTaskToCache(f))}else{const f="Task: "+d+"from file: "+e+"not found.";throw new Error(f)}}}catch(d){y.error("An error occurred in updateTaskDescription:",d)}}async checkForMoves(e,t){let i=!1;const n=await this.plugin.cacheOperation.getFilepathForTask(e);return n&&n!==t&&(i=!0),{projectMoved:i,oldFilePath:n}}async updateTaskLine(e,t,i,n,r,a){var d;let o={...e};o.items=[];const l=this.plugin.taskParser.getNumTabs(t);let c=await((d=this.plugin.taskParser)==null?void 0:d.convertTaskToLine(o,l));if(i&&n){const g={line:n.line,ch:0},f={line:n.line,ch:t.length};return i==null||i.replaceRange(c,g,f),c}else try{a.modifyTask(c,r);const g=this.app.vault.getAbstractFileByPath(a.getFilePath());await this.app.vault.modify(g,a.getFileLines())}catch(g){y.error(g)}}async confirmDeletion(e,t){var a;const i=await((a=this.plugin.cacheOperation)==null?void 0:a.getTaskTitles(e));return await new Va(this.app,i,t,o=>{this.ret=o}).showModal()}async handleTaskItem(e,t,i){var f,u,p,h,m;let n=!1,r=!1;if(!((f=this.plugin.taskParser)!=null&&f.isMarkdownTask(e)))return!1;let a;const o=this.plugin.taskParser.getLineItemId(e);if(o?a=t.getTaskItemRecord(o):i&&(a=t.getTaskItemRecordByLine(i)),!a)return y.warn("Item not found in file map: ",e),!1;if(!a.parentId||a.parentId===""||a.parentId.length<1)return!1;const l=a.parentId,c=a.ID,d=(u=this.plugin.taskParser)==null?void 0:u.taskFromLine(e),g=(p=this.plugin.cacheOperation)==null?void 0:p.loadTaskFromCacheID(l);if(g&&g.items)if(c){const k=g.items.find(T=>T.id==c);k?k.title.trim()!=d.description.trim()&&(k.title=d==null?void 0:d.description.trim(),k.status=d!=null&&d.status?2:0,n=!0):(y.warn("",d,"not found in parent items. Forcibly adding..."),g.items.push({id:c,title:d==null?void 0:d.description,status:d!=null&&d.status?2:0}))}else{const T=es().toHexString();g.items.push({id:T,title:d==null?void 0:d.description,status:d!=null&&d.status?2:0});const w=`${e} %%${T}%%`;try{const v=this.app.workspace.getActiveViewOfType(N.MarkdownView),b=(h=v==null?void 0:v.app.workspace.activeEditor)==null?void 0:h.editor,I={line:i,ch:0},O={line:i,ch:w.length};b==null||b.setLine(i,w)}catch(v){y.error(`Error updating item: ${v}`)}r=!0}else _().debugMode;if((n||r)&&g){const k=t.getFilePath();n=await this.updateTask(g,k),n&&await((m=this.plugin.cacheOperation)==null?void 0:m.updateTaskToCache(g,k))}return n}async updateTask(e,t){var r,a,o,l;if(e.modifiedTime=(r=this.plugin.dateMan)==null?void 0:r.formatDateToISO(new Date),await((a=this.plugin.cacheOperation)==null?void 0:a.updateTaskToCache(e)),_().fileLinksInTickTick!=="noLink"){let c=(o=this.plugin.taskParser)==null?void 0:o.getObsidianUrlFromFilepath(t);_().fileLinksInTickTick==="taskLink"&&c&&(e.title=e.title+" "+c)}const n=!await((l=this.plugin.tickTickRestAPI)==null?void 0:l.UpdateTask(e));return new N.Notice(`Task ${e.title} modified.`),!n}findTaskOrItemByLineNumber(e,t){for(let i of e)if(t>=i.startLine&&t<=i.endLine)return i;return null}}class ec extends N.Modal{constructor(e,t,i,n){super(e),this.title="Duplicate Projects/Lists found",this.cancelLabel="Cancel",this.confirmLabel="Abort Sync",this.projects=[],this.plugin=t,this.projects=i,this.message=`The following duplicate Projects/Lists were found. On ${_().baseURL},please either choose one of those to contain the tasks from both lists, or rename one of the lists.`,this.onSubmit=n}onOpen(){const{titleEl:e,contentEl:t}=this;e.setText(this.title),t.createEl("p",{text:`${this.message}`});const i=t.createEl("table","projects-table"),r=i.createEl("thead").createEl("tr"),a=r.createEl("th"),o=r.createEl("th");a.setText("Project Name"),o.setText("Project ID");const l=i.createEl("tbody");this.projects.forEach(c=>{const d=l.createEl("tr"),g=d.createEl("td","project-table-border"),f=d.createEl("td","project-table-border");g.setText(c.name),f.setText(c.id)}),new N.Setting(t).addButton(c=>{c.setClass("ts_button"),c.setWarning(),c.setButtonText(this.confirmLabel),c.onClick(()=>{this.result=!0,this.onSubmit(this.result),this.close()})})}onClose(){this.titleEl.empty(),this.contentEl.empty(),super.onClose(),this.resolvePromise(this.result)}showModal(){return this.open(),new Promise(e=>this.resolvePromise=e)}}const tc="[TickTickSync]",ic=y.methodFactory,sc={toString(){return`[${window.moment().format("YYYY-MM-DD-HH:mm:ss")}]`}};y.methodFactory=function(s,e,t){const i=s;return ic(s,e,t).bind(console,`${tc}[${i}]%s:`,sc)};y.rebuild();const ea=".md";class za{constructor(e,t){this.app=e,this.plugin=t}async addTaskToMetadata(e,t){const i=await this.getFileMetadata(e,t.projectId);if(!i)return;const n={taskId:t.id,taskItems:[]};t.items&&t.items.length>0&&t.items.forEach(r=>{n.taskItems.push(r.id)}),i.TickTickTasks.push(n),i.TickTickCount=i.TickTickTasks.length}async addTaskItemToMetadata(e,t,i,n){const r=await this.getFileMetadata(e,n),a=r.TickTickTasks.find(o=>o.taskId===t);a==null||a.taskItems.push(i),r.TickTickCount=r.TickTickTasks.length}async removeTaskItem(e,t,i){if(!e)return;if(e.TickTickTasks.findIndex(r=>r.taskId===t)!==-1){const r=this.loadTaskFromCacheID(t);if(!r||!r.items)return;let a=r.items;return i.forEach(o=>{a=a.filter(l=>l.id!==o)}),r.items=a,await this.updateTaskToCache(r)}else y.warn(`Task '${t}' not found in metadata`)}async getFileMetadata(e,t){const i=_().fileMetadata[e];return i||await this.newEmptyFileMetadata(e,t)}async getFileMetadatas(){return _().fileMetadata??null}async updateFileMetadata(e,t){const i=_().fileMetadata;i[e]||(i[e]={}),i[e].TickTickTasks=t.TickTickTasks,i[e].TickTickCount=t.TickTickCount,ge({fileMetadata:i}),await this.plugin.saveSettings()}async deleteTaskIdFromMetadata(e,t){const i=await this.getFileMetadata(e),r=i.TickTickTasks.filter(o=>o.taskId!==t),a=r.length;i.TickTickTasks=r,i.TickTickCount=a,await this.updateFileMetadata(e,i)}async updateTaskMetadata(e,t){await this.deleteTaskIdFromMetadataByTaskId(e.id),await this.addTaskToMetadata(t,e)}async deleteTaskIdFromMetadataByTaskId(e){const t=await this.getFileMetadatas();for(const i in t){const n=t[i].TickTickTasks;if(n&&n.find(r=>r.taskId===e)){await this.deleteTaskIdFromMetadata(i,e);break}}}async deleteFilepathFromMetadata(e){const t=_().fileMetadata,i={};for(const n in t)n!==e&&(i[n]=t[n]);return ge({fileMetadata:i}),await this.plugin.saveSettings(),_().fileMetadata}checkForDuplicates(e){var n;if(!e)return;const t={},i={};for(const r in e)(n=e[r].TickTickTasks)==null||n.forEach(a=>{if(!t.hasOwnProperty(a.taskId)){t[a.taskId]=r;return}i.hasOwnProperty(a.taskId)||(i[a.taskId]=[]),i[a.taskId].push(r)});return{taskIds:t,duplicates:i}}async checkFileMetadata(){var t,i;const e=await this.getFileMetadatas();for(const n in e){const r=e[n],a=this.app.vault.getAbstractFileByPath(n);if(!a&&(((t=r.TickTickTasks)==null?void 0:t.length)===0||!r.TickTickTasks)){y.error(`${n} does not exist and metadata is empty.`),await this.deleteFilepathFromMetadata(n);continue}if(!(((i=r.TickTickTasks)==null?void 0:i.length)===0||!r.TickTickTasks)&&!a){const o=r.TickTickTasks[0],l=await this.plugin.fileOperation.searchFilepathsByTaskidInVault(o.taskId);await this.updateRenamedFilePath(n,l),await this.plugin.saveSettings()}}return Object.keys(e).length}async getDefaultProjectNameForFilepath(e){const t=_().fileMetadata;if(!t[e]||t[e].defaultProjectId===void 0)return _().defaultProjectName;const i=t[e].defaultProjectId;return await this.getProjectNameByIdFromCache(i)}async getDefaultProjectIdForFilepath(e){const t=_().fileMetadata;if(!t[e]||!t[e].defaultProjectId){let i=_().defaultProjectId;return i||(i=_().inboxID),i}else{let i=t[e].defaultProjectId;return i||(i=_().inboxID),i}}async getFilepathForProjectId(e){const t=_().fileMetadata;for(const r in t)if(t[r].defaultProjectId===e)return r;if((e===_().inboxID||e===_().defaultProjectId)&&_().defaultProjectName)return _().defaultProjectName+ea;const i=await this.getProjectNameByIdFromCache(e);if(!i){const r=`File path not found for ${e}, returning ${i} instead.`;throw y.warn(r),new Error(r)}let n=`File path not found for ${e}, returning ${i} instead. `;return y.warn(n),i+ea}async setDefaultProjectIdForFilepath(e,t){const i=await this.getFileMetadata(e,t);i.defaultProjectId=t,(!i.TickTickTasks||!i.TickTickCount)&&(i.TickTickTasks=[],i.TickTickCount=0),await this.updateFileMetadata(e,i)}async loadTasksFromCache(){try{return ze()}catch(e){return y.error(`Error loading tasks from Cache: ${e}`),[]}}async saveTasksToCache(e){try{si(e)}catch(t){return y.error(`Error saving tasks to Cache: ${t}`),!1}}async appendTaskToCache(e,t){try{if(e===null)return;const i=ze();e.title=this.plugin.taskParser.stripOBSUrl(e.title),i.push(e),si(i),await this.addTaskToMetadata(t,e),await this.plugin.saveSettings()}catch(i){y.error(`Error appending task to Cache: ${i}`)}}loadTaskFromCacheID(e){if(e)try{return ze().find(i=>i.id===e)}catch(t){y.error("Error finding task from Cache:",t)}}async getTaskTitles(e){let i=ze().filter(n=>e.includes(n.id)).map(n=>n.title);return i=i.map(n=>this.plugin.taskParser.stripOBSUrl(n)),i}async updateTaskToCache(e,t=null){try{let i="";if(t)i=t;else if(i=await this.getFilepathForTask(e.id),i||(i=await this.getFilepathForProjectId(e.projectId)),!i)throw new Error(`File not found for ${e.id} - ${e.title}`);return await this.deleteTaskFromCache(e.id),await this.appendTaskToCache(e,i),e}catch(i){return y.error(`Error updating task to Cache: ${i}`),[]}}async getFilepathForTask(e){const t=await this.getFileMetadatas();for(const i in t)if(t[i].TickTickTasks.find(r=>r.taskId===e))return i;return null}async getProjectIdForTask(e){const t=ze(),i=t.findIndex(n=>n.id===e);if(i!==-1)return t[i].projectId}async reopenTaskToCacheByID(e){let t=null;try{const i=ze(),n=i.findIndex(r=>r.id===e);return n>-1&&(i[n].status=0,t=i[n].projectId),si(i),t}catch(i){throw y.error(`Error open task to Cache file: ${i}`),i}}async closeTaskToCacheByID(e){let t=null;try{const i=ze(),n=i.findIndex(r=>r.id===e);return n>-1&&(i[n].status=2,t=i[n].projectId),si(i),t}catch(i){throw y.error(`Error close task to Cache file: ${i}`),i}}async deleteTaskFromCache(e){try{const i=ze().filter(n=>n.id!==e);si(i),await this.deleteTaskIdFromMetadataByTaskId(e)}catch(t){y.error(`Error deleting task from Cache file: ${t}`)}}async deleteTaskFromCacheByIDs(e){try{const i=ze().filter(n=>!e.includes(n.id));si(i),e.forEach(async n=>{await this.deleteTaskIdFromMetadataByTaskId(n)})}catch(t){y.error(`Error deleting task from Cache : ${t}`)}}async getProjectIdByNameFromCache(e){try{const i=Ai().find(r=>r.name.toLowerCase()===e.toLowerCase());return i?i.id:null}catch(t){return y.error(`Error finding project from Cache file: ${t}`),!1}}async getProjectNameByIdFromCache(e){try{const i=Ai().find(n=>n.id===e);return i?i.name:void 0}catch(t){y.error(`Error finding project from Cache file: ${t}`)}}async saveProjectsToCache(e){try{const t={id:_().inboxID,name:_().inboxName};e.push(t);const n=e.reduce((r,a,o,l)=>(l.findIndex(d=>d.name===a.name&&d.id!==a.id)!==-1&&!r.includes(a)&&r.push(a),r),[]).sort((r,a)=>r.name.localeCompare(a.name));if(n.length>0){const r=n.map(a=>`${a.id} ${a.name}`);return y.debug("Found duplicate lists: ",r),await this.showFoundDuplicatesModal(this.app,this.plugin,n),!1}return qa(e),await this.plugin.saveSettings(),!0}catch(t){y.error("Error on save projects: ",t),new N.Notice(`error on save projects: ${t}`)}return!1}async updateRenamedFilePath(e,t){try{const n=(await this.loadTasksFromCache()).map(a=>a.path===e?{...a,path:t}:a);await this.saveTasksToCache(n);const r=_().fileMetadata;r[t]=r[e],delete r[e],ge({fileMetadata:r})}catch(i){y.error(`Error updating renamed file path to cache: ${i}`)}}findTaskInMetada(e,t){const i=_().fileMetadata;for(const n in i){if(y.debug("in file: :",n),n==t){y.debug("breaking");continue}const r=i[n].TickTickTasks;for(const a of r)if(a.taskId===e)return y.debug("found"),!0}return y.debug("not found"),!1}async isProjectMoved(e,t){const i=await this.getFilepathForTask(e.id);return i?i!=t?i:null:!1}isTaskInCache(e){try{if(ze().find(n=>n.id===e))return!0}catch(t){return y.error(`Error finding task from Cache: ${t}`),!1}return!1}async findTaskInFilesTrash(e){const t=this.app.vault.getMarkdownFiles();for(const i of t){const n=new Dt(this.app,this.plugin,i);if(await n.init(),n.getTaskIndex(e)!==-1)return i.path}return null}findTaskInFiles(e){const t=_().fileMetadata,i=Object.keys(t);let n=null;return i.forEach(r=>{const a=t[r].TickTickTasks;for(const o of a)if(o.taskId===e){n=r;return}}),n}async newEmptyFileMetadata(e,t){if(e instanceof N.TAbstractFile&&e instanceof N.TFile&&(e=e.name),!e){y.error("Attempt to create undefined FileMetaData Entry: ",e);return}if(this.app.vault.getAbstractFileByPath(e)instanceof N.TFolder){y.error("Not adding ",e," to Metadata because it's a folder.");return}const n=_().fileMetadata;return n[e]?n[e]:(n[e]={TickTickTasks:[],TickTickCount:0,defaultProjectId:t},ge({fileMetadata:n}),await this.plugin.saveSettings(),_().fileMetadata[e])}async findInFile(e,t){const n=(await this.app.vault.cachedRead(e)).split(`
`);return t.map(a=>a.position.start.line).map(a=>n[a]).map(a=>this.plugin.taskParser.getTickTickId(a)).filter(a=>a!==null)}async showFoundDuplicatesModal(e,t,i){return await new ec(e,t,i,r=>{}).showModal()}}class Ga{constructor(e,t){this.app=e,this.plugin=t}async completeTaskInTheFile(e){var o,l,c;await((o=this.plugin.cacheOperation)==null?void 0:o.loadTaskFromCacheID(e));const t=await((l=this.plugin.cacheOperation)==null?void 0:l.getFilepathForTask(e)),i=this.app.vault.getAbstractFileByPath(t),r=(await this.app.vault.read(i)).split(`
`);let a=!1;for(let d=0;d<r.length;d++){const g=r[d];if(g.includes(e)&&((c=this.plugin.taskParser)!=null&&c.hasTickTickTag(g))){r[d]=g.replace("[ ]","[x]"),a=!0;break}}if(a){const d=r.join(`
`);await this.app.vault.modify(i,d)}}async uncompleteTaskInTheFile(e){var o,l,c;await((o=this.plugin.cacheOperation)==null?void 0:o.loadTaskFromCacheID(e));const t=await((l=this.plugin.cacheOperation)==null?void 0:l.getFilepathForTask(e)),i=this.app.vault.getAbstractFileByPath(t),r=(await this.app.vault.read(i)).split(`
`);let a=!1;for(let d=0;d<r.length;d++){const g=r[d];if(g.includes(e)&&((c=this.plugin.taskParser)!=null&&c.hasTickTickTag(g))){r[d]=g.replace(/- \[(x|X)\]/g,"- [ ]"),a=!0;break}}if(a){const d=r.join(`
`);await this.app.vault.modify(i,d)}}async addTickTickTagToFile(e){if(e.markAllTasks()){const t=e.getFileLines();await this.app.vault.modify(e.file,t),new N.Notice("New Tasks will be added to TickTick on next Sync.")}}async addTickTickLinkToFile(e){var a,o,l,c,d,g;const t=this.app.vault.getAbstractFileByPath(e);if(t&&t instanceof N.TFolder)return;const n=(await this.app.vault.read(t)).split(`
`);let r=!1;for(let f=0;f<n.length;f++){const u=n[f];if((a=this.plugin.taskParser)!=null&&a.hasTickTickId(u)&&((o=this.plugin.taskParser)!=null&&o.hasTickTickTag(u))){if((l=this.plugin.taskParser)!=null&&l.hasTickTickLink(u))return;const p=(c=this.plugin.taskParser)==null?void 0:c.getTickTickId(u),h=await((d=this.plugin.cacheOperation)==null?void 0:d.loadTaskFromCacheID(p)),m=(g=this.plugin.taskParser)==null?void 0:g.addTickTickLink(u,h.id,h.projectId);n[f]=m,r=!0}else continue}if(r){const f=n.join(`
`);await this.app.vault.modify(t,f)}}async addTasksToFile(e,t){var n,r;if(!e)return y.error("No tasks to add."),!1;e.sort((a,o)=>a.projectId.localeCompare(o.projectId)||a.id.localeCompare(o.id));const i=[...new Set(e.map(a=>a.projectId))];for(const a of i){let o,l=null,c=e.filter(d=>d.projectId===a);if(a!==_().defaultProjectId)l=await((n=this.plugin.cacheOperation)==null?void 0:n.getFilepathForProjectId(a)),o=await this.doTheAdding(l,c,t);else{const d=[],g=await((r=this.plugin.cacheOperation)==null?void 0:r.getFilepathForProjectId(_().defaultProjectId));for(const f of c)l=this.plugin.cacheOperation.findTaskInFiles(f.id),y.debug("taskFile",l),l?(y.debug("adding to ",l),this.addTaskToTFF(d,l,f)):(y.debug("adding to ",g),this.addTaskToTFF(d,g,f));for(const{file:f,tasks:u}of d)o=await this.doTheAdding(f,u,t)}if(o&&await new Promise(d=>setTimeout(d,1e3)),_().debugMode){let d="";t?d="updating":d="adding",y.debug("===",l,c,o?"Completed "+d+" task(s).":" Failed "+d+" task(s).")}}return!0}async getOrCreateDefaultFile(e){let t;try{const i=_().TickTickTasksFilePath;let n=this.app.vault.getAbstractFileByPath(i);n instanceof N.TFolder||(y.warn(`Folder ${i} does not exit. It will be created`),n=await this.app.vault.createFolder(i)),new N.Notice(`Creating new file: ${n.path}/${e}`),y.warn(`Creating new file: ${n.path}/${e}`),e=`${n.path}/${e}`;const r=`${this.plugin.manifest.name} -- ${this.plugin.manifest.version}`;try{t=await this.app.vault.create(e,`== Added by ${r} == `)}catch(a){if(a.message.includes("File already exists")){if(y.info("Attempting to find existing file",e),t=this.app.vault.getAbstractFileByPath(e),!t){const o=e.split("/").pop();if(o){const l=this.app.vault.getMarkdownFiles();for(const c of l)if(y.debug("Checking file",c.path),c.path.toLowerCase()===o.toLowerCase()){y.debug("Found existing file",c.path),t=c;break}}}}else throw a}return t}catch(i){throw y.error("Error on create file: ",i),new Error(i)}}async updateTaskInFile(e){var a,o,l,c;const t=e.id,i=(a=this.plugin.cacheOperation)==null?void 0:a.loadTaskFromCacheID(t);(o=this.plugin.dateMan)==null||o.addDateHolderToTask(e,i);let n=await((l=this.plugin.cacheOperation)==null?void 0:l.getFilepathForTask(t));if(!n&&(n=await((c=this.plugin.cacheOperation)==null?void 0:c.getFilepathForProjectId(e.projectId)),!n))throw new Error(`File not found for ${e.id}, ${e.title}`);const r=this.app.vault.getAbstractFileByPath(n);await this.addProjectTasksToFile(r,[e],!0)}async checkForDuplicates(e,t){let i={},n={};if(!e)return;let r;try{for(const a in e){r=a;const o=this.app.vault.getAbstractFileByPath(a);if(!o){y.debug("Duplicate check Skipping ",a," because it's not found.");continue}if(o&&o instanceof N.TFolder){y.debug("Duplicate check Skipping ",a," because it's a folder.");continue}try{const l=await this.app.vault.read(o);for(let c in t)l.includes(c)&&(i[c]?(n[c]||(n[c]=[i[c]]),n[c].push(a)):i[c]=a)}catch{y.error("Duplicate check Skipping ",a," because it's not readable.");continue}}return n}catch(a){const o=`File [${r}] not found, or is locked. If file exists, Please try again later.`;throw y.error(a,o),new Error(o)}}async deleteTaskFromSpecificFile(e,t,i){if(i&&!await this.confirmDeletion(t.title+"in File: "+e))return new N.Notice("Tasks will not be deleted. Please rectify the issue before the next sync.",5e3),[];y.info("Task being deleted from file: ",t.id,e);const n=new Dt(this.app,this.plugin,e);await n.init(),n.deleteTask(t.id);const r=n.getFileLines();await this.app.vault.modify(e,r),this.plugin.lastLines.set(e.path,r.length)}async deleteTaskFromFile(e){var r;const t=e.id,i=await((r=this.plugin.cacheOperation)==null?void 0:r.getFilepathForTask(t)),n=this.app.vault.getAbstractFileByPath(i);if(i)await this.deleteTaskFromSpecificFile(n,e,!1);else throw new Error(`File not found for ${e.title}. File path found is ${i}`)}async searchTickTickIdFromFilePath(e,t){const i=this.app.vault.getAbstractFileByPath(e),r=(await this.app.vault.read(i)).split(`
`);let a=null;for(let o=0;o<r.length;o++){const l=r[o];if(l.includes(t)){const c=/\[ticktick_id::\s*(\w+)\]/.exec(l);c&&(a=c[1]);break}}return a}async getAllFilesInTheVault(){return this.app.vault.getFiles()}async searchFilepathsByTaskidInVault(e){const i=(await this.getAllFilesInTheVault()).map(async a=>{if(!this.isMarkdownFile(a.path))return;if((await this.app.vault.cachedRead(a)).includes(e))return a.path});return(await Promise.all(i)).filter(a=>a!==void 0)[0]||null}isMarkdownFile(e){let t=e.split(".").pop();return t=t.toLowerCase(),t==="md"}async doTheAdding(e,t,i){let n,r;return e&&(n=this.app.vault.getAbstractFileByPath(e),n instanceof N.TFile||(n=await this.getOrCreateDefaultFile(e),y.debug("Creating new file: ",n.path))),t=this.doTheSortMambo(t),r=await this.addProjectTasksToFile(n,t,i),r}async addProjectTasksToFile(e,t,i){try{const n=await this.writeLines(t,e,i);return await this.app.vault.process(e,r=>(r=n,r)),!0}catch(n){return y.error(`Could not ${i?"update":"add"} Tasks to file ${e.path} 
 Error: ${n}`),!1}}async writeLines(e,t,i){var l,c,d,g,f,u,p,h,m,k,T,w;const n=new Dt(this.app,this.plugin,t);await n.init();let r=!1;const a=[];for(const v of e){let b=0;const I=v.parentId;I&&(b=n.getNumParentTabs(I)+1);let O="";if(i){const A=(d=this.plugin.cacheOperation)==null?void 0:d.loadTaskFromCacheID(v.id);if((g=this.plugin.dateMan)==null||g.addDateHolderToTask(v,A),O=await((f=this.plugin.taskParser)==null?void 0:f.convertTaskToLine(v,b)),A)if((u=this.plugin.taskParser)!=null&&u.isProjectIdChanged(A,v))y.debug("Moving Task: ",v.id,v.title," from Project: ",A.projectId," to Project: ",v.projectId),await this.handleTickTickStructureMove(v,A),n.addTask(v,O),r=!0;else{const S=(p=this.plugin.taskParser)==null?void 0:p.isParentIdChanged(A,v);n.updateTask(v,O,S)}else y.warn("No Old Task found for: ",v.id)}else if(O=await((l=this.plugin.taskParser)==null?void 0:l.convertTaskToLine(v,b)),n.getTaskIndex(v.id)!=-1){y.warn("A Task was being added but was already in file: ",v.id,v.title),n.updateTask(v,O),await((c=this.plugin.cacheOperation)==null?void 0:c.updateTaskToCache(v,t.path)),a.push(v.id);continue}else n.addTask(v,O);let E=(h=this.plugin.taskParser)==null?void 0:h.getAllTagsFromLineText(O);E&&(v.tags=E);let L=(m=this.plugin.taskParser)==null?void 0:m.getObsidianUrlFromFilepath(t.path);if(L&&(v.title=v.title+" "+L),!i||r){let A=await((k=this.plugin.tickTickRestAPI)==null?void 0:k.UpdateTask(v));await((T=this.plugin.cacheOperation)==null?void 0:T.appendTaskToCache(A,t.path)),r=!1}else await((w=this.plugin.cacheOperation)==null?void 0:w.updateTaskToCache(v,t.path))}const o=n.getFileLines();return this.plugin.lastLines.set(t.path,o.length),o}hasChildren(e){var t;return e.childIds?((t=e.childIds)==null?void 0:t.length)>0:!1}async confirmDeletion(e){const t=[];t.push(e);const i="task not found in local cache.";return await new Va(this.app,t,i,a=>{this.ret=a}).showModal()}async handleTickTickStructureMove(e,t){var r,a,o,l,c,d;y.debug("deleting old task: ",t.id,t.title," from file"),await this.deleteTaskFromOldFile(t,e),await((r=this.plugin.cacheOperation)==null?void 0:r.deleteTaskFromCache(t.id));const i=(a=this.plugin.taskParser)==null?void 0:a.stripOBSUrl(e.title);let n="";if(e.projectId!=t.projectId){const g=await((o=this.plugin.cacheOperation)==null?void 0:o.getProjectNameByIdFromCache(e.projectId)),f=await((l=this.plugin.cacheOperation)==null?void 0:l.getProjectNameByIdFromCache(t.projectId));n=`Task Moved.
Task: `+i+`
was moved from
 `+f+`
to
`+g}else if(e.parentId){const g=await((c=this.plugin.cacheOperation)==null?void 0:c.loadTaskFromCacheID(e.parentId)),f=(d=this.plugin.taskParser)==null?void 0:d.stripOBSUrl(g.title);n=`Task has new Parent.
Task: `+i+`
is now a child of
 `+f}else n=`Task is now a top level task.
Task: `+i;new N.Notice(n,5e3)}async deleteTaskFromOldFile(e,t){var o;const i=await((o=this.plugin.cacheOperation)==null?void 0:o.getFilepathForTask(e.id));if(!i){let l=`File not found for moved newTask:  ${t.id}, ${t.title}`;throw new Error(l)}const n=this.app.vault.getAbstractFileByPath(i),r=new Dt(this.app,this.plugin,n);await r.init(),r.deleteTask(e.id);const a=r.getFileLines();return await this.app.vault.process(n,l=>(l=a,l)),i}async moveChildTasks(e,t,i){var n,r,a;for(const o of e.childIds){if(t.includes(o))continue;const l=await((n=this.plugin.cacheOperation)==null?void 0:n.loadTaskFromCacheID(o));if(l){l.parentId=e.id,l.projectId=e.projectId;const c=(r=l.items)==null?void 0:r.length;if(await this.moveTask(i,l,c,l.id,l.projectId),this.hasChildren(l)){const g=await((a=this.plugin.cacheOperation)==null?void 0:a.loadTaskFromCacheID(o));await this.moveChildTasks(g,t,i)}}else y.warn("Child not found: ",o)}}async moveTask(e,t,i,n,r){var c,d,g,f,u,p;const a=this.app.vault.getAbstractFileByPath(e);await this.deleteTaskFromSpecificFile(a,t,!1),await((c=this.plugin.cacheOperation)==null?void 0:c.deleteTaskFromCache(n)),await this.addTasksToFile([t]);const o=(d=this.plugin.taskParser)==null?void 0:d.stripOBSUrl(t.title);let l="";if(t.projectId!=r){const h=await((g=this.plugin.cacheOperation)==null?void 0:g.getProjectNameByIdFromCache(t.projectId)),m=await((f=this.plugin.cacheOperation)==null?void 0:f.getProjectNameByIdFromCache(r));l=`Task Moved.
Task: `+o+`
was moved from
 `+m+`
to
`+h}else if(t.parentId){const h=await((u=this.plugin.cacheOperation)==null?void 0:u.loadTaskFromCacheID(t.parentId)),m=(p=this.plugin.taskParser)==null?void 0:p.stripOBSUrl(h.title);l=`Task has new Parent.
Task: `+o+`
is now a child of
 `+m}else l=`Task is now a top level task.
Task: `+o;new N.Notice(l,5e3)}compareTasks(e,t){return!e.parentId&&t.parentId?-1:e.parentId&&!t.parentId?1:e.parentId&&t.parentId?t.parentId.localeCompare(e.parentId):e.sortOrder-t.sortOrder}getParent(e,t){return t.find(i=>i.id===e)}sortChildrenfirst(e){const t=[],i=new Map;e.forEach(r=>i.set(r.id,r));const n=r=>{t.includes(r)||(r.childIds&&r.childIds.forEach(a=>{const o=i.get(a);o&&n(o)}),t.push(r))};return e.forEach(r=>{n(r)}),t}sortTasks(e){const t=new Map;e.forEach(r=>t.set(r.id,{...r,children:[]}));let i=[];e.forEach(r=>{r.parentId&&t.has(r.parentId)?t.get(r.parentId).children.push(t.get(r.id)):i.push(t.get(r.id))});function n(r,a=[]){for(const o of r)a.push(o),o.children.length&&n(o.children,a);return a}return n(i).map(({children:r,...a})=>a)}doTheSortMambo(e){const t=JSON.parse(JSON.stringify(e)),i=this.sortTasksByLevel(t);return i.map(n=>`${"  ".repeat(n.level-1)}${n.title} (Level: ${n.level})`).join(`
`),i}sortTasksByLevel(e){const t={};e.forEach(n=>{t[n.id]={...n,level:0}}),e.forEach(n=>{if(!("parentId"in n)||!n.parentId)t[n.id].level=1;else{let r=n.id,a=1;for(;t[r]&&"parentId"in t[r]&&t[r].parentId;){if(a++,a>6)throw y.debug("this is the issue: ",r," ",t[r].parentId,""),new N.Notice("A circular Parent-Child dependency was found. Please fix in TickTick by checking parent-child relationships."),new Error("Circular Parent-Child dependency was found.");r=t[r].parentId}t[n.id].level=a}});const i=Object.values(t);return i.sort((n,r)=>n.level!==r.level?n.level-r.level:n.sortOrder-r.sortOrder),i}addTaskToTFF(e,t,i){let n=e.find(r=>r.file===t);n||(n={file:t,tasks:[]},e.push(n)),n.tasks.push(i)}}const pt="LOCK_TASKS";class nc{constructor(e){this.initialized=!1,this.plugin=e}initialize(){try{const e=_().token;return e?(_().inboxID.length===0&&y.warn("Something is wrong with your inbox ID."),this.api=new Qn({baseUrl:_().baseURL,token:e,checkPoint:_().checkPoint}),this.cacheOperation=new za(this.plugin.app,this.plugin),this.fileOperation=new Ga(this.plugin.app,this.plugin),this.tickTickSync=new Zl(this.plugin.app,this.plugin),this.initialized=!0,!0):(y.debug("Please login from settings."),!1)}catch(e){y.error("Error on initialization: ",e)}return!1}backup(){var e;(e=this.tickTickSync)==null||e.backupTickTickAllResources()}async login(e,t,i){try{const n=new Qn({username:t,password:i,baseUrl:e,token:"",checkPoint:0}),r=await n.login();let a;if(!r){a=n.lastError;const o="Login Failed. "+JSON.stringify(a.errorMessage,null,4);throw new N.Notice(o,5e3),new Error(a.errorMessage)}return ge({checkPoint:0}),await this.plugin.saveSettings(),r}catch(n){y.error("Error on login: ",n)}return null}async synchronization(){try{if(await ht(pt,async()=>await this.syncTickTickToObsidian()))return;await this.syncFiles()}catch(e){y.error("Error on synchronization: ",e)}}async saveProjectsToCache(){var t;const e=await((t=this.api)==null?void 0:t.getProjects());return e?this.cacheOperation.saveProjectsToCache(e):!1}async getProjects(){return Ai()}async getTasks(e){return y.debug("getTasks",e),ze()}async deletedTaskCheck(e){return await ht(pt,async()=>{var t;return(t=this.tickTickSync)==null?void 0:t.deletedTaskCheck(e)})}async deletedFileCheck(e){var i;const t=await((i=this.cacheOperation)==null?void 0:i.getFileMetadata(e,null));return!t||!t.TickTickTasks?!1:(await ht(pt,async()=>{await this.tickTickSync.deletedTaskCheck(e),await this.cacheOperation.deleteFilepathFromMetadata(e)}),!0)}async renamedFileCheck(e,t){var n;const i=await((n=this.cacheOperation)==null?void 0:n.getFileMetadata(t,null));return!i||!i.TickTickTasks?!1:(await ht(pt,async()=>{await this.tickTickSync.updateTaskContent(e),await this.cacheOperation.updateRenamedFilePath(t,e)}),!0)}async fullTextNewTaskCheck(e){await ht(pt,async()=>{var t;await((t=this.tickTickSync)==null?void 0:t.fullTextNewTaskCheck(e))})}async lineNewContentTaskCheck(e,t){return await ht(pt,async()=>{var i;await((i=this.tickTickSync)==null?void 0:i.lineNewContentTaskCheck(e,t))})}async lineModifiedTaskCheck(e,t,i){return await ht(pt,async()=>{var a;const n=this.plugin.app.vault.getAbstractFileByPath(e),r=new Dt(this.plugin.app,this.plugin,n);return await r.init(),(a=this.tickTickSync)==null?void 0:a.lineModifiedTaskCheck(e,t,i,r)})}async checkDataBase(){var n,r;const e=this.plugin.app.vault,t=await((n=this.plugin.cacheOperation)==null?void 0:n.checkFileMetadata());y.debug(`checking metadata for ${t} files`),(!t||t<1)&&(y.debug("File Metadata rebuild."),e.getMarkdownFiles().forEach(o=>{var l;(l=this.tickTickSync)==null||l.fullTextModifiedTaskCheck(o.path)})),await this.plugin.saveSettings();const i=await((r=this.cacheOperation)==null?void 0:r.getFileMetadatas());y.debug("checking deleted tasks"),await ht(pt,async()=>{var a,o,l,c,d,g,f,u;for(const p in i){const h=i[p];for(const m of h.TickTickTasks){let k;try{k=(a=this.plugin.cacheOperation)==null?void 0:a.loadTaskFromCacheID(m.taskId)}catch(T){y.error("An error occurred while loading task cache: ",T)}if(!k)try{k=await((o=this.plugin.tickTickRestAPI)==null?void 0:o.getTaskById(m.taskId)),k&&k.deleted===1&&await((l=this.plugin.cacheOperation)==null?void 0:l.deleteTaskIdFromMetadata(p,m.taskId))}catch(T){if(T.message.includes("404")){await((c=this.plugin.cacheOperation)==null?void 0:c.deleteTaskIdFromMetadata(p,m.taskId));continue}else{y.error("An error occurred while loading task from api: ",T);continue}}}}await this.plugin.saveSettings(),y.debug("checking renamed files -- This operation takes a while, please be patient.");try{for(const p in i){y.debug("Checking Renamed: ",p);const h=i[p],m=this.plugin.taskParser.getObsidianUrlFromFilepath(p);for(const k of h.TickTickTasks){let T;try{T=(d=this.plugin.cacheOperation)==null?void 0:d.loadTaskFromCacheID(k.taskId)}catch(v){y.warn(`An error occurred while loading task ${k.taskId} from cache:`,v)}if(!T){y.warn(`Task ${k.id}: ${k.title} is not found.`);continue}if(!((T==null?void 0:T.title)??"").includes(m))try{await((g=this.tickTickSync)==null?void 0:g.updateTaskContent(p))}catch(v){y.warn("An error occurred while updating task description:",v)}}}y.debug("Done File Rename check.");try{y.debug("checking unsynced tasks");const p=e.getFiles();for(const h of p)if(h.extension=="md")try{if(y.debug(`Scanning file ${h.path}`),_().taskLinksInObsidian==="taskLink"&&await((f=this.plugin.fileOperation)==null?void 0:f.addTickTickLinkToFile(h.path)),_().enableFullVaultSync){const m=new Dt(this.plugin.app,this.plugin,h);await m.init(),await((u=this.plugin.fileOperation)==null?void 0:u.addTickTickTagToFile(m))}}catch(m){y.error(`An error occurred while check new tasks in the file: ${h.path}`,m)}}catch(p){y.error("An error occurred while checking for unsynced tasks.:",p);return}new N.Notice("All files have been scanned.")}catch(p){y.warn("An error occurred while scanning the vault.:",p)}}),y.debug("Done checking data.")}async closeTask(e){await this.tickTickSync.closeTask(e)}async openTask(e){await this.tickTickSync.reopenTask(e)}async syncTickTickToObsidian(){return this.tickTickSync.syncTickTickToObsidian()}async syncFiles(){var i,n,r;const e=_().fileMetadata;if(!e){y.warn("No sync files found.");return}let t=e;_().SyncProject&&(t=Object.fromEntries(Object.entries(e).filter(([a,o])=>o.defaultProjectId===_().SyncProject)));try{const a=(i=this.cacheOperation)==null?void 0:i.checkForDuplicates(t);if(a!=null&&a.duplicates&&JSON.stringify(a.duplicates)!="{}"){let l="";for(const d in a.duplicates)l+="Task: "+d+`
in files: 
`,a.duplicates[d].forEach(g=>{l+=g+`
`});const c=`Found duplicates in MetaData.

${l}
Please fix manually. This causes unpredictable results
Please open an issue in the TickTickSync repository if you continue to see this issue.

To prevent data corruption. Sync is aborted.`;y.error("Metadata Duplicates: ",a.duplicates),new N.Notice(c,5e3);return}const o=await((n=this.fileOperation)==null?void 0:n.checkForDuplicates(e,a==null?void 0:a.taskIds));if(o&&JSON.stringify(o)!="{}"){let l="";for(let d in o)l+="Task: "+d+`
Found in Files: 
`,o[d].forEach(g=>{l+=g+`
`});const c=document.createDocumentFragment();c.appendChild(document.createTextNode("Found duplicates in Files.                                                             ")),c.appendChild(document.createElement("br")),c.appendChild(document.createTextNode(`${l}`)),c.appendChild(document.createElement("br")),c.appendChild(document.createTextNode("Please fix manually to avoid unpredictable results.")),c.appendChild(document.createElement("br")),c.appendChild(document.createElement("br")),c.appendChild(document.createTextNode("Please open an issue in the TickTickSync repository if you continue to see this issue.")),c.appendChild(document.createElement("br")),c.appendChild(document.createElement("br")),c.appendChild(document.createTextNode("Sync is aborted to prevent data corruption.")),new N.Notice(c,0),y.error("Duplicates in file: ",l);return}}catch(a){y.error(a),new N.Notice(`Duplicate check failed:  ${Error}`,5e3);return}y.debug("New Files: ",t);for(const a in t)if(!this.plugin.app.vault.getAbstractFileByPath(a)){y.debug("File ",a," was deleted before last sync."),await((r=this.cacheOperation)==null?void 0:r.deleteFilepathFromMetadata(a));const l=t.findIndex(a);t.splice(l,1)}for(const a in t)_().debugMode&&y.debug(a),await ht(pt,async()=>{var o;try{await((o=this.tickTickSync)==null?void 0:o.fullTextNewTaskCheck(a))}catch(l){y.error("An error occurred in fullTextNewTaskCheck:",l)}}),await ht(pt,async()=>{var o;try{await((o=this.tickTickSync)==null?void 0:o.fullTextModifiedTaskCheck(a))}catch(l){y.error("An error occurred in fullTextModifiedTaskCheck:",l)}}),await ht(pt,async()=>{var o;try{await((o=this.tickTickSync)==null?void 0:o.deletedTaskCheck(a))}catch(l){y.error("An error occurred in deletedTaskCheck:",l)}})}}class rc{constructor(e,t,i){if(this.app=e,this.plugin=t,this.token=_().token,this.baseURL=_().baseURL,!this.token||this.token==="")throw new N.Notice("Please login from Settings.",5e3),this.api=null,y.error("No Token"),new Error("API Not Initialized.");_().debugMode&&y.debug(JSON.stringify({baseUrl:this.baseURL,token:"["+this.token.substring(0,10)+"...] len: "+this.token.length})),i?this.api=i:(this.api=new Qn({baseUrl:_().baseURL,token:this.token,checkPoint:_().checkPoint}),this.api.inboxProperties={id:_().inboxID,sortOrder:0})}async initializeAPI(){var t,i,n,r,a;if(this.api===null||this.api===void 0)throw new Error("API Not Initialized. Please restart Obsidian.");let e=_().token;if(!e)try{if(await((t=this.api)==null?void 0:t.getUserSettings())){e=!0,await((i=this.api)==null?void 0:i.getInboxProperties());let l=!1;_().inboxID!=((n=this.api)==null?void 0:n.inboxId)&&(l=!0),_().defaultProjectId||ge({defaultProjectId:(r=this.api)==null?void 0:r.inboxId,defaultProjectName:"Inbox"}),l&&await this.plugin.saveSettings()}else y.error((a=this.api)==null?void 0:a.lastError);e?_().debugMode&&y.debug(`Logged In: ${e}`):(new N.Notice("Login failed, please login through settings."),y.error("Login failed! "))}catch(o){y.error("Login failed! ",o),new N.Notice(`Login failed: ${o}
Please login again`)}finally{await this.plugin.saveSettings()}}async AddTask(e){var t;await this.initializeAPI();try{return await((t=this.api)==null?void 0:t.addTask(e))}catch(i){throw new Error(`Error adding task: ${i.message}`)}}async deleteTask(e,t){var i;await this.initializeAPI();try{return await((i=this.api)==null?void 0:i.deleteTask(e,t))}catch(n){throw new Error(`Error deleting task: ${n.message}`)}}async getProjectSections(e){var t;await this.initializeAPI();try{return await((t=this.api)==null?void 0:t.getProjectSections(e))}catch(i){throw new Error(`Error getting Sections: ${i.message}`)}}async GetActiveTasks(){var e;await this.initializeAPI();try{return await((e=this.api)==null?void 0:e.getTasks())}catch(t){throw new Error(`Error get active tasks: ${t.message}`)}}async UpdateTask(e){var t,i,n;await this.initializeAPI();try{let r={};const a=e.dateHolder,o=await((t=this.api)==null?void 0:t.updateTask(e));if(!o){y.error("Error","Update Failed.",(i=this.api)==null?void 0:i.lastError,e);const l="Error updating task: "+((n=this.api)==null?void 0:n.lastError);throw new Error(l)}return JSON.stringify(o.id2error)==="{}"&&(r=await this.getTaskById(e.id,e.projectId),r?r.dateHolder=a:y.error("Didn't get back the updated Task")),r}catch(r){throw new Error(`Error updating task: ${r.message}`)}}async modifyTaskStatus(e,t,i){var n,r;await this.initializeAPI();try{let a=await((n=this.api)==null?void 0:n.getTask(e,t));return a?(a.status=i,await((r=this.api)==null?void 0:r.updateTask(a))):!1}catch(a){y.error("Error modifying task:",a);return}}async OpenTask(e,t){await this.initializeAPI();try{this.modifyTaskStatus(e,t,0)}catch(i){y.error("Error open a task:",i);return}}async CloseTask(e,t){await this.initializeAPI();try{return this.modifyTaskStatus(e,t,2)}catch(i){throw y.error("Error closing task:",i),i}}async getTaskById(e,t){var i;if(await this.initializeAPI(),!e)throw new Error("taskId is required");try{return await((i=this.api)==null?void 0:i.getTask(e,t))}catch(n){if(n.response&&n.response.status){const r=n.response.status;throw new Error(`Error retrieving task. Status code: ${r}`)}else throw new Error(`Error retrieving task: ${n.message}`)}}async getTaskDueById(e){var t;if(await this.initializeAPI(),!e)throw new Error("taskId is required");try{const i=await((t=this.api)==null?void 0:t.getTask(e,null));return(i==null?void 0:i.dueDate)??null}catch(i){throw new Error(`Error get Task Due By ID: ${i.message}`)}}async GetAllProjects(){var e;await this.initializeAPI();try{return await((e=this.api)==null?void 0:e.getProjects())??[]}catch(t){return y.error("Error get all projects",t),[]}}async GetProjectGroups(){var e,t,i,n;await this.initializeAPI();try{const r=await((e=this.api)==null?void 0:e.getProjectGroups());if((r==null?void 0:r.length)==0&&((t=this.api)!=null&&t.lastError)&&((i=this.api)==null?void 0:i.lastError.statusCode)!=200){let a=(n=this.api)==null?void 0:n.lastError;throw y.error("Error: ",a.operation,a.statusCode,a.errorMessage),new Error(a.errorMessage)}return r}catch(r){return y.error("Error get project groups",r),new N.Notice("Unable to get project groups: "+r,5e3),!1}}async getUserResources(){var e;await this.initializeAPI();try{return await((e=this.api)==null?void 0:e.getUserSettings())}catch(t){return y.error("Error get user resources",t),[]}}async getAllCompletedItems(){var e;await this.initializeAPI();try{return await((e=this.api)==null?void 0:e.getAllCompletedItems())}catch(t){return y.error("Error get all completed items",t),[]}}async getAllResources(){var e;if(await this.initializeAPI(),!this.api)return y.error("getAllResources No API."),null;try{const t=await this.api.getAllResources();if(!t||this.api.lastError&&this.api.lastError.statusCode!=200)throw new Error("getAllResources No Results.");return _().checkPoint!=t.checkPoint&&(this.api.checkpoint=t.checkPoint,_().checkPoint=(e=this.api)==null?void 0:e.checkpoint,await this.plugin.saveSettings()),t}catch(t){y.error("Error get all resources",t)}return null}async getAllTasks(){var e,t;await this.initializeAPI();try{const i=await((e=this.api)==null?void 0:e.getTaskDetails());if(!i||i.length===0&&((t=this.api)==null?void 0:t.lastError.statusCode)!=200)throw new Error("No Results.");return i}catch(i){return y.error("Error get all Tasks",i),[]}}async exportData(){var t,i;await this.initializeAPI();const e=await((t=this.api)==null?void 0:t.exportData());if(!e){let n=JSON.stringify((i=this.api)==null?void 0:i.lastError);throw n=n.replace(/{/g,`
`).replace(/,/g,`
`),new Error(`Back up failed ${n}`)}return e}async moveTaskProject(e,t,i){var r,a,o;await this.initializeAPI(),await((r=this.api)==null?void 0:r.projectMove(e.id,t,i))||y.error("Project Moved Failed: ",(a=this.api)==null?void 0:a.lastError),await((o=this.api)==null?void 0:o.updateTask(e))}async moveTaskParent(e,t,i,n){var r,a;if(t){const o=this.plugin.cacheOperation.loadTaskFromCacheID(t);o!=null&&o.childIds&&o.childIds.length>0&&(o.childIds=o.childIds.filter(l=>l!==e)),await((r=this.api)==null?void 0:r.updateTask(o))}await((a=this.api)==null?void 0:a.parentMove(e,i,n))}}const ac=s=>{const e=new DataView(s);let t="";for(let i=0;i<e.byteLength;i+=4)t+=e.getUint32(i).toString(16).padStart(8,"0");return t},oc=s=>async(e,{outputFormat:t="hex"}={})=>{typeof e=="string"&&(e=new globalThis.TextEncoder().encode(e));const i=await globalThis.crypto.subtle.digest(s,e);return t==="hex"?ac(i):i},lc=oc("SHA-256"),Ji={Highest:"",High:"",Medium:"",Low:"",Lowest:""},ts={TickTick_TAG:"#ticktick"},ta=[{ticktick:0,obsidian:null},{ticktick:0,obsidian:""},{ticktick:1,obsidian:""},{ticktick:3,obsidian:""},{ticktick:5,obsidian:""},{ticktick:5,obsidian:""}],ia=new RegExp("(?<=^|\\s)(#(?=[^\\s#.',;!?:]*[^\\d\\s#.',;!?:])[^\\s#.',;!?:]+)(?=[.,;!?:'\\s]|$)|(?<!`)```(?!`)","g"),cc="^\\s*(-|\\*)\\s+\\[(x| )\\]\\s",uc=/^([\s\t>]*)/,fc=/([-*+]|[0-9]+\.)/,dc=/\[(.)\]/u,hc=/ *(.*)/u,pc=/ %%(.*)%%/u,sa=new RegExp(uc.source+fc.source+" +"+dc.source+hc.source,"u"),ke={TickTick_TAG:new RegExp(`^[\\s]*[-] \\[[x ]\\] [\\s\\S]*${ts.TickTick_TAG}[\\s\\S]*$`,"i"),TickTick_ID:/\[ticktick_id::\s*[\d\S]+\]/,TickTick_ID_NUM:/\[ticktick_id::\s*(.*?)\]/,TickTick_ID_DV_NUM:/ticktick_id(.*?)%/,TickTick_LINK:/\[link\]\(.*?\)/,PROJECT_NAME:/\[project::\s*(.*?)\]/,TASK_CONTENT:{REMOVE_PRIORITY:/[]/ug,REMOVE_TAGS:ia,REMOVE_SPACE:/^\s+|\s+$/g,REMOVE_INLINE_METADATA:/%%\[\w+::\s*\w+\]%%/,REMOVE_CHECKBOX:/^(-|\*)\s+\[(x|X| )\]\s/,REMOVE_CHECKBOX_WITH_INDENTATION:/^([ \t]*)?(-|\*)\s+\[(x|X| )\]\s/,REMOVE_TickTick_LINK:/\[link\]\(.*?\)/},ALL_TAGS:ia,TASK_CHECKBOX_CHECKED:/- \[(x|X)\] /,TASK_INDENTATION:/^(\s{2,}|\t)(-|\*)\s+\[(x|X| )\]/,TAB_INDENTATION:/^(\t+)/,priorityRegex:/^.*([]).*$/u,BLANK_LINE:/^\s*$/,ITEM_LINE:/\[(.*?)\]\s*(.*?)\s*%%(.*?)%%/,LINE_ITEM_ID:/%%(?!\[ticktick_id::\s)[a-f0-9]{24}%%/g};class gc{constructor(e,t){this.app=e,this.plugin=t}async convertTaskToLine(e,t){var r,a;let n="	".repeat(t);if(e.title=this.stripOBSUrl(e.title),n+=`- [${e.status>0?"x":" "}] ${e.title}`,e.tags&&(n=this.addTagsToLine(n,e.tags)),n=this.addTickTickTag(n),_().taskLinksInObsidian==="taskLink"&&(n=this.addTickTickLink(n,e.id,e.projectId)),n=this.addTickTickId(n,e.id),n=this.addPriorityToLine(n,e),n=(r=this.plugin.dateMan)==null?void 0:r.addDatesToLine(n,e),_().syncNotes){const o=await((a=this.plugin.cacheOperation)==null?void 0:a.getFilepathForTask(e.id));this.plugin.taskParser.hasDescription(e)?n=this.addNote(n,e.desc,t,"Description",e.id,e.projectId,o):this.plugin.taskParser.hasNote(e)?n=this.addNote(n,e.content,t,"Note",e.id,e.projectId,o):n=this.addNote(n,"",t,"Note",e.id,e.projectId,o)}return this.plugin.taskParser.hasItems(e)&&(n=this.addItems(n,e.items,t)),n}stripOBSUrl(e){let t=e;if(t){let i=e.lastIndexOf(".md)"),n=0;if(i>0){for(let r=i;r>0;r--)if(e[r]==="["){n=r;break}n>0&&(t=e.substring(0,n),t=t+e.substring(i+4))}}return t.trim()}getTaskContentFromLineText(e){var i;let t=e.replace(ke.TASK_CONTENT.REMOVE_INLINE_METADATA,"").replace(ke.TASK_CONTENT.REMOVE_TickTick_LINK,"").replace(ke.TASK_CONTENT.REMOVE_PRIORITY,"").replace(ke.TASK_CONTENT.REMOVE_TAGS,"").replace(ke.TASK_CONTENT.REMOVE_CHECKBOX,"").replace(ke.TASK_CONTENT.REMOVE_CHECKBOX_WITH_INDENTATION,"").replace(ke.TASK_CONTENT.REMOVE_SPACE,"");return t=this.stripOBSUrl(t),t=(i=this.plugin.dateMan)==null?void 0:i.stripDatesFromLine(t),t}stripLineItemId(e){return e.replace(ke.LINE_ITEM_ID,"")}addTagsToLine(e,t){const i=new RegExp(ts.TickTick_TAG.substring(1),"i");return t.forEach(n=>{n.match(i)||(n.includes("-")&&(n=n.replace(/-/g,"/")),e=e+" #"+n)}),e}async convertLineToTask(e,t,i,n,r){var F,V,Q,K,G,re,he;let a=!1,o=null,l=null,c=[];const d=this.getNumTabs(e);let g=this.removeTaskIndentation(e);const f=this.getTickTickId(g),u=(F=this.plugin.dateMan)==null?void 0:F.parseDates(g);let p;r?p=r:f?p=n.getTaskRecord(f):p=await n.getTaskRecordByLine(t);let h=null,m=null,k="",T="",w="";_().fileLinksInTickTick!=="noLink"&&i&&(w=this.plugin.taskParser.getObsidianUrlFromFilepath(i)),_().fileLinksInTickTick==="taskLink"&&(k=w),_().fileLinksInTickTick==="noteLink"&&(T=w+`
`),y.debug(`taskURL: ${k}, url: ${w}`),d>0&&(o=p.parentId,a=!0,l=(V=this.plugin.cacheOperation)==null?void 0:V.loadTaskFromCacheID(o));const v=n.getTaskItems(f);if(v&&v.length>0)for(const ue in v)c.push(this.getItemFromLine(v[ue]));if(p)if(p.taskLines.length>1){const ue=this.getNoteString(p,f);let Y=T+ue.textContent;ue.isNote?m=Y:h=Y}else T&&(c.length>0?h=T:m=T);let b=Intl.DateTimeFormat().resolvedOptions().timeZone;const I=this.getAllTagsFromLineText(g);let O=await((Q=this.plugin.cacheOperation)==null?void 0:Q.getDefaultProjectIdForFilepath(i));if(a)l&&(O=l.projectId);else if(I)for(const ue of I){let Y=ue.replace(/#/g,""),fe=await((K=this.plugin.cacheOperation)==null?void 0:K.getProjectIdByNameFromCache(Y));if(fe){O=fe;break}}const E=this.getTaskContentFromLineText(g);_().debugMode&&!O&&y.error("Converting line to Object, could not find project Id: ",E);const L=this.isTaskCheckboxChecked(g),A=this.getTaskPriority(g);let S=u!=null&&u.startDate?u==null?void 0:u.startDate.isoDate:u!=null&&u.scheduled_date?u==null?void 0:u.scheduled_date.isoDate:u!=null&&u.dueDate?u==null?void 0:u.dueDate.isoDate:"";return{id:f||"",projectId:O,title:E.trim()+" "+k,content:m||"",desc:h||"",items:c||[],parentId:o||"",dueDate:((G=u==null?void 0:u.dueDate)==null?void 0:G.isoDate)||"",startDate:S||"",completedTime:((re=u==null?void 0:u.completedTime)==null?void 0:re.isoDate)||"",isAllDay:(u==null?void 0:u.isAllDay)||!1,tags:I||[],priority:Number(A),modifiedTime:((he=this.plugin.dateMan)==null?void 0:he.formatDateToISO(new Date))||"",status:L?2:0,timeZone:b,dateHolder:u}}escapeRegExp(e){return e.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}getNoteString(e,t){let i="";if(e.taskLines){let n=[...e.taskLines];n.splice(0,1),n.splice(n.length-1,1);let r;if(t){const a=new RegExp(`\\[link\\]\\(.*${this.escapeRegExp(t)}.*\\)`,"i");r=n.filter(o=>{const l=a.test(o);return y.debug("line: ",o,"linkRegex.test(line): ",l),!l})}r?(r=r.map(a=>a.replace(/^\t*\s{2}|^\s{2}/g,"")),i=r.length>0?r.join(`
`):""):(n=n.map(a=>a.replace(/^\t*\s{2}|^\s{2}/g,"")),i=n.length>0?n.join(`
`):"")}return{isNote:e.isNote,textContent:i}}hasTickTickTag(e){return this.isMarkdownTask(e)?ke.TickTick_TAG.test(e):!1}hasTickTickId(e){let t=ke.TickTick_ID.test(e);return t||(t=ke.TickTick_ID_DV_NUM.test(e)),t}getLineItemId(e){if(!e){y.error("No Text passed to getLineItemId");return}let t=e.match(ke.LINE_ITEM_ID),i;return t&&(i=t[0].slice(2,-2)),i}isTickTickTask(e){return this.hasTickTickId(e)}addTickTickId(e,t){return e=`${e} %%[ticktick_id:: ${t}]%%`,e}addChildToParent(e,t){return e.childIds||(e.childIds=[]),e.childIds.push(t),e}getProjectNameFromLineText(e){const t=ke.PROJECT_NAME.exec(e);return t?t[1]:null}getTickTickId(e){let t=ke.TickTick_ID_NUM.exec(e);return t||(t=ke.TickTick_ID_DV_NUM.exec(e)),t?t[1]:void 0}isTaskOpen(e){let t=new RegExp(cc,"gmi").exec(e);if(t)return t[2].search(/[xX]/)<0;throw new Error(`Status not found in line: ${e}`)}getAllTagsFromLineText(e){let i=[...e.matchAll(ke.ALL_TAGS)].map(n=>n[0].replace("#",""));return i=i.map(n=>n.replace(/\//g,"-")),i}isTaskCheckboxChecked(e){return ke.TASK_CHECKBOX_CHECKED.test(e)}isTitleChanged(e,t){const i=this.stripOBSUrl(e.title),n=this.stripOBSUrl(t.title);return!(i.trim()===n.trim())}isTagsChanged(e,t){const i=e.tags?e.tags:[],n=t.tags?t.tags:[];return!i&&!n?!1:i&&!n||!i&&n?!0:!(i.length===n.length&&i.sort().every((a,o)=>a===n.sort()[o]))}isStatusChanged(e,t){return!(e.status===t.status)}isParentIdChanged(e,t){let i=e.parentId?e.parentId:"",n=t.parentId?t.parentId:"";return i!=n}isChildrenChanged(e,t){return!e.childIds&&!t.childIds?!1:!e.childIds&&t.childIds||e.childIds&&!t.childIds?!0:(e==null?void 0:e.childIds.length)!=(t==null?void 0:t.childIds.length)}isProjectIdChanged(e,t){return e.projectId!==t.projectId}isIndentedTask(e){return ke.TASK_INDENTATION.test(e)}getNumTabs(e){const t=ke.TAB_INDENTATION.exec(e);return t?t[1].length:0}getTabs(e){const t=this.getNumTabs(e);let i="";for(let n=0;n<t;n++)i=i+"	";return i}getTaskPriority(e){let t="0";const i=e.match(ke.priorityRegex);return i!==null&&(t=this.parsePriority(i[1])),t}removeTaskIndentation(e){const t=/^([ \t]*)?- \[(x| )\] /;return e.replace(t,"- [$2] ")}isLineBlank(e){return ke.BLANK_LINE.test(e)}isMarkdownTask(e){return e?sa.test(e):!1}addTickTickTag(e){return e.charAt(e.length-1)===" "?e=e+`${ts.TickTick_TAG}`:e=e+` ${ts.TickTick_TAG} `,e}getObsidianUrlFromFilepath(e){const t=encodeURI(`obsidian://open?vault=${this.app.vault.getName()}&file=${e}`);return`[${e}](${t})`}addTickTickLink(e,t,i){let n=this.createURL(t,i);const r=new RegExp(`${ts.TickTick_TAG}`,"gi"),a=` [link](${n})`;return e.replace(r,a+" $&")}hasTickTickLink(e){return ke.TickTick_LINK.test(e)}createURL(e,t){let i="";return t?i=`https://${_().baseURL}/webapp/#p/${t}/tasks/${e}`:i=`https://${_().baseURL}/webapp/#q/all/tasks/${e}`,i}translateTickTickToObsidian(e){const t=ta.find(i=>i.ticktick===e);return t?t.obsidian:null}translateObsidianToTickTick(e){const t=ta.find(i=>i.obsidian===e);return t?t.ticktick:null}taskFromLine(e){let t=sa.exec(e);if(!t)return null;const n=(t[3]||"")=="x";let r=t[4]||"";r=r.replace(pc,"");let a=t[1]?t[1].length:0;return{line:e,status:n,description:r,indent:a}}getAllTags(){}async getLineHash(e){try{return await lc(e)}catch(t){y.error("Hashing error.",t)}}hasNote(e){return e.content&&e.content.length>0}hasDescription(e){return e.desc&&e.desc.length>0}hasItems(e){return e.items&&e.items.length>0}areNotesChanged(e,t){if(e.length!==t.length)return!0;const i=e.split(`
`),n=t.split(`
`);for(let r=0;r<i.length;r++)if(i[r]!==n[r])return!0;return!1}areItemsChanged(e,t){if((e==null?void 0:e.length)!=(t==null?void 0:t.length))return!0;e.sort((i,n)=>i.id.localeCompare(n.id)),t.sort((i,n)=>i.id.localeCompare(n.id));for(let i=0;i<e.length;i++)if(e[i].id!==e[i].id||e[i].status!==e[i].status||e[i].title!==e[i].title)return!0}parsePriority(e){switch(e){case Ji.Lowest:return"0";case Ji.Low:return"1";case Ji.Medium:return"3";case Ji.High:return"5";case Ji.Highest:return"5";default:return"0"}}addItems(e,t,i){return t.forEach(n=>{let r=n.status>0?"- [x]":"- [ ]";const a="	".repeat(i+1);e=`${e} 
${a}${r} ${n.title} `,e=`${e} %%${n.id}%%`}),e}addNote(e,t,i,n,r,a,o){const l=`
`+"	".repeat(i)+"  ";if(e=`${e}${l}-------------------------------------------------------------`,_().taskLinksInObsidian==="noteLink"){const g=`[link](${this.createURL(r,a)})`;e=`${e}${l}${g}`}let c;t.length>0?(c=t.split(`
`),c.length>0&&c[c.length-1].length===0&&c.pop()):c=[];const d=new RegExp(`\\[${o}\\]\\(obsidian://open\\?vault=.*&file=${o}\\)`,"giu");return c.forEach(g=>{y.debug(g,g.search(d)),g.search(d)<0&&(e=`${e}${l}${g}`)}),e=`${e}${l}-------------------------------------------------------------`,e}getItemFromLine(e){const t=ke.ITEM_LINE.exec(e);let i={};if(t){const n=t[1],r=t[2];i={id:t[3],title:r,status:n?0:2}}return i}addPriorityToLine(e,t){let i=this.translateTickTickToObsidian(t.priority);return i!=null&&(e=`${e} ${i}`),e}}class mc extends N.Modal{constructor(e,t,i){super(e),this.filepath=i,this.plugin=t,this.open()}async onOpen(){const{contentEl:e}=this;e.empty(),e.createEl("h5",{text:"Set default project for TickTick tasks in the current file"}),this.defaultProjectId=await this.plugin.cacheOperation.getDefaultProjectIdForFilepath(this.filepath),this.defaultProjectName=await this.plugin.cacheOperation.getProjectNameByIdFromCache(this.defaultProjectId);const t=_().fileMetadata,i=Object.values(t).map(a=>a.defaultProjectId),r=Ai().filter(a=>!i.includes(a.id)).reduce((a,o)=>(a[o.id]=o.name,a),{});new N.Setting(e).setName("Default project").addDropdown(a=>a.addOption(this.defaultProjectId,this.defaultProjectName).addOption("","").addOptions(r).onChange(async o=>{var l;await((l=this.plugin.cacheOperation)==null?void 0:l.setDefaultProjectIdForFilepath(this.filepath,o)),await this.plugin.setStatusBarText(),this.close()}))}onClose(){const{contentEl:e}=this;e.empty()}}class vc extends N.Modal{constructor(e,t,i){super(e),this.title="TicTickSync -- Latest Changes.",this.cancelLabel="Cancel",this.confirmLabel="Got it.",this.message="",this.intro="<p>The following are user experience affecting changes from prior versions of TickTickSync.</p><p><strong>Strongly</strong> recommend that you take a backup ASAP.</p>",this.notableChanges=t,this.onSubmit=i}onOpen(){const e="https://github.com/thesamim/TickTickSync/wiki/Notable-Changes#";let{titleEl:t,contentEl:i}=this;t.setText(this.title);let n=i.createEl("p");n.innerHTML=`${this.intro}`,n=i.createEl("ol"),this.notableChanges.forEach(r=>{let a=n.createEl("li");a.createEl("a",{href:`${e}${r[2]}`,text:`${r[0]}`}),a.createEl("ol").createEl("p",{text:`${r[1]}`})}),new N.Setting(i).addButton(r=>{r.setClass("ts_button"),r.setWarning(),r.setButtonText(this.confirmLabel),r.onClick(()=>{this.result=!0,this.onSubmit(this.result),this.close()})})}onClose(){this.titleEl.empty(),this.contentEl.empty(),super.onClose(),this.resolvePromise(this.result)}showModal(){return this.open(),new Promise(e=>this.resolvePromise=e)}}function ii(s,e){const t=s.split("."),i=e.split(".");for(let n=0;n<Math.max(t.length,i.length);n++){const r=parseInt(t[n]||"0"),a=parseInt(i[n]||"0");if(r<a)return!0;if(r>a)return!1}return!1}const na=!1;var ys=Array.isArray,kc=Array.prototype.indexOf,hr=Array.from,yc=Object.defineProperty,Ei=Object.getOwnPropertyDescriptor,wc=Object.getOwnPropertyDescriptors,bc=Object.prototype,Tc=Array.prototype,Wa=Object.getPrototypeOf,ra=Object.isExtensible;const Rn=()=>{};function Ic(s){return typeof(s==null?void 0:s.then)=="function"}function _c(s){return s()}function Gs(s){for(var e=0;e<s.length;e++)s[e]()}function Wt(s,e){if(Array.isArray(s))return s;if(!(Symbol.iterator in s))return Array.from(s);const t=[];for(const i of s)if(t.push(i),t.length===e)break;return t}const nt=2,Ya=4,fn=8,pr=16,jt=32,$i=64,Ws=128,We=256,Ys=512,Me=1024,Et=2048,Zt=4096,Ft=8192,dn=16384,Sc=32768,hn=65536,Ja=1<<17,Ec=1<<19,Xa=1<<20,Zn=1<<21,Kt=Symbol("$state"),Pc=Symbol("legacy props");let cs=[],er=[];function Qa(){var s=cs;cs=[],Gs(s)}function Oc(){var s=er;er=[],Gs(s)}function gr(s){cs.length===0&&queueMicrotask(Qa),cs.push(s)}function Ac(){cs.length>0&&Qa(),er.length>0&&Oc()}function Za(s){return s===this.v}function eo(s,e){return s!=s?e==e:s!==e||s!==null&&typeof s=="object"||typeof s=="function"}function mr(s){return!eo(s,this.v)}function Cc(s){throw new Error("https://svelte.dev/e/effect_in_teardown")}function Nc(){throw new Error("https://svelte.dev/e/effect_in_unowned_derived")}function Lc(s){throw new Error("https://svelte.dev/e/effect_orphan")}function Dc(){throw new Error("https://svelte.dev/e/effect_update_depth_exceeded")}function Fc(s){throw new Error("https://svelte.dev/e/props_invalid_value")}function xc(){throw new Error("https://svelte.dev/e/state_descriptors_fixed")}function Mc(){throw new Error("https://svelte.dev/e/state_prototype_fixed")}function $c(){throw new Error("https://svelte.dev/e/state_unsafe_mutation")}let ji=!1,jc=!1;function Rc(){ji=!0}const vr=1,kr=2,to=4,Bc=8,Uc=16,qc=1,Hc=2,Kc=4,Vc=8,zc=16,Gc=1,Wc=2,Ae=Symbol(),Yc="http://www.w3.org/1999/xhtml";function io(s){throw new Error("https://svelte.dev/e/lifecycle_outside_component")}let oe=null;function Js(s){oe=s}function Je(s,e=!1,t){var i=oe={p:oe,c:null,d:!1,e:null,m:!1,s,x:null,l:null};ji&&!e&&(oe.l={s:null,u:null,r1:[],r2:di(!1)}),ko(()=>{i.d=!0})}function Xe(s){const e=oe;if(e!==null){const a=e.e;if(a!==null){var t=le,i=ae;e.e=null;try{for(var n=0;n<a.length;n++){var r=a[n];Pt(r.effect),rt(r.reaction),ws(r.fn)}}finally{Pt(t),rt(i)}}oe=e.p,e.m=!0}return{}}function Ri(){return!ji||oe!==null&&oe.l===null}function ni(s){if(typeof s!="object"||s===null||Kt in s)return s;const e=Wa(s);if(e!==bc&&e!==Tc)return s;var t=new Map,i=ys(s),n=Rt(0),r=ae,a=o=>{var l=ae;rt(r);var c=o();return rt(l),c};return i&&t.set("length",Rt(s.length)),new Proxy(s,{defineProperty(o,l,c){(!("value"in c)||c.configurable===!1||c.enumerable===!1||c.writable===!1)&&xc();var d=t.get(l);return d===void 0?(d=a(()=>Rt(c.value)),t.set(l,d)):M(d,a(()=>ni(c.value))),!0},deleteProperty(o,l){var c=t.get(l);if(c===void 0)l in o&&(t.set(l,a(()=>Rt(Ae))),Bn(n));else{if(i&&typeof l=="string"){var d=t.get("length"),g=Number(l);Number.isInteger(g)&&g<d.v&&M(d,g)}M(c,Ae),Bn(n)}return!0},get(o,l,c){var u;if(l===Kt)return s;var d=t.get(l),g=l in o;if(d===void 0&&(!g||(u=Ei(o,l))!=null&&u.writable)&&(d=a(()=>Rt(ni(g?o[l]:Ae))),t.set(l,d)),d!==void 0){var f=P(d);return f===Ae?void 0:f}return Reflect.get(o,l,c)},getOwnPropertyDescriptor(o,l){var c=Reflect.getOwnPropertyDescriptor(o,l);if(c&&"value"in c){var d=t.get(l);d&&(c.value=P(d))}else if(c===void 0){var g=t.get(l),f=g==null?void 0:g.v;if(g!==void 0&&f!==Ae)return{enumerable:!0,configurable:!0,value:f,writable:!0}}return c},has(o,l){var f;if(l===Kt)return!0;var c=t.get(l),d=c!==void 0&&c.v!==Ae||Reflect.has(o,l);if(c!==void 0||le!==null&&(!d||(f=Ei(o,l))!=null&&f.writable)){c===void 0&&(c=a(()=>Rt(d?ni(o[l]):Ae)),t.set(l,c));var g=P(c);if(g===Ae)return!1}return d},set(o,l,c,d){var T;var g=t.get(l),f=l in o;if(i&&l==="length")for(var u=c;u<g.v;u+=1){var p=t.get(u+"");p!==void 0?M(p,Ae):u in o&&(p=a(()=>Rt(Ae)),t.set(u+"",p))}g===void 0?(!f||(T=Ei(o,l))!=null&&T.writable)&&(g=a(()=>Rt(void 0)),M(g,a(()=>ni(c))),t.set(l,g)):(f=g.v!==Ae,M(g,a(()=>ni(c))));var h=Reflect.getOwnPropertyDescriptor(o,l);if(h!=null&&h.set&&h.set.call(d,c),!f){if(i&&typeof l=="string"){var m=t.get("length"),k=Number(l);Number.isInteger(k)&&k>=m.v&&M(m,k+1)}Bn(n)}return!0},ownKeys(o){P(n);var l=Reflect.ownKeys(o).filter(g=>{var f=t.get(g);return f===void 0||f.v!==Ae});for(var[c,d]of t)d.v!==Ae&&!(c in o)&&l.push(c);return l},setPrototypeOf(){Mc()}})}function Bn(s,e=1){M(s,s.v+e)}function aa(s){try{if(s!==null&&typeof s=="object"&&Kt in s)return s[Kt]}catch{}return s}function Jc(s,e){return Object.is(aa(s),aa(e))}function Ci(s){var e=nt|Et,t=ae!==null&&(ae.f&nt)!==0?ae:null;return le===null||t!==null&&(t.f&We)!==0?e|=We:le.f|=Xa,{ctx:oe,deps:null,effects:null,equals:Za,f:e,fn:s,reactions:null,rv:0,v:null,wv:0,parent:t??le}}function Yt(s){const e=Ci(s);return uo(e),e}function fi(s){const e=Ci(s);return e.equals=mr,e}function so(s){var e=s.effects;if(e!==null){s.effects=null;for(var t=0;t<e.length;t+=1)Xt(e[t])}}function Xc(s){for(var e=s.parent;e!==null;){if((e.f&nt)===0)return e;e=e.parent}return null}function no(s){var e,t=le;Pt(Xc(s));try{so(s),e=go(s)}finally{Pt(t)}return e}function ro(s){var e=no(s);if(s.equals(e)||(s.v=e,s.wv=ho()),!Bi){var t=(Ht||(s.f&We)!==0)&&s.deps!==null?Zt:Me;at(s,t)}}const us=new Map;function di(s,e){var t={f:0,v:s,reactions:null,equals:Za,rv:0,wv:0};return t}function Rt(s,e){const t=di(s);return uo(t),t}function te(s,e=!1){var i;const t=di(s);return e||(t.equals=mr),ji&&oe!==null&&oe.l!==null&&((i=oe.l).s??(i.s=[])).push(t),t}function M(s,e,t=!1){ae!==null&&!Tt&&Ri()&&(ae.f&(nt|pr))!==0&&!(xe!=null&&xe.includes(s))&&$c();let i=t?ni(e):e;return Vt(s,i)}function Vt(s,e){if(!s.equals(e)){var t=s.v;Bi?us.set(s,e):us.set(s,t),s.v=e,(s.f&nt)!==0&&((s.f&Et)!==0&&no(s),at(s,(s.f&We)===0?Me:Zt)),s.wv=ho(),ao(s,Et),Ri()&&le!==null&&(le.f&Me)!==0&&(le.f&(jt|$i))===0&&(tt===null?iu([s]):tt.push(s))}return e}function ao(s,e){var t=s.reactions;if(t!==null)for(var i=Ri(),n=t.length,r=0;r<n;r++){var a=t[r],o=a.f;(o&Et)===0&&(!i&&a===le||(at(a,e),(o&(Me|We))!==0&&((o&nt)!==0?ao(a,Zt):kn(a))))}}function Qc(){console.warn("https://svelte.dev/e/select_multiple_invalid_value")}let Zc=!1;var oa,oo,lo,co;function eu(){if(oa===void 0){oa=window,oo=/Firefox/.test(navigator.userAgent);var s=Element.prototype,e=Node.prototype,t=Text.prototype;lo=Ei(e,"firstChild").get,co=Ei(e,"nextSibling").get,ra(s)&&(s.__click=void 0,s.__className=void 0,s.__attributes=null,s.__style=void 0,s.__e=void 0),ra(t)&&(t.__t=void 0)}}function pn(s=""){return document.createTextNode(s)}function Xs(s){return lo.call(s)}function gn(s){return co.call(s)}function D(s,e){return Xs(s)}function Jt(s,e){{var t=Xs(s);return t instanceof Comment&&t.data===""?gn(t):t}}function x(s,e=1,t=!1){let i=s;for(;e--;)i=gn(i);return i}function tu(s){s.textContent=""}let Us=!1,Qs=!1,Zs=null,li=!1,Bi=!1;function la(s){Bi=s}let ns=[];let ae=null,Tt=!1;function rt(s){ae=s}let le=null;function Pt(s){le=s}let xe=null;function uo(s){ae!==null&&ae.f&Zn&&(xe===null?xe=[s]:xe.push(s))}let De=null,Ve=0,tt=null;function iu(s){tt=s}let fo=1,en=0,Ht=!1,qt=null;function ho(){return++fo}function Ui(s){var g;var e=s.f;if((e&Et)!==0)return!0;if((e&Zt)!==0){var t=s.deps,i=(e&We)!==0;if(t!==null){var n,r,a=(e&Ys)!==0,o=i&&le!==null&&!Ht,l=t.length;if(a||o){var c=s,d=c.parent;for(n=0;n<l;n++)r=t[n],(a||!((g=r==null?void 0:r.reactions)!=null&&g.includes(c)))&&(r.reactions??(r.reactions=[])).push(c);a&&(c.f^=Ys),o&&d!==null&&(d.f&We)===0&&(c.f^=We)}for(n=0;n<l;n++)if(r=t[n],Ui(r)&&ro(r),r.wv>s.wv)return!0}(!i||le!==null&&!Ht)&&at(s,Me)}return!1}function su(s,e){for(var t=e;t!==null;){if((t.f&Ws)!==0)try{t.fn(s);return}catch{t.f^=Ws}t=t.parent}throw Us=!1,s}function ca(s){return(s.f&dn)===0&&(s.parent===null||(s.parent.f&Ws)===0)}function mn(s,e,t,i){if(Us){if(t===null&&(Us=!1),ca(e))throw s;return}if(t!==null&&(Us=!0),su(s,e),ca(e))throw s}function po(s,e,t=!0){var i=s.reactions;if(i!==null)for(var n=0;n<i.length;n++){var r=i[n];xe!=null&&xe.includes(s)||((r.f&nt)!==0?po(r,e,!1):e===r&&(t?at(r,Et):(r.f&Me)!==0&&at(r,Zt),kn(r)))}}function go(s){var u;var e=De,t=Ve,i=tt,n=ae,r=Ht,a=xe,o=oe,l=Tt,c=s.f;De=null,Ve=0,tt=null,Ht=(c&We)!==0&&(Tt||!li||ae===null),ae=(c&(jt|$i))===0?s:null,xe=null,Js(s.ctx),Tt=!1,en++,s.f|=Zn;try{var d=(0,s.fn)(),g=s.deps;if(De!==null){var f;if(tn(s,Ve),g!==null&&Ve>0)for(g.length=Ve+De.length,f=0;f<De.length;f++)g[Ve+f]=De[f];else s.deps=g=De;if(!Ht)for(f=Ve;f<g.length;f++)((u=g[f]).reactions??(u.reactions=[])).push(s)}else g!==null&&Ve<g.length&&(tn(s,Ve),g.length=Ve);if(Ri()&&tt!==null&&!Tt&&g!==null&&(s.f&(nt|Zt|Et))===0)for(f=0;f<tt.length;f++)po(tt[f],s);return n!==null&&n!==s&&(en++,tt!==null&&(i===null?i=tt:i.push(...tt))),d}finally{De=e,Ve=t,tt=i,ae=n,Ht=r,xe=a,Js(o),Tt=l,s.f^=Zn}}function nu(s,e){let t=e.reactions;if(t!==null){var i=kc.call(t,s);if(i!==-1){var n=t.length-1;n===0?t=e.reactions=null:(t[i]=t[n],t.pop())}}t===null&&(e.f&nt)!==0&&(De===null||!De.includes(e))&&(at(e,Zt),(e.f&(We|Ys))===0&&(e.f^=Ys),so(e),tn(e,0))}function tn(s,e){var t=s.deps;if(t!==null)for(var i=e;i<t.length;i++)nu(s,t[i])}function vn(s){var e=s.f;if((e&dn)===0){at(s,Me);var t=le,i=oe,n=li;le=s,li=!0;try{(e&pr)!==0?gu(s):wo(s),yo(s);var r=go(s);s.teardown=typeof r=="function"?r:null,s.wv=fo;var a=s.deps,o;na&&jc&&s.f&Et}catch(l){mn(l,s,t,i||s.ctx)}finally{li=n,le=t}}}function ru(){try{Dc()}catch(s){if(Zs!==null)mn(s,Zs,null);else throw s}}function mo(){var s=li;try{var e=0;for(li=!0;ns.length>0;){e++>1e3&&ru();var t=ns,i=t.length;ns=[];for(var n=0;n<i;n++){var r=ou(t[n]);au(r)}us.clear()}}finally{Qs=!1,li=s,Zs=null}}function au(s){var e=s.length;if(e!==0)for(var t=0;t<e;t++){var i=s[t];if((i.f&(dn|Ft))===0)try{Ui(i)&&(vn(i),i.deps===null&&i.first===null&&i.nodes_start===null&&(i.teardown===null?bo(i):i.fn=null))}catch(n){mn(n,i,null,i.ctx)}}}function kn(s){Qs||(Qs=!0,queueMicrotask(mo));for(var e=Zs=s;e.parent!==null;){e=e.parent;var t=e.f;if((t&($i|jt))!==0){if((t&Me)===0)return;e.f^=Me}}ns.push(e)}function ou(s){for(var e=[],t=s;t!==null;){var i=t.f,n=(i&(jt|$i))!==0,r=n&&(i&Me)!==0;if(!r&&(i&Ft)===0){if((i&Ya)!==0)e.push(t);else if(n)t.f^=Me;else try{Ui(t)&&vn(t)}catch(l){mn(l,t,null,t.ctx)}var a=t.first;if(a!==null){t=a;continue}}var o=t.parent;for(t=t.next;t===null&&o!==null;)t=o.next,o=o.parent}return e}function lu(s){for(var e;;){if(Ac(),ns.length===0)return e;Qs=!0,mo()}}function P(s){var e=s.f,t=(e&nt)!==0;if(qt!==null&&qt.add(s),ae!==null&&!Tt){if(!(xe!=null&&xe.includes(s))){var i=ae.deps;s.rv<en&&(s.rv=en,De===null&&i!==null&&i[Ve]===s?Ve++:De===null?De=[s]:(!Ht||!De.includes(s))&&De.push(s))}}else if(t&&s.deps===null&&s.effects===null){var n=s,r=n.parent;r!==null&&(r.f&We)===0&&(n.f^=We)}return t&&(n=s,Ui(n)&&ro(n)),Bi&&us.has(s)?us.get(s):s.v}function cu(s){var e=qt;qt=new Set;var t=qt,i;try{if(mt(s),e!==null)for(i of qt)e.add(i)}finally{qt=e}return t}function fs(s){var e=cu(()=>mt(s));for(var t of e)if((t.f&Ja)!==0)for(const i of t.deps||[])(i.f&nt)===0&&Vt(i,i.v);else Vt(t,t.v)}function mt(s){var e=Tt;try{return Tt=!0,s()}finally{Tt=e}}const uu=-7169;function at(s,e){s.f=s.f&uu|e}function fu(s){if(!(typeof s!="object"||!s||s instanceof EventTarget)){if(Kt in s)tr(s);else if(!Array.isArray(s))for(let e in s){const t=s[e];typeof t=="object"&&t&&Kt in t&&tr(t)}}}function tr(s,e=new Set){if(typeof s=="object"&&s!==null&&!(s instanceof EventTarget)&&!e.has(s)){e.add(s),s instanceof Date&&s.getTime();for(let i in s)try{tr(s[i],e)}catch{}const t=Wa(s);if(t!==Object.prototype&&t!==Array.prototype&&t!==Map.prototype&&t!==Set.prototype&&t!==Date.prototype){const i=wc(t);for(let n in i){const r=i[n].get;if(r)try{r.call(s)}catch{}}}}}function vo(s){le===null&&ae===null&&Lc(),ae!==null&&(ae.f&We)!==0&&le===null&&Nc(),Bi&&Cc()}function du(s,e){var t=e.last;t===null?e.last=e.first=s:(t.next=s,s.prev=t,e.last=s)}function qi(s,e,t,i=!0){var n=le,r={ctx:oe,deps:null,nodes_start:null,nodes_end:null,f:s|Et,first:null,fn:e,last:null,next:null,parent:n,prev:null,teardown:null,transitions:null,wv:0};if(t)try{vn(r),r.f|=Sc}catch(l){throw Xt(r),l}else e!==null&&kn(r);var a=t&&r.deps===null&&r.first===null&&r.nodes_start===null&&r.teardown===null&&(r.f&(Xa|Ws))===0;if(!a&&i&&(n!==null&&du(r,n),ae!==null&&(ae.f&nt)!==0)){var o=ae;(o.effects??(o.effects=[])).push(r)}return r}function ko(s){const e=qi(fn,null,!1);return at(e,Me),e.teardown=s,e}function ir(s){vo();var e=le!==null&&(le.f&jt)!==0&&oe!==null&&!oe.m;if(e){var t=oe;(t.e??(t.e=[])).push({fn:s,effect:le,reaction:ae})}else{var i=ws(s);return i}}function hu(s){return vo(),bs(s)}function pu(s){const e=qi($i,s,!0);return(t={})=>new Promise(i=>{t.outro?zt(e,()=>{Xt(e),i(void 0)}):(Xt(e),i(void 0))})}function ws(s){return qi(Ya,s,!1)}function sn(s,e){var t=oe,i={effect:null,ran:!1};t.l.r1.push(i),i.effect=bs(()=>{s(),!i.ran&&(i.ran=!0,M(t.l.r2,!0),mt(e))})}function yr(){var s=oe;bs(()=>{if(P(s.l.r2)){for(var e of s.l.r1){var t=e.effect;(t.f&Me)!==0&&at(t,Zt),Ui(t)&&vn(t),e.ran=!1}s.l.r2.v=!1}})}function bs(s){return qi(fn,s,!0)}function ne(s,e=[],t=Ci){const i=e.map(t);return Ts(()=>s(...i.map(P)))}function Ts(s,e=0){return qi(fn|pr|e,s,!0)}function xt(s,e=!0){return qi(fn|jt,s,!0,e)}function yo(s){var e=s.teardown;if(e!==null){const t=Bi,i=ae;la(!0),rt(null);try{e.call(null)}finally{la(t),rt(i)}}}function wo(s,e=!1){var t=s.first;for(s.first=s.last=null;t!==null;){var i=t.next;(t.f&$i)!==0?t.parent=null:Xt(t,e),t=i}}function gu(s){for(var e=s.first;e!==null;){var t=e.next;(e.f&jt)===0&&Xt(e),e=t}}function Xt(s,e=!0){var t=!1;(e||(s.f&Ec)!==0)&&s.nodes_start!==null&&(mu(s.nodes_start,s.nodes_end),t=!0),wo(s,e&&!t),tn(s,0),at(s,dn);var i=s.transitions;if(i!==null)for(const r of i)r.stop();yo(s);var n=s.parent;n!==null&&n.first!==null&&bo(s),s.next=s.prev=s.teardown=s.ctx=s.deps=s.fn=s.nodes_start=s.nodes_end=null}function mu(s,e){for(;s!==null;){var t=s===e?null:gn(s);s.remove(),s=t}}function bo(s){var e=s.parent,t=s.prev,i=s.next;t!==null&&(t.next=i),i!==null&&(i.prev=t),e!==null&&(e.first===s&&(e.first=i),e.last===s&&(e.last=t))}function zt(s,e){var t=[];wr(s,t,!0),To(t,()=>{Xt(s),e&&e()})}function To(s,e){var t=s.length;if(t>0){var i=()=>--t||e();for(var n of s)n.out(i)}else e()}function wr(s,e,t){if((s.f&Ft)===0){if(s.f^=Ft,s.transitions!==null)for(const a of s.transitions)(a.is_global||t)&&e.push(a);for(var i=s.first;i!==null;){var n=i.next,r=(i.f&hn)!==0||(i.f&jt)!==0;wr(i,e,r?t:!1),i=n}}}function ci(s){Io(s,!0)}function Io(s,e){if((s.f&Ft)!==0){s.f^=Ft,(s.f&Me)===0&&(s.f^=Me),Ui(s)&&(at(s,Et),kn(s));for(var t=s.first;t!==null;){var i=t.next,n=(t.f&hn)!==0||(t.f&jt)!==0;Io(t,n?e:!1),t=i}if(s.transitions!==null)for(const r of s.transitions)(r.is_global||e)&&r.in()}}const vu=["touchstart","touchmove"];function ku(s){return vu.includes(s)}let ua=!1;function yu(){ua||(ua=!0,document.addEventListener("reset",s=>{Promise.resolve().then(()=>{var e;if(!s.defaultPrevented)for(const t of s.target.elements)(e=t.__on_r)==null||e.call(t)})},{capture:!0}))}function _o(s){var e=ae,t=le;rt(null),Pt(null);try{return s()}finally{rt(e),Pt(t)}}function br(s,e,t,i=t){s.addEventListener(e,()=>_o(t));const n=s.__on_r;n?s.__on_r=()=>{n(),i(!0)}:s.__on_r=()=>i(!0),yu()}const wu=new Set,fa=new Set;function bu(s,e,t,i={}){function n(r){if(i.capture||is.call(e,r),!r.cancelBubble)return _o(()=>t==null?void 0:t.call(this,r))}return s.startsWith("pointer")||s.startsWith("touch")||s==="wheel"?gr(()=>{e.addEventListener(s,n,i)}):e.addEventListener(s,n,i),n}function Te(s,e,t,i,n){var r={capture:i,passive:n},a=bu(s,e,t,r);(e===document.body||e===window||e===document||e instanceof HTMLMediaElement)&&ko(()=>{e.removeEventListener(s,a,r)})}function is(s){var T;var e=this,t=e.ownerDocument,i=s.type,n=((T=s.composedPath)==null?void 0:T.call(s))||[],r=n[0]||s.target,a=0,o=s.__root;if(o){var l=n.indexOf(o);if(l!==-1&&(e===document||e===window)){s.__root=e;return}var c=n.indexOf(e);if(c===-1)return;l<=c&&(a=l)}if(r=n[a]||s.target,r!==e){yc(s,"currentTarget",{configurable:!0,get(){return r||t}});var d=ae,g=le;rt(null),Pt(null);try{for(var f,u=[];r!==null;){var p=r.assignedSlot||r.parentNode||r.host||null;try{var h=r["__"+i];if(h!=null&&(!r.disabled||s.target===r))if(ys(h)){var[m,...k]=h;m.apply(r,[s,...k])}else h.call(r,s)}catch(w){f?u.push(w):f=w}if(s.cancelBubble||p===e||p===null)break;r=p}if(f){for(let w of u)queueMicrotask(()=>{throw w});throw f}}finally{s.__root=e,delete s.currentTarget,rt(d),Pt(g)}}}function Tu(s){var e=document.createElement("template");return e.innerHTML=s.replaceAll("<!>","<!---->"),e.content}function nn(s,e){var t=le;t.nodes_start===null&&(t.nodes_start=s,t.nodes_end=e)}function J(s,e){var t=(e&Gc)!==0,i=(e&Wc)!==0,n,r=!s.startsWith("<!>");return()=>{n===void 0&&(n=Tu(r?s:"<!>"+s),t||(n=Xs(n)));var a=i||oo?document.importNode(n,!0):n.cloneNode(!0);if(t){var o=Xs(a),l=a.lastChild;nn(o,l)}else nn(a,a);return a}}function da(s=""){{var e=pn(s+"");return nn(e,e),e}}function sr(){var s=document.createDocumentFragment(),e=document.createComment(""),t=pn();return s.append(e,t),nn(e,t),s}function z(s,e){s!==null&&s.before(e)}function pe(s,e){var t=e==null?"":typeof e=="object"?e+"":e;t!==(s.__t??(s.__t=s.nodeValue))&&(s.__t=t,s.nodeValue=t+"")}function So(s,e){return Iu(s,e)}const vi=new Map;function Iu(s,{target:e,anchor:t,props:i={},events:n,context:r,intro:a=!0}){eu();var o=new Set,l=g=>{for(var f=0;f<g.length;f++){var u=g[f];if(!o.has(u)){o.add(u);var p=ku(u);e.addEventListener(u,is,{passive:p});var h=vi.get(u);h===void 0?(document.addEventListener(u,is,{passive:p}),vi.set(u,1)):vi.set(u,h+1)}}};l(hr(wu)),fa.add(l);var c=void 0,d=pu(()=>{var g=t??e.appendChild(pn());return xt(()=>{if(r){Je({});var f=oe;f.c=r}n&&(i.$$events=n),c=s(g,i)||{},r&&Xe()}),()=>{var p;for(var f of o){e.removeEventListener(f,is);var u=vi.get(f);--u===0?(document.removeEventListener(f,is),vi.delete(f)):vi.set(f,u)}fa.delete(l),g!==t&&((p=g.parentNode)==null||p.removeChild(g))}});return nr.set(c,d),c}let nr=new WeakMap;function Eo(s,e){const t=nr.get(s);return t?(nr.delete(s),t(e)):Promise.resolve()}const Un=0,Ls=1,qn=2;function _u(s,e,t,i,n){var r=s,a=Ri(),o=oe,l=Ae,c,d,g,f=(a?di:te)(void 0),u=(a?di:te)(void 0),p=!1;function h(k,T){p=!0,T&&(Pt(m),rt(m),Js(o));try{k===Un&&t&&(c?ci(c):c=xt(()=>t(r))),k===Ls&&i&&(d?ci(d):d=xt(()=>i(r,f))),k===qn&&n&&(g?ci(g):g=xt(()=>n(r,u))),k!==Un&&c&&zt(c,()=>c=null),k!==Ls&&d&&zt(d,()=>d=null),k!==qn&&g&&zt(g,()=>g=null)}finally{T&&(Js(null),rt(null),Pt(null),lu())}}var m=Ts(()=>{if(l!==(l=e())){if(Ic(l)){var k=l;p=!1,k.then(T=>{k===l&&(Vt(f,T),h(Ls,!0))},T=>{if(k===l&&(Vt(u,T),h(qn,!0),!n))throw u.v}),gr(()=>{p||h(Un,!0)})}else Vt(f,l),h(Ls,!1);return()=>l=Ae}})}function Se(s,e,[t,i]=[0,0]){var n=s,r=null,a=null,o=Ae,l=t>0?hn:0,c=!1;const d=(f,u=!0)=>{c=!0,g(u,f)},g=(f,u)=>{o!==(o=f)&&(o?(r?ci(r):u&&(r=xt(()=>u(n))),a&&zt(a,()=>{a=null})):(a?ci(a):u&&(a=xt(()=>u(n,[t+1,i]))),r&&zt(r,()=>{r=null})))};Ts(()=>{c=!1,e(d),c||g(null,null)},l)}function vt(s,e){return e}function Su(s,e,t,i){for(var n=[],r=e.length,a=0;a<r;a++)wr(e[a].e,n,!0);var o=r>0&&n.length===0&&t!==null;if(o){var l=t.parentNode;tu(l),l.append(t),i.clear(),Bt(s,e[0].prev,e[r-1].next)}To(n,()=>{for(var c=0;c<r;c++){var d=e[c];o||(i.delete(d.k),Bt(s,d.prev,d.next)),Xt(d.e,!o)}})}function kt(s,e,t,i,n,r=null){var a=s,o={flags:e,items:new Map,first:null},l=(e&to)!==0;if(l){var c=s;a=c.appendChild(pn())}var d=null,g=!1,f=fi(()=>{var u=t();return ys(u)?u:u==null?[]:hr(u)});Ts(()=>{var u=P(f),p=u.length;g&&p===0||(g=p===0,Eu(u,o,a,n,e,i,t),r!==null&&(p===0?d?ci(d):d=xt(()=>r(a)):d!==null&&zt(d,()=>{d=null})),P(f))})}function Eu(s,e,t,i,n,r,a){var V,Q,K,G;var o=(n&Bc)!==0,l=(n&(vr|kr))!==0,c=s.length,d=e.items,g=e.first,f=g,u,p=null,h,m=[],k=[],T,w,v,b;if(o)for(b=0;b<c;b+=1)T=s[b],w=r(T,b),v=d.get(w),v!==void 0&&((V=v.a)==null||V.measure(),(h??(h=new Set)).add(v));for(b=0;b<c;b+=1){if(T=s[b],w=r(T,b),v=d.get(w),v===void 0){var I=f?f.e.nodes_start:t;p=Ou(I,e,p,p===null?e.first:p.next,T,w,b,i,n,a),d.set(w,p),m=[],k=[],f=p.next;continue}if(l&&Pu(v,T,b,n),(v.e.f&Ft)!==0&&(ci(v.e),o&&((Q=v.a)==null||Q.unfix(),(h??(h=new Set)).delete(v))),v!==f){if(u!==void 0&&u.has(v)){if(m.length<k.length){var O=k[0],E;p=O.prev;var L=m[0],A=m[m.length-1];for(E=0;E<m.length;E+=1)ha(m[E],O,t);for(E=0;E<k.length;E+=1)u.delete(k[E]);Bt(e,L.prev,A.next),Bt(e,p,L),Bt(e,A,O),f=O,p=A,b-=1,m=[],k=[]}else u.delete(v),ha(v,f,t),Bt(e,v.prev,v.next),Bt(e,v,p===null?e.first:p.next),Bt(e,p,v),p=v;continue}for(m=[],k=[];f!==null&&f.k!==w;)(f.e.f&Ft)===0&&(u??(u=new Set)).add(f),k.push(f),f=f.next;if(f===null)continue;v=f}m.push(v),p=v,f=v.next}if(f!==null||u!==void 0){for(var S=u===void 0?[]:hr(u);f!==null;)(f.e.f&Ft)===0&&S.push(f),f=f.next;var C=S.length;if(C>0){var F=(n&to)!==0&&c===0?t:null;if(o){for(b=0;b<C;b+=1)(K=S[b].a)==null||K.measure();for(b=0;b<C;b+=1)(G=S[b].a)==null||G.fix()}Su(e,S,F,d)}}o&&gr(()=>{var re;if(h!==void 0)for(v of h)(re=v.a)==null||re.apply()}),le.first=e.first&&e.first.e,le.last=p&&p.e}function Pu(s,e,t,i){(i&vr)!==0&&Vt(s.v,e),(i&kr)!==0?Vt(s.i,t):s.i=t}function Ou(s,e,t,i,n,r,a,o,l,c){var d=(l&vr)!==0,g=(l&Uc)===0,f=d?g?te(n):di(n):n,u=(l&kr)===0?a:di(a),p={i:u,v:f,k:r,a:null,e:null,prev:t,next:i};try{return p.e=xt(()=>o(s,f,u,c),Zc),p.e.prev=t&&t.e,p.e.next=i&&i.e,t===null?e.first=p:(t.next=p,t.e.next=p.e),i!==null&&(i.prev=p,i.e.prev=p.e),p}finally{}}function ha(s,e,t){for(var i=s.next?s.next.e.nodes_start:t,n=e?e.e.nodes_start:t,r=s.e.nodes_start;r!==i;){var a=gn(r);n.before(r),r=a}}function Bt(s,e,t){e===null?s.first=t:(e.next=t,e.e.next=t&&t.e),t!==null&&(t.prev=e,t.e.prev=e&&e.e)}function Au(s,e,t,i,n){var o;var r=(o=e.$$slots)==null?void 0:o[t],a=!1;r===!0&&(r=e.children,a=!0),r===void 0||r(s,a?()=>i:i)}function Cu(s,e,t){var i=s,n,r;Ts(()=>{n!==(n=e())&&(r&&(zt(r),r=null),n&&(r=xt(()=>t(i,n))))},hn)}function Nu(s,e,t){ws(()=>{var i=mt(()=>e(s,t==null?void 0:t())||{});if(i!=null&&i.destroy)return()=>i.destroy()})}function Lu(s,e,t){var i=s==null?"":""+s;return i===""?null:i}function Tr(s,e,t,i,n,r){var a=s.__className;if(a!==t||a===void 0){var o=Lu(t);o==null?s.removeAttribute("class"):s.className=o,s.__className=t}return r}function ds(s,e,t){if(s.multiple){if(e==null)return;if(!ys(e))return Qc();for(var i of s.options)i.selected=e.includes(rs(i));return}for(i of s.options){var n=rs(i);if(Jc(n,e)){i.selected=!0;return}}(!t||e!==void 0)&&(s.selectedIndex=-1)}function Ir(s,e){let t=!0;ws(()=>{e&&ds(s,mt(e),t),t=!1;var i=new MutationObserver(()=>{var n=s.__value;ds(s,n)});return i.observe(s,{childList:!0,subtree:!0,attributes:!0,attributeFilter:["value"]}),()=>{i.disconnect()}})}function hs(s,e,t=e){var i=!0;br(s,"change",n=>{var r=n?"[selected]":":checked",a;if(s.multiple)a=[].map.call(s.querySelectorAll(r),rs);else{var o=s.querySelector(r)??s.querySelector("option:not([disabled])");a=o&&rs(o)}t(a)}),ws(()=>{var n=e();if(ds(s,n,i),i&&n===void 0){var r=s.querySelector(":checked");r!==null&&(n=rs(r),t(n))}s.__value=n,i=!1}),Ir(s)}function rs(s){return"__value"in s?s.__value:s.value}const Du=Symbol("is custom element"),Fu=Symbol("is html");function xu(s,e){var t=Mu(s);t.checked!==(t.checked=e??void 0)&&(s.checked=e)}function Mu(s){return s.__attributes??(s.__attributes={[Du]:s.nodeName.includes("-"),[Fu]:s.namespaceURI===Yc})}function rn(s,e,t=e){var i=Ri();br(s,"input",n=>{var r=n?s.defaultValue:s.value;if(r=Hn(s)?Kn(r):r,t(r),i&&r!==(r=e())){var a=s.selectionStart,o=s.selectionEnd;s.value=r??"",o!==null&&(s.selectionStart=a,s.selectionEnd=Math.min(o,s.value.length))}}),mt(e)==null&&s.value&&t(Hn(s)?Kn(s.value):s.value),bs(()=>{var n=e();Hn(s)&&n===Kn(s.value)||s.type==="date"&&!n&&!s.value||n!==s.value&&(s.value=n??"")})}function _r(s,e,t=e){br(s,"change",i=>{var n=i?s.defaultChecked:s.checked;t(n)}),mt(e)==null&&t(s.checked),bs(()=>{var i=e();s.checked=!!i})}function Hn(s){var e=s.type;return e==="number"||e==="range"}function Kn(s){return s===""?null:+s}function ut(s=!1){const e=oe,t=e.l.u;if(!t)return;let i=()=>fu(e.s);if(s){let n=0,r={};const a=Ci(()=>{let o=!1;const l=e.s;for(const c in l)l[c]!==r[c]&&(r[c]=l[c],o=!0);return o&&n++,n});i=()=>P(a)}t.b.length&&hu(()=>{pa(e,i),Gs(t.b)}),ir(()=>{const n=mt(()=>t.m.map(_c));return()=>{for(const r of n)typeof r=="function"&&r()}}),t.a.length&&ir(()=>{pa(e,i),Gs(t.a)})}function pa(s,e){if(s.l.s)for(const t of s.l.s)P(t);e()}let Ds=!1;function $u(s){var e=Ds;try{return Ds=!1,[s(),Ds]}finally{Ds=e}}function ga(s){var e;return((e=s.ctx)==null?void 0:e.d)??!1}function be(s,e,t,i){var O;var n=(t&qc)!==0,r=!ji||(t&Hc)!==0,a=(t&Vc)!==0,o=(t&zc)!==0,l=!1,c;a?[c,l]=$u(()=>s[e]):c=s[e];var d=Kt in s||Pc in s,g=a&&(((O=Ei(s,e))==null?void 0:O.set)??(d&&e in s&&(E=>s[e]=E)))||void 0,f=i,u=!0,p=!1,h=()=>(p=!0,u&&(u=!1,o?f=mt(i):f=i),f);c===void 0&&i!==void 0&&(g&&r&&Fc(),c=h(),g&&g(c));var m;if(r)m=()=>{var E=s[e];return E===void 0?h():(u=!0,p=!1,E)};else{var k=(n?Ci:fi)(()=>s[e]);k.f|=Ja,m=()=>{var E=P(k);return E!==void 0&&(f=void 0),E===void 0?f:E}}if((t&Kc)===0)return m;if(g){var T=s.$$legacy;return function(E,L){return arguments.length>0?((!r||!L||T||l)&&g(L?m():E),E):m()}}var w=!1,v=!1,b=te(c),I=Ci(()=>{var E=m(),L=P(b);return w?(w=!1,v=!0,L):(v=!1,b.v=E)});return a&&P(I),n||(I.equals=mr),function(E,L){if(qt!==null&&(w=v,m(),P(b)),arguments.length>0){const A=L?P(I):r&&a?ni(E):E;if(!I.equals(A)){if(w=!0,M(b,A),p&&f!==void 0&&(f=A),ga(I))return E;mt(()=>P(I))}return E}return ga(I)?I.v:P(I)}}function Hi(s){oe===null&&io(),ji&&oe.l!==null?Ru(oe).m.push(s):ir(()=>{const e=mt(s);if(typeof e=="function")return e})}function ju(s,e,{bubbles:t=!1,cancelable:i=!1}={}){return new CustomEvent(s,{detail:e,bubbles:t,cancelable:i})}function Is(){const s=oe;return s===null&&io(),(e,t,i)=>{var r;const n=(r=s.s.$$events)==null?void 0:r[e];if(n){const a=ys(n)?n.slice():[n],o=ju(e,t,i);for(const l of a)l.call(s.x,o);return!o.defaultPrevented}return!0}}function Ru(s){var e=s.l;return e.u??(e.u={a:[],b:[],m:[]})}const ki=[];function Po(s,e=Rn){let t=null;const i=new Set;function n(o){if(eo(s,o)&&(s=o,t)){const l=!ki.length;for(const c of i)c[1](),ki.push(c,s);if(l){for(let c=0;c<ki.length;c+=2)ki[c][0](ki[c+1]);ki.length=0}}}function r(o){n(o(s))}function a(o,l=Rn){const c=[o,l];return i.add(c),i.size===1&&(t=e(n,r)||Rn),o(s),()=>{i.delete(c),i.size===0&&t&&(t(),t=null)}}return{set:n,update:r,subscribe:a}}let ma;function Bu(s){if(ma)return;const{subscribe:e,set:t,update:i}=Po(St);ma={subscribe:e,update:i,set:n=>{t(n),s.saveSettings()}}}const Uu="5";var Ba;typeof window<"u"&&((Ba=window.__svelte??(window.__svelte={})).v??(Ba.v=new Set)).add(Uu);Rc();var qu=J("<option> </option>"),Hu=J('<div class="access-control"><div class="setting-item"><div class="setting-item-info"><div class="setting-item-name">TickTick/Dida</div> <div class="setting-item-description">Select home server</div></div> <div class="setting-item-control"><select></select></div></div> <div class="setting-item"><div class="setting-item-info"><div class="setting-item-name">Username</div> <div class="setting-item-description">Your TickTick/Dida account username</div></div> <div class="setting-item-control"><input type="text" placeholder="Username"/></div></div> <div class="setting-item"><div class="setting-item-info"><div class="setting-item-name">Password</div> <div class="setting-item-description">Your TickTick/Dida account password</div></div> <div class="setting-item-control"><input type="password" placeholder="Password"/></div></div> <div class="setting-item"><div class="setting-item-info"><div class="setting-item-name">Login</div> <div class="setting-item-description"> </div></div> <div class="setting-item-control"><button class="mod-cta ts_login_button">Login</button></div></div></div>');function Ku(s,e){Je(e,!1);let t=be(e,"plugin",12);const i={"ticktick.com":"TickTick","dida365.com":"Dida365"};let n=te(""),r=te(""),a=te(),o=te(!1);async function l(){if(M(o,!0),!_().baseURL||!P(n)||!P(r)){new N.Notice("Please fill in both Username and Password"),M(o,!1);return}const S=await t().service.login(P(a),P(n),P(r));if(!S){new N.Notice("Login Failed. "),M(o,!1);return}const C=_().inboxID;C.length>0&&C!=S.inboxId&&new N.Notice("You are logged in with a different user ID."),ge({token:S.token,inboxID:S.inboxId,inboxName:"Inbox",checkPoint:0}),t().tickTickRestAPI&&t().tickTickRestAPI.api&&t(t().tickTickRestAPI.api.checkpoint=0,!0),await t().saveProjectsToCache(),await t().saveSettings(!0),M(o,!1)}ut();var c=Hu(),d=D(c),g=x(D(d),2),f=D(g);const u=fi(()=>_().baseURL);Ir(f,()=>P(u));var p;kt(f,5,()=>Object.entries(i),vt,(S,C)=>{var F=Yt(()=>Wt(P(C),2));let V=()=>P(F)[0],Q=()=>P(F)[1];var K=qu(),G={},re=D(K);ne(()=>{G!==(G=V())&&(K.value=(K.__value=V())??""),pe(re,Q())}),z(S,K)});var h=x(d,2),m=x(D(h),2),k=D(m),T=x(h,2),w=x(D(T),2),v=D(w),b=x(T,2),I=D(b),O=x(D(I),2),E=D(O),L=x(I,2),A=D(L);ne(S=>{p!==(p=P(u))&&(f.value=(f.__value=P(u))??"",ds(f,P(u))),pe(E,S),A.disabled=P(o)},[()=>_().token?"You are logged in. You can re-login here.":"Please login here."],fi),Te("change",f,async S=>{M(a,S.target.value),ge({baseURL:S.target.value}),await t().saveSettings()}),rn(k,()=>P(n),S=>M(n,S)),rn(v,()=>P(r),S=>M(r,S)),Te("click",A,l),z(s,c),Xe()}var Vu=J('<div class="setting-item"><div class="setting-item-info"><div class="setting-item-name">Manual sync</div> <div class="setting-item-description">Manually perform a synchronization task</div></div> <div class="setting-item-control"><button class="mod-cta">Sync</button></div></div> <div class="setting-item"><div class="setting-item-info"><div class="setting-item-name">Check database</div> <div class="setting-item-description">Check for possible issues: sync error, file renaming not updated, or missed tasks not synchronized</div></div> <div class="setting-item-control"><button class="mod-cta">Check Database</button></div></div> <div class="setting-item"><div class="setting-item-info"><div class="setting-item-name">Backup TickTick data</div> <div class="setting-item-description">Click to backup TickTick data. The backed-up files will be stored in the root directory of the Obsidian vault</div></div> <div class="setting-item-control"><button class="mod-cta">Backup</button></div></div>',1),zu=J('<div class="manual-operations"><!></div>');function Gu(s,e){Je(e,!1);let t=be(e,"plugin",8);async function i(){if(!_().token){new N.Notice("Please log in from settings first");return}try{await t().scheduledSynchronization(),new N.Notice("Sync completed.")}catch(o){new N.Notice(`An error occurred while syncing: ${o}`)}}ut();var n=zu(),r=D(n);{var a=o=>{var l=Vu(),c=Jt(l),d=x(D(c),2),g=D(d),f=x(c,2),u=x(D(f),2),p=D(u),h=x(f,2),m=x(D(h),2),k=D(m);Te("click",g,i),Te("click",p,()=>t().service.checkDataBase()),Te("click",k,()=>t().service.backup()),z(o,l)};Se(r,o=>{_().token&&o(a)})}z(s,n),Xe()}const Wu={1:"AND",2:"OR"},Yu={trace:"trace",debug:"debug",info:"info",warn:"warn",error:"error"},Ju={noLink:"No Link",taskLink:"Link in Task",noteLink:"Link in Description"};var Xu=J("<option> </option>"),Qu=J('<div class="setting-item"><div class="setting-item-info"><div class="setting-item-name">Log Level</div> <div class="setting-item-description">Determine log level</div></div> <div class="setting-item-control"><select></select></div></div> <div class="setting-item"><div class="setting-item-info"><div class="setting-item-name">Skip backup</div> <div class="setting-item-description">Skip backup on startup</div></div> <div class="setting-item-control"><label class="toggle-switch"><input type="checkbox"/> <span class="slider"></span></label></div></div>',1),Zu=J('<div class="debug-options"><div class="setting-item"><div class="setting-item-info"><div class="setting-item-name">Debug mode</div> <div class="setting-item-description">Allow access to developer settings</div></div> <div class="setting-item-control"><label class="toggle-switch"><input type="checkbox"/> <span class="slider"></span></label></div></div> <!></div>');function ef(s,e){Je(e,!1);let t=be(e,"plugin",8),i=te(!1);Hi(async()=>{M(i,_().debugMode)}),ut();var n=Zu(),r=D(n),a=x(D(r),2),o=D(a),l=D(o),c=x(r,2);{var d=g=>{var f=Qu(),u=Jt(f),p=x(D(u),2),h=D(p);const m=fi(()=>_().logLevel);Ir(h,()=>P(m));var k;kt(h,5,()=>Object.entries(Yu),vt,(I,O)=>{var E=Yt(()=>Wt(P(O),2));let L=()=>P(E)[0],A=()=>P(E)[1];var S=Xu(),C={},F=D(S);ne(()=>{C!==(C=L())&&(S.value=(S.__value=L())??""),pe(F,A())}),z(I,S)});var T=x(u,2),w=x(D(T),2),v=D(w),b=D(v);ne(I=>{k!==(k=P(m))&&(h.value=(h.__value=P(m))??"",ds(h,P(m))),xu(b,I)},[()=>_().skipBackup],fi),Te("change",h,async I=>{ge({logLevel:I.target.value}),await t().saveSettings(!0),y.setLevel(I.target.value)}),Te("change",b,async I=>{ge({skipBackup:I.target.checked}),await t().saveSettings()}),z(g,f)};Se(c,g=>{P(i)&&g(d)})}_r(l,()=>P(i),g=>M(i,g)),Te("change",l,async g=>{const f=g.target.checked;M(i,f),ge({debugMode:f}),await t().saveSettings()}),z(s,n),Xe()}var tf=J("<div>Notes will be synchronized.</div> <br/>",1),sf=J("<div>Notes will be not synchronized.</div> <br/>",1),nf=J(`<div><div class="notes-settings "><div class="setting-item"><div class="setting-item-info"><div class="setting-item-name">Sync Notes</div> <div class="setting-item-description">Synchronize Notes</div></div> <div class="setting-item-control"><label class="toggle-switch"><input type="checkbox"/> <span class="slider"></span></label></div></div> <!> <div>If you have thoughts about Note formatting, please contribute them in the <a href="https://github.com/thesamim/TickTickSync/discussions/255#discussion-8452861">discussion forum.</a></div> <br/> <div class="setting-item"><div class="setting-item-info"><div class="setting-item-name">Reset Notes</div> <div class="setting-item-description"> <br/> <em>Caution: This may take
					some
					time.</em></div></div> <div class="setting-item-control"><button class="mod-cta">Reset Notes.</button></div></div></div></div>`);function rf(s,e){Je(e,!1);let t=be(e,"plugin",12),i=te(!1),n=te(!1),r=te("");Hi(async()=>{M(n,_().syncNotes)});async function a(){M(i,!0);const I=_().TickTickTasksData.tasks;for(const O of I)O.modifiedTime="1970-01-01T00:00:00.000Z";ge({TickTickTasksData:{..._().TickTickTasksData,tasks:I}}),t().tickTickRestAPI&&t().tickTickRestAPI.api&&t(t().tickTickRestAPI.api.checkpoint=0,!0),ge({checkPoint:0}),await t().saveSettings(),await t().scheduledSynchronization(),M(i,!1)}sn(()=>P(n),()=>{M(r,P(n)?"Get all Notes from TickTick?":"Remove all Notes from Obsidian? (This will not delete Notes in TickTick)")}),yr(),ut();var o=nf(),l=D(o),c=D(l),d=x(D(c),2),g=D(d),f=D(g),u=x(c,2);{var p=I=>{var O=tf();z(I,O)},h=I=>{var O=sf();z(I,O)};Se(u,I=>{P(n)?I(p):I(h,!1)})}var m=x(u,6),k=D(m),T=x(D(k),2),w=D(T),v=x(k,2),b=D(v);ne(()=>{Tr(o,1,P(i)?"wait-cursor":"default-cursor"),pe(w,`Do you want to ${P(r)??""} `),b.disabled=P(i)}),_r(f,()=>P(n),I=>M(n,I)),Te("change",f,async I=>{const O=I.target.checked;M(n,O),ge({syncNotes:O}),await t().saveSettings()}),Te("click",b,a),z(s,o),Xe()}var af=J('<div class="collapsible-body"><!></div>'),of=J('<div class="short-desc"> </div>'),lf=J('<div class="collapsible-section"><div class="collapsible-header"><span> </span> </div> <!></div>');function yn(s,e){Je(e,!1);let t=be(e,"title",8),i=be(e,"open",8,!1),n=be(e,"shortDesc",8,"");const r=Is();function a(){r("headerClick")}ut();var o=lf(),l=D(o),c=D(l),d=D(c),g=x(c,1,!0),f=x(l,2);{var u=h=>{var m=af(),k=D(m);Au(k,e,"default",{}),z(h,m)},p=(h,m)=>{{var k=T=>{var w=of(),v=D(w);ne(()=>pe(v,n())),z(T,w)};Se(h,T=>{n()&&T(k)},m)}};Se(f,h=>{i()?h(u):h(p,!1)})}ne(()=>{pe(d,i()?"":""),pe(g,t())}),Te("click",l,a),z(s,o),Xe()}var je="top",ot="bottom",lt="right",Re="left",Sr="auto",_s=[je,ot,lt,Re],Ni="start",ps="end",cf="clippingParents",Oo="viewport",Xi="popper",uf="reference",va=_s.reduce(function(s,e){return s.concat([e+"-"+Ni,e+"-"+ps])},[]),Ao=[].concat(_s,[Sr]).reduce(function(s,e){return s.concat([e,e+"-"+Ni,e+"-"+ps])},[]),ff="beforeRead",df="read",hf="afterRead",pf="beforeMain",gf="main",mf="afterMain",vf="beforeWrite",kf="write",yf="afterWrite",wf=[ff,df,hf,pf,gf,mf,vf,kf,yf];function Ot(s){return s?(s.nodeName||"").toLowerCase():null}function Ye(s){if(s==null)return window;if(s.toString()!=="[object Window]"){var e=s.ownerDocument;return e&&e.defaultView||window}return s}function hi(s){var e=Ye(s).Element;return s instanceof e||s instanceof Element}function it(s){var e=Ye(s).HTMLElement;return s instanceof e||s instanceof HTMLElement}function Er(s){if(typeof ShadowRoot>"u")return!1;var e=Ye(s).ShadowRoot;return s instanceof e||s instanceof ShadowRoot}function bf(s){var e=s.state;Object.keys(e.elements).forEach(function(t){var i=e.styles[t]||{},n=e.attributes[t]||{},r=e.elements[t];!it(r)||!Ot(r)||(Object.assign(r.style,i),Object.keys(n).forEach(function(a){var o=n[a];o===!1?r.removeAttribute(a):r.setAttribute(a,o===!0?"":o)}))})}function Tf(s){var e=s.state,t={popper:{position:e.options.strategy,left:"0",top:"0",margin:"0"},arrow:{position:"absolute"},reference:{}};return Object.assign(e.elements.popper.style,t.popper),e.styles=t,e.elements.arrow&&Object.assign(e.elements.arrow.style,t.arrow),function(){Object.keys(e.elements).forEach(function(i){var n=e.elements[i],r=e.attributes[i]||{},a=Object.keys(e.styles.hasOwnProperty(i)?e.styles[i]:t[i]),o=a.reduce(function(l,c){return l[c]="",l},{});!it(n)||!Ot(n)||(Object.assign(n.style,o),Object.keys(r).forEach(function(l){n.removeAttribute(l)}))})}}const If={name:"applyStyles",enabled:!0,phase:"write",fn:bf,effect:Tf,requires:["computeStyles"]};function It(s){return s.split("-")[0]}var ui=Math.max,an=Math.min,Li=Math.round;function rr(){var s=navigator.userAgentData;return s!=null&&s.brands&&Array.isArray(s.brands)?s.brands.map(function(e){return e.brand+"/"+e.version}).join(" "):navigator.userAgent}function Co(){return!/^((?!chrome|android).)*safari/i.test(rr())}function Di(s,e,t){e===void 0&&(e=!1),t===void 0&&(t=!1);var i=s.getBoundingClientRect(),n=1,r=1;e&&it(s)&&(n=s.offsetWidth>0&&Li(i.width)/s.offsetWidth||1,r=s.offsetHeight>0&&Li(i.height)/s.offsetHeight||1);var a=hi(s)?Ye(s):window,o=a.visualViewport,l=!Co()&&t,c=(i.left+(l&&o?o.offsetLeft:0))/n,d=(i.top+(l&&o?o.offsetTop:0))/r,g=i.width/n,f=i.height/r;return{width:g,height:f,top:d,right:c+g,bottom:d+f,left:c,x:c,y:d}}function Pr(s){var e=Di(s),t=s.offsetWidth,i=s.offsetHeight;return Math.abs(e.width-t)<=1&&(t=e.width),Math.abs(e.height-i)<=1&&(i=e.height),{x:s.offsetLeft,y:s.offsetTop,width:t,height:i}}function No(s,e){var t=e.getRootNode&&e.getRootNode();if(s.contains(e))return!0;if(t&&Er(t)){var i=e;do{if(i&&s.isSameNode(i))return!0;i=i.parentNode||i.host}while(i)}return!1}function $t(s){return Ye(s).getComputedStyle(s)}function _f(s){return["table","td","th"].indexOf(Ot(s))>=0}function ei(s){return((hi(s)?s.ownerDocument:s.document)||window.document).documentElement}function wn(s){return Ot(s)==="html"?s:s.assignedSlot||s.parentNode||(Er(s)?s.host:null)||ei(s)}function ka(s){return!it(s)||$t(s).position==="fixed"?null:s.offsetParent}function Sf(s){var e=/firefox/i.test(rr()),t=/Trident/i.test(rr());if(t&&it(s)){var i=$t(s);if(i.position==="fixed")return null}var n=wn(s);for(Er(n)&&(n=n.host);it(n)&&["html","body"].indexOf(Ot(n))<0;){var r=$t(n);if(r.transform!=="none"||r.perspective!=="none"||r.contain==="paint"||["transform","perspective"].indexOf(r.willChange)!==-1||e&&r.willChange==="filter"||e&&r.filter&&r.filter!=="none")return n;n=n.parentNode}return null}function Ss(s){for(var e=Ye(s),t=ka(s);t&&_f(t)&&$t(t).position==="static";)t=ka(t);return t&&(Ot(t)==="html"||Ot(t)==="body"&&$t(t).position==="static")?e:t||Sf(s)||e}function Or(s){return["top","bottom"].indexOf(s)>=0?"x":"y"}function as(s,e,t){return ui(s,an(e,t))}function Ef(s,e,t){var i=as(s,e,t);return i>t?t:i}function Lo(){return{top:0,right:0,bottom:0,left:0}}function Do(s){return Object.assign({},Lo(),s)}function Fo(s,e){return e.reduce(function(t,i){return t[i]=s,t},{})}var Pf=function(e,t){return e=typeof e=="function"?e(Object.assign({},t.rects,{placement:t.placement})):e,Do(typeof e!="number"?e:Fo(e,_s))};function Of(s){var e,t=s.state,i=s.name,n=s.options,r=t.elements.arrow,a=t.modifiersData.popperOffsets,o=It(t.placement),l=Or(o),c=[Re,lt].indexOf(o)>=0,d=c?"height":"width";if(!(!r||!a)){var g=Pf(n.padding,t),f=Pr(r),u=l==="y"?je:Re,p=l==="y"?ot:lt,h=t.rects.reference[d]+t.rects.reference[l]-a[l]-t.rects.popper[d],m=a[l]-t.rects.reference[l],k=Ss(r),T=k?l==="y"?k.clientHeight||0:k.clientWidth||0:0,w=h/2-m/2,v=g[u],b=T-f[d]-g[p],I=T/2-f[d]/2+w,O=as(v,I,b),E=l;t.modifiersData[i]=(e={},e[E]=O,e.centerOffset=O-I,e)}}function Af(s){var e=s.state,t=s.options,i=t.element,n=i===void 0?"[data-popper-arrow]":i;n!=null&&(typeof n=="string"&&(n=e.elements.popper.querySelector(n),!n)||No(e.elements.popper,n)&&(e.elements.arrow=n))}const Cf={name:"arrow",enabled:!0,phase:"main",fn:Of,effect:Af,requires:["popperOffsets"],requiresIfExists:["preventOverflow"]};function Fi(s){return s.split("-")[1]}var Nf={top:"auto",right:"auto",bottom:"auto",left:"auto"};function Lf(s,e){var t=s.x,i=s.y,n=e.devicePixelRatio||1;return{x:Li(t*n)/n||0,y:Li(i*n)/n||0}}function ya(s){var e,t=s.popper,i=s.popperRect,n=s.placement,r=s.variation,a=s.offsets,o=s.position,l=s.gpuAcceleration,c=s.adaptive,d=s.roundOffsets,g=s.isFixed,f=a.x,u=f===void 0?0:f,p=a.y,h=p===void 0?0:p,m=typeof d=="function"?d({x:u,y:h}):{x:u,y:h};u=m.x,h=m.y;var k=a.hasOwnProperty("x"),T=a.hasOwnProperty("y"),w=Re,v=je,b=window;if(c){var I=Ss(t),O="clientHeight",E="clientWidth";if(I===Ye(t)&&(I=ei(t),$t(I).position!=="static"&&o==="absolute"&&(O="scrollHeight",E="scrollWidth")),I=I,n===je||(n===Re||n===lt)&&r===ps){v=ot;var L=g&&I===b&&b.visualViewport?b.visualViewport.height:I[O];h-=L-i.height,h*=l?1:-1}if(n===Re||(n===je||n===ot)&&r===ps){w=lt;var A=g&&I===b&&b.visualViewport?b.visualViewport.width:I[E];u-=A-i.width,u*=l?1:-1}}var S=Object.assign({position:o},c&&Nf),C=d===!0?Lf({x:u,y:h},Ye(t)):{x:u,y:h};if(u=C.x,h=C.y,l){var F;return Object.assign({},S,(F={},F[v]=T?"0":"",F[w]=k?"0":"",F.transform=(b.devicePixelRatio||1)<=1?"translate("+u+"px, "+h+"px)":"translate3d("+u+"px, "+h+"px, 0)",F))}return Object.assign({},S,(e={},e[v]=T?h+"px":"",e[w]=k?u+"px":"",e.transform="",e))}function Df(s){var e=s.state,t=s.options,i=t.gpuAcceleration,n=i===void 0?!0:i,r=t.adaptive,a=r===void 0?!0:r,o=t.roundOffsets,l=o===void 0?!0:o,c={placement:It(e.placement),variation:Fi(e.placement),popper:e.elements.popper,popperRect:e.rects.popper,gpuAcceleration:n,isFixed:e.options.strategy==="fixed"};e.modifiersData.popperOffsets!=null&&(e.styles.popper=Object.assign({},e.styles.popper,ya(Object.assign({},c,{offsets:e.modifiersData.popperOffsets,position:e.options.strategy,adaptive:a,roundOffsets:l})))),e.modifiersData.arrow!=null&&(e.styles.arrow=Object.assign({},e.styles.arrow,ya(Object.assign({},c,{offsets:e.modifiersData.arrow,position:"absolute",adaptive:!1,roundOffsets:l})))),e.attributes.popper=Object.assign({},e.attributes.popper,{"data-popper-placement":e.placement})}const Ff={name:"computeStyles",enabled:!0,phase:"beforeWrite",fn:Df,data:{}};var Fs={passive:!0};function xf(s){var e=s.state,t=s.instance,i=s.options,n=i.scroll,r=n===void 0?!0:n,a=i.resize,o=a===void 0?!0:a,l=Ye(e.elements.popper),c=[].concat(e.scrollParents.reference,e.scrollParents.popper);return r&&c.forEach(function(d){d.addEventListener("scroll",t.update,Fs)}),o&&l.addEventListener("resize",t.update,Fs),function(){r&&c.forEach(function(d){d.removeEventListener("scroll",t.update,Fs)}),o&&l.removeEventListener("resize",t.update,Fs)}}const Mf={name:"eventListeners",enabled:!0,phase:"write",fn:function(){},effect:xf,data:{}};var $f={left:"right",right:"left",bottom:"top",top:"bottom"};function qs(s){return s.replace(/left|right|bottom|top/g,function(e){return $f[e]})}var jf={start:"end",end:"start"};function wa(s){return s.replace(/start|end/g,function(e){return jf[e]})}function Ar(s){var e=Ye(s),t=e.pageXOffset,i=e.pageYOffset;return{scrollLeft:t,scrollTop:i}}function Cr(s){return Di(ei(s)).left+Ar(s).scrollLeft}function Rf(s,e){var t=Ye(s),i=ei(s),n=t.visualViewport,r=i.clientWidth,a=i.clientHeight,o=0,l=0;if(n){r=n.width,a=n.height;var c=Co();(c||!c&&e==="fixed")&&(o=n.offsetLeft,l=n.offsetTop)}return{width:r,height:a,x:o+Cr(s),y:l}}function Bf(s){var e,t=ei(s),i=Ar(s),n=(e=s.ownerDocument)==null?void 0:e.body,r=ui(t.scrollWidth,t.clientWidth,n?n.scrollWidth:0,n?n.clientWidth:0),a=ui(t.scrollHeight,t.clientHeight,n?n.scrollHeight:0,n?n.clientHeight:0),o=-i.scrollLeft+Cr(s),l=-i.scrollTop;return $t(n||t).direction==="rtl"&&(o+=ui(t.clientWidth,n?n.clientWidth:0)-r),{width:r,height:a,x:o,y:l}}function Nr(s){var e=$t(s),t=e.overflow,i=e.overflowX,n=e.overflowY;return/auto|scroll|overlay|hidden/.test(t+n+i)}function xo(s){return["html","body","#document"].indexOf(Ot(s))>=0?s.ownerDocument.body:it(s)&&Nr(s)?s:xo(wn(s))}function os(s,e){var t;e===void 0&&(e=[]);var i=xo(s),n=i===((t=s.ownerDocument)==null?void 0:t.body),r=Ye(i),a=n?[r].concat(r.visualViewport||[],Nr(i)?i:[]):i,o=e.concat(a);return n?o:o.concat(os(wn(a)))}function ar(s){return Object.assign({},s,{left:s.x,top:s.y,right:s.x+s.width,bottom:s.y+s.height})}function Uf(s,e){var t=Di(s,!1,e==="fixed");return t.top=t.top+s.clientTop,t.left=t.left+s.clientLeft,t.bottom=t.top+s.clientHeight,t.right=t.left+s.clientWidth,t.width=s.clientWidth,t.height=s.clientHeight,t.x=t.left,t.y=t.top,t}function ba(s,e,t){return e===Oo?ar(Rf(s,t)):hi(e)?Uf(e,t):ar(Bf(ei(s)))}function qf(s){var e=os(wn(s)),t=["absolute","fixed"].indexOf($t(s).position)>=0,i=t&&it(s)?Ss(s):s;return hi(i)?e.filter(function(n){return hi(n)&&No(n,i)&&Ot(n)!=="body"}):[]}function Hf(s,e,t,i){var n=e==="clippingParents"?qf(s):[].concat(e),r=[].concat(n,[t]),a=r[0],o=r.reduce(function(l,c){var d=ba(s,c,i);return l.top=ui(d.top,l.top),l.right=an(d.right,l.right),l.bottom=an(d.bottom,l.bottom),l.left=ui(d.left,l.left),l},ba(s,a,i));return o.width=o.right-o.left,o.height=o.bottom-o.top,o.x=o.left,o.y=o.top,o}function Mo(s){var e=s.reference,t=s.element,i=s.placement,n=i?It(i):null,r=i?Fi(i):null,a=e.x+e.width/2-t.width/2,o=e.y+e.height/2-t.height/2,l;switch(n){case je:l={x:a,y:e.y-t.height};break;case ot:l={x:a,y:e.y+e.height};break;case lt:l={x:e.x+e.width,y:o};break;case Re:l={x:e.x-t.width,y:o};break;default:l={x:e.x,y:e.y}}var c=n?Or(n):null;if(c!=null){var d=c==="y"?"height":"width";switch(r){case Ni:l[c]=l[c]-(e[d]/2-t[d]/2);break;case ps:l[c]=l[c]+(e[d]/2-t[d]/2);break}}return l}function gs(s,e){e===void 0&&(e={});var t=e,i=t.placement,n=i===void 0?s.placement:i,r=t.strategy,a=r===void 0?s.strategy:r,o=t.boundary,l=o===void 0?cf:o,c=t.rootBoundary,d=c===void 0?Oo:c,g=t.elementContext,f=g===void 0?Xi:g,u=t.altBoundary,p=u===void 0?!1:u,h=t.padding,m=h===void 0?0:h,k=Do(typeof m!="number"?m:Fo(m,_s)),T=f===Xi?uf:Xi,w=s.rects.popper,v=s.elements[p?T:f],b=Hf(hi(v)?v:v.contextElement||ei(s.elements.popper),l,d,a),I=Di(s.elements.reference),O=Mo({reference:I,element:w,placement:n}),E=ar(Object.assign({},w,O)),L=f===Xi?E:I,A={top:b.top-L.top+k.top,bottom:L.bottom-b.bottom+k.bottom,left:b.left-L.left+k.left,right:L.right-b.right+k.right},S=s.modifiersData.offset;if(f===Xi&&S){var C=S[n];Object.keys(A).forEach(function(F){var V=[lt,ot].indexOf(F)>=0?1:-1,Q=[je,ot].indexOf(F)>=0?"y":"x";A[F]+=C[Q]*V})}return A}function Kf(s,e){e===void 0&&(e={});var t=e,i=t.placement,n=t.boundary,r=t.rootBoundary,a=t.padding,o=t.flipVariations,l=t.allowedAutoPlacements,c=l===void 0?Ao:l,d=Fi(i),g=d?o?va:va.filter(function(p){return Fi(p)===d}):_s,f=g.filter(function(p){return c.indexOf(p)>=0});f.length===0&&(f=g);var u=f.reduce(function(p,h){return p[h]=gs(s,{placement:h,boundary:n,rootBoundary:r,padding:a})[It(h)],p},{});return Object.keys(u).sort(function(p,h){return u[p]-u[h]})}function Vf(s){if(It(s)===Sr)return[];var e=qs(s);return[wa(s),e,wa(e)]}function zf(s){var e=s.state,t=s.options,i=s.name;if(!e.modifiersData[i]._skip){for(var n=t.mainAxis,r=n===void 0?!0:n,a=t.altAxis,o=a===void 0?!0:a,l=t.fallbackPlacements,c=t.padding,d=t.boundary,g=t.rootBoundary,f=t.altBoundary,u=t.flipVariations,p=u===void 0?!0:u,h=t.allowedAutoPlacements,m=e.options.placement,k=It(m),T=k===m,w=l||(T||!p?[qs(m)]:Vf(m)),v=[m].concat(w).reduce(function(ie,se){return ie.concat(It(se)===Sr?Kf(e,{placement:se,boundary:d,rootBoundary:g,padding:c,flipVariations:p,allowedAutoPlacements:h}):se)},[]),b=e.rects.reference,I=e.rects.popper,O=new Map,E=!0,L=v[0],A=0;A<v.length;A++){var S=v[A],C=It(S),F=Fi(S)===Ni,V=[je,ot].indexOf(C)>=0,Q=V?"width":"height",K=gs(e,{placement:S,boundary:d,rootBoundary:g,altBoundary:f,padding:c}),G=V?F?lt:Re:F?ot:je;b[Q]>I[Q]&&(G=qs(G));var re=qs(G),he=[];if(r&&he.push(K[C]<=0),o&&he.push(K[G]<=0,K[re]<=0),he.every(function(ie){return ie})){L=S,E=!1;break}O.set(S,he)}if(E)for(var ue=p?3:1,Y=function(se){var Z=v.find(function($){var ve=O.get($);if(ve)return ve.slice(0,se).every(function(Ee){return Ee})});if(Z)return L=Z,"break"},fe=ue;fe>0;fe--){var X=Y(fe);if(X==="break")break}e.placement!==L&&(e.modifiersData[i]._skip=!0,e.placement=L,e.reset=!0)}}const Gf={name:"flip",enabled:!0,phase:"main",fn:zf,requiresIfExists:["offset"],data:{_skip:!1}};function Ta(s,e,t){return t===void 0&&(t={x:0,y:0}),{top:s.top-e.height-t.y,right:s.right-e.width+t.x,bottom:s.bottom-e.height+t.y,left:s.left-e.width-t.x}}function Ia(s){return[je,lt,ot,Re].some(function(e){return s[e]>=0})}function Wf(s){var e=s.state,t=s.name,i=e.rects.reference,n=e.rects.popper,r=e.modifiersData.preventOverflow,a=gs(e,{elementContext:"reference"}),o=gs(e,{altBoundary:!0}),l=Ta(a,i),c=Ta(o,n,r),d=Ia(l),g=Ia(c);e.modifiersData[t]={referenceClippingOffsets:l,popperEscapeOffsets:c,isReferenceHidden:d,hasPopperEscaped:g},e.attributes.popper=Object.assign({},e.attributes.popper,{"data-popper-reference-hidden":d,"data-popper-escaped":g})}const Yf={name:"hide",enabled:!0,phase:"main",requiresIfExists:["preventOverflow"],fn:Wf};function Jf(s,e,t){var i=It(s),n=[Re,je].indexOf(i)>=0?-1:1,r=typeof t=="function"?t(Object.assign({},e,{placement:s})):t,a=r[0],o=r[1];return a=a||0,o=(o||0)*n,[Re,lt].indexOf(i)>=0?{x:o,y:a}:{x:a,y:o}}function Xf(s){var e=s.state,t=s.options,i=s.name,n=t.offset,r=n===void 0?[0,0]:n,a=Ao.reduce(function(d,g){return d[g]=Jf(g,e.rects,r),d},{}),o=a[e.placement],l=o.x,c=o.y;e.modifiersData.popperOffsets!=null&&(e.modifiersData.popperOffsets.x+=l,e.modifiersData.popperOffsets.y+=c),e.modifiersData[i]=a}const Qf={name:"offset",enabled:!0,phase:"main",requires:["popperOffsets"],fn:Xf};function Zf(s){var e=s.state,t=s.name;e.modifiersData[t]=Mo({reference:e.rects.reference,element:e.rects.popper,placement:e.placement})}const ed={name:"popperOffsets",enabled:!0,phase:"read",fn:Zf,data:{}};function td(s){return s==="x"?"y":"x"}function id(s){var e=s.state,t=s.options,i=s.name,n=t.mainAxis,r=n===void 0?!0:n,a=t.altAxis,o=a===void 0?!1:a,l=t.boundary,c=t.rootBoundary,d=t.altBoundary,g=t.padding,f=t.tether,u=f===void 0?!0:f,p=t.tetherOffset,h=p===void 0?0:p,m=gs(e,{boundary:l,rootBoundary:c,padding:g,altBoundary:d}),k=It(e.placement),T=Fi(e.placement),w=!T,v=Or(k),b=td(v),I=e.modifiersData.popperOffsets,O=e.rects.reference,E=e.rects.popper,L=typeof h=="function"?h(Object.assign({},e.rects,{placement:e.placement})):h,A=typeof L=="number"?{mainAxis:L,altAxis:L}:Object.assign({mainAxis:0,altAxis:0},L),S=e.modifiersData.offset?e.modifiersData.offset[e.placement]:null,C={x:0,y:0};if(I){if(r){var F,V=v==="y"?je:Re,Q=v==="y"?ot:lt,K=v==="y"?"height":"width",G=I[v],re=G+m[V],he=G-m[Q],ue=u?-E[K]/2:0,Y=T===Ni?O[K]:E[K],fe=T===Ni?-E[K]:-O[K],X=e.elements.arrow,ie=u&&X?Pr(X):{width:0,height:0},se=e.modifiersData["arrow#persistent"]?e.modifiersData["arrow#persistent"].padding:Lo(),Z=se[V],$=se[Q],ve=as(0,O[K],ie[K]),Ee=w?O[K]/2-ue-ve-Z-A.mainAxis:Y-ve-Z-A.mainAxis,R=w?-O[K]/2+ue+ve+$+A.mainAxis:fe+ve+$+A.mainAxis,Ue=e.elements.arrow&&Ss(e.elements.arrow),Ct=Ue?v==="y"?Ue.clientTop||0:Ue.clientLeft||0:0,Pe=(F=S==null?void 0:S[v])!=null?F:0,Qe=G+Ee-Pe-Ct,Oe=G+R-Pe,ft=as(u?an(re,Qe):re,G,u?ui(he,Oe):he);I[v]=ft,C[v]=ft-G}if(o){var Ze,qe=v==="x"?je:Re,wt=v==="x"?ot:lt,de=I[b],Ne=b==="y"?"height":"width",dt=de+m[qe],Ie=de-m[wt],Le=[je,Re].indexOf(k)!==-1,He=(Ze=S==null?void 0:S[b])!=null?Ze:0,H=Le?dt:de-O[Ne]-E[Ne]-He+A.altAxis,W=Le?de+O[Ne]+E[Ne]-He-A.altAxis:Ie,j=u&&Le?Ef(H,de,W):as(u?H:dt,de,u?W:Ie);I[b]=j,C[b]=j-de}e.modifiersData[i]=C}}const sd={name:"preventOverflow",enabled:!0,phase:"main",fn:id,requiresIfExists:["offset"]};function nd(s){return{scrollLeft:s.scrollLeft,scrollTop:s.scrollTop}}function rd(s){return s===Ye(s)||!it(s)?Ar(s):nd(s)}function ad(s){var e=s.getBoundingClientRect(),t=Li(e.width)/s.offsetWidth||1,i=Li(e.height)/s.offsetHeight||1;return t!==1||i!==1}function od(s,e,t){t===void 0&&(t=!1);var i=it(e),n=it(e)&&ad(e),r=ei(e),a=Di(s,n,t),o={scrollLeft:0,scrollTop:0},l={x:0,y:0};return(i||!i&&!t)&&((Ot(e)!=="body"||Nr(r))&&(o=rd(e)),it(e)?(l=Di(e,!0),l.x+=e.clientLeft,l.y+=e.clientTop):r&&(l.x=Cr(r))),{x:a.left+o.scrollLeft-l.x,y:a.top+o.scrollTop-l.y,width:a.width,height:a.height}}function ld(s){var e=new Map,t=new Set,i=[];s.forEach(function(r){e.set(r.name,r)});function n(r){t.add(r.name);var a=[].concat(r.requires||[],r.requiresIfExists||[]);a.forEach(function(o){if(!t.has(o)){var l=e.get(o);l&&n(l)}}),i.push(r)}return s.forEach(function(r){t.has(r.name)||n(r)}),i}function cd(s){var e=ld(s);return wf.reduce(function(t,i){return t.concat(e.filter(function(n){return n.phase===i}))},[])}function ud(s){var e;return function(){return e||(e=new Promise(function(t){Promise.resolve().then(function(){e=void 0,t(s())})})),e}}function fd(s){var e=s.reduce(function(t,i){var n=t[i.name];return t[i.name]=n?Object.assign({},n,i,{options:Object.assign({},n.options,i.options),data:Object.assign({},n.data,i.data)}):i,t},{});return Object.keys(e).map(function(t){return e[t]})}var _a={placement:"bottom",modifiers:[],strategy:"absolute"};function Sa(){for(var s=arguments.length,e=new Array(s),t=0;t<s;t++)e[t]=arguments[t];return!e.some(function(i){return!(i&&typeof i.getBoundingClientRect=="function")})}function dd(s){s===void 0&&(s={});var e=s,t=e.defaultModifiers,i=t===void 0?[]:t,n=e.defaultOptions,r=n===void 0?_a:n;return function(o,l,c){c===void 0&&(c=r);var d={placement:"bottom",orderedModifiers:[],options:Object.assign({},_a,r),modifiersData:{},elements:{reference:o,popper:l},attributes:{},styles:{}},g=[],f=!1,u={state:d,setOptions:function(k){var T=typeof k=="function"?k(d.options):k;h(),d.options=Object.assign({},r,d.options,T),d.scrollParents={reference:hi(o)?os(o):o.contextElement?os(o.contextElement):[],popper:os(l)};var w=cd(fd([].concat(i,d.options.modifiers)));return d.orderedModifiers=w.filter(function(v){return v.enabled}),p(),u.update()},forceUpdate:function(){if(!f){var k=d.elements,T=k.reference,w=k.popper;if(Sa(T,w)){d.rects={reference:od(T,Ss(w),d.options.strategy==="fixed"),popper:Pr(w)},d.reset=!1,d.placement=d.options.placement,d.orderedModifiers.forEach(function(A){return d.modifiersData[A.name]=Object.assign({},A.data)});for(var v=0;v<d.orderedModifiers.length;v++){if(d.reset===!0){d.reset=!1,v=-1;continue}var b=d.orderedModifiers[v],I=b.fn,O=b.options,E=O===void 0?{}:O,L=b.name;typeof I=="function"&&(d=I({state:d,options:E,name:L,instance:u})||d)}}}},update:ud(function(){return new Promise(function(m){u.forceUpdate(),m(d)})}),destroy:function(){h(),f=!0}};if(!Sa(o,l))return u;u.setOptions(c).then(function(m){!f&&c.onFirstUpdate&&c.onFirstUpdate(m)});function p(){d.orderedModifiers.forEach(function(m){var k=m.name,T=m.options,w=T===void 0?{}:T,v=m.effect;if(typeof v=="function"){var b=v({state:d,name:k,instance:u,options:w}),I=function(){};g.push(b||I)}})}function h(){g.forEach(function(m){return m()}),g=[]}return u}}var hd=[Mf,ed,Ff,If,Qf,Gf,sd,Cf,Yf],pd=dd({defaultModifiers:hd});const gd=(s,e)=>(s%e+e)%e;class md{constructor(e,t,i){this.owner=e,this.containerEl=t,t.on("click",".suggestion-item",this.onSuggestionClick.bind(this)),t.on("mousemove",".suggestion-item",this.onSuggestionMouseover.bind(this)),i.register([],"ArrowUp",n=>{if(!n.isComposing)return this.setSelectedItem(this.selectedItem-1,!0),!1}),i.register([],"ArrowDown",n=>{if(!n.isComposing)return this.setSelectedItem(this.selectedItem+1,!0),!1}),i.register([],"Enter",n=>{if(!n.isComposing)return this.useSelectedItem(n),!1})}onSuggestionClick(e,t){e.preventDefault();const i=this.suggestions.indexOf(t);this.setSelectedItem(i,!1),this.useSelectedItem(e)}onSuggestionMouseover(e,t){const i=this.suggestions.indexOf(t);this.setSelectedItem(i,!1)}setSuggestions(e){this.containerEl.empty();const t=[];e.forEach(i=>{const n=this.containerEl.createDiv("suggestion-item");this.owner.renderSuggestion(i,n),t.push(n)}),this.values=e,this.suggestions=t,this.setSelectedItem(0,!1)}useSelectedItem(e){const t=this.values[this.selectedItem];t&&this.owner.selectSuggestion(t,e)}setSelectedItem(e,t){const i=gd(e,this.suggestions.length),n=this.suggestions[this.selectedItem],r=this.suggestions[i];n==null||n.removeClass("is-selected"),r==null||r.addClass("is-selected"),this.selectedItem=i,t&&r.scrollIntoView(!1)}}class vd{constructor(e){this.inputEl=e,this.scope=new N.Scope,this.suggestEl=createDiv("suggestion-container");const t=this.suggestEl.createDiv("suggestion");this.suggest=new md(this,t,this.scope),this.scope.register([],"Escape",this.close.bind(this)),this.inputEl.addEventListener("input",this.onInputChanged.bind(this)),this.inputEl.addEventListener("focus",this.onInputChanged.bind(this)),this.inputEl.addEventListener("blur",this.close.bind(this)),this.suggestEl.on("mousedown",".suggestion-container",i=>{i.preventDefault()})}onInputChanged(){const e=this.inputEl.value,t=this.getSuggestions(e);if(!t){this.close();return}t.length>0?(this.suggest.setSuggestions(t),this.open(app.dom.appContainerEl,this.inputEl)):this.close()}open(e,t){app.keymap.pushScope(this.scope),e.appendChild(this.suggestEl),this.popper=pd(t,this.suggestEl,{placement:"bottom-start",modifiers:[{name:"sameWidth",enabled:!0,fn:({state:i,instance:n})=>{const r=`${i.rects.reference.width}px`;i.styles.popper.width!==r&&(i.styles.popper.width=r,n.update())},phase:"beforeWrite",requires:["computeStyles"]}]})}close(){app.keymap.popScope(this.scope),this.suggest.setSuggestions([]),this.popper&&this.popper.destroy(),this.suggestEl.detach()}}class kd extends vd{constructor(e,t){super(e),this.inputEl=e,this.app=t}getSuggestions(e){const t=this.app.vault.getAllLoadedFiles(),i=[],n=e.toLowerCase();return t.forEach(r=>{r instanceof N.TFolder&&r.path.toLowerCase().contains(n)&&i.push(r)}),i}renderSuggestion(e,t){t.setText(e.path)}selectSuggestion(e){this.inputEl.value=e.path,this.inputEl.trigger("input"),this.close()}}var yd=J("<option> </option>"),wd=J(`<div class="sync-control"><div class="setting-item"><div class="setting-item-info"><div class="setting-item-name">Default Project</div> <div class="setting-item-description">Tasks are added to the default project associated with a file. If
					tasks are added to a file with no default project association the will be added to the <span class="setting-item-name"> </span> project.</div></div> <div class="setting-item-control"><select class="dropdown" id="sync-project"><option>(none)</option><!></select></div></div> <div class="setting-item"><div class="setting-item-info"><div class="setting-item-name">Default folder location</div> <div class="setting-item-description">If not set, TickTickSync saves Task files to the root folder
					("/"). To choose an alternative directory, search for or type in the new folder name.</div></div> <div class="setting-item-control flex-container"><div class="modal-form remove-padding remove-border fix-suggest"></div></div></div></div>`);function bd(s,e){Je(e,!1);let t=be(e,"open",8,!1),i=be(e,"plugin",8),n=te("");const r=Is();function a(){r("toggle")}let o=[],l=te({}),c;function d(p){new N.Setting(p).addSearch(h=>{h.setPlaceholder("Select or Create folder").setValue(_().TickTickTasksFilePath),h.setValue(P(l)),new kd(h.inputEl,app),h.onChange(m=>{c&&clearTimeout(c),c=setTimeout(async()=>{const k=await f(m);k&&(ge({TickTickTasksFilePath:k}),await i().saveSettings())},700)})})}function g(){return o.reduce((p,h)=>(p[h.id]=h.name,p),{})}async function f(p){if(!p)return null;p&&p.length>1&&/^[/\\]/.test(p)&&(p=p.substring(1));let h=app.vault.getAbstractFileByPath(p);if(!h)try{h=await app.vault.createFolder(p),new N.Notice(`New folder ${h.path} created.`)}catch(m){return new N.Notice(`Folder ${p} creation failed: ${m}. Please correct and try again.`,5e3),null}return h instanceof N.TFolder?h.path:null}async function u(p){var h,m,k;if(_().defaultProjectId=p,p&&p!==""){ge({defaultProjectName:await((h=i().cacheOperation)==null?void 0:h.getProjectNameByIdFromCache(p))});const T=_().defaultProjectName+".md",w=await((m=i().fileOperation)==null?void 0:m.getOrCreateDefaultFile(T));w?(k=i().cacheOperation)==null||k.setDefaultProjectIdForFilepath(w.path,_().defaultProjectId):new N.Notice("Unable to create file for selected default project "+_().defaultProjectName)}else ge({defaultProjectName:""});await i().saveSettings()}Hi(async()=>{var p,h;o=await((h=(p=i().service).getProjects)==null?void 0:h.call(p))??[],M(l,g()),M(n,_().defaultProjectId??"")}),ut(),yn(s,{title:"Defaults",shortDesc:"Default Folder and Project settings",get open(){return t()},$$events:{headerClick:a},children:(p,h)=>{var m=wd(),k=D(m),T=D(k),w=x(D(T),2),v=x(D(w)),b=D(v),I=x(T,2),O=D(I);ne(()=>{P(n),fs(()=>{P(l)})});var E=D(O);E.value=E.__value="";var L=x(E);kt(L,1,()=>Object.entries(P(l)),vt,(F,V)=>{var Q=Yt(()=>Wt(P(V),2));let K=()=>P(Q)[0],G=()=>P(Q)[1];var re=yd(),he={},ue=D(re);ne(()=>{he!==(he=K())&&(re.value=(re.__value=K())??""),pe(ue,G())}),z(F,re)});var A=x(k,2),S=x(D(A),2),C=D(S);Nu(C,F=>d==null?void 0:d(F)),ne(()=>pe(b,P(n)?P(l)[P(n)]:"Inbox")),hs(O,()=>P(n),F=>M(n,F)),Te("change",O,F=>u(F.target.value)),z(p,m)},$$slots:{default:!0}}),Xe()}var Td=J("<option> </option>"),Id=J("<option> </option>"),_d=J("<p>No limitation.</p>"),Sd=J("<p>Only Tasks in <b> </b> will be synchronized</p>"),Ed=J("<p>Only Tasks tagged with <b> </b> tag will be synchronized</p>"),Pd=J(`<p>Only tasks in <b> </b> AND tagged with <b> </b> tag
				will be synchronized</p>`),Od=J("<p>All tasks in <b> </b> will be synchronized. All tasks tagged with <b> </b> tag will be synchronized</p>"),Ad=J(`<div class="setting-item-description">To limit the tasks TickTickSync will synchronize from TickTick to
		Obsidian select a tag and/or project(list) below. If a tag is entered, only tasks with that tag will be
		synchronized. If a project(list) is selected, only tasks in that project will be synchronized. If
		both are chosen the behavior will be determined by your settings. See result below.</div> <div class="setting-item"><div class="setting-item-info"><div class="setting-item-name">Project</div> <div class="setting-item-description">Only tasks in this project will be synchronized.</div></div> <div class="setting-item-control"><select class="dropdown" id="sync-project"><option>(none)</option><!></select></div></div> <div class="setting-item"><div class="setting-item-info"><div class="setting-item-name">Tag Behavior</div> <div class="setting-item-description">Determine how Tags will be handled.</div></div> <div class="setting-item-control"><select class="dropdown" id="tag-and-or"></select></div></div> <div class="setting-item"><div class="setting-item-info"><div class="setting-item-name">Tag</div> <div class="setting-item-description">Tag value, no "#".</div></div> <div class="setting-item-control"><input id="sync-tag" type="text" placeholder="Only tasks with this tag will be synced"/></div></div> <div class="sync-explanation"><!></div>`,1);function Cd(s,e){Je(e,!1);const t=te();let i=be(e,"open",8,!1),n=be(e,"plugin",8),r=[],a=te({}),o=te(""),l=te(1),c=te(""),d;const g=Is();function f(){g("toggle")}async function u(w){var I;ge({SyncProject:w}),M(o,w);const v=_().fileMetadata;if(!Object.values(v).find(O=>O.defaultProjectId===w)){const O=`Did not find a default Project File for Project ${(I=P(a))==null?void 0:I[w]}. Please create a file and set its default to this project, or select a file to be the default for this project.`;new N.Notice(O,5e3)}await n().saveSettings()}async function p(w){ge({tagAndOr:parseInt(w)}),M(l,parseInt(w)),await n().saveSettings()}let h=te({});function m(w){const v=w[_().SyncProject],b=_().SyncTag,I=v&&b?_().tagAndOr==1:void 0;M(h,{project:v,tag:b,andOr:I})}function k(){return r.reduce((w,v)=>(w[v.id]=v.name,w),{})}function T(w){M(c,w),ge({SyncTag:w}),d&&clearTimeout(d),d=setTimeout(async()=>{await n().saveSettings()},800)}Hi(async()=>{var w,v;r=await((v=(w=n().service).getProjects)==null?void 0:v.call(w))??[],M(a,k()),M(o,_().SyncProject??""),_().defaultProjectId,M(l,_().tagAndOr??"1"),M(c,_().SyncTag??""),m(P(a))}),sn(()=>P(l),()=>{M(t,P(l).toString())}),sn(()=>P(a),()=>{m(P(a))}),yr(),ut(),yn(s,{title:"Limit synchronization",shortDesc:"Synchronization settings added for effect",get open(){return i()},$$events:{headerClick:f},children:(w,v)=>{var b=Ad(),I=x(Jt(b),2),O=x(D(I),2),E=D(O);ne(()=>{P(o),fs(()=>{P(a)})});var L=D(E);L.value=L.__value="";var A=x(L);kt(A,1,()=>Object.entries(P(a)),vt,(Y,fe)=>{var X=Yt(()=>Wt(P(fe),2));let ie=()=>P(X)[0],se=()=>P(X)[1];var Z=Td(),$={},ve=D(Z);ne(()=>{$!==($=ie())&&(Z.value=(Z.__value=ie())??""),pe(ve,se())}),z(Y,Z)});var S=x(I,2),C=x(D(S),2),F=D(C);ne(()=>{P(t),fs(()=>{P(a)})}),kt(F,5,()=>Object.entries(Wu),vt,(Y,fe)=>{var X=Yt(()=>Wt(P(fe),2));let ie=()=>P(X)[0],se=()=>P(X)[1];var Z=Id(),$={},ve=D(Z);ne(()=>{$!==($=ie())&&(Z.value=(Z.__value=ie())??""),pe(ve,se())}),z(Y,Z)});var V=x(S,2),Q=x(D(V),2),K=D(Q),G=x(V,2),re=D(G);{var he=Y=>{var fe=_d();z(Y,fe)},ue=(Y,fe)=>{{var X=se=>{var Z=Sd(),$=x(D(Z)),ve=D($);ne(()=>pe(ve,P(h).project)),z(se,Z)},ie=(se,Z)=>{{var $=Ee=>{var R=Ed(),Ue=x(D(R)),Ct=D(Ue);ne(()=>pe(Ct,`#${P(h).tag??""}`)),z(Ee,R)},ve=(Ee,R)=>{{var Ue=Pe=>{var Qe=Pd(),Oe=x(D(Qe)),ft=D(Oe),Ze=x(Oe,2),qe=D(Ze);ne(()=>{pe(ft,P(h).project),pe(qe,`#${P(h).tag??""}`)}),z(Pe,Qe)},Ct=Pe=>{var Qe=Od(),Oe=x(D(Qe)),ft=D(Oe),Ze=x(Oe,2),qe=D(Ze);ne(()=>{pe(ft,P(h).project),pe(qe,`#${P(h).tag??""}`)}),z(Pe,Qe)};Se(Ee,Pe=>{P(h).andOr?Pe(Ue):Pe(Ct,!1)},R)}};Se(se,Ee=>{!P(h).project&&P(h).tag?Ee($):Ee(ve,!1)},Z)}};Se(Y,se=>{P(h).project&&!P(h).tag?se(X):se(ie,!1)},fe)}};Se(re,Y=>{!P(h).project&&!P(h).tag?Y(he):Y(ue,!1)})}hs(E,()=>P(o),Y=>M(o,Y)),Te("change",E,Y=>{u(Y.target.value),m(P(a))}),hs(F,()=>P(t),Y=>M(t,Y)),Te("change",F,Y=>{p(Y.target.value),m(P(a))}),rn(K,()=>P(c),Y=>M(c,Y)),Te("input",K,Y=>{T(Y.target.value),m(P(a))}),z(w,b)},$$slots:{default:!0}}),Xe()}var Nd=J(`<div class="setting-item"><div class="setting-item-info"><div class="setting-item-name">Automatic sync interval time</div> <div class="setting-item-description">Please specify the desired interval time, with seconds as the default
				unit. 0 for manual sync. The default setting is 300 seconds, which corresponds to syncing once every 5
				minutes. You can customize it, but it cannot be lower than 20 seconds.</div></div> <div class="setting-item-control"><input id="sync-tag" type="text" Placeholder="Sync interval"/></div></div>`);function Ld(s,e){Je(e,!1);const t=te();let i=be(e,"open",8,!1),n=be(e,"plugin",8),r=te(_().automaticSynchronizationInterval),a=te();const o=Is();function l(){o("toggle")}async function c(d){const g=Number(d);if(isNaN(g)||!Number.isInteger(g)){new N.Notice("Wrong type, please enter a integer.");return}if(g!==0&&g<20){new N.Notice("The synchronization interval time cannot be less than 20 seconds.");return}ge({automaticSynchronizationInterval:g}),await n().saveSettings(),n().reloadInterval(),new N.Notice("Settings have been updated.")}sn(()=>P(r),()=>{M(t,P(r).toString())}),yr(),ut(),yn(s,{title:"Automatic sync interval time",shortDesc:"Sync interval setting",get open(){return i()},$$events:{headerClick:l},children:(d,g)=>{var f=Nd(),u=x(D(f),2),p=D(u);rn(p,()=>P(r),h=>M(r,h)),Te("input",p,h=>{P(a)&&clearTimeout(P(a)),M(a,setTimeout(async()=>{const m=h.target;await c(m.value)},700))}),z(d,f)},$$slots:{default:!0}}),Xe()}let Dd=class extends N.Modal{constructor(e,t){super(e),this.title="Full Vault Task Sync Confirmation",this.message=`Are you sure you want to Sync ALL tasks? 
Indented Tasks created in Obsidian will be created as subtasks in TickTick
 Task Items created in TickTick will still be Task Items. This is the only way to create Task Items when Full Vault Sync is enabled.
Tasks that are currently "Items" of tasks MAY be converted to "Sub Tasks" of the containing Tasks.
The "Items" will not be deleted.
Please proceed with Caution.`,this.cancelLabel="Cancel",this.confirmLabel="Confirm Full Vault Task Sync",this.onSubmit=t}onOpen(){const{titleEl:e,contentEl:t}=this;e.setText(this.title),this.message.split(`
`).forEach(n=>{t.createEl("p",{text:n})}),new N.Setting(t).addButton(n=>{n.setClass("ts_button"),n.setButtonText(this.cancelLabel),n.onClick(()=>{this.result=!1,this.onSubmit(this.result),this.close()})}).addButton(n=>{n.setClass("ts_button"),n.setWarning(),n.setButtonText(this.confirmLabel),n.onClick(()=>{this.result=!0,this.onSubmit(this.result),this.close()})})}onClose(){this.titleEl.empty(),this.contentEl.empty(),super.onClose(),this.resolvePromise(this.result)}showModal(){return this.open(),new Promise(e=>this.resolvePromise=e)}};var Fd=J(`<div class="Full vault sync"><div class="setting-item"><div class="setting-item-info"><div class="setting-item-name">Full vault sync</div> <div class="setting-item-description">By default, only tasks marked with #TickTick are synchronized. If this option is turned on, all
					tasks in
					the vault will be synchronized. <p><b>NOTE: This includes all tasks that are currently Items of a task.</b></p></div></div> <div class="setting-item-control"><label class="toggle-switch"><input type="checkbox"/> <span class="slider"></span></label></div></div></div>`);function xd(s,e){Je(e,!1);let t=be(e,"open",8,!1),i=be(e,"plugin",8),n=te(!1);const r=Is();function a(){r("toggle")}Hi(async()=>{M(n,_().enableFullVaultSync)});async function o(){return await new Dd(app,()=>{}).showModal()}async function l(c){let d;_().enableFullVaultSync?(M(n,!1),d="Full vault sync is disabled."):await o()?(M(n,!0),d="Full vault sync is enabled."):(M(n,!1),d="Full vault sync not enabled."),ge({enableFullVaultSync:P(n)}),new Notice(d),await i().saveSettings()}ut(),yn(s,{title:"Full vault sync",shortDesc:"Full vault settings",get open(){return t()},$$events:{headerClick:a},children:(c,d)=>{var g=Fd(),f=D(g),u=x(D(f),2),p=D(u),h=D(p);_r(h,()=>P(n),m=>M(n,m)),Te("change",h,async m=>{m.target.checked,await l()}),z(c,g)},$$slots:{default:!0}}),Xe()}function Md(s,e){let t=be(e,"plugin",8);const i=[{key:"defaults",component:bd},{key:"limit",component:Cd},{key:"auto",component:Ld},{key:"full",component:xd}];let n=te("defaults");function r(l){M(n,P(n)===l?"":l)}var a=sr(),o=Jt(a);kt(o,1,()=>i,vt,(l,c)=>{var d=sr(),g=Jt(d);const f=fi(()=>P(n)===P(c).key);Cu(g,()=>P(c).component,(u,p)=>{p(u,{get plugin(){return t()},get open(){return P(f)},$$events:{toggle:()=>r(P(c).key)}})}),z(l,d)}),z(s,a)}var $d=J('<div class="setting-item-info"><hr/> <div class="setting-item-name">Notice:</div> <p>Note syncing is disabled. Links can only be added to the Task text or not added at all.</p> <hr/></div>'),jd=J("<option> </option>"),Rd=J("<option> </option>"),Bd=J('<div><!> <div class="task-settings "><div class="setting-item"><div class="setting-item-info"><div class="setting-item-name">Task link handling in Obsidian</div> <div class="setting-item-description">Add TickTick task link to Tasks in Obsidian</div></div> <div class="setting-item-control"><select class="dropdown" id="sync-project"></select></div></div></div> <div class="task-settings "><div class="setting-item"><div class="setting-item-info"><div class="setting-item-name">Task link handling in TickTick</div> <div class="setting-item-description">Add Obsidian file link to Tasks in TickTick</div></div> <div class="setting-item-control"><select class="dropdown" id="sync-project"></select></div></div> <hr/> <div class="setting-item-info"><div class="setting-item-name">Notice:</div> <p>Links will be added/removed on the next update of the task from TickTick/Obsidian.</p> <hr/></div></div></div>');function Ud(s,e){Je(e,!1);let t=be(e,"plugin",12),i=te(!1),n=te(),r=te(),a=te(),o=Ju;Hi(async()=>{M(n,_().fileLinksInTickTick),M(r,_().taskLinksInObsidian),M(a,_().syncNotes),P(a)||delete o.noteLink});async function l(b){_().taskLinksInObsidian=b,await t().saveSettings()}async function c(b){_().fileLinksInTickTick=b,await t().saveSettings()}ut();var d=Bd(),g=D(d);{var f=b=>{var I=$d();z(b,I)};Se(g,b=>{P(a)||b(f)})}var u=x(g,2),p=D(u),h=x(D(p),2),m=D(h);ne(()=>{P(r),fs(()=>{})}),kt(m,5,()=>Object.entries(o),vt,(b,I)=>{var O=Yt(()=>Wt(P(I),2));let E=()=>P(O)[0],L=()=>P(O)[1];var A=jd(),S={},C=D(A);ne(()=>{S!==(S=E())&&(A.value=(A.__value=E())??""),pe(C,L())}),z(b,A)});var k=x(u,2),T=D(k),w=x(D(T),2),v=D(w);ne(()=>{P(n),fs(()=>{})}),kt(v,5,()=>Object.entries(o),vt,(b,I)=>{var O=Yt(()=>Wt(P(I),2));let E=()=>P(O)[0],L=()=>P(O)[1];var A=Rd(),S={},C=D(A);ne(()=>{S!==(S=E())&&(A.value=(A.__value=E())??""),pe(C,L())}),z(b,A)}),ne(()=>Tr(d,1,P(i)?"wait-cursor":"default-cursor")),hs(m,()=>P(r),b=>M(r,b)),Te("change",m,b=>l(b.target.value)),hs(v,()=>P(n),b=>M(n,b)),Te("change",v,b=>c(b.target.value)),z(s,d),Xe()}var qd=J("<button> </button>"),Hd=J('<div class="ticktick-settings"> </div> <div class="ticktick-settings"><nav class="settings-tabs"></nav> <div class="tab-content"><!></div></div>',1);function Kd(s,e){Je(e,!1);let t=be(e,"app",8),i=be(e,"plugin",8);const n=t().vault.getName(),r=_().version;let a=te("access");const o={access:"Access Control",sync:"Sync Control",manual:"Manual Operations",debug:"Debug Options",tasks:"Task Links",notes:"Notes"};ut();var l=Hd(),c=Jt(l),d=D(c),g=x(c,2),f=D(g);kt(f,5,()=>Object.entries(o),vt,(k,T)=>{var w=Yt(()=>Wt(P(T),2));let v=()=>P(w)[0],b=()=>P(w)[1];var I=qd(),O=D(I);ne(()=>{Tr(I,1,`tab-button ${P(a)===v()?"active":""}`),pe(O,b())}),Te("click",I,()=>M(a,v())),z(k,I)});var u=x(f,2),p=D(u);{var h=k=>{Ku(k,{get plugin(){return i()}})},m=(k,T)=>{{var w=b=>{Md(b,{get plugin(){return i()},get app(){return t()}})},v=(b,I)=>{{var O=L=>{Gu(L,{get plugin(){return i()}})},E=(L,A)=>{{var S=F=>{ef(F,{get plugin(){return i()}})},C=(F,V)=>{{var Q=G=>{rf(G,{get plugin(){return i()}})},K=(G,re)=>{{var he=ue=>{Ud(ue,{get plugin(){return i()}})};Se(G,ue=>{P(a)==="tasks"&&ue(he)},re)}};Se(F,G=>{P(a)==="notes"?G(Q):G(K,!1)},V)}};Se(L,F=>{P(a)==="debug"?F(S):F(C,!1)},A)}};Se(b,L=>{P(a)==="manual"?L(O):L(E,!1)},I)}};Se(k,b=>{P(a)==="sync"?b(w):b(v,!1)},T)}};Se(p,k=>{P(a)==="access"?k(h):k(m,!1)})}ne(()=>pe(d,`${n??""} -- ${r??""}`)),z(s,l),Xe()}class Vd extends N.PluginSettingTab{constructor(e,t){super(e,t),this.plugin=t,Bu(this.plugin)}async display(){const{containerEl:e}=this;e.empty(),this.settingsComponent=So(Kd,{target:e,props:{app:this.app,plugin:this.plugin}})}async hide(){super.hide(),Eo(this.settingsComponent)}getProjectTagText(e){const t=e[_().SyncProject],i=_().SyncTag,n=_().tagAndOr;return!t&&!i?"No limitation.":t&&!i?`Only Tasks in <b>${t}</b> will be synchronized`:!t&&i?`Only Tasks tagged with <b>#${i}</b> tag will be synchronized`:n==1?`Only tasks in <b>${t}</b> AND tagged with <b>#${i}</b> tag will be synchronized`:`All tasks in <b>${t}</b> will be synchronized. All tasks tagged with <b>#${i}</b> tag will be synchronized`}async confirmFullSync(){return await new ConfirmFullSyncModal(this.app,()=>{}).showModal()}async validateNewFolder(e){e&&e.length>1&&/^[/\\]/.test(e)&&(e=e.substring(1));let t=this.app.vault.getAbstractFileByPath(e);if(!t)try{t=await this.app.vault.createFolder(e),new N.Notice(`New folder ${t.path} created.`)}catch(i){return new N.Notice(`Folder ${e} creation failed: ${i}. Please correct and try again.`,5e3),null}return t instanceof N.TFolder?t.path:null}}var zd=J('<div class="break-words number svelte-1bzi045"><h1>Error in Query</h1> <p></p></div>');function Gd(s){var e=zd();x(D(e),2),z(s,e)}const Wd=Po(),$o={service:Wd};var Yd=J(" <br/>",1),Jd=J("<p> </p>"),Xd=J('<div class="warning"><h2>Warnings</h2> <!></div>'),Qd=J('<div class="break-words"><h1>Tasks</h1> <p><!></p> <!></div>');function Zd(s,e){Je(e,!1);let t=be(e,"query",8),i=be(e,"warnings",8),n;$o.service.subscribe(f=>n=f);let r=a(t());async function a(f){return n.getTasks(f.filter)}ut();var o=Qd(),l=x(D(o),2),c=D(l);_u(c,()=>r,f=>{var u=da("Loading tasks...");z(f,u)},(f,u)=>{var p=sr(),h=Jt(p);kt(h,1,()=>P(u),vt,(m,k)=>{var T=Yd(),w=Jt(T);ne(()=>pe(w,P(k).title)),z(m,T)}),z(f,p)},(f,u)=>{var p=da();ne(()=>pe(p,`System error: ${P(u).message??""}.`)),z(f,p)});var d=x(l,2);{var g=f=>{var u=Xd(),p=x(D(u),2);kt(p,1,i,vt,(h,m)=>{var k=Jd(),T=D(k);ne(()=>pe(T,P(m))),z(h,k)}),z(f,u)};Se(d,f=>{i().length>0&&f(g)})}z(s,o),Xe()}var et=(s=>(s[s.Priority=0]="Priority",s[s.PriorityAscending=1]="PriorityAscending",s[s.Date=2]="Date",s[s.DateDescending=3]="DateDescending",s[s.Order=4]="Order",s[s.DateAdded=5]="DateAdded",s[s.DateAddedDescending=6]="DateAddedDescending",s))(et||{}),bi=(s=>(s[s.Due=0]="Due",s[s.Project=1]="Project",s[s.Labels=2]="Labels",s[s.Description=3]="Description",s))(bi||{}),Nt=(s=>(s[s.None=0]="None",s[s.Project=1]="Project",s[s.Section=2]="Section",s[s.Priority=3]="Priority",s[s.Date=4]="Date",s[s.Label=5]="Label",s))(Nt||{});const Lr=Symbol.for("yaml.alias"),or=Symbol.for("yaml.document"),Gt=Symbol.for("yaml.map"),jo=Symbol.for("yaml.pair"),At=Symbol.for("yaml.scalar"),Ki=Symbol.for("yaml.seq"),ct=Symbol.for("yaml.node.type"),ti=s=>!!s&&typeof s=="object"&&s[ct]===Lr,gi=s=>!!s&&typeof s=="object"&&s[ct]===or,Vi=s=>!!s&&typeof s=="object"&&s[ct]===Gt,me=s=>!!s&&typeof s=="object"&&s[ct]===jo,ce=s=>!!s&&typeof s=="object"&&s[ct]===At,zi=s=>!!s&&typeof s=="object"&&s[ct]===Ki;function ye(s){if(s&&typeof s=="object")switch(s[ct]){case Gt:case Ki:return!0}return!1}function we(s){if(s&&typeof s=="object")switch(s[ct]){case Lr:case Gt:case At:case Ki:return!0}return!1}const Ro=s=>(ce(s)||ye(s))&&!!s.anchor,$e=Symbol("break visit"),Bo=Symbol("skip children"),_t=Symbol("remove node");function mi(s,e){const t=Uo(e);gi(s)?Ti(null,s.contents,t,Object.freeze([s]))===_t&&(s.contents=null):Ti(null,s,t,Object.freeze([]))}mi.BREAK=$e;mi.SKIP=Bo;mi.REMOVE=_t;function Ti(s,e,t,i){const n=qo(s,e,t,i);if(we(n)||me(n))return Ho(s,i,n),Ti(s,n,t,i);if(typeof n!="symbol"){if(ye(e)){i=Object.freeze(i.concat(e));for(let r=0;r<e.items.length;++r){const a=Ti(r,e.items[r],t,i);if(typeof a=="number")r=a-1;else{if(a===$e)return $e;a===_t&&(e.items.splice(r,1),r-=1)}}}else if(me(e)){i=Object.freeze(i.concat(e));const r=Ti("key",e.key,t,i);if(r===$e)return $e;r===_t&&(e.key=null);const a=Ti("value",e.value,t,i);if(a===$e)return $e;a===_t&&(e.value=null)}}return n}async function bn(s,e){const t=Uo(e);gi(s)?await Ii(null,s.contents,t,Object.freeze([s]))===_t&&(s.contents=null):await Ii(null,s,t,Object.freeze([]))}bn.BREAK=$e;bn.SKIP=Bo;bn.REMOVE=_t;async function Ii(s,e,t,i){const n=await qo(s,e,t,i);if(we(n)||me(n))return Ho(s,i,n),Ii(s,n,t,i);if(typeof n!="symbol"){if(ye(e)){i=Object.freeze(i.concat(e));for(let r=0;r<e.items.length;++r){const a=await Ii(r,e.items[r],t,i);if(typeof a=="number")r=a-1;else{if(a===$e)return $e;a===_t&&(e.items.splice(r,1),r-=1)}}}else if(me(e)){i=Object.freeze(i.concat(e));const r=await Ii("key",e.key,t,i);if(r===$e)return $e;r===_t&&(e.key=null);const a=await Ii("value",e.value,t,i);if(a===$e)return $e;a===_t&&(e.value=null)}}return n}function Uo(s){return typeof s=="object"&&(s.Collection||s.Node||s.Value)?Object.assign({Alias:s.Node,Map:s.Node,Scalar:s.Node,Seq:s.Node},s.Value&&{Map:s.Value,Scalar:s.Value,Seq:s.Value},s.Collection&&{Map:s.Collection,Seq:s.Collection},s):s}function qo(s,e,t,i){var n,r,a,o,l;if(typeof t=="function")return t(s,e,i);if(Vi(e))return(n=t.Map)==null?void 0:n.call(t,s,e,i);if(zi(e))return(r=t.Seq)==null?void 0:r.call(t,s,e,i);if(me(e))return(a=t.Pair)==null?void 0:a.call(t,s,e,i);if(ce(e))return(o=t.Scalar)==null?void 0:o.call(t,s,e,i);if(ti(e))return(l=t.Alias)==null?void 0:l.call(t,s,e,i)}function Ho(s,e,t){const i=e[e.length-1];if(ye(i))i.items[s]=t;else if(me(i))s==="key"?i.key=t:i.value=t;else if(gi(i))i.contents=t;else{const n=ti(i)?"alias":"scalar";throw new Error(`Cannot replace node with ${n} parent`)}}const eh={"!":"%21",",":"%2C","[":"%5B","]":"%5D","{":"%7B","}":"%7D"},th=s=>s.replace(/[!,[\]{}]/g,e=>eh[e]);class Fe{constructor(e,t){this.docStart=null,this.docEnd=!1,this.yaml=Object.assign({},Fe.defaultYaml,e),this.tags=Object.assign({},Fe.defaultTags,t)}clone(){const e=new Fe(this.yaml,this.tags);return e.docStart=this.docStart,e}atDocument(){const e=new Fe(this.yaml,this.tags);switch(this.yaml.version){case"1.1":this.atNextDocument=!0;break;case"1.2":this.atNextDocument=!1,this.yaml={explicit:Fe.defaultYaml.explicit,version:"1.2"},this.tags=Object.assign({},Fe.defaultTags);break}return e}add(e,t){this.atNextDocument&&(this.yaml={explicit:Fe.defaultYaml.explicit,version:"1.1"},this.tags=Object.assign({},Fe.defaultTags),this.atNextDocument=!1);const i=e.trim().split(/[ \t]+/),n=i.shift();switch(n){case"%TAG":{if(i.length!==2&&(t(0,"%TAG directive should contain exactly two parts"),i.length<2))return!1;const[r,a]=i;return this.tags[r]=a,!0}case"%YAML":{if(this.yaml.explicit=!0,i.length!==1)return t(0,"%YAML directive should contain exactly one part"),!1;const[r]=i;if(r==="1.1"||r==="1.2")return this.yaml.version=r,!0;{const a=/^\d+\.\d+$/.test(r);return t(6,`Unsupported YAML version ${r}`,a),!1}}default:return t(0,`Unknown directive ${n}`,!0),!1}}tagName(e,t){if(e==="!")return"!";if(e[0]!=="!")return t(`Not a valid tag: ${e}`),null;if(e[1]==="<"){const a=e.slice(2,-1);return a==="!"||a==="!!"?(t(`Verbatim tags aren't resolved, so ${e} is invalid.`),null):(e[e.length-1]!==">"&&t("Verbatim tags must end with a >"),a)}const[,i,n]=e.match(/^(.*!)([^!]*)$/s);n||t(`The ${e} tag has no suffix`);const r=this.tags[i];if(r)try{return r+decodeURIComponent(n)}catch(a){return t(String(a)),null}return i==="!"?e:(t(`Could not resolve tag: ${e}`),null)}tagString(e){for(const[t,i]of Object.entries(this.tags))if(e.startsWith(i))return t+th(e.substring(i.length));return e[0]==="!"?e:`!<${e}>`}toString(e){const t=this.yaml.explicit?[`%YAML ${this.yaml.version||"1.2"}`]:[],i=Object.entries(this.tags);let n;if(e&&i.length>0&&we(e.contents)){const r={};mi(e.contents,(a,o)=>{we(o)&&o.tag&&(r[o.tag]=!0)}),n=Object.keys(r)}else n=[];for(const[r,a]of i)r==="!!"&&a==="tag:yaml.org,2002:"||(!e||n.some(o=>o.startsWith(a)))&&t.push(`%TAG ${r} ${a}`);return t.join(`
`)}}Fe.defaultYaml={explicit:!1,version:"1.2"};Fe.defaultTags={"!!":"tag:yaml.org,2002:"};function Ko(s){if(/[\x00-\x19\s,[\]{}]/.test(s)){const t=`Anchor must not contain whitespace or control characters: ${JSON.stringify(s)}`;throw new Error(t)}return!0}function Vo(s){const e=new Set;return mi(s,{Value(t,i){i.anchor&&e.add(i.anchor)}}),e}function zo(s,e){for(let t=1;;++t){const i=`${s}${t}`;if(!e.has(i))return i}}function ih(s,e){const t=[],i=new Map;let n=null;return{onAnchor:r=>{t.push(r),n??(n=Vo(s));const a=zo(e,n);return n.add(a),a},setAnchors:()=>{for(const r of t){const a=i.get(r);if(typeof a=="object"&&a.anchor&&(ce(a.node)||ye(a.node)))a.node.anchor=a.anchor;else{const o=new Error("Failed to resolve repeated object (this should not happen)");throw o.source=r,o}}},sourceObjects:i}}function _i(s,e,t,i){if(i&&typeof i=="object")if(Array.isArray(i))for(let n=0,r=i.length;n<r;++n){const a=i[n],o=_i(s,i,String(n),a);o===void 0?delete i[n]:o!==a&&(i[n]=o)}else if(i instanceof Map)for(const n of Array.from(i.keys())){const r=i.get(n),a=_i(s,i,n,r);a===void 0?i.delete(n):a!==r&&i.set(n,a)}else if(i instanceof Set)for(const n of Array.from(i)){const r=_i(s,i,n,n);r===void 0?i.delete(n):r!==n&&(i.delete(n),i.add(r))}else for(const[n,r]of Object.entries(i)){const a=_i(s,i,n,r);a===void 0?delete i[n]:a!==r&&(i[n]=a)}return s.call(e,t,i)}function st(s,e,t){if(Array.isArray(s))return s.map((i,n)=>st(i,String(n),t));if(s&&typeof s.toJSON=="function"){if(!t||!Ro(s))return s.toJSON(e,t);const i={aliasCount:0,count:1,res:void 0};t.anchors.set(s,i),t.onCreate=r=>{i.res=r,delete t.onCreate};const n=s.toJSON(e,t);return t.onCreate&&t.onCreate(n),n}return typeof s=="bigint"&&!(t!=null&&t.keep)?Number(s):s}class Dr{constructor(e){Object.defineProperty(this,ct,{value:e})}clone(){const e=Object.create(Object.getPrototypeOf(this),Object.getOwnPropertyDescriptors(this));return this.range&&(e.range=this.range.slice()),e}toJS(e,{mapAsMap:t,maxAliasCount:i,onAnchor:n,reviver:r}={}){if(!gi(e))throw new TypeError("A document argument is required");const a={anchors:new Map,doc:e,keep:!0,mapAsMap:t===!0,mapKeyWarned:!1,maxAliasCount:typeof i=="number"?i:100},o=st(this,"",a);if(typeof n=="function")for(const{count:l,res:c}of a.anchors.values())n(c,l);return typeof r=="function"?_i(r,{"":o},"",o):o}}class Tn extends Dr{constructor(e){super(Lr),this.source=e,Object.defineProperty(this,"tag",{set(){throw new Error("Alias nodes cannot have tags")}})}resolve(e,t){let i;t!=null&&t.aliasResolveCache?i=t.aliasResolveCache:(i=[],mi(e,{Node:(r,a)=>{(ti(a)||Ro(a))&&i.push(a)}}),t&&(t.aliasResolveCache=i));let n;for(const r of i){if(r===this)break;r.anchor===this.source&&(n=r)}return n}toJSON(e,t){if(!t)return{source:this.source};const{anchors:i,doc:n,maxAliasCount:r}=t,a=this.resolve(n,t);if(!a){const l=`Unresolved alias (the anchor must be set before the alias): ${this.source}`;throw new ReferenceError(l)}let o=i.get(a);if(o||(st(a,null,t),o=i.get(a)),!o||o.res===void 0){const l="This should not happen: Alias anchor was not resolved?";throw new ReferenceError(l)}if(r>=0&&(o.count+=1,o.aliasCount===0&&(o.aliasCount=Hs(n,a,i)),o.count*o.aliasCount>r)){const l="Excessive alias count indicates a resource exhaustion attack";throw new ReferenceError(l)}return o.res}toString(e,t,i){const n=`*${this.source}`;if(e){if(Ko(this.source),e.options.verifyAliasOrder&&!e.anchors.has(this.source)){const r=`Unresolved alias (the anchor must be set before the alias): ${this.source}`;throw new Error(r)}if(e.implicitKey)return`${n} `}return n}}function Hs(s,e,t){if(ti(e)){const i=e.resolve(s),n=t&&i&&t.get(i);return n?n.count*n.aliasCount:0}else if(ye(e)){let i=0;for(const n of e.items){const r=Hs(s,n,t);r>i&&(i=r)}return i}else if(me(e)){const i=Hs(s,e.key,t),n=Hs(s,e.value,t);return Math.max(i,n)}return 1}const Go=s=>!s||typeof s!="function"&&typeof s!="object";class q extends Dr{constructor(e){super(At),this.value=e}toJSON(e,t){return t!=null&&t.keep?this.value:st(this.value,e,t)}toString(){return String(this.value)}}q.BLOCK_FOLDED="BLOCK_FOLDED";q.BLOCK_LITERAL="BLOCK_LITERAL";q.PLAIN="PLAIN";q.QUOTE_DOUBLE="QUOTE_DOUBLE";q.QUOTE_SINGLE="QUOTE_SINGLE";const sh="tag:yaml.org,2002:";function nh(s,e,t){if(e){const i=t.filter(r=>r.tag===e),n=i.find(r=>!r.format)??i[0];if(!n)throw new Error(`Tag ${e} not found`);return n}return t.find(i=>{var n;return((n=i.identify)==null?void 0:n.call(i,s))&&!i.format})}function ms(s,e,t){var g,f,u;if(gi(s)&&(s=s.contents),we(s))return s;if(me(s)){const p=(f=(g=t.schema[Gt]).createNode)==null?void 0:f.call(g,t.schema,null,t);return p.items.push(s),p}(s instanceof String||s instanceof Number||s instanceof Boolean||typeof BigInt<"u"&&s instanceof BigInt)&&(s=s.valueOf());const{aliasDuplicateObjects:i,onAnchor:n,onTagObj:r,schema:a,sourceObjects:o}=t;let l;if(i&&s&&typeof s=="object"){if(l=o.get(s),l)return l.anchor??(l.anchor=n(s)),new Tn(l.anchor);l={anchor:null,node:null},o.set(s,l)}e!=null&&e.startsWith("!!")&&(e=sh+e.slice(2));let c=nh(s,e,a.tags);if(!c){if(s&&typeof s.toJSON=="function"&&(s=s.toJSON()),!s||typeof s!="object"){const p=new q(s);return l&&(l.node=p),p}c=s instanceof Map?a[Gt]:Symbol.iterator in Object(s)?a[Ki]:a[Gt]}r&&(r(c),delete t.onTagObj);const d=c!=null&&c.createNode?c.createNode(t.schema,s,t):typeof((u=c==null?void 0:c.nodeClass)==null?void 0:u.from)=="function"?c.nodeClass.from(t.schema,s,t):new q(s);return e?d.tag=e:c.default||(d.tag=c.tag),l&&(l.node=d),d}function on(s,e,t){let i=t;for(let n=e.length-1;n>=0;--n){const r=e[n];if(typeof r=="number"&&Number.isInteger(r)&&r>=0){const a=[];a[r]=i,i=a}else i=new Map([[r,i]])}return ms(i,void 0,{aliasDuplicateObjects:!1,keepUndefined:!1,onAnchor:()=>{throw new Error("This should not happen, please report a bug.")},schema:s,sourceObjects:new Map})}const ss=s=>s==null||typeof s=="object"&&!!s[Symbol.iterator]().next().done;class Wo extends Dr{constructor(e,t){super(e),Object.defineProperty(this,"schema",{value:t,configurable:!0,enumerable:!1,writable:!0})}clone(e){const t=Object.create(Object.getPrototypeOf(this),Object.getOwnPropertyDescriptors(this));return e&&(t.schema=e),t.items=t.items.map(i=>we(i)||me(i)?i.clone(e):i),this.range&&(t.range=this.range.slice()),t}addIn(e,t){if(ss(e))this.add(t);else{const[i,...n]=e,r=this.get(i,!0);if(ye(r))r.addIn(n,t);else if(r===void 0&&this.schema)this.set(i,on(this.schema,n,t));else throw new Error(`Expected YAML collection at ${i}. Remaining path: ${n}`)}}deleteIn(e){const[t,...i]=e;if(i.length===0)return this.delete(t);const n=this.get(t,!0);if(ye(n))return n.deleteIn(i);throw new Error(`Expected YAML collection at ${t}. Remaining path: ${i}`)}getIn(e,t){const[i,...n]=e,r=this.get(i,!0);return n.length===0?!t&&ce(r)?r.value:r:ye(r)?r.getIn(n,t):void 0}hasAllNullValues(e){return this.items.every(t=>{if(!me(t))return!1;const i=t.value;return i==null||e&&ce(i)&&i.value==null&&!i.commentBefore&&!i.comment&&!i.tag})}hasIn(e){const[t,...i]=e;if(i.length===0)return this.has(t);const n=this.get(t,!0);return ye(n)?n.hasIn(i):!1}setIn(e,t){const[i,...n]=e;if(n.length===0)this.set(i,t);else{const r=this.get(i,!0);if(ye(r))r.setIn(n,t);else if(r===void 0&&this.schema)this.set(i,on(this.schema,n,t));else throw new Error(`Expected YAML collection at ${i}. Remaining path: ${n}`)}}}const rh=s=>s.replace(/^(?!$)(?: $)?/gm,"#");function Lt(s,e){return/^\n+$/.test(s)?s.substring(1):e?s.replace(/^(?! *$)/gm,e):s}const ri=(s,e,t)=>s.endsWith(`
`)?Lt(t,e):t.includes(`
`)?`
`+Lt(t,e):(s.endsWith(" ")?"":" ")+t,Yo="flow",lr="block",Ks="quoted";function In(s,e,t="flow",{indentAtStart:i,lineWidth:n=80,minContentWidth:r=20,onFold:a,onOverflow:o}={}){if(!n||n<0)return s;n<r&&(r=0);const l=Math.max(1+r,1+n-e.length);if(s.length<=l)return s;const c=[],d={};let g=n-e.length;typeof i=="number"&&(i>n-Math.max(2,r)?c.push(0):g=n-i);let f,u,p=!1,h=-1,m=-1,k=-1;t===lr&&(h=Ea(s,h,e.length),h!==-1&&(g=h+l));for(let w;w=s[h+=1];){if(t===Ks&&w==="\\"){switch(m=h,s[h+1]){case"x":h+=3;break;case"u":h+=5;break;case"U":h+=9;break;default:h+=1}k=h}if(w===`
`)t===lr&&(h=Ea(s,h,e.length)),g=h+e.length+l,f=void 0;else{if(w===" "&&u&&u!==" "&&u!==`
`&&u!=="	"){const v=s[h+1];v&&v!==" "&&v!==`
`&&v!=="	"&&(f=h)}if(h>=g)if(f)c.push(f),g=f+l,f=void 0;else if(t===Ks){for(;u===" "||u==="	";)u=w,w=s[h+=1],p=!0;const v=h>k+1?h-2:m-1;if(d[v])return s;c.push(v),d[v]=!0,g=v+l,f=void 0}else p=!0}u=w}if(p&&o&&o(),c.length===0)return s;a&&a();let T=s.slice(0,c[0]);for(let w=0;w<c.length;++w){const v=c[w],b=c[w+1]||s.length;v===0?T=`
${e}${s.slice(0,b)}`:(t===Ks&&d[v]&&(T+=`${s[v]}\\`),T+=`
${e}${s.slice(v+1,b)}`)}return T}function Ea(s,e,t){let i=e,n=e+1,r=s[n];for(;r===" "||r==="	";)if(e<n+t)r=s[++e];else{do r=s[++e];while(r&&r!==`
`);i=e,n=e+1,r=s[n]}return i}const _n=(s,e)=>({indentAtStart:e?s.indent.length:s.indentAtStart,lineWidth:s.options.lineWidth,minContentWidth:s.options.minContentWidth}),Sn=s=>/^(%|---|\.\.\.)/m.test(s);function ah(s,e,t){if(!e||e<0)return!1;const i=e-t,n=s.length;if(n<=i)return!1;for(let r=0,a=0;r<n;++r)if(s[r]===`
`){if(r-a>i)return!0;if(a=r+1,n-a<=i)return!1}return!0}function ls(s,e){const t=JSON.stringify(s);if(e.options.doubleQuotedAsJSON)return t;const{implicitKey:i}=e,n=e.options.doubleQuotedMinMultiLineLength,r=e.indent||(Sn(s)?"  ":"");let a="",o=0;for(let l=0,c=t[l];c;c=t[++l])if(c===" "&&t[l+1]==="\\"&&t[l+2]==="n"&&(a+=t.slice(o,l)+"\\ ",l+=1,o=l,c="\\"),c==="\\")switch(t[l+1]){case"u":{a+=t.slice(o,l);const d=t.substr(l+2,4);switch(d){case"0000":a+="\\0";break;case"0007":a+="\\a";break;case"000b":a+="\\v";break;case"001b":a+="\\e";break;case"0085":a+="\\N";break;case"00a0":a+="\\_";break;case"2028":a+="\\L";break;case"2029":a+="\\P";break;default:d.substr(0,2)==="00"?a+="\\x"+d.substr(2):a+=t.substr(l,6)}l+=5,o=l+1}break;case"n":if(i||t[l+2]==='"'||t.length<n)l+=1;else{for(a+=t.slice(o,l)+`

`;t[l+2]==="\\"&&t[l+3]==="n"&&t[l+4]!=='"';)a+=`
`,l+=2;a+=r,t[l+2]===" "&&(a+="\\"),l+=1,o=l+1}break;default:l+=1}return a=o?a+t.slice(o):t,i?a:In(a,r,Ks,_n(e,!1))}function cr(s,e){if(e.options.singleQuote===!1||e.implicitKey&&s.includes(`
`)||/[ \t]\n|\n[ \t]/.test(s))return ls(s,e);const t=e.indent||(Sn(s)?"  ":""),i="'"+s.replace(/'/g,"''").replace(/\n+/g,`$&
${t}`)+"'";return e.implicitKey?i:In(i,t,Yo,_n(e,!1))}function Si(s,e){const{singleQuote:t}=e.options;let i;if(t===!1)i=ls;else{const n=s.includes('"'),r=s.includes("'");n&&!r?i=cr:r&&!n?i=ls:i=t?cr:ls}return i(s,e)}let ur;try{ur=new RegExp(`(^|(?<!
))
+(?!
|$)`,"g")}catch{ur=/\n+(?!\n|$)/g}function Vs({comment:s,type:e,value:t},i,n,r){const{blockQuote:a,commentString:o,lineWidth:l}=i.options;if(!a||/\n[\t ]+$/.test(t)||/^\s*$/.test(t))return Si(t,i);const c=i.indent||(i.forceBlockIndent||Sn(t)?"  ":""),d=a==="literal"?!0:a==="folded"||e===q.BLOCK_FOLDED?!1:e===q.BLOCK_LITERAL?!0:!ah(t,l,c.length);if(!t)return d?`|
`:`>
`;let g,f;for(f=t.length;f>0;--f){const b=t[f-1];if(b!==`
`&&b!=="	"&&b!==" ")break}let u=t.substring(f);const p=u.indexOf(`
`);p===-1?g="-":t===u||p!==u.length-1?(g="+",r&&r()):g="",u&&(t=t.slice(0,-u.length),u[u.length-1]===`
`&&(u=u.slice(0,-1)),u=u.replace(ur,`$&${c}`));let h=!1,m,k=-1;for(m=0;m<t.length;++m){const b=t[m];if(b===" ")h=!0;else if(b===`
`)k=m;else break}let T=t.substring(0,k<m?k+1:m);T&&(t=t.substring(T.length),T=T.replace(/\n+/g,`$&${c}`));let v=(h?c?"2":"1":"")+g;if(s&&(v+=" "+o(s.replace(/ ?[\r\n]+/g," ")),n&&n()),!d){const b=t.replace(/\n+/g,`
$&`).replace(/(?:^|\n)([\t ].*)(?:([\n\t ]*)\n(?![\n\t ]))?/g,"$1$2").replace(/\n+/g,`$&${c}`);let I=!1;const O=_n(i,!0);a!=="folded"&&e!==q.BLOCK_FOLDED&&(O.onOverflow=()=>{I=!0});const E=In(`${T}${b}${u}`,c,lr,O);if(!I)return`>${v}
${c}${E}`}return t=t.replace(/\n+/g,`$&${c}`),`|${v}
${c}${T}${t}${u}`}function oh(s,e,t,i){const{type:n,value:r}=s,{actualString:a,implicitKey:o,indent:l,indentStep:c,inFlow:d}=e;if(o&&r.includes(`
`)||d&&/[[\]{},]/.test(r))return Si(r,e);if(/^[\n\t ,[\]{}#&*!|>'"%@`]|^[?-]$|^[?-][ \t]|[\n:][ \t]|[ \t]\n|[\n\t ]#|[\n\t :]$/.test(r))return o||d||!r.includes(`
`)?Si(r,e):Vs(s,e,t,i);if(!o&&!d&&n!==q.PLAIN&&r.includes(`
`))return Vs(s,e,t,i);if(Sn(r)){if(l==="")return e.forceBlockIndent=!0,Vs(s,e,t,i);if(o&&l===c)return Si(r,e)}const g=r.replace(/\n+/g,`$&
${l}`);if(a){const f=h=>{var m;return h.default&&h.tag!=="tag:yaml.org,2002:str"&&((m=h.test)==null?void 0:m.test(g))},{compat:u,tags:p}=e.doc.schema;if(p.some(f)||u!=null&&u.some(f))return Si(r,e)}return o?g:In(g,l,Yo,_n(e,!1))}function Es(s,e,t,i){const{implicitKey:n,inFlow:r}=e,a=typeof s.value=="string"?s:Object.assign({},s,{value:String(s.value)});let{type:o}=s;o!==q.QUOTE_DOUBLE&&/[\x00-\x08\x0b-\x1f\x7f-\x9f\u{D800}-\u{DFFF}]/u.test(a.value)&&(o=q.QUOTE_DOUBLE);const l=d=>{switch(d){case q.BLOCK_FOLDED:case q.BLOCK_LITERAL:return n||r?Si(a.value,e):Vs(a,e,t,i);case q.QUOTE_DOUBLE:return ls(a.value,e);case q.QUOTE_SINGLE:return cr(a.value,e);case q.PLAIN:return oh(a,e,t,i);default:return null}};let c=l(o);if(c===null){const{defaultKeyType:d,defaultStringType:g}=e.options,f=n&&d||g;if(c=l(f),c===null)throw new Error(`Unsupported default string type ${f}`)}return c}function Jo(s,e){const t=Object.assign({blockQuote:!0,commentString:rh,defaultKeyType:null,defaultStringType:"PLAIN",directives:null,doubleQuotedAsJSON:!1,doubleQuotedMinMultiLineLength:40,falseStr:"false",flowCollectionPadding:!0,indentSeq:!0,lineWidth:80,minContentWidth:20,nullStr:"null",simpleKeys:!1,singleQuote:null,trueStr:"true",verifyAliasOrder:!0},s.schema.toStringOptions,e);let i;switch(t.collectionStyle){case"block":i=!1;break;case"flow":i=!0;break;default:i=null}return{anchors:new Set,doc:s,flowCollectionPadding:t.flowCollectionPadding?" ":"",indent:"",indentStep:typeof t.indent=="number"?" ".repeat(t.indent):"  ",inFlow:i,options:t}}function lh(s,e){var n;if(e.tag){const r=s.filter(a=>a.tag===e.tag);if(r.length>0)return r.find(a=>a.format===e.format)??r[0]}let t,i;if(ce(e)){i=e.value;let r=s.filter(a=>{var o;return(o=a.identify)==null?void 0:o.call(a,i)});if(r.length>1){const a=r.filter(o=>o.test);a.length>0&&(r=a)}t=r.find(a=>a.format===e.format)??r.find(a=>!a.format)}else i=e,t=s.find(r=>r.nodeClass&&i instanceof r.nodeClass);if(!t){const r=((n=i==null?void 0:i.constructor)==null?void 0:n.name)??(i===null?"null":typeof i);throw new Error(`Tag not resolved for ${r} value`)}return t}function ch(s,e,{anchors:t,doc:i}){if(!i.directives)return"";const n=[],r=(ce(s)||ye(s))&&s.anchor;r&&Ko(r)&&(t.add(r),n.push(`&${r}`));const a=s.tag??(e.default?null:e.tag);return a&&n.push(i.directives.tagString(a)),n.join(" ")}function xi(s,e,t,i){var l;if(me(s))return s.toString(e,t,i);if(ti(s)){if(e.doc.directives)return s.toString(e);if((l=e.resolvedAliases)!=null&&l.has(s))throw new TypeError("Cannot stringify circular structure without alias nodes");e.resolvedAliases?e.resolvedAliases.add(s):e.resolvedAliases=new Set([s]),s=s.resolve(e.doc)}let n;const r=we(s)?s:e.doc.createNode(s,{onTagObj:c=>n=c});n??(n=lh(e.doc.schema.tags,r));const a=ch(r,n,e);a.length>0&&(e.indentAtStart=(e.indentAtStart??0)+a.length+1);const o=typeof n.stringify=="function"?n.stringify(r,e,t,i):ce(r)?Es(r,e,t,i):r.toString(e,t,i);return a?ce(r)||o[0]==="{"||o[0]==="["?`${a} ${o}`:`${a}
${e.indent}${o}`:o}function uh({key:s,value:e},t,i,n){const{allNullValues:r,doc:a,indent:o,indentStep:l,options:{commentString:c,indentSeq:d,simpleKeys:g}}=t;let f=we(s)&&s.comment||null;if(g){if(f)throw new Error("With simple keys, key nodes cannot have comments");if(ye(s)||!we(s)&&typeof s=="object"){const O="With simple keys, collection cannot be used as a key value";throw new Error(O)}}let u=!g&&(!s||f&&e==null&&!t.inFlow||ye(s)||(ce(s)?s.type===q.BLOCK_FOLDED||s.type===q.BLOCK_LITERAL:typeof s=="object"));t=Object.assign({},t,{allNullValues:!1,implicitKey:!u&&(g||!r),indent:o+l});let p=!1,h=!1,m=xi(s,t,()=>p=!0,()=>h=!0);if(!u&&!t.inFlow&&m.length>1024){if(g)throw new Error("With simple keys, single line scalar must not span more than 1024 characters");u=!0}if(t.inFlow){if(r||e==null)return p&&i&&i(),m===""?"?":u?`? ${m}`:m}else if(r&&!g||e==null&&u)return m=`? ${m}`,f&&!p?m+=ri(m,t.indent,c(f)):h&&n&&n(),m;p&&(f=null),u?(f&&(m+=ri(m,t.indent,c(f))),m=`? ${m}
${o}:`):(m=`${m}:`,f&&(m+=ri(m,t.indent,c(f))));let k,T,w;we(e)?(k=!!e.spaceBefore,T=e.commentBefore,w=e.comment):(k=!1,T=null,w=null,e&&typeof e=="object"&&(e=a.createNode(e))),t.implicitKey=!1,!u&&!f&&ce(e)&&(t.indentAtStart=m.length+1),h=!1,!d&&l.length>=2&&!t.inFlow&&!u&&zi(e)&&!e.flow&&!e.tag&&!e.anchor&&(t.indent=t.indent.substring(2));let v=!1;const b=xi(e,t,()=>v=!0,()=>h=!0);let I=" ";if(f||k||T){if(I=k?`
`:"",T){const O=c(T);I+=`
${Lt(O,t.indent)}`}b===""&&!t.inFlow?I===`
`&&(I=`

`):I+=`
${t.indent}`}else if(!u&&ye(e)){const O=b[0],E=b.indexOf(`
`),L=E!==-1,A=t.inFlow??e.flow??e.items.length===0;if(L||!A){let S=!1;if(L&&(O==="&"||O==="!")){let C=b.indexOf(" ");O==="&"&&C!==-1&&C<E&&b[C+1]==="!"&&(C=b.indexOf(" ",C+1)),(C===-1||E<C)&&(S=!0)}S||(I=`
${t.indent}`)}}else(b===""||b[0]===`
`)&&(I="");return m+=I+b,t.inFlow?v&&i&&i():w&&!v?m+=ri(m,t.indent,c(w)):h&&n&&n(),m}function Xo(s,e){(s==="debug"||s==="warn")&&console.warn(e)}const xs="<<",Mt={identify:s=>s===xs||typeof s=="symbol"&&s.description===xs,default:"key",tag:"tag:yaml.org,2002:merge",test:/^<<$/,resolve:()=>Object.assign(new q(Symbol(xs)),{addToJSMap:Qo}),stringify:()=>xs},fh=(s,e)=>(Mt.identify(e)||ce(e)&&(!e.type||e.type===q.PLAIN)&&Mt.identify(e.value))&&(s==null?void 0:s.doc.schema.tags.some(t=>t.tag===Mt.tag&&t.default));function Qo(s,e,t){if(t=s&&ti(t)?t.resolve(s.doc):t,zi(t))for(const i of t.items)Vn(s,e,i);else if(Array.isArray(t))for(const i of t)Vn(s,e,i);else Vn(s,e,t)}function Vn(s,e,t){const i=s&&ti(t)?t.resolve(s.doc):t;if(!Vi(i))throw new Error("Merge sources must be maps or map aliases");const n=i.toJSON(null,s,Map);for(const[r,a]of n)e instanceof Map?e.has(r)||e.set(r,a):e instanceof Set?e.add(r):Object.prototype.hasOwnProperty.call(e,r)||Object.defineProperty(e,r,{value:a,writable:!0,enumerable:!0,configurable:!0});return e}function Zo(s,e,{key:t,value:i}){if(we(t)&&t.addToJSMap)t.addToJSMap(s,e,i);else if(fh(s,t))Qo(s,e,i);else{const n=st(t,"",s);if(e instanceof Map)e.set(n,st(i,n,s));else if(e instanceof Set)e.add(n);else{const r=dh(t,n,s),a=st(i,r,s);r in e?Object.defineProperty(e,r,{value:a,writable:!0,enumerable:!0,configurable:!0}):e[r]=a}}return e}function dh(s,e,t){if(e===null)return"";if(typeof e!="object")return String(e);if(we(s)&&(t!=null&&t.doc)){const i=Jo(t.doc,{});i.anchors=new Set;for(const r of t.anchors.keys())i.anchors.add(r.anchor);i.inFlow=!0,i.inStringifyKey=!0;const n=s.toString(i);if(!t.mapKeyWarned){let r=JSON.stringify(n);r.length>40&&(r=r.substring(0,36)+'..."'),Xo(t.doc.options.logLevel,`Keys with collection values will be stringified due to JS Object restrictions: ${r}. Set mapAsMap: true to use object keys.`),t.mapKeyWarned=!0}return n}return JSON.stringify(e)}function Fr(s,e,t){const i=ms(s,void 0,t),n=ms(e,void 0,t);return new Ce(i,n)}class Ce{constructor(e,t=null){Object.defineProperty(this,ct,{value:jo}),this.key=e,this.value=t}clone(e){let{key:t,value:i}=this;return we(t)&&(t=t.clone(e)),we(i)&&(i=i.clone(e)),new Ce(t,i)}toJSON(e,t){const i=t!=null&&t.mapAsMap?new Map:{};return Zo(t,i,this)}toString(e,t,i){return e!=null&&e.doc?uh(this,e,t,i):JSON.stringify(this)}}function el(s,e,t){return(e.inFlow??s.flow?ph:hh)(s,e,t)}function hh({comment:s,items:e},t,{blockItemPrefix:i,flowChars:n,itemIndent:r,onChompKeep:a,onComment:o}){const{indent:l,options:{commentString:c}}=t,d=Object.assign({},t,{indent:r,type:null});let g=!1;const f=[];for(let p=0;p<e.length;++p){const h=e[p];let m=null;if(we(h))!g&&h.spaceBefore&&f.push(""),ln(t,f,h.commentBefore,g),h.comment&&(m=h.comment);else if(me(h)){const T=we(h.key)?h.key:null;T&&(!g&&T.spaceBefore&&f.push(""),ln(t,f,T.commentBefore,g))}g=!1;let k=xi(h,d,()=>m=null,()=>g=!0);m&&(k+=ri(k,r,c(m))),g&&m&&(g=!1),f.push(i+k)}let u;if(f.length===0)u=n.start+n.end;else{u=f[0];for(let p=1;p<f.length;++p){const h=f[p];u+=h?`
${l}${h}`:`
`}}return s?(u+=`
`+Lt(c(s),l),o&&o()):g&&a&&a(),u}function ph({items:s},e,{flowChars:t,itemIndent:i}){const{indent:n,indentStep:r,flowCollectionPadding:a,options:{commentString:o}}=e;i+=r;const l=Object.assign({},e,{indent:i,inFlow:!0,type:null});let c=!1,d=0;const g=[];for(let p=0;p<s.length;++p){const h=s[p];let m=null;if(we(h))h.spaceBefore&&g.push(""),ln(e,g,h.commentBefore,!1),h.comment&&(m=h.comment);else if(me(h)){const T=we(h.key)?h.key:null;T&&(T.spaceBefore&&g.push(""),ln(e,g,T.commentBefore,!1),T.comment&&(c=!0));const w=we(h.value)?h.value:null;w?(w.comment&&(m=w.comment),w.commentBefore&&(c=!0)):h.value==null&&(T!=null&&T.comment)&&(m=T.comment)}m&&(c=!0);let k=xi(h,l,()=>m=null);p<s.length-1&&(k+=","),m&&(k+=ri(k,i,o(m))),!c&&(g.length>d||k.includes(`
`))&&(c=!0),g.push(k),d=g.length}const{start:f,end:u}=t;if(g.length===0)return f+u;if(!c){const p=g.reduce((h,m)=>h+m.length+2,2);c=e.options.lineWidth>0&&p>e.options.lineWidth}if(c){let p=f;for(const h of g)p+=h?`
${r}${n}${h}`:`
`;return`${p}
${n}${u}`}else return`${f}${a}${g.join(" ")}${a}${u}`}function ln({indent:s,options:{commentString:e}},t,i,n){if(i&&n&&(i=i.replace(/^\n+/,"")),i){const r=Lt(e(i),s);t.push(r.trimStart())}}function ai(s,e){const t=ce(e)?e.value:e;for(const i of s)if(me(i)&&(i.key===e||i.key===t||ce(i.key)&&i.key.value===t))return i}class Ge extends Wo{static get tagName(){return"tag:yaml.org,2002:map"}constructor(e){super(Gt,e),this.items=[]}static from(e,t,i){const{keepUndefined:n,replacer:r}=i,a=new this(e),o=(l,c)=>{if(typeof r=="function")c=r.call(t,l,c);else if(Array.isArray(r)&&!r.includes(l))return;(c!==void 0||n)&&a.items.push(Fr(l,c,i))};if(t instanceof Map)for(const[l,c]of t)o(l,c);else if(t&&typeof t=="object")for(const l of Object.keys(t))o(l,t[l]);return typeof e.sortMapEntries=="function"&&a.items.sort(e.sortMapEntries),a}add(e,t){var a;let i;me(e)?i=e:!e||typeof e!="object"||!("key"in e)?i=new Ce(e,e==null?void 0:e.value):i=new Ce(e.key,e.value);const n=ai(this.items,i.key),r=(a=this.schema)==null?void 0:a.sortMapEntries;if(n){if(!t)throw new Error(`Key ${i.key} already set`);ce(n.value)&&Go(i.value)?n.value.value=i.value:n.value=i.value}else if(r){const o=this.items.findIndex(l=>r(i,l)<0);o===-1?this.items.push(i):this.items.splice(o,0,i)}else this.items.push(i)}delete(e){const t=ai(this.items,e);return t?this.items.splice(this.items.indexOf(t),1).length>0:!1}get(e,t){const i=ai(this.items,e),n=i==null?void 0:i.value;return(!t&&ce(n)?n.value:n)??void 0}has(e){return!!ai(this.items,e)}set(e,t){this.add(new Ce(e,t),!0)}toJSON(e,t,i){const n=i?new i:t!=null&&t.mapAsMap?new Map:{};t!=null&&t.onCreate&&t.onCreate(n);for(const r of this.items)Zo(t,n,r);return n}toString(e,t,i){if(!e)return JSON.stringify(this);for(const n of this.items)if(!me(n))throw new Error(`Map items must all be pairs; found ${JSON.stringify(n)} instead`);return!e.allNullValues&&this.hasAllNullValues(!1)&&(e=Object.assign({},e,{allNullValues:!0})),el(this,e,{blockItemPrefix:"",flowChars:{start:"{",end:"}"},itemIndent:e.indent||"",onChompKeep:i,onComment:t})}}const Gi={collection:"map",default:!0,nodeClass:Ge,tag:"tag:yaml.org,2002:map",resolve(s,e){return Vi(s)||e("Expected a mapping for this tag"),s},createNode:(s,e,t)=>Ge.from(s,e,t)};class Qt extends Wo{static get tagName(){return"tag:yaml.org,2002:seq"}constructor(e){super(Ki,e),this.items=[]}add(e){this.items.push(e)}delete(e){const t=Ms(e);return typeof t!="number"?!1:this.items.splice(t,1).length>0}get(e,t){const i=Ms(e);if(typeof i!="number")return;const n=this.items[i];return!t&&ce(n)?n.value:n}has(e){const t=Ms(e);return typeof t=="number"&&t<this.items.length}set(e,t){const i=Ms(e);if(typeof i!="number")throw new Error(`Expected a valid index, not ${e}.`);const n=this.items[i];ce(n)&&Go(t)?n.value=t:this.items[i]=t}toJSON(e,t){const i=[];t!=null&&t.onCreate&&t.onCreate(i);let n=0;for(const r of this.items)i.push(st(r,String(n++),t));return i}toString(e,t,i){return e?el(this,e,{blockItemPrefix:"- ",flowChars:{start:"[",end:"]"},itemIndent:(e.indent||"")+"  ",onChompKeep:i,onComment:t}):JSON.stringify(this)}static from(e,t,i){const{replacer:n}=i,r=new this(e);if(t&&Symbol.iterator in Object(t)){let a=0;for(let o of t){if(typeof n=="function"){const l=t instanceof Set?o:String(a++);o=n.call(t,l,o)}r.items.push(ms(o,void 0,i))}}return r}}function Ms(s){let e=ce(s)?s.value:s;return e&&typeof e=="string"&&(e=Number(e)),typeof e=="number"&&Number.isInteger(e)&&e>=0?e:null}const Wi={collection:"seq",default:!0,nodeClass:Qt,tag:"tag:yaml.org,2002:seq",resolve(s,e){return zi(s)||e("Expected a sequence for this tag"),s},createNode:(s,e,t)=>Qt.from(s,e,t)},En={identify:s=>typeof s=="string",default:!0,tag:"tag:yaml.org,2002:str",resolve:s=>s,stringify(s,e,t,i){return e=Object.assign({actualString:!0},e),Es(s,e,t,i)}},Pn={identify:s=>s==null,createNode:()=>new q(null),default:!0,tag:"tag:yaml.org,2002:null",test:/^(?:~|[Nn]ull|NULL)?$/,resolve:()=>new q(null),stringify:({source:s},e)=>typeof s=="string"&&Pn.test.test(s)?s:e.options.nullStr},xr={identify:s=>typeof s=="boolean",default:!0,tag:"tag:yaml.org,2002:bool",test:/^(?:[Tt]rue|TRUE|[Ff]alse|FALSE)$/,resolve:s=>new q(s[0]==="t"||s[0]==="T"),stringify({source:s,value:e},t){if(s&&xr.test.test(s)){const i=s[0]==="t"||s[0]==="T";if(e===i)return s}return e?t.options.trueStr:t.options.falseStr}};function yt({format:s,minFractionDigits:e,tag:t,value:i}){if(typeof i=="bigint")return String(i);const n=typeof i=="number"?i:Number(i);if(!isFinite(n))return isNaN(n)?".nan":n<0?"-.inf":".inf";let r=JSON.stringify(i);if(!s&&e&&(!t||t==="tag:yaml.org,2002:float")&&/^\d/.test(r)){let a=r.indexOf(".");a<0&&(a=r.length,r+=".");let o=e-(r.length-a-1);for(;o-- >0;)r+="0"}return r}const tl={identify:s=>typeof s=="number",default:!0,tag:"tag:yaml.org,2002:float",test:/^(?:[-+]?\.(?:inf|Inf|INF)|\.nan|\.NaN|\.NAN)$/,resolve:s=>s.slice(-3).toLowerCase()==="nan"?NaN:s[0]==="-"?Number.NEGATIVE_INFINITY:Number.POSITIVE_INFINITY,stringify:yt},il={identify:s=>typeof s=="number",default:!0,tag:"tag:yaml.org,2002:float",format:"EXP",test:/^[-+]?(?:\.[0-9]+|[0-9]+(?:\.[0-9]*)?)[eE][-+]?[0-9]+$/,resolve:s=>parseFloat(s),stringify(s){const e=Number(s.value);return isFinite(e)?e.toExponential():yt(s)}},sl={identify:s=>typeof s=="number",default:!0,tag:"tag:yaml.org,2002:float",test:/^[-+]?(?:\.[0-9]+|[0-9]+\.[0-9]*)$/,resolve(s){const e=new q(parseFloat(s)),t=s.indexOf(".");return t!==-1&&s[s.length-1]==="0"&&(e.minFractionDigits=s.length-t-1),e},stringify:yt},On=s=>typeof s=="bigint"||Number.isInteger(s),Mr=(s,e,t,{intAsBigInt:i})=>i?BigInt(s):parseInt(s.substring(e),t);function nl(s,e,t){const{value:i}=s;return On(i)&&i>=0?t+i.toString(e):yt(s)}const rl={identify:s=>On(s)&&s>=0,default:!0,tag:"tag:yaml.org,2002:int",format:"OCT",test:/^0o[0-7]+$/,resolve:(s,e,t)=>Mr(s,2,8,t),stringify:s=>nl(s,8,"0o")},al={identify:On,default:!0,tag:"tag:yaml.org,2002:int",test:/^[-+]?[0-9]+$/,resolve:(s,e,t)=>Mr(s,0,10,t),stringify:yt},ol={identify:s=>On(s)&&s>=0,default:!0,tag:"tag:yaml.org,2002:int",format:"HEX",test:/^0x[0-9a-fA-F]+$/,resolve:(s,e,t)=>Mr(s,2,16,t),stringify:s=>nl(s,16,"0x")},gh=[Gi,Wi,En,Pn,xr,rl,al,ol,tl,il,sl];function Pa(s){return typeof s=="bigint"||Number.isInteger(s)}const $s=({value:s})=>JSON.stringify(s),mh=[{identify:s=>typeof s=="string",default:!0,tag:"tag:yaml.org,2002:str",resolve:s=>s,stringify:$s},{identify:s=>s==null,createNode:()=>new q(null),default:!0,tag:"tag:yaml.org,2002:null",test:/^null$/,resolve:()=>null,stringify:$s},{identify:s=>typeof s=="boolean",default:!0,tag:"tag:yaml.org,2002:bool",test:/^true$|^false$/,resolve:s=>s==="true",stringify:$s},{identify:Pa,default:!0,tag:"tag:yaml.org,2002:int",test:/^-?(?:0|[1-9][0-9]*)$/,resolve:(s,e,{intAsBigInt:t})=>t?BigInt(s):parseInt(s,10),stringify:({value:s})=>Pa(s)?s.toString():JSON.stringify(s)},{identify:s=>typeof s=="number",default:!0,tag:"tag:yaml.org,2002:float",test:/^-?(?:0|[1-9][0-9]*)(?:\.[0-9]*)?(?:[eE][-+]?[0-9]+)?$/,resolve:s=>parseFloat(s),stringify:$s}],vh={default:!0,tag:"",test:/^/,resolve(s,e){return e(`Unresolved plain scalar ${JSON.stringify(s)}`),s}},kh=[Gi,Wi].concat(mh,vh),$r={identify:s=>s instanceof Uint8Array,default:!1,tag:"tag:yaml.org,2002:binary",resolve(s,e){if(typeof atob=="function"){const t=atob(s.replace(/[\n\r]/g,"")),i=new Uint8Array(t.length);for(let n=0;n<t.length;++n)i[n]=t.charCodeAt(n);return i}else return e("This environment does not support reading binary tags; either Buffer or atob is required"),s},stringify({comment:s,type:e,value:t},i,n,r){if(!t)return"";const a=t;let o;if(typeof btoa=="function"){let l="";for(let c=0;c<a.length;++c)l+=String.fromCharCode(a[c]);o=btoa(l)}else throw new Error("This environment does not support writing binary tags; either Buffer or btoa is required");if(e??(e=q.BLOCK_LITERAL),e!==q.QUOTE_DOUBLE){const l=Math.max(i.options.lineWidth-i.indent.length,i.options.minContentWidth),c=Math.ceil(o.length/l),d=new Array(c);for(let g=0,f=0;g<c;++g,f+=l)d[g]=o.substr(f,l);o=d.join(e===q.BLOCK_LITERAL?`
`:" ")}return Es({comment:s,type:e,value:o},i,n,r)}};function ll(s,e){if(zi(s))for(let t=0;t<s.items.length;++t){let i=s.items[t];if(!me(i)){if(Vi(i)){i.items.length>1&&e("Each pair must have its own sequence indicator");const n=i.items[0]||new Ce(new q(null));if(i.commentBefore&&(n.key.commentBefore=n.key.commentBefore?`${i.commentBefore}
${n.key.commentBefore}`:i.commentBefore),i.comment){const r=n.value??n.key;r.comment=r.comment?`${i.comment}
${r.comment}`:i.comment}i=n}s.items[t]=me(i)?i:new Ce(i)}}else e("Expected a sequence for this tag");return s}function cl(s,e,t){const{replacer:i}=t,n=new Qt(s);n.tag="tag:yaml.org,2002:pairs";let r=0;if(e&&Symbol.iterator in Object(e))for(let a of e){typeof i=="function"&&(a=i.call(e,String(r++),a));let o,l;if(Array.isArray(a))if(a.length===2)o=a[0],l=a[1];else throw new TypeError(`Expected [key, value] tuple: ${a}`);else if(a&&a instanceof Object){const c=Object.keys(a);if(c.length===1)o=c[0],l=a[o];else throw new TypeError(`Expected tuple with one key, not ${c.length} keys`)}else o=a;n.items.push(Fr(o,l,t))}return n}const jr={collection:"seq",default:!1,tag:"tag:yaml.org,2002:pairs",resolve:ll,createNode:cl};class Pi extends Qt{constructor(){super(),this.add=Ge.prototype.add.bind(this),this.delete=Ge.prototype.delete.bind(this),this.get=Ge.prototype.get.bind(this),this.has=Ge.prototype.has.bind(this),this.set=Ge.prototype.set.bind(this),this.tag=Pi.tag}toJSON(e,t){if(!t)return super.toJSON(e);const i=new Map;t!=null&&t.onCreate&&t.onCreate(i);for(const n of this.items){let r,a;if(me(n)?(r=st(n.key,"",t),a=st(n.value,r,t)):r=st(n,"",t),i.has(r))throw new Error("Ordered maps must not include duplicate keys");i.set(r,a)}return i}static from(e,t,i){const n=cl(e,t,i),r=new this;return r.items=n.items,r}}Pi.tag="tag:yaml.org,2002:omap";const Rr={collection:"seq",identify:s=>s instanceof Map,nodeClass:Pi,default:!1,tag:"tag:yaml.org,2002:omap",resolve(s,e){const t=ll(s,e),i=[];for(const{key:n}of t.items)ce(n)&&(i.includes(n.value)?e(`Ordered maps must not include duplicate keys: ${n.value}`):i.push(n.value));return Object.assign(new Pi,t)},createNode:(s,e,t)=>Pi.from(s,e,t)};function ul({value:s,source:e},t){return e&&(s?fl:dl).test.test(e)?e:s?t.options.trueStr:t.options.falseStr}const fl={identify:s=>s===!0,default:!0,tag:"tag:yaml.org,2002:bool",test:/^(?:Y|y|[Yy]es|YES|[Tt]rue|TRUE|[Oo]n|ON)$/,resolve:()=>new q(!0),stringify:ul},dl={identify:s=>s===!1,default:!0,tag:"tag:yaml.org,2002:bool",test:/^(?:N|n|[Nn]o|NO|[Ff]alse|FALSE|[Oo]ff|OFF)$/,resolve:()=>new q(!1),stringify:ul},yh={identify:s=>typeof s=="number",default:!0,tag:"tag:yaml.org,2002:float",test:/^(?:[-+]?\.(?:inf|Inf|INF)|\.nan|\.NaN|\.NAN)$/,resolve:s=>s.slice(-3).toLowerCase()==="nan"?NaN:s[0]==="-"?Number.NEGATIVE_INFINITY:Number.POSITIVE_INFINITY,stringify:yt},wh={identify:s=>typeof s=="number",default:!0,tag:"tag:yaml.org,2002:float",format:"EXP",test:/^[-+]?(?:[0-9][0-9_]*)?(?:\.[0-9_]*)?[eE][-+]?[0-9]+$/,resolve:s=>parseFloat(s.replace(/_/g,"")),stringify(s){const e=Number(s.value);return isFinite(e)?e.toExponential():yt(s)}},bh={identify:s=>typeof s=="number",default:!0,tag:"tag:yaml.org,2002:float",test:/^[-+]?(?:[0-9][0-9_]*)?\.[0-9_]*$/,resolve(s){const e=new q(parseFloat(s.replace(/_/g,""))),t=s.indexOf(".");if(t!==-1){const i=s.substring(t+1).replace(/_/g,"");i[i.length-1]==="0"&&(e.minFractionDigits=i.length)}return e},stringify:yt},Ps=s=>typeof s=="bigint"||Number.isInteger(s);function An(s,e,t,{intAsBigInt:i}){const n=s[0];if((n==="-"||n==="+")&&(e+=1),s=s.substring(e).replace(/_/g,""),i){switch(t){case 2:s=`0b${s}`;break;case 8:s=`0o${s}`;break;case 16:s=`0x${s}`;break}const a=BigInt(s);return n==="-"?BigInt(-1)*a:a}const r=parseInt(s,t);return n==="-"?-1*r:r}function Br(s,e,t){const{value:i}=s;if(Ps(i)){const n=i.toString(e);return i<0?"-"+t+n.substr(1):t+n}return yt(s)}const Th={identify:Ps,default:!0,tag:"tag:yaml.org,2002:int",format:"BIN",test:/^[-+]?0b[0-1_]+$/,resolve:(s,e,t)=>An(s,2,2,t),stringify:s=>Br(s,2,"0b")},Ih={identify:Ps,default:!0,tag:"tag:yaml.org,2002:int",format:"OCT",test:/^[-+]?0[0-7_]+$/,resolve:(s,e,t)=>An(s,1,8,t),stringify:s=>Br(s,8,"0")},_h={identify:Ps,default:!0,tag:"tag:yaml.org,2002:int",test:/^[-+]?[0-9][0-9_]*$/,resolve:(s,e,t)=>An(s,0,10,t),stringify:yt},Sh={identify:Ps,default:!0,tag:"tag:yaml.org,2002:int",format:"HEX",test:/^[-+]?0x[0-9a-fA-F_]+$/,resolve:(s,e,t)=>An(s,2,16,t),stringify:s=>Br(s,16,"0x")};class Oi extends Ge{constructor(e){super(e),this.tag=Oi.tag}add(e){let t;me(e)?t=e:e&&typeof e=="object"&&"key"in e&&"value"in e&&e.value===null?t=new Ce(e.key,null):t=new Ce(e,null),ai(this.items,t.key)||this.items.push(t)}get(e,t){const i=ai(this.items,e);return!t&&me(i)?ce(i.key)?i.key.value:i.key:i}set(e,t){if(typeof t!="boolean")throw new Error(`Expected boolean value for set(key, value) in a YAML set, not ${typeof t}`);const i=ai(this.items,e);i&&!t?this.items.splice(this.items.indexOf(i),1):!i&&t&&this.items.push(new Ce(e))}toJSON(e,t){return super.toJSON(e,t,Set)}toString(e,t,i){if(!e)return JSON.stringify(this);if(this.hasAllNullValues(!0))return super.toString(Object.assign({},e,{allNullValues:!0}),t,i);throw new Error("Set items must all have null values")}static from(e,t,i){const{replacer:n}=i,r=new this(e);if(t&&Symbol.iterator in Object(t))for(let a of t)typeof n=="function"&&(a=n.call(t,a,a)),r.items.push(Fr(a,null,i));return r}}Oi.tag="tag:yaml.org,2002:set";const Ur={collection:"map",identify:s=>s instanceof Set,nodeClass:Oi,default:!1,tag:"tag:yaml.org,2002:set",createNode:(s,e,t)=>Oi.from(s,e,t),resolve(s,e){if(Vi(s)){if(s.hasAllNullValues(!0))return Object.assign(new Oi,s);e("Set items must all have null values")}else e("Expected a mapping for this tag");return s}};function qr(s,e){const t=s[0],i=t==="-"||t==="+"?s.substring(1):s,n=a=>e?BigInt(a):Number(a),r=i.replace(/_/g,"").split(":").reduce((a,o)=>a*n(60)+n(o),n(0));return t==="-"?n(-1)*r:r}function hl(s){let{value:e}=s,t=a=>a;if(typeof e=="bigint")t=a=>BigInt(a);else if(isNaN(e)||!isFinite(e))return yt(s);let i="";e<0&&(i="-",e*=t(-1));const n=t(60),r=[e%n];return e<60?r.unshift(0):(e=(e-r[0])/n,r.unshift(e%n),e>=60&&(e=(e-r[0])/n,r.unshift(e))),i+r.map(a=>String(a).padStart(2,"0")).join(":").replace(/000000\d*$/,"")}const pl={identify:s=>typeof s=="bigint"||Number.isInteger(s),default:!0,tag:"tag:yaml.org,2002:int",format:"TIME",test:/^[-+]?[0-9][0-9_]*(?::[0-5]?[0-9])+$/,resolve:(s,e,{intAsBigInt:t})=>qr(s,t),stringify:hl},gl={identify:s=>typeof s=="number",default:!0,tag:"tag:yaml.org,2002:float",format:"TIME",test:/^[-+]?[0-9][0-9_]*(?::[0-5]?[0-9])+\.[0-9_]*$/,resolve:s=>qr(s,!1),stringify:hl},Cn={identify:s=>s instanceof Date,default:!0,tag:"tag:yaml.org,2002:timestamp",test:RegExp("^([0-9]{4})-([0-9]{1,2})-([0-9]{1,2})(?:(?:t|T|[ \\t]+)([0-9]{1,2}):([0-9]{1,2}):([0-9]{1,2}(\\.[0-9]+)?)(?:[ \\t]*(Z|[-+][012]?[0-9](?::[0-9]{2})?))?)?$"),resolve(s){const e=s.match(Cn.test);if(!e)throw new Error("!!timestamp expects a date, starting with yyyy-mm-dd");const[,t,i,n,r,a,o]=e.map(Number),l=e[7]?Number((e[7]+"00").substr(1,3)):0;let c=Date.UTC(t,i-1,n,r||0,a||0,o||0,l);const d=e[8];if(d&&d!=="Z"){let g=qr(d,!1);Math.abs(g)<30&&(g*=60),c-=6e4*g}return new Date(c)},stringify:({value:s})=>(s==null?void 0:s.toISOString().replace(/(T00:00:00)?\.000Z$/,""))??""},Oa=[Gi,Wi,En,Pn,fl,dl,Th,Ih,_h,Sh,yh,wh,bh,$r,Mt,Rr,jr,Ur,pl,gl,Cn],Aa=new Map([["core",gh],["failsafe",[Gi,Wi,En]],["json",kh],["yaml11",Oa],["yaml-1.1",Oa]]),Ca={binary:$r,bool:xr,float:sl,floatExp:il,floatNaN:tl,floatTime:gl,int:al,intHex:ol,intOct:rl,intTime:pl,map:Gi,merge:Mt,null:Pn,omap:Rr,pairs:jr,seq:Wi,set:Ur,timestamp:Cn},Eh={"tag:yaml.org,2002:binary":$r,"tag:yaml.org,2002:merge":Mt,"tag:yaml.org,2002:omap":Rr,"tag:yaml.org,2002:pairs":jr,"tag:yaml.org,2002:set":Ur,"tag:yaml.org,2002:timestamp":Cn};function zn(s,e,t){const i=Aa.get(e);if(i&&!s)return t&&!i.includes(Mt)?i.concat(Mt):i.slice();let n=i;if(!n)if(Array.isArray(s))n=[];else{const r=Array.from(Aa.keys()).filter(a=>a!=="yaml11").map(a=>JSON.stringify(a)).join(", ");throw new Error(`Unknown schema "${e}"; use one of ${r} or define customTags array`)}if(Array.isArray(s))for(const r of s)n=n.concat(r);else typeof s=="function"&&(n=s(n.slice()));return t&&(n=n.concat(Mt)),n.reduce((r,a)=>{const o=typeof a=="string"?Ca[a]:a;if(!o){const l=JSON.stringify(a),c=Object.keys(Ca).map(d=>JSON.stringify(d)).join(", ");throw new Error(`Unknown custom tag ${l}; use one of ${c}`)}return r.includes(o)||r.push(o),r},[])}const Ph=(s,e)=>s.key<e.key?-1:s.key>e.key?1:0;class Nn{constructor({compat:e,customTags:t,merge:i,resolveKnownTags:n,schema:r,sortMapEntries:a,toStringDefaults:o}){this.compat=Array.isArray(e)?zn(e,"compat"):e?zn(null,e):null,this.name=typeof r=="string"&&r||"core",this.knownTags=n?Eh:{},this.tags=zn(t,this.name,i),this.toStringOptions=o??null,Object.defineProperty(this,Gt,{value:Gi}),Object.defineProperty(this,At,{value:En}),Object.defineProperty(this,Ki,{value:Wi}),this.sortMapEntries=typeof a=="function"?a:a===!0?Ph:null}clone(){const e=Object.create(Nn.prototype,Object.getOwnPropertyDescriptors(this));return e.tags=this.tags.slice(),e}}function Oh(s,e){var l;const t=[];let i=e.directives===!0;if(e.directives!==!1&&s.directives){const c=s.directives.toString(s);c?(t.push(c),i=!0):s.directives.docStart&&(i=!0)}i&&t.push("---");const n=Jo(s,e),{commentString:r}=n.options;if(s.commentBefore){t.length!==1&&t.unshift("");const c=r(s.commentBefore);t.unshift(Lt(c,""))}let a=!1,o=null;if(s.contents){if(we(s.contents)){if(s.contents.spaceBefore&&i&&t.push(""),s.contents.commentBefore){const g=r(s.contents.commentBefore);t.push(Lt(g,""))}n.forceBlockIndent=!!s.comment,o=s.contents.comment}const c=o?void 0:()=>a=!0;let d=xi(s.contents,n,()=>o=null,c);o&&(d+=ri(d,"",r(o))),(d[0]==="|"||d[0]===">")&&t[t.length-1]==="---"?t[t.length-1]=`--- ${d}`:t.push(d)}else t.push(xi(s.contents,n));if((l=s.directives)!=null&&l.docEnd)if(s.comment){const c=r(s.comment);c.includes(`
`)?(t.push("..."),t.push(Lt(c,""))):t.push(`... ${c}`)}else t.push("...");else{let c=s.comment;c&&a&&(c=c.replace(/^\n+/,"")),c&&((!a||o)&&t[t.length-1]!==""&&t.push(""),t.push(Lt(r(c),"")))}return t.join(`
`)+`
`}class Yi{constructor(e,t,i){this.commentBefore=null,this.comment=null,this.errors=[],this.warnings=[],Object.defineProperty(this,ct,{value:or});let n=null;typeof t=="function"||Array.isArray(t)?n=t:i===void 0&&t&&(i=t,t=void 0);const r=Object.assign({intAsBigInt:!1,keepSourceTokens:!1,logLevel:"warn",prettyErrors:!0,strict:!0,stringKeys:!1,uniqueKeys:!0,version:"1.2"},i);this.options=r;let{version:a}=r;i!=null&&i._directives?(this.directives=i._directives.atDocument(),this.directives.yaml.explicit&&(a=this.directives.yaml.version)):this.directives=new Fe({version:a}),this.setSchema(a,i),this.contents=e===void 0?null:this.createNode(e,n,i)}clone(){const e=Object.create(Yi.prototype,{[ct]:{value:or}});return e.commentBefore=this.commentBefore,e.comment=this.comment,e.errors=this.errors.slice(),e.warnings=this.warnings.slice(),e.options=Object.assign({},this.options),this.directives&&(e.directives=this.directives.clone()),e.schema=this.schema.clone(),e.contents=we(this.contents)?this.contents.clone(e.schema):this.contents,this.range&&(e.range=this.range.slice()),e}add(e){yi(this.contents)&&this.contents.add(e)}addIn(e,t){yi(this.contents)&&this.contents.addIn(e,t)}createAlias(e,t){if(!e.anchor){const i=Vo(this);e.anchor=!t||i.has(t)?zo(t||"a",i):t}return new Tn(e.anchor)}createNode(e,t,i){let n;if(typeof t=="function")e=t.call({"":e},"",e),n=t;else if(Array.isArray(t)){const m=T=>typeof T=="number"||T instanceof String||T instanceof Number,k=t.filter(m).map(String);k.length>0&&(t=t.concat(k)),n=t}else i===void 0&&t&&(i=t,t=void 0);const{aliasDuplicateObjects:r,anchorPrefix:a,flow:o,keepUndefined:l,onTagObj:c,tag:d}=i??{},{onAnchor:g,setAnchors:f,sourceObjects:u}=ih(this,a||"a"),p={aliasDuplicateObjects:r??!0,keepUndefined:l??!1,onAnchor:g,onTagObj:c,replacer:n,schema:this.schema,sourceObjects:u},h=ms(e,d,p);return o&&ye(h)&&(h.flow=!0),f(),h}createPair(e,t,i={}){const n=this.createNode(e,null,i),r=this.createNode(t,null,i);return new Ce(n,r)}delete(e){return yi(this.contents)?this.contents.delete(e):!1}deleteIn(e){return ss(e)?this.contents==null?!1:(this.contents=null,!0):yi(this.contents)?this.contents.deleteIn(e):!1}get(e,t){return ye(this.contents)?this.contents.get(e,t):void 0}getIn(e,t){return ss(e)?!t&&ce(this.contents)?this.contents.value:this.contents:ye(this.contents)?this.contents.getIn(e,t):void 0}has(e){return ye(this.contents)?this.contents.has(e):!1}hasIn(e){return ss(e)?this.contents!==void 0:ye(this.contents)?this.contents.hasIn(e):!1}set(e,t){this.contents==null?this.contents=on(this.schema,[e],t):yi(this.contents)&&this.contents.set(e,t)}setIn(e,t){ss(e)?this.contents=t:this.contents==null?this.contents=on(this.schema,Array.from(e),t):yi(this.contents)&&this.contents.setIn(e,t)}setSchema(e,t={}){typeof e=="number"&&(e=String(e));let i;switch(e){case"1.1":this.directives?this.directives.yaml.version="1.1":this.directives=new Fe({version:"1.1"}),i={resolveKnownTags:!1,schema:"yaml-1.1"};break;case"1.2":case"next":this.directives?this.directives.yaml.version=e:this.directives=new Fe({version:e}),i={resolveKnownTags:!0,schema:"core"};break;case null:this.directives&&delete this.directives,i=null;break;default:{const n=JSON.stringify(e);throw new Error(`Expected '1.1', '1.2' or null as first argument, but found: ${n}`)}}if(t.schema instanceof Object)this.schema=t.schema;else if(i)this.schema=new Nn(Object.assign(i,t));else throw new Error("With a null YAML version, the { schema: Schema } option is required")}toJS({json:e,jsonArg:t,mapAsMap:i,maxAliasCount:n,onAnchor:r,reviver:a}={}){const o={anchors:new Map,doc:this,keep:!e,mapAsMap:i===!0,mapKeyWarned:!1,maxAliasCount:typeof n=="number"?n:100},l=st(this.contents,t??"",o);if(typeof r=="function")for(const{count:c,res:d}of o.anchors.values())r(d,c);return typeof a=="function"?_i(a,{"":l},"",l):l}toJSON(e,t){return this.toJS({json:!0,jsonArg:e,mapAsMap:!1,onAnchor:t})}toString(e={}){if(this.errors.length>0)throw new Error("Document with errors cannot be stringified");if("indent"in e&&(!Number.isInteger(e.indent)||Number(e.indent)<=0)){const t=JSON.stringify(e.indent);throw new Error(`"indent" option must be a positive integer, not ${t}`)}return Oh(this,e)}}function yi(s){if(ye(s))return!0;throw new Error("Expected a YAML collection as document contents")}class Hr extends Error{constructor(e,t,i,n){super(),this.name=e,this.code=i,this.message=n,this.pos=t}}class oi extends Hr{constructor(e,t,i){super("YAMLParseError",e,t,i)}}class ml extends Hr{constructor(e,t,i){super("YAMLWarning",e,t,i)}}const cn=(s,e)=>t=>{if(t.pos[0]===-1)return;t.linePos=t.pos.map(o=>e.linePos(o));const{line:i,col:n}=t.linePos[0];t.message+=` at line ${i}, column ${n}`;let r=n-1,a=s.substring(e.lineStarts[i-1],e.lineStarts[i]).replace(/[\n\r]+$/,"");if(r>=60&&a.length>80){const o=Math.min(r-39,a.length-79);a=""+a.substring(o),r-=o-1}if(a.length>80&&(a=a.substring(0,79)+""),i>1&&/^ *$/.test(a.substring(0,r))){let o=s.substring(e.lineStarts[i-2],e.lineStarts[i-1]);o.length>80&&(o=o.substring(0,79)+`
`),a=o+a}if(/[^ ]/.test(a)){let o=1;const l=t.linePos[1];l&&l.line===i&&l.col>n&&(o=Math.max(1,Math.min(l.col-n,80-r)));const c=" ".repeat(r)+"^".repeat(o);t.message+=`:

${a}
${c}
`}};function Mi(s,{flow:e,indicator:t,next:i,offset:n,onError:r,parentIndent:a,startOnNewline:o}){let l=!1,c=o,d=o,g="",f="",u=!1,p=!1,h=null,m=null,k=null,T=null,w=null,v=null,b=null;for(const E of s)switch(p&&(E.type!=="space"&&E.type!=="newline"&&E.type!=="comma"&&r(E.offset,"MISSING_CHAR","Tags and anchors must be separated from the next token by white space"),p=!1),h&&(c&&E.type!=="comment"&&E.type!=="newline"&&r(h,"TAB_AS_INDENT","Tabs are not allowed as indentation"),h=null),E.type){case"space":!e&&(t!=="doc-start"||(i==null?void 0:i.type)!=="flow-collection")&&E.source.includes("	")&&(h=E),d=!0;break;case"comment":{d||r(E,"MISSING_CHAR","Comments must be separated from other tokens by white space characters");const L=E.source.substring(1)||" ";g?g+=f+L:g=L,f="",c=!1;break}case"newline":c?g?g+=E.source:(!v||t!=="seq-item-ind")&&(l=!0):f+=E.source,c=!0,u=!0,(m||k)&&(T=E),d=!0;break;case"anchor":m&&r(E,"MULTIPLE_ANCHORS","A node can have at most one anchor"),E.source.endsWith(":")&&r(E.offset+E.source.length-1,"BAD_ALIAS","Anchor ending in : is ambiguous",!0),m=E,b??(b=E.offset),c=!1,d=!1,p=!0;break;case"tag":{k&&r(E,"MULTIPLE_TAGS","A node can have at most one tag"),k=E,b??(b=E.offset),c=!1,d=!1,p=!0;break}case t:(m||k)&&r(E,"BAD_PROP_ORDER",`Anchors and tags must be after the ${E.source} indicator`),v&&r(E,"UNEXPECTED_TOKEN",`Unexpected ${E.source} in ${e??"collection"}`),v=E,c=t==="seq-item-ind"||t==="explicit-key-ind",d=!1;break;case"comma":if(e){w&&r(E,"UNEXPECTED_TOKEN",`Unexpected , in ${e}`),w=E,c=!1,d=!1;break}default:r(E,"UNEXPECTED_TOKEN",`Unexpected ${E.type} token`),c=!1,d=!1}const I=s[s.length-1],O=I?I.offset+I.source.length:n;return p&&i&&i.type!=="space"&&i.type!=="newline"&&i.type!=="comma"&&(i.type!=="scalar"||i.source!=="")&&r(i.offset,"MISSING_CHAR","Tags and anchors must be separated from the next token by white space"),h&&(c&&h.indent<=a||(i==null?void 0:i.type)==="block-map"||(i==null?void 0:i.type)==="block-seq")&&r(h,"TAB_AS_INDENT","Tabs are not allowed as indentation"),{comma:w,found:v,spaceBefore:l,comment:g,hasNewline:u,anchor:m,tag:k,newlineAfterProp:T,end:O,start:b??O}}function vs(s){if(!s)return null;switch(s.type){case"alias":case"scalar":case"double-quoted-scalar":case"single-quoted-scalar":if(s.source.includes(`
`))return!0;if(s.end){for(const e of s.end)if(e.type==="newline")return!0}return!1;case"flow-collection":for(const e of s.items){for(const t of e.start)if(t.type==="newline")return!0;if(e.sep){for(const t of e.sep)if(t.type==="newline")return!0}if(vs(e.key)||vs(e.value))return!0}return!1;default:return!0}}function fr(s,e,t){if((e==null?void 0:e.type)==="flow-collection"){const i=e.end[0];i.indent===s&&(i.source==="]"||i.source==="}")&&vs(e)&&t(i,"BAD_INDENT","Flow end indicator should be more indented than parent",!0)}}function vl(s,e,t){const{uniqueKeys:i}=s.options;if(i===!1)return!1;const n=typeof i=="function"?i:(r,a)=>r===a||ce(r)&&ce(a)&&r.value===a.value;return e.some(r=>n(r.key,t))}const Na="All mapping items must start at the same column";function Ah({composeNode:s,composeEmptyNode:e},t,i,n,r){var d;const a=(r==null?void 0:r.nodeClass)??Ge,o=new a(t.schema);t.atRoot&&(t.atRoot=!1);let l=i.offset,c=null;for(const g of i.items){const{start:f,key:u,sep:p,value:h}=g,m=Mi(f,{indicator:"explicit-key-ind",next:u??(p==null?void 0:p[0]),offset:l,onError:n,parentIndent:i.indent,startOnNewline:!0}),k=!m.found;if(k){if(u&&(u.type==="block-seq"?n(l,"BLOCK_AS_IMPLICIT_KEY","A block sequence may not be used as an implicit map key"):"indent"in u&&u.indent!==i.indent&&n(l,"BAD_INDENT",Na)),!m.anchor&&!m.tag&&!p){c=m.end,m.comment&&(o.comment?o.comment+=`
`+m.comment:o.comment=m.comment);continue}(m.newlineAfterProp||vs(u))&&n(u??f[f.length-1],"MULTILINE_IMPLICIT_KEY","Implicit keys need to be on a single line")}else((d=m.found)==null?void 0:d.indent)!==i.indent&&n(l,"BAD_INDENT",Na);t.atKey=!0;const T=m.end,w=u?s(t,u,m,n):e(t,T,f,null,m,n);t.schema.compat&&fr(i.indent,u,n),t.atKey=!1,vl(t,o.items,w)&&n(T,"DUPLICATE_KEY","Map keys must be unique");const v=Mi(p??[],{indicator:"map-value-ind",next:h,offset:w.range[2],onError:n,parentIndent:i.indent,startOnNewline:!u||u.type==="block-scalar"});if(l=v.end,v.found){k&&((h==null?void 0:h.type)==="block-map"&&!v.hasNewline&&n(l,"BLOCK_AS_IMPLICIT_KEY","Nested mappings are not allowed in compact mappings"),t.options.strict&&m.start<v.found.offset-1024&&n(w.range,"KEY_OVER_1024_CHARS","The : indicator must be at most 1024 chars after the start of an implicit block mapping key"));const b=h?s(t,h,v,n):e(t,l,p,null,v,n);t.schema.compat&&fr(i.indent,h,n),l=b.range[2];const I=new Ce(w,b);t.options.keepSourceTokens&&(I.srcToken=g),o.items.push(I)}else{k&&n(w.range,"MISSING_CHAR","Implicit map keys need to be followed by map values"),v.comment&&(w.comment?w.comment+=`
`+v.comment:w.comment=v.comment);const b=new Ce(w);t.options.keepSourceTokens&&(b.srcToken=g),o.items.push(b)}}return c&&c<l&&n(c,"IMPOSSIBLE","Map comment with trailing content"),o.range=[i.offset,l,c??l],o}function Ch({composeNode:s,composeEmptyNode:e},t,i,n,r){const a=(r==null?void 0:r.nodeClass)??Qt,o=new a(t.schema);t.atRoot&&(t.atRoot=!1),t.atKey&&(t.atKey=!1);let l=i.offset,c=null;for(const{start:d,value:g}of i.items){const f=Mi(d,{indicator:"seq-item-ind",next:g,offset:l,onError:n,parentIndent:i.indent,startOnNewline:!0});if(!f.found)if(f.anchor||f.tag||g)g&&g.type==="block-seq"?n(f.end,"BAD_INDENT","All sequence items must start at the same column"):n(l,"MISSING_CHAR","Sequence item without - indicator");else{c=f.end,f.comment&&(o.comment=f.comment);continue}const u=g?s(t,g,f,n):e(t,f.end,d,null,f,n);t.schema.compat&&fr(i.indent,g,n),l=u.range[2],o.items.push(u)}return o.range=[i.offset,l,c??l],o}function Os(s,e,t,i){let n="";if(s){let r=!1,a="";for(const o of s){const{source:l,type:c}=o;switch(c){case"space":r=!0;break;case"comment":{t&&!r&&i(o,"MISSING_CHAR","Comments must be separated from other tokens by white space characters");const d=l.substring(1)||" ";n?n+=a+d:n=d,a="";break}case"newline":n&&(a+=l),r=!0;break;default:i(o,"UNEXPECTED_TOKEN",`Unexpected ${c} at node end`)}e+=l.length}}return{comment:n,offset:e}}const Gn="Block collections are not allowed within flow collections",Wn=s=>s&&(s.type==="block-map"||s.type==="block-seq");function Nh({composeNode:s,composeEmptyNode:e},t,i,n,r){const a=i.start.source==="{",o=a?"flow map":"flow sequence",l=(r==null?void 0:r.nodeClass)??(a?Ge:Qt),c=new l(t.schema);c.flow=!0;const d=t.atRoot;d&&(t.atRoot=!1),t.atKey&&(t.atKey=!1);let g=i.offset+i.start.source.length;for(let m=0;m<i.items.length;++m){const k=i.items[m],{start:T,key:w,sep:v,value:b}=k,I=Mi(T,{flow:o,indicator:"explicit-key-ind",next:w??(v==null?void 0:v[0]),offset:g,onError:n,parentIndent:i.indent,startOnNewline:!1});if(!I.found){if(!I.anchor&&!I.tag&&!v&&!b){m===0&&I.comma?n(I.comma,"UNEXPECTED_TOKEN",`Unexpected , in ${o}`):m<i.items.length-1&&n(I.start,"UNEXPECTED_TOKEN",`Unexpected empty item in ${o}`),I.comment&&(c.comment?c.comment+=`
`+I.comment:c.comment=I.comment),g=I.end;continue}!a&&t.options.strict&&vs(w)&&n(w,"MULTILINE_IMPLICIT_KEY","Implicit keys of flow sequence pairs need to be on a single line")}if(m===0)I.comma&&n(I.comma,"UNEXPECTED_TOKEN",`Unexpected , in ${o}`);else if(I.comma||n(I.start,"MISSING_CHAR",`Missing , between ${o} items`),I.comment){let O="";e:for(const E of T)switch(E.type){case"comma":case"space":break;case"comment":O=E.source.substring(1);break e;default:break e}if(O){let E=c.items[c.items.length-1];me(E)&&(E=E.value??E.key),E.comment?E.comment+=`
`+O:E.comment=O,I.comment=I.comment.substring(O.length+1)}}if(!a&&!v&&!I.found){const O=b?s(t,b,I,n):e(t,I.end,v,null,I,n);c.items.push(O),g=O.range[2],Wn(b)&&n(O.range,"BLOCK_IN_FLOW",Gn)}else{t.atKey=!0;const O=I.end,E=w?s(t,w,I,n):e(t,O,T,null,I,n);Wn(w)&&n(E.range,"BLOCK_IN_FLOW",Gn),t.atKey=!1;const L=Mi(v??[],{flow:o,indicator:"map-value-ind",next:b,offset:E.range[2],onError:n,parentIndent:i.indent,startOnNewline:!1});if(L.found){if(!a&&!I.found&&t.options.strict){if(v)for(const C of v){if(C===L.found)break;if(C.type==="newline"){n(C,"MULTILINE_IMPLICIT_KEY","Implicit keys of flow sequence pairs need to be on a single line");break}}I.start<L.found.offset-1024&&n(L.found,"KEY_OVER_1024_CHARS","The : indicator must be at most 1024 chars after the start of an implicit flow sequence key")}}else b&&("source"in b&&b.source&&b.source[0]===":"?n(b,"MISSING_CHAR",`Missing space after : in ${o}`):n(L.start,"MISSING_CHAR",`Missing , or : between ${o} items`));const A=b?s(t,b,L,n):L.found?e(t,L.end,v,null,L,n):null;A?Wn(b)&&n(A.range,"BLOCK_IN_FLOW",Gn):L.comment&&(E.comment?E.comment+=`
`+L.comment:E.comment=L.comment);const S=new Ce(E,A);if(t.options.keepSourceTokens&&(S.srcToken=k),a){const C=c;vl(t,C.items,E)&&n(O,"DUPLICATE_KEY","Map keys must be unique"),C.items.push(S)}else{const C=new Ge(t.schema);C.flow=!0,C.items.push(S);const F=(A??E).range;C.range=[E.range[0],F[1],F[2]],c.items.push(C)}g=A?A.range[2]:L.end}}const f=a?"}":"]",[u,...p]=i.end;let h=g;if(u&&u.source===f)h=u.offset+u.source.length;else{const m=o[0].toUpperCase()+o.substring(1),k=d?`${m} must end with a ${f}`:`${m} in block collection must be sufficiently indented and end with a ${f}`;n(g,d?"MISSING_CHAR":"BAD_INDENT",k),u&&u.source.length!==1&&p.unshift(u)}if(p.length>0){const m=Os(p,h,t.options.strict,n);m.comment&&(c.comment?c.comment+=`
`+m.comment:c.comment=m.comment),c.range=[i.offset,h,m.offset]}else c.range=[i.offset,h,h];return c}function Yn(s,e,t,i,n,r){const a=t.type==="block-map"?Ah(s,e,t,i,r):t.type==="block-seq"?Ch(s,e,t,i,r):Nh(s,e,t,i,r),o=a.constructor;return n==="!"||n===o.tagName?(a.tag=o.tagName,a):(n&&(a.tag=n),a)}function Lh(s,e,t,i,n){var f;const r=i.tag,a=r?e.directives.tagName(r.source,u=>n(r,"TAG_RESOLVE_FAILED",u)):null;if(t.type==="block-seq"){const{anchor:u,newlineAfterProp:p}=i,h=u&&r?u.offset>r.offset?u:r:u??r;h&&(!p||p.offset<h.offset)&&n(h,"MISSING_CHAR","Missing newline after block sequence props")}const o=t.type==="block-map"?"map":t.type==="block-seq"?"seq":t.start.source==="{"?"map":"seq";if(!r||!a||a==="!"||a===Ge.tagName&&o==="map"||a===Qt.tagName&&o==="seq")return Yn(s,e,t,n,a);let l=e.schema.tags.find(u=>u.tag===a&&u.collection===o);if(!l){const u=e.schema.knownTags[a];if(u&&u.collection===o)e.schema.tags.push(Object.assign({},u,{default:!1})),l=u;else return u?n(r,"BAD_COLLECTION_TYPE",`${u.tag} used for ${o} collection, but expects ${u.collection??"scalar"}`,!0):n(r,"TAG_RESOLVE_FAILED",`Unresolved tag: ${a}`,!0),Yn(s,e,t,n,a)}const c=Yn(s,e,t,n,a,l),d=((f=l.resolve)==null?void 0:f.call(l,c,u=>n(r,"TAG_RESOLVE_FAILED",u),e.options))??c,g=we(d)?d:new q(d);return g.range=c.range,g.tag=a,l!=null&&l.format&&(g.format=l.format),g}function kl(s,e,t){const i=e.offset,n=Dh(e,s.options.strict,t);if(!n)return{value:"",type:null,comment:"",range:[i,i,i]};const r=n.mode===">"?q.BLOCK_FOLDED:q.BLOCK_LITERAL,a=e.source?Fh(e.source):[];let o=a.length;for(let h=a.length-1;h>=0;--h){const m=a[h][1];if(m===""||m==="\r")o=h;else break}if(o===0){const h=n.chomp==="+"&&a.length>0?`
`.repeat(Math.max(1,a.length-1)):"";let m=i+n.length;return e.source&&(m+=e.source.length),{value:h,type:r,comment:n.comment,range:[i,m,m]}}let l=e.indent+n.indent,c=e.offset+n.length,d=0;for(let h=0;h<o;++h){const[m,k]=a[h];if(k===""||k==="\r")n.indent===0&&m.length>l&&(l=m.length);else{m.length<l&&t(c+m.length,"MISSING_CHAR","Block scalars with more-indented leading empty lines must use an explicit indentation indicator"),n.indent===0&&(l=m.length),d=h,l===0&&!s.atRoot&&t(c,"BAD_INDENT","Block scalar values in collections must be indented");break}c+=m.length+k.length+1}for(let h=a.length-1;h>=o;--h)a[h][0].length>l&&(o=h+1);let g="",f="",u=!1;for(let h=0;h<d;++h)g+=a[h][0].slice(l)+`
`;for(let h=d;h<o;++h){let[m,k]=a[h];c+=m.length+k.length+1;const T=k[k.length-1]==="\r";if(T&&(k=k.slice(0,-1)),k&&m.length<l){const v=`Block scalar lines must not be less indented than their ${n.indent?"explicit indentation indicator":"first line"}`;t(c-k.length-(T?2:1),"BAD_INDENT",v),m=""}r===q.BLOCK_LITERAL?(g+=f+m.slice(l)+k,f=`
`):m.length>l||k[0]==="	"?(f===" "?f=`
`:!u&&f===`
`&&(f=`

`),g+=f+m.slice(l)+k,f=`
`,u=!0):k===""?f===`
`?g+=`
`:f=`
`:(g+=f+k,f=" ",u=!1)}switch(n.chomp){case"-":break;case"+":for(let h=o;h<a.length;++h)g+=`
`+a[h][0].slice(l);g[g.length-1]!==`
`&&(g+=`
`);break;default:g+=`
`}const p=i+n.length+e.source.length;return{value:g,type:r,comment:n.comment,range:[i,p,p]}}function Dh({offset:s,props:e},t,i){if(e[0].type!=="block-scalar-header")return i(e[0],"IMPOSSIBLE","Block scalar header not found"),null;const{source:n}=e[0],r=n[0];let a=0,o="",l=-1;for(let f=1;f<n.length;++f){const u=n[f];if(!o&&(u==="-"||u==="+"))o=u;else{const p=Number(u);!a&&p?a=p:l===-1&&(l=s+f)}}l!==-1&&i(l,"UNEXPECTED_TOKEN",`Block scalar header includes extra characters: ${n}`);let c=!1,d="",g=n.length;for(let f=1;f<e.length;++f){const u=e[f];switch(u.type){case"space":c=!0;case"newline":g+=u.source.length;break;case"comment":t&&!c&&i(u,"MISSING_CHAR","Comments must be separated from other tokens by white space characters"),g+=u.source.length,d=u.source.substring(1);break;case"error":i(u,"UNEXPECTED_TOKEN",u.message),g+=u.source.length;break;default:{const p=`Unexpected token in block scalar header: ${u.type}`;i(u,"UNEXPECTED_TOKEN",p);const h=u.source;h&&typeof h=="string"&&(g+=h.length)}}}return{mode:r,indent:a,chomp:o,comment:d,length:g}}function Fh(s){const e=s.split(/\n( *)/),t=e[0],i=t.match(/^( *)/),r=[i!=null&&i[1]?[i[1],t.slice(i[1].length)]:["",t]];for(let a=1;a<e.length;a+=2)r.push([e[a],e[a+1]]);return r}function yl(s,e,t){const{offset:i,type:n,source:r,end:a}=s;let o,l;const c=(f,u,p)=>t(i+f,u,p);switch(n){case"scalar":o=q.PLAIN,l=xh(r,c);break;case"single-quoted-scalar":o=q.QUOTE_SINGLE,l=Mh(r,c);break;case"double-quoted-scalar":o=q.QUOTE_DOUBLE,l=$h(r,c);break;default:return t(s,"UNEXPECTED_TOKEN",`Expected a flow scalar value, but found: ${n}`),{value:"",type:null,comment:"",range:[i,i+r.length,i+r.length]}}const d=i+r.length,g=Os(a,d,e,t);return{value:l,type:o,comment:g.comment,range:[i,d,g.offset]}}function xh(s,e){let t="";switch(s[0]){case"	":t="a tab character";break;case",":t="flow indicator character ,";break;case"%":t="directive indicator character %";break;case"|":case">":{t=`block scalar indicator ${s[0]}`;break}case"@":case"`":{t=`reserved character ${s[0]}`;break}}return t&&e(0,"BAD_SCALAR_START",`Plain value cannot start with ${t}`),wl(s)}function Mh(s,e){return(s[s.length-1]!=="'"||s.length===1)&&e(s.length,"MISSING_CHAR","Missing closing 'quote"),wl(s.slice(1,-1)).replace(/''/g,"'")}function wl(s){let e,t;try{e=new RegExp(`(.*?)(?<![ 	])[ 	]*\r?
`,"sy"),t=new RegExp(`[ 	]*(.*?)(?:(?<![ 	])[ 	]*)?\r?
`,"sy")}catch{e=/(.*?)[ \t]*\r?\n/sy,t=/[ \t]*(.*?)[ \t]*\r?\n/sy}let i=e.exec(s);if(!i)return s;let n=i[1],r=" ",a=e.lastIndex;for(t.lastIndex=a;i=t.exec(s);)i[1]===""?r===`
`?n+=r:r=`
`:(n+=r+i[1],r=" "),a=t.lastIndex;const o=/[ \t]*(.*)/sy;return o.lastIndex=a,i=o.exec(s),n+r+((i==null?void 0:i[1])??"")}function $h(s,e){let t="";for(let i=1;i<s.length-1;++i){const n=s[i];if(!(n==="\r"&&s[i+1]===`
`))if(n===`
`){const{fold:r,offset:a}=jh(s,i);t+=r,i=a}else if(n==="\\"){let r=s[++i];const a=Rh[r];if(a)t+=a;else if(r===`
`)for(r=s[i+1];r===" "||r==="	";)r=s[++i+1];else if(r==="\r"&&s[i+1]===`
`)for(r=s[++i+1];r===" "||r==="	";)r=s[++i+1];else if(r==="x"||r==="u"||r==="U"){const o={x:2,u:4,U:8}[r];t+=Bh(s,i+1,o,e),i+=o}else{const o=s.substr(i-1,2);e(i-1,"BAD_DQ_ESCAPE",`Invalid escape sequence ${o}`),t+=o}}else if(n===" "||n==="	"){const r=i;let a=s[i+1];for(;a===" "||a==="	";)a=s[++i+1];a!==`
`&&!(a==="\r"&&s[i+2]===`
`)&&(t+=i>r?s.slice(r,i+1):n)}else t+=n}return(s[s.length-1]!=='"'||s.length===1)&&e(s.length,"MISSING_CHAR",'Missing closing "quote'),t}function jh(s,e){let t="",i=s[e+1];for(;(i===" "||i==="	"||i===`
`||i==="\r")&&!(i==="\r"&&s[e+2]!==`
`);)i===`
`&&(t+=`
`),e+=1,i=s[e+1];return t||(t=" "),{fold:t,offset:e}}const Rh={0:"\0",a:"\x07",b:"\b",e:"\x1B",f:"\f",n:`
`,r:"\r",t:"	",v:"\v",N:"",_:"",L:"\u2028",P:"\u2029"," ":" ",'"':'"',"/":"/","\\":"\\","	":"	"};function Bh(s,e,t,i){const n=s.substr(e,t),a=n.length===t&&/^[0-9a-fA-F]+$/.test(n)?parseInt(n,16):NaN;if(isNaN(a)){const o=s.substr(e-2,t+2);return i(e-2,"BAD_DQ_ESCAPE",`Invalid escape sequence ${o}`),o}return String.fromCodePoint(a)}function bl(s,e,t,i){const{value:n,type:r,comment:a,range:o}=e.type==="block-scalar"?kl(s,e,i):yl(e,s.options.strict,i),l=t?s.directives.tagName(t.source,g=>i(t,"TAG_RESOLVE_FAILED",g)):null;let c;s.options.stringKeys&&s.atKey?c=s.schema[At]:l?c=Uh(s.schema,n,l,t,i):e.type==="scalar"?c=qh(s,n,e,i):c=s.schema[At];let d;try{const g=c.resolve(n,f=>i(t??e,"TAG_RESOLVE_FAILED",f),s.options);d=ce(g)?g:new q(g)}catch(g){const f=g instanceof Error?g.message:String(g);i(t??e,"TAG_RESOLVE_FAILED",f),d=new q(n)}return d.range=o,d.source=n,r&&(d.type=r),l&&(d.tag=l),c.format&&(d.format=c.format),a&&(d.comment=a),d}function Uh(s,e,t,i,n){var o;if(t==="!")return s[At];const r=[];for(const l of s.tags)if(!l.collection&&l.tag===t)if(l.default&&l.test)r.push(l);else return l;for(const l of r)if((o=l.test)!=null&&o.test(e))return l;const a=s.knownTags[t];return a&&!a.collection?(s.tags.push(Object.assign({},a,{default:!1,test:void 0})),a):(n(i,"TAG_RESOLVE_FAILED",`Unresolved tag: ${t}`,t!=="tag:yaml.org,2002:str"),s[At])}function qh({atKey:s,directives:e,schema:t},i,n,r){const a=t.tags.find(o=>{var l;return(o.default===!0||s&&o.default==="key")&&((l=o.test)==null?void 0:l.test(i))})||t[At];if(t.compat){const o=t.compat.find(l=>{var c;return l.default&&((c=l.test)==null?void 0:c.test(i))})??t[At];if(a.tag!==o.tag){const l=e.tagString(a.tag),c=e.tagString(o.tag),d=`Value may be parsed as either ${l} or ${c}`;r(n,"TAG_RESOLVE_FAILED",d,!0)}}return a}function Hh(s,e,t){if(e){t??(t=e.length);for(let i=t-1;i>=0;--i){let n=e[i];switch(n.type){case"space":case"comment":case"newline":s-=n.source.length;continue}for(n=e[++i];(n==null?void 0:n.type)==="space";)s+=n.source.length,n=e[++i];break}}return s}const Kh={composeNode:Tl,composeEmptyNode:Kr};function Tl(s,e,t,i){const n=s.atKey,{spaceBefore:r,comment:a,anchor:o,tag:l}=t;let c,d=!0;switch(e.type){case"alias":c=Vh(s,e,i),(o||l)&&i(e,"ALIAS_PROPS","An alias node must not specify any properties");break;case"scalar":case"single-quoted-scalar":case"double-quoted-scalar":case"block-scalar":c=bl(s,e,l,i),o&&(c.anchor=o.source.substring(1));break;case"block-map":case"block-seq":case"flow-collection":c=Lh(Kh,s,e,t,i),o&&(c.anchor=o.source.substring(1));break;default:{const g=e.type==="error"?e.message:`Unsupported token (type: ${e.type})`;i(e,"UNEXPECTED_TOKEN",g),c=Kr(s,e.offset,void 0,null,t,i),d=!1}}return o&&c.anchor===""&&i(o,"BAD_ALIAS","Anchor cannot be an empty string"),n&&s.options.stringKeys&&(!ce(c)||typeof c.value!="string"||c.tag&&c.tag!=="tag:yaml.org,2002:str")&&i(l??e,"NON_STRING_KEY","With stringKeys, all keys must be strings"),r&&(c.spaceBefore=!0),a&&(e.type==="scalar"&&e.source===""?c.comment=a:c.commentBefore=a),s.options.keepSourceTokens&&d&&(c.srcToken=e),c}function Kr(s,e,t,i,{spaceBefore:n,comment:r,anchor:a,tag:o,end:l},c){const d={type:"scalar",offset:Hh(e,t,i),indent:-1,source:""},g=bl(s,d,o,c);return a&&(g.anchor=a.source.substring(1),g.anchor===""&&c(a,"BAD_ALIAS","Anchor cannot be an empty string")),n&&(g.spaceBefore=!0),r&&(g.comment=r,g.range[2]=l),g}function Vh({options:s},{offset:e,source:t,end:i},n){const r=new Tn(t.substring(1));r.source===""&&n(e,"BAD_ALIAS","Alias cannot be an empty string"),r.source.endsWith(":")&&n(e+t.length-1,"BAD_ALIAS","Alias ending in : is ambiguous",!0);const a=e+t.length,o=Os(i,a,s.strict,n);return r.range=[e,a,o.offset],o.comment&&(r.comment=o.comment),r}function zh(s,e,{offset:t,start:i,value:n,end:r},a){const o=Object.assign({_directives:e},s),l=new Yi(void 0,o),c={atKey:!1,atRoot:!0,directives:l.directives,options:l.options,schema:l.schema},d=Mi(i,{indicator:"doc-start",next:n??(r==null?void 0:r[0]),offset:t,onError:a,parentIndent:0,startOnNewline:!0});d.found&&(l.directives.docStart=!0,n&&(n.type==="block-map"||n.type==="block-seq")&&!d.hasNewline&&a(d.end,"MISSING_CHAR","Block collection cannot start on same line with directives-end marker")),l.contents=n?Tl(c,n,d,a):Kr(c,d.end,i,null,d,a);const g=l.contents.range[2],f=Os(r,g,!1,a);return f.comment&&(l.comment=f.comment),l.range=[t,g,f.offset],l}function Qi(s){if(typeof s=="number")return[s,s+1];if(Array.isArray(s))return s.length===2?s:[s[0],s[1]];const{offset:e,source:t}=s;return[e,e+(typeof t=="string"?t.length:1)]}function La(s){var n;let e="",t=!1,i=!1;for(let r=0;r<s.length;++r){const a=s[r];switch(a[0]){case"#":e+=(e===""?"":i?`

`:`
`)+(a.substring(1)||" "),t=!0,i=!1;break;case"%":((n=s[r+1])==null?void 0:n[0])!=="#"&&(r+=1),t=!1;break;default:t||(i=!0),t=!1}}return{comment:e,afterEmptyLine:i}}class Vr{constructor(e={}){this.doc=null,this.atDirectives=!1,this.prelude=[],this.errors=[],this.warnings=[],this.onError=(t,i,n,r)=>{const a=Qi(t);r?this.warnings.push(new ml(a,i,n)):this.errors.push(new oi(a,i,n))},this.directives=new Fe({version:e.version||"1.2"}),this.options=e}decorate(e,t){const{comment:i,afterEmptyLine:n}=La(this.prelude);if(i){const r=e.contents;if(t)e.comment=e.comment?`${e.comment}
${i}`:i;else if(n||e.directives.docStart||!r)e.commentBefore=i;else if(ye(r)&&!r.flow&&r.items.length>0){let a=r.items[0];me(a)&&(a=a.key);const o=a.commentBefore;a.commentBefore=o?`${i}
${o}`:i}else{const a=r.commentBefore;r.commentBefore=a?`${i}
${a}`:i}}t?(Array.prototype.push.apply(e.errors,this.errors),Array.prototype.push.apply(e.warnings,this.warnings)):(e.errors=this.errors,e.warnings=this.warnings),this.prelude=[],this.errors=[],this.warnings=[]}streamInfo(){return{comment:La(this.prelude).comment,directives:this.directives,errors:this.errors,warnings:this.warnings}}*compose(e,t=!1,i=-1){for(const n of e)yield*this.next(n);yield*this.end(t,i)}*next(e){switch(e.type){case"directive":this.directives.add(e.source,(t,i,n)=>{const r=Qi(e);r[0]+=t,this.onError(r,"BAD_DIRECTIVE",i,n)}),this.prelude.push(e.source),this.atDirectives=!0;break;case"document":{const t=zh(this.options,this.directives,e,this.onError);this.atDirectives&&!t.directives.docStart&&this.onError(e,"MISSING_CHAR","Missing directives-end/doc-start indicator line"),this.decorate(t,!1),this.doc&&(yield this.doc),this.doc=t,this.atDirectives=!1;break}case"byte-order-mark":case"space":break;case"comment":case"newline":this.prelude.push(e.source);break;case"error":{const t=e.source?`${e.message}: ${JSON.stringify(e.source)}`:e.message,i=new oi(Qi(e),"UNEXPECTED_TOKEN",t);this.atDirectives||!this.doc?this.errors.push(i):this.doc.errors.push(i);break}case"doc-end":{if(!this.doc){const i="Unexpected doc-end without preceding document";this.errors.push(new oi(Qi(e),"UNEXPECTED_TOKEN",i));break}this.doc.directives.docEnd=!0;const t=Os(e.end,e.offset+e.source.length,this.doc.options.strict,this.onError);if(this.decorate(this.doc,!0),t.comment){const i=this.doc.comment;this.doc.comment=i?`${i}
${t.comment}`:t.comment}this.doc.range[2]=t.offset;break}default:this.errors.push(new oi(Qi(e),"UNEXPECTED_TOKEN",`Unsupported token ${e.type}`))}}*end(e=!1,t=-1){if(this.doc)this.decorate(this.doc,!0),yield this.doc,this.doc=null;else if(e){const i=Object.assign({_directives:this.directives},this.options),n=new Yi(void 0,i);this.atDirectives&&this.onError(t,"MISSING_CHAR","Missing directives-end indicator line"),n.range=[0,t,t],this.decorate(n,!1),yield n}}}function Gh(s,e=!0,t){if(s){const i=(n,r,a)=>{const o=typeof n=="number"?n:Array.isArray(n)?n[0]:n.offset;if(t)t(o,r,a);else throw new oi([o,o+1],r,a)};switch(s.type){case"scalar":case"single-quoted-scalar":case"double-quoted-scalar":return yl(s,e,i);case"block-scalar":return kl({options:{strict:e}},s,i)}}return null}function Wh(s,e){const{implicitKey:t=!1,indent:i,inFlow:n=!1,offset:r=-1,type:a="PLAIN"}=e,o=Es({type:a,value:s},{implicitKey:t,indent:i>0?" ".repeat(i):"",inFlow:n,options:{blockQuote:!0,lineWidth:-1}}),l=e.end??[{type:"newline",offset:-1,indent:i,source:`
`}];switch(o[0]){case"|":case">":{const c=o.indexOf(`
`),d=o.substring(0,c),g=o.substring(c+1)+`
`,f=[{type:"block-scalar-header",offset:r,indent:i,source:d}];return Il(f,l)||f.push({type:"newline",offset:-1,indent:i,source:`
`}),{type:"block-scalar",offset:r,indent:i,props:f,source:g}}case'"':return{type:"double-quoted-scalar",offset:r,indent:i,source:o,end:l};case"'":return{type:"single-quoted-scalar",offset:r,indent:i,source:o,end:l};default:return{type:"scalar",offset:r,indent:i,source:o,end:l}}}function Yh(s,e,t={}){let{afterKey:i=!1,implicitKey:n=!1,inFlow:r=!1,type:a}=t,o="indent"in s?s.indent:null;if(i&&typeof o=="number"&&(o+=2),!a)switch(s.type){case"single-quoted-scalar":a="QUOTE_SINGLE";break;case"double-quoted-scalar":a="QUOTE_DOUBLE";break;case"block-scalar":{const c=s.props[0];if(c.type!=="block-scalar-header")throw new Error("Invalid block scalar header");a=c.source[0]===">"?"BLOCK_FOLDED":"BLOCK_LITERAL";break}default:a="PLAIN"}const l=Es({type:a,value:e},{implicitKey:n||o===null,indent:o!==null&&o>0?" ".repeat(o):"",inFlow:r,options:{blockQuote:!0,lineWidth:-1}});switch(l[0]){case"|":case">":Jh(s,l);break;case'"':Jn(s,l,"double-quoted-scalar");break;case"'":Jn(s,l,"single-quoted-scalar");break;default:Jn(s,l,"scalar")}}function Jh(s,e){const t=e.indexOf(`
`),i=e.substring(0,t),n=e.substring(t+1)+`
`;if(s.type==="block-scalar"){const r=s.props[0];if(r.type!=="block-scalar-header")throw new Error("Invalid block scalar header");r.source=i,s.source=n}else{const{offset:r}=s,a="indent"in s?s.indent:-1,o=[{type:"block-scalar-header",offset:r,indent:a,source:i}];Il(o,"end"in s?s.end:void 0)||o.push({type:"newline",offset:-1,indent:a,source:`
`});for(const l of Object.keys(s))l!=="type"&&l!=="offset"&&delete s[l];Object.assign(s,{type:"block-scalar",indent:a,props:o,source:n})}}function Il(s,e){if(e)for(const t of e)switch(t.type){case"space":case"comment":s.push(t);break;case"newline":return s.push(t),!0}return!1}function Jn(s,e,t){switch(s.type){case"scalar":case"double-quoted-scalar":case"single-quoted-scalar":s.type=t,s.source=e;break;case"block-scalar":{const i=s.props.slice(1);let n=e.length;s.props[0].type==="block-scalar-header"&&(n-=s.props[0].source.length);for(const r of i)r.offset+=n;delete s.props,Object.assign(s,{type:t,source:e,end:i});break}case"block-map":case"block-seq":{const n={type:"newline",offset:s.offset+e.length,indent:s.indent,source:`
`};delete s.items,Object.assign(s,{type:t,source:e,end:[n]});break}default:{const i="indent"in s?s.indent:-1,n="end"in s&&Array.isArray(s.end)?s.end.filter(r=>r.type==="space"||r.type==="comment"||r.type==="newline"):[];for(const r of Object.keys(s))r!=="type"&&r!=="offset"&&delete s[r];Object.assign(s,{type:t,indent:i,source:e,end:n})}}}const Xh=s=>"type"in s?un(s):zs(s);function un(s){switch(s.type){case"block-scalar":{let e="";for(const t of s.props)e+=un(t);return e+s.source}case"block-map":case"block-seq":{let e="";for(const t of s.items)e+=zs(t);return e}case"flow-collection":{let e=s.start.source;for(const t of s.items)e+=zs(t);for(const t of s.end)e+=t.source;return e}case"document":{let e=zs(s);if(s.end)for(const t of s.end)e+=t.source;return e}default:{let e=s.source;if("end"in s&&s.end)for(const t of s.end)e+=t.source;return e}}}function zs({start:s,key:e,sep:t,value:i}){let n="";for(const r of s)n+=r.source;if(e&&(n+=un(e)),t)for(const r of t)n+=r.source;return i&&(n+=un(i)),n}const dr=Symbol("break visit"),Qh=Symbol("skip children"),_l=Symbol("remove item");function pi(s,e){"type"in s&&s.type==="document"&&(s={start:s.start,value:s.value}),Sl(Object.freeze([]),s,e)}pi.BREAK=dr;pi.SKIP=Qh;pi.REMOVE=_l;pi.itemAtPath=(s,e)=>{let t=s;for(const[i,n]of e){const r=t==null?void 0:t[i];if(r&&"items"in r)t=r.items[n];else return}return t};pi.parentCollection=(s,e)=>{const t=pi.itemAtPath(s,e.slice(0,-1)),i=e[e.length-1][0],n=t==null?void 0:t[i];if(n&&"items"in n)return n;throw new Error("Parent collection not found")};function Sl(s,e,t){let i=t(e,s);if(typeof i=="symbol")return i;for(const n of["key","value"]){const r=e[n];if(r&&"items"in r){for(let a=0;a<r.items.length;++a){const o=Sl(Object.freeze(s.concat([[n,a]])),r.items[a],t);if(typeof o=="number")a=o-1;else{if(o===dr)return dr;o===_l&&(r.items.splice(a,1),a-=1)}}typeof i=="function"&&n==="key"&&(i=i(e,s))}}return typeof i=="function"?i(e,s):i}const Ln="\uFEFF",Dn="",Fn="",ks="",Zh=s=>!!s&&"items"in s,ep=s=>!!s&&(s.type==="scalar"||s.type==="single-quoted-scalar"||s.type==="double-quoted-scalar"||s.type==="block-scalar");function tp(s){switch(s){case Ln:return"<BOM>";case Dn:return"<DOC>";case Fn:return"<FLOW_END>";case ks:return"<SCALAR>";default:return JSON.stringify(s)}}function El(s){switch(s){case Ln:return"byte-order-mark";case Dn:return"doc-mode";case Fn:return"flow-error-end";case ks:return"scalar";case"---":return"doc-start";case"...":return"doc-end";case"":case`
`:case`\r
`:return"newline";case"-":return"seq-item-ind";case"?":return"explicit-key-ind";case":":return"map-value-ind";case"{":return"flow-map-start";case"}":return"flow-map-end";case"[":return"flow-seq-start";case"]":return"flow-seq-end";case",":return"comma"}switch(s[0]){case" ":case"	":return"space";case"#":return"comment";case"%":return"directive-line";case"*":return"alias";case"&":return"anchor";case"!":return"tag";case"'":return"single-quoted-scalar";case'"':return"double-quoted-scalar";case"|":case">":return"block-scalar-header"}return null}const ip=Object.freeze(Object.defineProperty({__proto__:null,BOM:Ln,DOCUMENT:Dn,FLOW_END:Fn,SCALAR:ks,createScalarToken:Wh,isCollection:Zh,isScalar:ep,prettyToken:tp,resolveAsScalar:Gh,setScalarValue:Yh,stringify:Xh,tokenType:El,visit:pi},Symbol.toStringTag,{value:"Module"}));function gt(s){switch(s){case void 0:case" ":case`
`:case"\r":case"	":return!0;default:return!1}}const Da=new Set("0123456789ABCDEFabcdef"),sp=new Set("0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz-#;/?:@&=+$_.!~*'()"),js=new Set(",[]{}"),np=new Set(` ,[]{}
\r	`),Xn=s=>!s||np.has(s);class Pl{constructor(){this.atEnd=!1,this.blockScalarIndent=-1,this.blockScalarKeep=!1,this.buffer="",this.flowKey=!1,this.flowLevel=0,this.indentNext=0,this.indentValue=0,this.lineEndPos=null,this.next=null,this.pos=0}*lex(e,t=!1){if(e){if(typeof e!="string")throw TypeError("source is not a string");this.buffer=this.buffer?this.buffer+e:e,this.lineEndPos=null}this.atEnd=!t;let i=this.next??"stream";for(;i&&(t||this.hasChars(1));)i=yield*this.parseNext(i)}atLineEnd(){let e=this.pos,t=this.buffer[e];for(;t===" "||t==="	";)t=this.buffer[++e];return!t||t==="#"||t===`
`?!0:t==="\r"?this.buffer[e+1]===`
`:!1}charAt(e){return this.buffer[this.pos+e]}continueScalar(e){let t=this.buffer[e];if(this.indentNext>0){let i=0;for(;t===" ";)t=this.buffer[++i+e];if(t==="\r"){const n=this.buffer[i+e+1];if(n===`
`||!n&&!this.atEnd)return e+i+1}return t===`
`||i>=this.indentNext||!t&&!this.atEnd?e+i:-1}if(t==="-"||t==="."){const i=this.buffer.substr(e,3);if((i==="---"||i==="...")&&gt(this.buffer[e+3]))return-1}return e}getLine(){let e=this.lineEndPos;return(typeof e!="number"||e!==-1&&e<this.pos)&&(e=this.buffer.indexOf(`
`,this.pos),this.lineEndPos=e),e===-1?this.atEnd?this.buffer.substring(this.pos):null:(this.buffer[e-1]==="\r"&&(e-=1),this.buffer.substring(this.pos,e))}hasChars(e){return this.pos+e<=this.buffer.length}setNext(e){return this.buffer=this.buffer.substring(this.pos),this.pos=0,this.lineEndPos=null,this.next=e,null}peek(e){return this.buffer.substr(this.pos,e)}*parseNext(e){switch(e){case"stream":return yield*this.parseStream();case"line-start":return yield*this.parseLineStart();case"block-start":return yield*this.parseBlockStart();case"doc":return yield*this.parseDocument();case"flow":return yield*this.parseFlowCollection();case"quoted-scalar":return yield*this.parseQuotedScalar();case"block-scalar":return yield*this.parseBlockScalar();case"plain-scalar":return yield*this.parsePlainScalar()}}*parseStream(){let e=this.getLine();if(e===null)return this.setNext("stream");if(e[0]===Ln&&(yield*this.pushCount(1),e=e.substring(1)),e[0]==="%"){let t=e.length,i=e.indexOf("#");for(;i!==-1;){const r=e[i-1];if(r===" "||r==="	"){t=i-1;break}else i=e.indexOf("#",i+1)}for(;;){const r=e[t-1];if(r===" "||r==="	")t-=1;else break}const n=(yield*this.pushCount(t))+(yield*this.pushSpaces(!0));return yield*this.pushCount(e.length-n),this.pushNewline(),"stream"}if(this.atLineEnd()){const t=yield*this.pushSpaces(!0);return yield*this.pushCount(e.length-t),yield*this.pushNewline(),"stream"}return yield Dn,yield*this.parseLineStart()}*parseLineStart(){const e=this.charAt(0);if(!e&&!this.atEnd)return this.setNext("line-start");if(e==="-"||e==="."){if(!this.atEnd&&!this.hasChars(4))return this.setNext("line-start");const t=this.peek(3);if((t==="---"||t==="...")&&gt(this.charAt(3)))return yield*this.pushCount(3),this.indentValue=0,this.indentNext=0,t==="---"?"doc":"stream"}return this.indentValue=yield*this.pushSpaces(!1),this.indentNext>this.indentValue&&!gt(this.charAt(1))&&(this.indentNext=this.indentValue),yield*this.parseBlockStart()}*parseBlockStart(){const[e,t]=this.peek(2);if(!t&&!this.atEnd)return this.setNext("block-start");if((e==="-"||e==="?"||e===":")&&gt(t)){const i=(yield*this.pushCount(1))+(yield*this.pushSpaces(!0));return this.indentNext=this.indentValue+1,this.indentValue+=i,yield*this.parseBlockStart()}return"doc"}*parseDocument(){yield*this.pushSpaces(!0);const e=this.getLine();if(e===null)return this.setNext("doc");let t=yield*this.pushIndicators();switch(e[t]){case"#":yield*this.pushCount(e.length-t);case void 0:return yield*this.pushNewline(),yield*this.parseLineStart();case"{":case"[":return yield*this.pushCount(1),this.flowKey=!1,this.flowLevel=1,"flow";case"}":case"]":return yield*this.pushCount(1),"doc";case"*":return yield*this.pushUntil(Xn),"doc";case'"':case"'":return yield*this.parseQuotedScalar();case"|":case">":return t+=yield*this.parseBlockScalarHeader(),t+=yield*this.pushSpaces(!0),yield*this.pushCount(e.length-t),yield*this.pushNewline(),yield*this.parseBlockScalar();default:return yield*this.parsePlainScalar()}}*parseFlowCollection(){let e,t,i=-1;do e=yield*this.pushNewline(),e>0?(t=yield*this.pushSpaces(!1),this.indentValue=i=t):t=0,t+=yield*this.pushSpaces(!0);while(e+t>0);const n=this.getLine();if(n===null)return this.setNext("flow");if((i!==-1&&i<this.indentNext&&n[0]!=="#"||i===0&&(n.startsWith("---")||n.startsWith("..."))&&gt(n[3]))&&!(i===this.indentNext-1&&this.flowLevel===1&&(n[0]==="]"||n[0]==="}")))return this.flowLevel=0,yield Fn,yield*this.parseLineStart();let r=0;for(;n[r]===",";)r+=yield*this.pushCount(1),r+=yield*this.pushSpaces(!0),this.flowKey=!1;switch(r+=yield*this.pushIndicators(),n[r]){case void 0:return"flow";case"#":return yield*this.pushCount(n.length-r),"flow";case"{":case"[":return yield*this.pushCount(1),this.flowKey=!1,this.flowLevel+=1,"flow";case"}":case"]":return yield*this.pushCount(1),this.flowKey=!0,this.flowLevel-=1,this.flowLevel?"flow":"doc";case"*":return yield*this.pushUntil(Xn),"flow";case'"':case"'":return this.flowKey=!0,yield*this.parseQuotedScalar();case":":{const a=this.charAt(1);if(this.flowKey||gt(a)||a===",")return this.flowKey=!1,yield*this.pushCount(1),yield*this.pushSpaces(!0),"flow"}default:return this.flowKey=!1,yield*this.parsePlainScalar()}}*parseQuotedScalar(){const e=this.charAt(0);let t=this.buffer.indexOf(e,this.pos+1);if(e==="'")for(;t!==-1&&this.buffer[t+1]==="'";)t=this.buffer.indexOf("'",t+2);else for(;t!==-1;){let r=0;for(;this.buffer[t-1-r]==="\\";)r+=1;if(r%2===0)break;t=this.buffer.indexOf('"',t+1)}const i=this.buffer.substring(0,t);let n=i.indexOf(`
`,this.pos);if(n!==-1){for(;n!==-1;){const r=this.continueScalar(n+1);if(r===-1)break;n=i.indexOf(`
`,r)}n!==-1&&(t=n-(i[n-1]==="\r"?2:1))}if(t===-1){if(!this.atEnd)return this.setNext("quoted-scalar");t=this.buffer.length}return yield*this.pushToIndex(t+1,!1),this.flowLevel?"flow":"doc"}*parseBlockScalarHeader(){this.blockScalarIndent=-1,this.blockScalarKeep=!1;let e=this.pos;for(;;){const t=this.buffer[++e];if(t==="+")this.blockScalarKeep=!0;else if(t>"0"&&t<="9")this.blockScalarIndent=Number(t)-1;else if(t!=="-")break}return yield*this.pushUntil(t=>gt(t)||t==="#")}*parseBlockScalar(){let e=this.pos-1,t=0,i;e:for(let r=this.pos;i=this.buffer[r];++r)switch(i){case" ":t+=1;break;case`
`:e=r,t=0;break;case"\r":{const a=this.buffer[r+1];if(!a&&!this.atEnd)return this.setNext("block-scalar");if(a===`
`)break}default:break e}if(!i&&!this.atEnd)return this.setNext("block-scalar");if(t>=this.indentNext){this.blockScalarIndent===-1?this.indentNext=t:this.indentNext=this.blockScalarIndent+(this.indentNext===0?1:this.indentNext);do{const r=this.continueScalar(e+1);if(r===-1)break;e=this.buffer.indexOf(`
`,r)}while(e!==-1);if(e===-1){if(!this.atEnd)return this.setNext("block-scalar");e=this.buffer.length}}let n=e+1;for(i=this.buffer[n];i===" ";)i=this.buffer[++n];if(i==="	"){for(;i==="	"||i===" "||i==="\r"||i===`
`;)i=this.buffer[++n];e=n-1}else if(!this.blockScalarKeep)do{let r=e-1,a=this.buffer[r];a==="\r"&&(a=this.buffer[--r]);const o=r;for(;a===" ";)a=this.buffer[--r];if(a===`
`&&r>=this.pos&&r+1+t>o)e=r;else break}while(!0);return yield ks,yield*this.pushToIndex(e+1,!0),yield*this.parseLineStart()}*parsePlainScalar(){const e=this.flowLevel>0;let t=this.pos-1,i=this.pos-1,n;for(;n=this.buffer[++i];)if(n===":"){const r=this.buffer[i+1];if(gt(r)||e&&js.has(r))break;t=i}else if(gt(n)){let r=this.buffer[i+1];if(n==="\r"&&(r===`
`?(i+=1,n=`
`,r=this.buffer[i+1]):t=i),r==="#"||e&&js.has(r))break;if(n===`
`){const a=this.continueScalar(i+1);if(a===-1)break;i=Math.max(i,a-2)}}else{if(e&&js.has(n))break;t=i}return!n&&!this.atEnd?this.setNext("plain-scalar"):(yield ks,yield*this.pushToIndex(t+1,!0),e?"flow":"doc")}*pushCount(e){return e>0?(yield this.buffer.substr(this.pos,e),this.pos+=e,e):0}*pushToIndex(e,t){const i=this.buffer.slice(this.pos,e);return i?(yield i,this.pos+=i.length,i.length):(t&&(yield""),0)}*pushIndicators(){switch(this.charAt(0)){case"!":return(yield*this.pushTag())+(yield*this.pushSpaces(!0))+(yield*this.pushIndicators());case"&":return(yield*this.pushUntil(Xn))+(yield*this.pushSpaces(!0))+(yield*this.pushIndicators());case"-":case"?":case":":{const e=this.flowLevel>0,t=this.charAt(1);if(gt(t)||e&&js.has(t))return e?this.flowKey&&(this.flowKey=!1):this.indentNext=this.indentValue+1,(yield*this.pushCount(1))+(yield*this.pushSpaces(!0))+(yield*this.pushIndicators())}}return 0}*pushTag(){if(this.charAt(1)==="<"){let e=this.pos+2,t=this.buffer[e];for(;!gt(t)&&t!==">";)t=this.buffer[++e];return yield*this.pushToIndex(t===">"?e+1:e,!1)}else{let e=this.pos+1,t=this.buffer[e];for(;t;)if(sp.has(t))t=this.buffer[++e];else if(t==="%"&&Da.has(this.buffer[e+1])&&Da.has(this.buffer[e+2]))t=this.buffer[e+=3];else break;return yield*this.pushToIndex(e,!1)}}*pushNewline(){const e=this.buffer[this.pos];return e===`
`?yield*this.pushCount(1):e==="\r"&&this.charAt(1)===`
`?yield*this.pushCount(2):0}*pushSpaces(e){let t=this.pos-1,i;do i=this.buffer[++t];while(i===" "||e&&i==="	");const n=t-this.pos;return n>0&&(yield this.buffer.substr(this.pos,n),this.pos=t),n}*pushUntil(e){let t=this.pos,i=this.buffer[t];for(;!e(i);)i=this.buffer[++t];return yield*this.pushToIndex(t,!1)}}class Ol{constructor(){this.lineStarts=[],this.addNewLine=e=>this.lineStarts.push(e),this.linePos=e=>{let t=0,i=this.lineStarts.length;for(;t<i;){const r=t+i>>1;this.lineStarts[r]<e?t=r+1:i=r}if(this.lineStarts[t]===e)return{line:t+1,col:1};if(t===0)return{line:0,col:e};const n=this.lineStarts[t-1];return{line:t,col:e-n+1}}}}function Ut(s,e){for(let t=0;t<s.length;++t)if(s[t].type===e)return!0;return!1}function Fa(s){for(let e=0;e<s.length;++e)switch(s[e].type){case"space":case"comment":case"newline":break;default:return e}return-1}function Al(s){switch(s==null?void 0:s.type){case"alias":case"scalar":case"single-quoted-scalar":case"double-quoted-scalar":case"flow-collection":return!0;default:return!1}}function Rs(s){switch(s.type){case"document":return s.start;case"block-map":{const e=s.items[s.items.length-1];return e.sep??e.start}case"block-seq":return s.items[s.items.length-1].start;default:return[]}}function wi(s){var t;if(s.length===0)return[];let e=s.length;e:for(;--e>=0;)switch(s[e].type){case"doc-start":case"explicit-key-ind":case"map-value-ind":case"seq-item-ind":case"newline":break e}for(;((t=s[++e])==null?void 0:t.type)==="space";);return s.splice(e,s.length)}function xa(s){if(s.start.type==="flow-seq-start")for(const e of s.items)e.sep&&!e.value&&!Ut(e.start,"explicit-key-ind")&&!Ut(e.sep,"map-value-ind")&&(e.key&&(e.value=e.key),delete e.key,Al(e.value)?e.value.end?Array.prototype.push.apply(e.value.end,e.sep):e.value.end=e.sep:Array.prototype.push.apply(e.start,e.sep),delete e.sep)}class zr{constructor(e){this.atNewLine=!0,this.atScalar=!1,this.indent=0,this.offset=0,this.onKeyLine=!1,this.stack=[],this.source="",this.type="",this.lexer=new Pl,this.onNewLine=e}*parse(e,t=!1){this.onNewLine&&this.offset===0&&this.onNewLine(0);for(const i of this.lexer.lex(e,t))yield*this.next(i);t||(yield*this.end())}*next(e){if(this.source=e,this.atScalar){this.atScalar=!1,yield*this.step(),this.offset+=e.length;return}const t=El(e);if(t)if(t==="scalar")this.atNewLine=!1,this.atScalar=!0,this.type="scalar";else{switch(this.type=t,yield*this.step(),t){case"newline":this.atNewLine=!0,this.indent=0,this.onNewLine&&this.onNewLine(this.offset+e.length);break;case"space":this.atNewLine&&e[0]===" "&&(this.indent+=e.length);break;case"explicit-key-ind":case"map-value-ind":case"seq-item-ind":this.atNewLine&&(this.indent+=e.length);break;case"doc-mode":case"flow-error-end":return;default:this.atNewLine=!1}this.offset+=e.length}else{const i=`Not a YAML token: ${e}`;yield*this.pop({type:"error",offset:this.offset,message:i,source:e}),this.offset+=e.length}}*end(){for(;this.stack.length>0;)yield*this.pop()}get sourceToken(){return{type:this.type,offset:this.offset,indent:this.indent,source:this.source}}*step(){const e=this.peek(1);if(this.type==="doc-end"&&(!e||e.type!=="doc-end")){for(;this.stack.length>0;)yield*this.pop();this.stack.push({type:"doc-end",offset:this.offset,source:this.source});return}if(!e)return yield*this.stream();switch(e.type){case"document":return yield*this.document(e);case"alias":case"scalar":case"single-quoted-scalar":case"double-quoted-scalar":return yield*this.scalar(e);case"block-scalar":return yield*this.blockScalar(e);case"block-map":return yield*this.blockMap(e);case"block-seq":return yield*this.blockSequence(e);case"flow-collection":return yield*this.flowCollection(e);case"doc-end":return yield*this.documentEnd(e)}yield*this.pop()}peek(e){return this.stack[this.stack.length-e]}*pop(e){const t=e??this.stack.pop();if(!t)yield{type:"error",offset:this.offset,source:"",message:"Tried to pop an empty stack"};else if(this.stack.length===0)yield t;else{const i=this.peek(1);switch(t.type==="block-scalar"?t.indent="indent"in i?i.indent:0:t.type==="flow-collection"&&i.type==="document"&&(t.indent=0),t.type==="flow-collection"&&xa(t),i.type){case"document":i.value=t;break;case"block-scalar":i.props.push(t);break;case"block-map":{const n=i.items[i.items.length-1];if(n.value){i.items.push({start:[],key:t,sep:[]}),this.onKeyLine=!0;return}else if(n.sep)n.value=t;else{Object.assign(n,{key:t,sep:[]}),this.onKeyLine=!n.explicitKey;return}break}case"block-seq":{const n=i.items[i.items.length-1];n.value?i.items.push({start:[],value:t}):n.value=t;break}case"flow-collection":{const n=i.items[i.items.length-1];!n||n.value?i.items.push({start:[],key:t,sep:[]}):n.sep?n.value=t:Object.assign(n,{key:t,sep:[]});return}default:yield*this.pop(),yield*this.pop(t)}if((i.type==="document"||i.type==="block-map"||i.type==="block-seq")&&(t.type==="block-map"||t.type==="block-seq")){const n=t.items[t.items.length-1];n&&!n.sep&&!n.value&&n.start.length>0&&Fa(n.start)===-1&&(t.indent===0||n.start.every(r=>r.type!=="comment"||r.indent<t.indent))&&(i.type==="document"?i.end=n.start:i.items.push({start:n.start}),t.items.splice(-1,1))}}}*stream(){switch(this.type){case"directive-line":yield{type:"directive",offset:this.offset,source:this.source};return;case"byte-order-mark":case"space":case"comment":case"newline":yield this.sourceToken;return;case"doc-mode":case"doc-start":{const e={type:"document",offset:this.offset,start:[]};this.type==="doc-start"&&e.start.push(this.sourceToken),this.stack.push(e);return}}yield{type:"error",offset:this.offset,message:`Unexpected ${this.type} token in YAML stream`,source:this.source}}*document(e){if(e.value)return yield*this.lineEnd(e);switch(this.type){case"doc-start":{Fa(e.start)!==-1?(yield*this.pop(),yield*this.step()):e.start.push(this.sourceToken);return}case"anchor":case"tag":case"space":case"comment":case"newline":e.start.push(this.sourceToken);return}const t=this.startBlockValue(e);t?this.stack.push(t):yield{type:"error",offset:this.offset,message:`Unexpected ${this.type} token in YAML document`,source:this.source}}*scalar(e){if(this.type==="map-value-ind"){const t=Rs(this.peek(2)),i=wi(t);let n;e.end?(n=e.end,n.push(this.sourceToken),delete e.end):n=[this.sourceToken];const r={type:"block-map",offset:e.offset,indent:e.indent,items:[{start:i,key:e,sep:n}]};this.onKeyLine=!0,this.stack[this.stack.length-1]=r}else yield*this.lineEnd(e)}*blockScalar(e){switch(this.type){case"space":case"comment":case"newline":e.props.push(this.sourceToken);return;case"scalar":if(e.source=this.source,this.atNewLine=!0,this.indent=0,this.onNewLine){let t=this.source.indexOf(`
`)+1;for(;t!==0;)this.onNewLine(this.offset+t),t=this.source.indexOf(`
`,t)+1}yield*this.pop();break;default:yield*this.pop(),yield*this.step()}}*blockMap(e){var i;const t=e.items[e.items.length-1];switch(this.type){case"newline":if(this.onKeyLine=!1,t.value){const n="end"in t.value?t.value.end:void 0,r=Array.isArray(n)?n[n.length-1]:void 0;(r==null?void 0:r.type)==="comment"?n==null||n.push(this.sourceToken):e.items.push({start:[this.sourceToken]})}else t.sep?t.sep.push(this.sourceToken):t.start.push(this.sourceToken);return;case"space":case"comment":if(t.value)e.items.push({start:[this.sourceToken]});else if(t.sep)t.sep.push(this.sourceToken);else{if(this.atIndentedComment(t.start,e.indent)){const n=e.items[e.items.length-2],r=(i=n==null?void 0:n.value)==null?void 0:i.end;if(Array.isArray(r)){Array.prototype.push.apply(r,t.start),r.push(this.sourceToken),e.items.pop();return}}t.start.push(this.sourceToken)}return}if(this.indent>=e.indent){const n=!this.onKeyLine&&this.indent===e.indent,r=n&&(t.sep||t.explicitKey)&&this.type!=="seq-item-ind";let a=[];if(r&&t.sep&&!t.value){const o=[];for(let l=0;l<t.sep.length;++l){const c=t.sep[l];switch(c.type){case"newline":o.push(l);break;case"space":break;case"comment":c.indent>e.indent&&(o.length=0);break;default:o.length=0}}o.length>=2&&(a=t.sep.splice(o[1]))}switch(this.type){case"anchor":case"tag":r||t.value?(a.push(this.sourceToken),e.items.push({start:a}),this.onKeyLine=!0):t.sep?t.sep.push(this.sourceToken):t.start.push(this.sourceToken);return;case"explicit-key-ind":!t.sep&&!t.explicitKey?(t.start.push(this.sourceToken),t.explicitKey=!0):r||t.value?(a.push(this.sourceToken),e.items.push({start:a,explicitKey:!0})):this.stack.push({type:"block-map",offset:this.offset,indent:this.indent,items:[{start:[this.sourceToken],explicitKey:!0}]}),this.onKeyLine=!0;return;case"map-value-ind":if(t.explicitKey)if(t.sep)if(t.value)e.items.push({start:[],key:null,sep:[this.sourceToken]});else if(Ut(t.sep,"map-value-ind"))this.stack.push({type:"block-map",offset:this.offset,indent:this.indent,items:[{start:a,key:null,sep:[this.sourceToken]}]});else if(Al(t.key)&&!Ut(t.sep,"newline")){const o=wi(t.start),l=t.key,c=t.sep;c.push(this.sourceToken),delete t.key,delete t.sep,this.stack.push({type:"block-map",offset:this.offset,indent:this.indent,items:[{start:o,key:l,sep:c}]})}else a.length>0?t.sep=t.sep.concat(a,this.sourceToken):t.sep.push(this.sourceToken);else if(Ut(t.start,"newline"))Object.assign(t,{key:null,sep:[this.sourceToken]});else{const o=wi(t.start);this.stack.push({type:"block-map",offset:this.offset,indent:this.indent,items:[{start:o,key:null,sep:[this.sourceToken]}]})}else t.sep?t.value||r?e.items.push({start:a,key:null,sep:[this.sourceToken]}):Ut(t.sep,"map-value-ind")?this.stack.push({type:"block-map",offset:this.offset,indent:this.indent,items:[{start:[],key:null,sep:[this.sourceToken]}]}):t.sep.push(this.sourceToken):Object.assign(t,{key:null,sep:[this.sourceToken]});this.onKeyLine=!0;return;case"alias":case"scalar":case"single-quoted-scalar":case"double-quoted-scalar":{const o=this.flowScalar(this.type);r||t.value?(e.items.push({start:a,key:o,sep:[]}),this.onKeyLine=!0):t.sep?this.stack.push(o):(Object.assign(t,{key:o,sep:[]}),this.onKeyLine=!0);return}default:{const o=this.startBlockValue(e);if(o){if(o.type==="block-seq"){if(!t.explicitKey&&t.sep&&!Ut(t.sep,"newline")){yield*this.pop({type:"error",offset:this.offset,message:"Unexpected block-seq-ind on same line with key",source:this.source});return}}else n&&e.items.push({start:a});this.stack.push(o);return}}}}yield*this.pop(),yield*this.step()}*blockSequence(e){var i;const t=e.items[e.items.length-1];switch(this.type){case"newline":if(t.value){const n="end"in t.value?t.value.end:void 0,r=Array.isArray(n)?n[n.length-1]:void 0;(r==null?void 0:r.type)==="comment"?n==null||n.push(this.sourceToken):e.items.push({start:[this.sourceToken]})}else t.start.push(this.sourceToken);return;case"space":case"comment":if(t.value)e.items.push({start:[this.sourceToken]});else{if(this.atIndentedComment(t.start,e.indent)){const n=e.items[e.items.length-2],r=(i=n==null?void 0:n.value)==null?void 0:i.end;if(Array.isArray(r)){Array.prototype.push.apply(r,t.start),r.push(this.sourceToken),e.items.pop();return}}t.start.push(this.sourceToken)}return;case"anchor":case"tag":if(t.value||this.indent<=e.indent)break;t.start.push(this.sourceToken);return;case"seq-item-ind":if(this.indent!==e.indent)break;t.value||Ut(t.start,"seq-item-ind")?e.items.push({start:[this.sourceToken]}):t.start.push(this.sourceToken);return}if(this.indent>e.indent){const n=this.startBlockValue(e);if(n){this.stack.push(n);return}}yield*this.pop(),yield*this.step()}*flowCollection(e){const t=e.items[e.items.length-1];if(this.type==="flow-error-end"){let i;do yield*this.pop(),i=this.peek(1);while(i&&i.type==="flow-collection")}else if(e.end.length===0){switch(this.type){case"comma":case"explicit-key-ind":!t||t.sep?e.items.push({start:[this.sourceToken]}):t.start.push(this.sourceToken);return;case"map-value-ind":!t||t.value?e.items.push({start:[],key:null,sep:[this.sourceToken]}):t.sep?t.sep.push(this.sourceToken):Object.assign(t,{key:null,sep:[this.sourceToken]});return;case"space":case"comment":case"newline":case"anchor":case"tag":!t||t.value?e.items.push({start:[this.sourceToken]}):t.sep?t.sep.push(this.sourceToken):t.start.push(this.sourceToken);return;case"alias":case"scalar":case"single-quoted-scalar":case"double-quoted-scalar":{const n=this.flowScalar(this.type);!t||t.value?e.items.push({start:[],key:n,sep:[]}):t.sep?this.stack.push(n):Object.assign(t,{key:n,sep:[]});return}case"flow-map-end":case"flow-seq-end":e.end.push(this.sourceToken);return}const i=this.startBlockValue(e);i?this.stack.push(i):(yield*this.pop(),yield*this.step())}else{const i=this.peek(2);if(i.type==="block-map"&&(this.type==="map-value-ind"&&i.indent===e.indent||this.type==="newline"&&!i.items[i.items.length-1].sep))yield*this.pop(),yield*this.step();else if(this.type==="map-value-ind"&&i.type!=="flow-collection"){const n=Rs(i),r=wi(n);xa(e);const a=e.end.splice(1,e.end.length);a.push(this.sourceToken);const o={type:"block-map",offset:e.offset,indent:e.indent,items:[{start:r,key:e,sep:a}]};this.onKeyLine=!0,this.stack[this.stack.length-1]=o}else yield*this.lineEnd(e)}}flowScalar(e){if(this.onNewLine){let t=this.source.indexOf(`
`)+1;for(;t!==0;)this.onNewLine(this.offset+t),t=this.source.indexOf(`
`,t)+1}return{type:e,offset:this.offset,indent:this.indent,source:this.source}}startBlockValue(e){switch(this.type){case"alias":case"scalar":case"single-quoted-scalar":case"double-quoted-scalar":return this.flowScalar(this.type);case"block-scalar-header":return{type:"block-scalar",offset:this.offset,indent:this.indent,props:[this.sourceToken],source:""};case"flow-map-start":case"flow-seq-start":return{type:"flow-collection",offset:this.offset,indent:this.indent,start:this.sourceToken,items:[],end:[]};case"seq-item-ind":return{type:"block-seq",offset:this.offset,indent:this.indent,items:[{start:[this.sourceToken]}]};case"explicit-key-ind":{this.onKeyLine=!0;const t=Rs(e),i=wi(t);return i.push(this.sourceToken),{type:"block-map",offset:this.offset,indent:this.indent,items:[{start:i,explicitKey:!0}]}}case"map-value-ind":{this.onKeyLine=!0;const t=Rs(e),i=wi(t);return{type:"block-map",offset:this.offset,indent:this.indent,items:[{start:i,key:null,sep:[this.sourceToken]}]}}}return null}atIndentedComment(e,t){return this.type!=="comment"||this.indent<=t?!1:e.every(i=>i.type==="newline"||i.type==="space")}*documentEnd(e){this.type!=="doc-mode"&&(e.end?e.end.push(this.sourceToken):e.end=[this.sourceToken],this.type==="newline"&&(yield*this.pop()))}*lineEnd(e){switch(this.type){case"comma":case"doc-start":case"doc-end":case"flow-seq-end":case"flow-map-end":case"map-value-ind":yield*this.pop(),yield*this.step();break;case"newline":this.onKeyLine=!1;case"space":case"comment":default:e.end?e.end.push(this.sourceToken):e.end=[this.sourceToken],this.type==="newline"&&(yield*this.pop())}}}function Cl(s){const e=s.prettyErrors!==!1;return{lineCounter:s.lineCounter||e&&new Ol||null,prettyErrors:e}}function rp(s,e={}){const{lineCounter:t,prettyErrors:i}=Cl(e),n=new zr(t==null?void 0:t.addNewLine),r=new Vr(e),a=Array.from(r.compose(n.parse(s)));if(i&&t)for(const o of a)o.errors.forEach(cn(s,t)),o.warnings.forEach(cn(s,t));return a.length>0?a:Object.assign([],{empty:!0},r.streamInfo())}function Nl(s,e={}){const{lineCounter:t,prettyErrors:i}=Cl(e),n=new zr(t==null?void 0:t.addNewLine),r=new Vr(e);let a=null;for(const o of r.compose(n.parse(s),!0,s.length))if(!a)a=o;else if(a.options.logLevel!=="silent"){a.errors.push(new oi(o.range.slice(0,2),"MULTIPLE_DOCS","Source contains multiple documents; please use YAML.parseAllDocuments()"));break}return i&&t&&(a.errors.forEach(cn(s,t)),a.warnings.forEach(cn(s,t))),a}function ap(s,e,t){let i;typeof e=="function"?i=e:t===void 0&&e&&typeof e=="object"&&(t=e);const n=Nl(s,t);if(!n)return null;if(n.warnings.forEach(r=>Xo(n.options.logLevel,r)),n.errors.length>0){if(n.options.logLevel!=="silent")throw n.errors[0];n.errors=[]}return n.toJS(Object.assign({reviver:i},t))}function op(s,e,t){let i=null;if(typeof e=="function"||Array.isArray(e)?i=e:t===void 0&&e&&(t=e),typeof t=="string"&&(t=t.length),typeof t=="number"){const n=Math.round(t);t=n<1?void 0:n>8?{indent:8}:{indent:n}}if(s===void 0){const{keepUndefined:n}=t??e??{};if(!n)return}return gi(s)&&!i?s.toString(t):new Yi(s,i,t).toString(t)}const lp=Object.freeze(Object.defineProperty({__proto__:null,Alias:Tn,CST:ip,Composer:Vr,Document:Yi,Lexer:Pl,LineCounter:Ol,Pair:Ce,Parser:zr,Scalar:q,Schema:Nn,YAMLError:Hr,YAMLMap:Ge,YAMLParseError:oi,YAMLSeq:Qt,YAMLWarning:ml,isAlias:ti,isCollection:ye,isDocument:gi,isMap:Vi,isNode:we,isPair:me,isScalar:ce,isSeq:zi,parse:ap,parseAllDocuments:rp,parseDocument:Nl,stringify:op,visit:mi,visitAsync:bn},Symbol.toStringTag,{value:"Module"})),Ll={JsonQuery:"This query is written using JSON. This is deprecated and will be removed in a future version. Please use YAML instead.",GroupParameter:"The 'group' field is deprecated and will be removed in a future version. Please use 'groupBy' instead."};class Be extends Error{constructor(e,t=void 0){super(e),this.inner=t}toString(){return this.inner?`${this.message}: '${this.inner}'`:super.toString()}}function cp(s){let e;const t=[];try{e=up(s),t.push(Ll.JsonQuery)}catch(r){try{e=fp(s)}catch(a){throw new Be("Unable to parse as YAML or JSON",{eJson:r,eYaml:a})}}const[i,n]=dp(e);return t.push(...n),[i,t]}function up(s){try{return JSON.parse(s)}catch(e){throw new Be("Invalid JSON",e)}}function fp(s){try{return lp.parse(s)}catch(e){throw new Be("Invalid YAML",e)}}function dp(s){const e=gp(s,"group")??!1,t=e?Nt.Project:mp(s,"groupBy",kp)??Nt.None,i=[];return e&&i.push(Ll.GroupParameter),[{name:Ma(s,"name")??"",filter:hp("filter",Ma(s,"filter")),autorefresh:pp(s,"autorefresh")??0,sorting:$a(s,"sorting",vp)??[et.Order],show:new Set($a(s,"show",ja)??Object.values(ja)),groupBy:t},i]}function hp(s,e){if(e===void 0)throw new Be(`Field ${s} must be text`);return e}function Ma(s,e){const t=s[e];if(t!==void 0){if(typeof t!="string")throw new Be(`Field ${e} must be text`);return t}}function pp(s,e,t){const i=s[e];if(i===void 0)return;if(typeof i!="number")throw new Be(`Field ${e} must be a number`);const n=i;if(Number.isNaN(n))throw new Be(`Field ${e} must be a number`);if(n<0)throw new Be(`Field ${e} must be a positive number`);return n}function gp(s,e){const t=s[e];if(t!==void 0){if(typeof t!="boolean")throw new Be(`Field ${e} must be a boolean.`);return t}}function $a(s,e,t){const i=s[e];if(i===void 0)return;const n=Object.keys(t).join(", ");if(!Array.isArray(i))throw new Be(`Field ${e} must be an array from values: ${n}`);const r=i,a=[];for(const o of r){if(typeof o!="string")throw new Be(`Field ${e} must be an array from values: ${n}`);const l=t[o];if(l===void 0)throw new Be(`Field ${e} must be an array from values: ${n}`);a.push(l)}return a}function mp(s,e,t){const i=s[e];if(i===void 0)return;const n=Object.keys(t).join(", ");if(typeof i!="string")throw new Be(`Field ${e} must be one of: ${n}`);const r=t[i];if(r===void 0)throw new Be(`Field ${e} must be one of: ${n}`);return r}const vp={priority:et.Priority,priorityAscending:et.PriorityAscending,priorityDescending:et.Priority,date:et.Date,dateAscending:et.Date,dateDescending:et.DateDescending,order:et.Order,dateAdded:et.DateAdded,dateAddedAscending:et.DateAdded,dateAddedDescending:et.DateAddedDescending},ja={due:bi.Due,date:bi.Due,description:bi.Description,labels:bi.Labels,project:bi.Project},kp={project:Nt.Project,section:Nt.Section,priority:Nt.Priority,due:Nt.Date,date:Nt.Date,labels:Nt.Label};class yp{constructor(e){this.plugin=e}onNewBlock(e,t,i){let n;try{const[r,a]=cp(e);n=new Ra(t,this.plugin,Zd,{query:r,warnings:a},!0)}catch(r){log.error(r),n=new Ra(t,this.plugin,Gd,{error:r},!1)}i.addChild(n)}}class Ra extends N.MarkdownRenderChild{constructor(e,t,i,n,r){super(e),this.plugin=t,this.component=i,this.props=n}onload(){const e=this.component;this.root=So(e,{target:this.containerEl,props:this.props})}onunload(){this.root&&Eo(this.root)}}var Dl=(s=>(s.createdTime="",s.scheduled_date="",s.startDate="",s.dueDate="",s.completedTime="",s.cancelled_date="",s))(Dl||{});class wp{parseDates(e){let t=this.getEmptydateHolder();const i="\\[\\s*(\\d{1,2}:\\d{2})(?:\\s*-\\s*(\\d{1,2}:\\d{2}))?\\s*\\]",n=new RegExp(i,"i"),r=e.match(n);let a,o;r&&(a=r[1],o=r[2]);for(const[l,c]of Object.entries(Dl)){let d=this.extractDates(l,e,c);if(d){if((l=="scheduled_date"||l=="startDate")&&a&&!d.hasATime){d.hasATime=!0,d.time=a;const g=`${d.date}T${a}`;d.isoDate=this.formatDateToISO(new Date(g))}if(l=="dueDate"&&!d.hasATime){let g="";if(a&&o?(g=o,d.hasATime=!0):a&&(g=a,d.hasATime=!0),g){d.time=g;const f=`${d.date}T${g}`;d.isoDate=this.formatDateToISO(new Date(f))}}d.hasATime&&(t.isAllDay=!d.hasATime),t[l]=d}}return t}addDatesToLine(e,t){let i=[],n="",r="",a=null;if(t.dateHolder?a=Object.keys(t.dateHolder):(y.warn("No DateHolder found: ",t.dateHolder),t.dateHolder=this.getEmptydateHolder()),a)for(let o=0;o<a.length;o++){const l=a[o];if(l=="isAllDay")continue;const c=t.dateHolder[l];if(c&&c.isoDate){const d=this.buildDateLineComponent(c.isoDate,c.emoji,i);switch(l){case"scheduled_date":case"startDate":n=d;break;case"dueDate":r=d;break}}}else y.error("Date Holder Keys Not found.");if(!t.isAllDay){let o=e.indexOf("]",0);o=o+1,n!=""&&r!=""?e=e.substring(0,o)+" ["+n+" - "+r+"] "+e.substring(o):n!=""?e=e.substring(0,o)+" ["+n+"]"+e.substring(o):r!=""&&(e=e.substring(0,o)+" ["+r+"]"+e.substring(o))}return i&&i.forEach(o=>{e+=" "+o}),e}stripDatesFromLine(e){let t,i=/[]\s(\d{4}-\d{2}-\d{2})(\s\d{1,}:\d{2})?/gus;t=e.replace(i,"");const n=/\[\s*(\d{1,2}:\d{2})(?:\s*-\s*(\d{1,2}:\d{2}))?\s*\]/gus;return t=t.replace(n,""),t}addDateHolderToTask(e,t){let i=this.getEmptydateHolder();"isAllDay"in e?"dueDate"in e&&(i.dueDate=this.getDateAndTime(e.dueDate,e.isAllDay,""),e.dueDate!==e.startDate&&(t?t.dateHolder.scheduled_date?i.scheduled_date=this.getDateAndTime(e.startDate,e.isAllDay,""):i.startDate=this.getDateAndTime(e.startDate,e.isAllDay,""):i.startDate=this.getDateAndTime(e.startDate,e.isAllDay,""))):e.dateHolder=i,e.completedTime&&(i.completedTime=this.getDateAndTime(e.completedTime,!1,"")),t&&(t.dateHolder.cancelled_date&&(i.cancelled_date=t.dateHolder.cancelled_date),t.dateHolder.createdTime&&(i.createdTime=t.dateHolder.createdTime)),e.dateHolder=i}areDatesChanged(e,t){var a,o;const i=e.dateHolder,n=t.dateHolder;if(!i){if(y.error("Edited Task has no dateholder"),n){const l=Object.keys(n);if(l)for(let c=0;c<l.length;c++){const d=l[c];if(d!="isAllDay"&&n[d])return!0}}return!1}if(!n)return y.error("Cached Task has no dateholder"),!0;const r=Object.keys(i);if(r)for(let l=0;l<r.length;l++){const c=r[l];if(c!="isAllDay"){if(i[c]&&!n[c])return!0;if(i[c]){let d=!1;if(i[c].hasATime?d=this.areDatesDifferent(i[c].isoDate,n[c].isoDate):d=((a=i[c])==null?void 0:a.date)!=((o=n[c])==null?void 0:o.date),d)return y.debug("dateChanged",{key:c,newDate:i[c].isoDate,oldDate:n[c].isoDate}),!0}if(!i[c]&&n[c])return!0}}return!1}formatDateToISO(e){return isNaN(e.getTime())?"Invalid Date":new Date(e.getTime()).toISOString().replace(/Z$/,"+0000")}utcToLocal(e){const t=new Date(e),i="en-US",n=Intl.DateTimeFormat().resolvedOptions().timeZone,r=t.toLocaleString(i,{timeZone:n}),[a,o]=r.split(", ");let[l,c,d]=a.split("/");if(l=String(l).padStart(2,"0"),c=String(c).padStart(2,"0"),o){let[g,f]=o.split(":");return r.includes("PM")&&g!=="12"?g=(Number(g)+12).toString():r.includes("AM")&&g==="12"&&(g="00"),g=String(g).padStart(2,"0"),f=String(f).padStart(2,"0"),`${d}-${l}-${c} ${g}:${f}`}return`${d}-${l}-${c}`}cleanDate(e){if(e.includes("+-")){e=e.replace("+-","-");let t=/(.*)([+-])(\d*)/;const i=e.match(t);i&&i[3].length<4&&(e=i[1]+"-0"+i[3])}return new Date(e)}getEmptydateHolder(){return{cancelled_date:null,createdTime:null,completedTime:null,dueDate:null,scheduled_date:null,startDate:null,isAllDay:!0}}getEmptyDate(){return{hasATime:!1,date:null,time:null,isoDate:null,emoji:null}}getDateAndTime(e,t,i){let n=this.getEmptyDate();n.isoDate=this.formatDateToISO(new Date(e));const a=this.utcToLocal(e).split(" ");return n.date=a[0],a[1]?n.time=a[1]:n.time="",n.hasATime=!t,n.emoji=i,n}buildDateLineComponent(e,t,i){let n=this.utcToLocal(e),r="",a=n.split(" "),o=t+" "+a[0];return i.push(o),a[1]&&(r=a[1]),r}extractDates(e,t,i){let n={};const r=`(${i})\\s(\\d{4}-\\d{2}-\\d{2})\\s*(\\d{1,}:\\d{2})*`;let a=t.match(r);if(a){let o=null,l=!1;if(!a[3])o=`${a[2]}T00:00:00.000`,l=!1;else{a[3].includes("24:")&&(a[3]=a[3].replace("24:","00:"));let[c,d]=a[3].split(":");c=String(c).padStart(2,"0"),d=String(d).padStart(2,"0"),o=`${a[2]}T${c}:${d}`,l=!0}o=this.formatDateToISO(new Date(o)),n={hasATime:l,date:a[2],time:a[3],isoDate:o,emoji:a[1]}}else n=null;return n}areDatesDifferent(e,t){const i=this.cleanDate(e),n=this.cleanDate(t);return i.getTime()!==n.getTime()}}class bp extends N.Plugin{constructor(){super(...arguments),this.service=new nc(this),this.taskParser=new gc(this.app,this),this.fileOperation=new Ga(this.app,this),this.cacheOperation=new za(this.app,this),this.dateMan=new wp,this.lastLines=new Map}async onload(){this.app.workspace.onLayoutReady(async()=>{await this.pluginLoad()})}reloadInterval(){this.syncIntervalId&&(window.clearInterval(this.syncIntervalId),this.syncIntervalId=void 0);const e=_().automaticSynchronizationInterval*1e3;e!==0&&(this.syncIntervalId=window.setInterval(this.scheduledSynchronization.bind(this),e))}async onunload(){this.syncIntervalId&&window.clearInterval(this.syncIntervalId),y.debug("TickTickSync unloaded!")}async loadSettings(){try{let e=await this.loadData();try{e=await this.migrateData(e)}catch(i){return y.error("Failed to migrate data:",i),!1}e!=null&&e.TickTickTasksData&&(qa(e.TickTickTasksData.projects),si(e.TickTickTasksData.tasks),Ha(e.TickTickTasksData.projectGroups),delete e.TickTickTasksData);const t=Object.assign({},Ua,e);ge(t)}catch(e){return y.error(`Failed to load data:( ${e})`),!1}return!0}async saveSettings(){try{const e=_();e&&Object.keys(e).length>0?await this.saveData({...e,TickTickTasksData:{projects:Ai(),tasks:ze()}}):y.warn("Settings are empty or invalid, not saving to avoid data loss.")}catch(e){y.error("Error saving settings:",e)}}async initializePlugin(){if(!_().token)return!1;if(!await this.saveProjectsToCache())return this.tickTickRestAPI=void 0,new N.Notice("TickTickSync plugin initialization failed, please check userID and password in settings."),!1;this.initializeModuleClass();try{_().skipBackup||this.service.backup()}catch(t){return y.error("error creating user data folder: ",t),new N.Notice("error creating user data folder"),!1}return new N.Notice("TickTickSync loaded successfully."+_().skipBackup?" Skipping backup.":"TickTick data has been backed up."),!0}initializeModuleClass(){this.tickTickRestAPI||(this.tickTickRestAPI=new rc(this.app,this,null))}async lineNumberCheck(){var o;const e=this.app.workspace.getActiveViewOfType(N.MarkdownView);if(!e)return!1;const t=e==null?void 0:e.editor.getCursor(),i=t==null?void 0:t.line;e.data;const n=(o=e==null?void 0:e.app.workspace.activeEditor)==null?void 0:o.file,r=n==null?void 0:n.name,a=n==null?void 0:n.path;if(typeof this.lastLines>"u"||typeof this.lastLines.get(r)>"u")return this.lastLines.set(r,i),!1;if(this.lastLines.has(r)&&i!==this.lastLines.get(r)){const l=this.lastLines.get(r),c=e.editor.getLine(l);return this.checkModuleClass()?(this.lastLines.set(r,i),await this.service.lineModifiedTaskCheck(a,c,l)):!1}return!1}async checkboxEventhandler(e,t){const i=e.target,n=i.checked;if(i.className==="task-list-item-checkbox"&&t){t.getCursor("from");const a=t.posAtMouse(e).line,o=t.getLine(a);if(this.taskParser.isMarkdownTask(o)){const l=this.taskParser.getTickTickId(o);l?n?await this.service.closeTask(l):await this.service.openTask(l):this.taskParser.getLineItemId(o)&&new N.Notice("Item will be updated on next sync")}}}checkModuleClass(){return _().token?(this.service.initialized||this.service.initialize(),this.tickTickRestAPI===void 0&&this.initializeModuleClass(),!0):(new N.Notice("Please login from settings."),!1)}async setStatusBarText(){var n,r;const e=this.app.workspace.getActiveViewOfType(N.MarkdownView);if(!e||!e.file){(n=this.statusBar)==null||n.setText("");return}const t=e.file.path;let i=await this.cacheOperation.getDefaultProjectNameForFilepath(t);i||(t.startsWith("Inbox")?i="Inbox":i="No default Project"),(r=this.statusBar)==null||r.setText(i)}async scheduledSynchronization(){if(!this.checkModuleClass())return;const e=performance.now();y.debug(`TickTick scheduled synchronization task started at ${new Date().toLocaleString()}`);try{await this.service.synchronization()}catch(i){y.error("An error occurred: ",i),new N.Notice(`An error occurred: ${i}`)}const t=performance.now();y.debug(`TickTick scheduled synchronization task completed at ${new Date().toLocaleString()}, took ${(t-e).toFixed(2)} ms`)}async saveProjectsToCache(){if(!this.checkModuleClass())return!1;let e=!1;const t=performance.now();y.debug(`TickTick saveProjectsToCache started at ${new Date().toLocaleString()}`);try{e=await this.service.saveProjectsToCache()}catch(n){y.error(`An error in saveProjectsToCache occurred:( ${n}`),new N.Notice(`An error in saveProjectsToCache occurred: ${n}`)}const i=performance.now();return y.debug(`TickTick saveProjectsToCache completed at ${new Date().toLocaleString()}, took ${(i-t).toFixed(2)} ms`),e}async pluginLoad(){if(!await this.loadSettings()){new N.Notice("Settings failed to load. Please reload the TickTickSync plugin.");return}y.setLevel(_().logLevel),y.info(`loading plugin "${this.manifest.name}" v${this.manifest.version}`),this.addSettingTab(new Vd(this.app,this));try{await this.initializePlugin()}catch(i){y.error(`API Initialization Failed.( ${i})`)}$o.service.set(this.service);const t=new yp(this);this.registerMarkdownCodeBlockProcessor("ticktick",t.onNewBlock.bind(t)),this.addRibbonIcon("sync","TickTickSync",async i=>{await this.synchronizeNow()}),this.registerEvents(),this.reloadInterval(),this.addCommand({id:"set-default-project-for-TickTick-task-in-the-current-file",name:"Set default TickTick project for current file",editorCallback:(i,n)=>{if(!n||!n.file){new N.Notice("No active file.");return}const r=n.file.path;new mc(this.app,this,r)}}),this.addCommand({id:"tts-sync",name:"Synchronize",callback:async()=>{await this.synchronizeNow()}}),this.statusBar=this.addStatusBarItem()}async synchronizeNow(){await this.scheduledSynchronization(),new N.Notice("Sync completed..")}registerEvents(){this.registerDomEvent(document,"keyup",async t=>{var n;if(!_().token)return;const i=(n=this.app.workspace.activeEditor)==null?void 0:n.editor;if(!(!i||!i.hasFocus())){if(["ArrowUp","ArrowDown","ArrowLeft","ArrowRight","PageUp","PageDown"].includes(t.key)){if(!this.checkModuleClass())return;await this.lineNumberCheck()}if(["Delete","Backspace"].includes(t.key))try{if(!this.checkModuleClass())return;await this.service.deletedTaskCheck(null),await this.saveSettings()}catch(r){y.warn(`An error occurred while deleting tasks: ${r}`)}}}),this.registerDomEvent(document,"click",async t=>{var r;const{target:i}=t;if(!_().token)return;const n=(r=this.app.workspace.activeEditor)==null?void 0:r.editor;this.checkModuleClass()&&(await this.lineNumberCheck(),i&&i.type==="checkbox"&&await this.checkboxEventhandler(t,n))});let e;this.registerEvent(this.app.workspace.on("editor-change",async(t,i)=>{e=setTimeout(async()=>{clearTimeout(e);try{if(!_().token||_().enableFullVaultSync||(await this.lineNumberCheck(),!this.checkModuleClass()))return;await this.service.lineNewContentTaskCheck(t,i),await this.saveSettings()}catch(n){y.error("An error occurred while check new task in line: ",n)}},1e3)})),this.registerEvent(this.app.vault.on("delete",async t=>{if(t instanceof N.TFolder||!_().token)return;await this.service.deletedFileCheck(t.path)&&await this.saveSettings()})),this.registerEvent(this.app.vault.on("rename",async(t,i)=>{if(t instanceof N.TFolder||!_().token)return;await this.service.renamedFileCheck(t.path,i)&&await this.saveSettings()})),this.registerEvent(this.app.vault.on("modify",async t=>{try{if(!_().token)return;const i=t.path,n=this.app.workspace.getActiveFile();if((n==null?void 0:n.path)==i)return;await this.service.fullTextNewTaskCheck(i)}catch(i){y.error("An error occurred while modifying the file: ",i)}})),this.registerEvent(this.app.workspace.on("active-leaf-change",async t=>{await this.setStatusBarText()}))}async migrateData(e){if(!e)return e;const t=[];if(!e.version){const i=e.fileMetadata;if(Array.isArray(i))for(const n in i){const r=i[n];let a={};a={TickTickTasks:r.TickTickTasks.map(o=>({taskId:o,taskItems:[]})),TickTickCount:r.TickTickCount,defaultProjectId:r.defaultProjectId},i[n]=a}_().token&&await this.scheduledSynchronization()}return(!e.version||ii(e.version,"1.0.10"))&&(delete e.username,delete e.password),(!e.version||ii(e.version,"1.0.36"))&&(e.tagAndOr=1,t.push(["New Task Limiting rules","Please update your preferences in settings as needed.","priorTo1.0.36"])),(!e.version||ii(e.version,"1.0.40"))&&t.push(["New Date/Time Handling","Old date formats will be converted on the next synchronization operation.","priorTo1.0.40"]),(!e.version||ii(e.version,"1.1.1"))&&t.push(["Note Synchronization","TickTickSync will now synchronize Notes.","priorTo1.1.1"]),(!e.version||ii(e.version,"1.1.7"))&&t.push(["Note and Default Project Settings","Note and Default Project settings improvements.","priorTo1.1.7"]),(!e.version||ii(e.version,"1.1.8"))&&t.push(["Link to Tasks now Configurable","Link to Tasks are now Configurable.","priorTo1.1.8"]),t.length>0&&await this.LatestChangesModal(t),(!e.version||ii(e.version,this.manifest.version))&&(e.version=this.manifest.version,await this.saveSettings()),e}async LatestChangesModal(e){return await new vc(this.app,e,i=>{this.ret=i}).showModal()}}module.exports=bp;

/* nosourcemap */